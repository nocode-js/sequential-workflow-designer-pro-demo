(()=>{"use strict";var t={946:(t,e,n)=>{n.d(e,{Z:()=>a});var s=n(601),i=n.n(s),o=n(609),r=n.n(o)()(i());r.push([t.id,"\n/* dark > .sqd-icon */\n\n.sqd-theme-dark .sqd-step-icon-circle {\n\tfill: #C6C6C6;\n\tstroke: none;\n\tfilter: drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, .15));\n}\n.sqd-theme-dark .sqd-step-icon-circle.sqd-selected {\n\tstroke: #FFF;\n}\n\n/* dark > .sqd-step-folder */\n\n.sqd-theme-dark .sqd-step-folder-rect {\n\tfill: #FAD876;\n\tstroke: #CAAE5C;\n\tfilter: drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, .15));\n}\n.sqd-theme-dark .sqd-step-folder-rect.sqd-selected {\n\tstroke: #FFF;\n}\n.sqd-theme-dark .sqd-step-folder-tab-rect {\n\tfill: #7C631B;\n}\n.sqd-theme-dark .sqd-step-folder-empty-icon {\n\tfill: #7C631B;\n}\n.sqd-theme-dark .sqd-step-folder-button-text {\n\tfill: #7C631B;\n}\n.sqd-theme-dark .sqd-step-folder-button-rect {\n\tstroke: #7C631B;\n}\n.sqd-theme-dark .sqd-step-folder-button-rect:hover {\n\tstroke: #CAAE5C;\n}\n.sqd-theme-dark .sqd-step-folder-button-icon-path {\n\tfill: #7C631B;\n}\n",""]);const a=r},769:(t,e,n)=>{n.d(e,{Z:()=>a});var s=n(601),i=n.n(s),o=n(609),r=n.n(o)()(i());r.push([t.id,"\n/* light > .sqd-icon */\n\n.sqd-theme-light .sqd-step-icon-circle {\n\tfill: #FFF;\n\tstroke: #C3C3C3;\n\tfilter: drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, .15));\n}\n.sqd-theme-light .sqd-step-icon-circle.sqd-selected {\n\tstroke: #ED4800;\n}\n\n/* light > .sqd-step-folder */\n\n.sqd-theme-light .sqd-step-folder-rect {\n\tfill: #FAD876;\n\tstroke: #CAAE5C;\n\tfilter: drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, .15));\n}\n.sqd-theme-light .sqd-step-folder-rect.sqd-selected {\n\tstroke: #ED4800;\n}\n.sqd-theme-light .sqd-step-folder-tab-rect {\n\tfill: #7C631B;\n}\n.sqd-theme-light .sqd-step-folder-empty-icon {\n\tfill: #7C631B;\n}\n.sqd-theme-light .sqd-step-folder-button-text {\n\tfill: #7C631B;\n}\n.sqd-theme-light .sqd-step-folder-button-rect {\n\tstroke: #7C631B;\n}\n.sqd-theme-light .sqd-step-folder-button-rect:hover {\n\tstroke: #CAAE5C;\n}\n.sqd-theme-light .sqd-step-folder-button-icon-path {\n\tfill: #7C631B;\n}\n",""]);const a=r},279:(t,e,n)=>{n.d(e,{Z:()=>a});var s=n(601),i=n.n(s),o=n(609),r=n.n(o)()(i());r.push([t.id,"\n/* .sqd-step-icon */\n\n.sqd-step-icon-circle {\n\tstroke-width: 1;\n}\n.sqd-step-icon-circle.sqd-selected {\n\tstroke-width: 2;\n}\n\n/* .sqd-step-folder */\n\n.sqd-step-folder-rect {\n\tstroke-width: 1;\n}\n.sqd-step-folder-rect.sqd-selected {\n\tstroke-width: 2;\n}\n.sqd-step-folder-name {\n\ttext-anchor: left;\n\tdominant-baseline: central;\n}\n.sqd-step-folder-button-text {\n\tfont-size: 11px;\n\ttext-anchor: left;\n\tdominant-baseline: central;\n}\n.sqd-step-folder-button-rect {\n\tfill: transparent;\n\tcursor: pointer;\n\tstroke-width: 1;\n}\n",""]);const a=r},21:(t,e,n)=>{n.d(e,{Z:()=>a});var s=n(601),i=n.n(s),o=n(609),r=n.n(o)()(i());r.push([t.id,"\n/********* dark *********/\n\n.sqd-theme-dark.sqd-designer {\n\tbackground: #1F1F1F;\n}\n\n/* dark > .sqd-toolbox */\n\n.sqd-theme-dark .sqd-toolbox {\n\tbackground: #3F3F3F;\n}\n.sqd-theme-dark .sqd-toolbox-header-title {\n\tcolor: #FFF;\n\n}\n.sqd-theme-dark .sqd-toolbox-filter {\n\tborder: 0;\n\tbackground: #242424;\n\tcolor: #FFF;\n}\n.sqd-theme-dark .sqd-toolbox-group-title {\n\tbackground: #242424;\n\tcolor: #FFF;\n}\n.sqd-theme-dark .sqd-toolbox-item {\n\tborder: none;\n\tbackground: #C6C6C6;\n}\n.sqd-theme-dark .sqd-toolbox-item:hover {\n\tbackground: #D3D3D3;\n}\n.sqd-theme-dark .sqd-toolbox-item-icon.sqd-no-icon {\n\tbackground: #C6C6C6;\n}\n.sqd-theme-dark .sqd-control-bar-button.sqd-delete .sqd-icon-path {\n\tfill: #E01A24;\n}\n\n/* dark > .sqd-control-bar */\n\n.sqd-theme-dark .sqd-control-bar {\n\tbackground: #3F3F3F;\n}\n.sqd-theme-dark .sqd-control-bar-button {\n\tbackground: #C6C6C6;\n}\n.sqd-theme-dark .sqd-control-bar-button:hover {\n\tbackground: #D3D3D3;\n}\n\n/* dark > .sqd-path-bar */\n\n.sqd-theme-dark .sqd-path-bar {\n\tbackground: #3F3F3F;\n\tcolor: #FFF;\n}\n.sqd-theme-dark .sqd-path-bar-item:hover {\n\tborder-color: #D3D3D3;\n}\n.sqd-theme-dark .sqd-path-bar-reset-button {\n\tborder: 1px solid transparent;\n}\n.sqd-theme-dark .sqd-path-bar-reset-button .sqd-icon-path {\n\tfill: #FFF;\n}\n.sqd-theme-dark .sqd-path-bar-reset-button:hover {\n\tborder-color: #D3D3D3;\n}\n\n/* dark > .sqd-workspace */\n\n.sqd-theme-dark .sqd-grid-path {\n\tstroke: #2A2A2A;\n}\n.sqd-theme-dark .sqd-join {\n\tstroke: #707070;\n}\n\n/* dark > .sqd-smart-editor */\n\n.sqd-theme-dark .sqd-smart-editor {\n\tbackground: #3F3F3F;\n}\n.sqd-theme-dark .sqd-smart-editor-toggle {\n\tbackground: #6F6F6F;\n}\n\n/* dark > .sqd-step-task */\n\n.sqd-theme-dark .sqd-step-task-rect {\n\tfill: #C6C6C6;\n\tstroke: none;\n\tfilter: drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, .15));\n}\n.sqd-theme-dark .sqd-step-task-rect.sqd-selected {\n\tstroke: #FFF;\n}\n.sqd-theme-dark .sqd-step-task-text {\n\tfill: #000;\n}\n.sqd-theme-dark .sqd-step-task-empty-icon {\n\tfill: #C6C6C6;\n}\n\n/* dark > .sqd-input + .sqd-output */\n\n.sqd-theme-dark .sqd-input {\n\tfill: #C6C6C6;\n\tstroke: #707070;\n}\n\n.sqd-theme-dark .sqd-output {\n\tfill: #707070;\n}\n\n/* dark > .sqd-region */\n\n.sqd-theme-dark .sqd-region {\n\tstroke: #434343;\n}\n.sqd-theme-dark .sqd-region.sqd-selected {\n\tstroke: #FFF;\n}\n.sqd-theme-dark .sqd-label-rect {\n\tfill: #2411DB;\n}\n.sqd-theme-dark .sqd-label-rect.sqd-label-secondary {\n\tfill: #0E0E0E;\n}\n.sqd-theme-dark .sqd-label-text {\n\tfill: #FFF;\n}\n\n/* dark > .sqd-step-start-stop */\n\n.sqd-theme-dark .sqd-step-start-stop-circle {\n\tfill: #2C18DF;\n}\n.sqd-theme-dark .sqd-step-start-stop-icon {\n\tfill: #FFF;\n}\n\n/* dark > .sqd-placeholder */\n\n.sqd-theme-dark .sqd-placeholder .sqd-placeholder-rect {\n\tfill: #0E0E0E;\n\tstroke: #6A6A6A;\n}\n.sqd-theme-dark .sqd-placeholder-icon-path {\n\tfill: #FFF;\n}\n.sqd-theme-dark .sqd-placeholder.sqd-hover .sqd-placeholder-rect {\n\tfill: #ED4800;\n}\n.sqd-theme-dark .sqd-placeholder.sqd-hover .sqd-placeholder-icon-path {\n\tfill: #FFF;\n}\n\n/* dark > .sqd-validation-error */\n\n.sqd-theme-dark .sqd-validation-error {\n\tfill: #FFA200;\n}\n",""]);const a=r},929:(t,e,n)=>{n.d(e,{Z:()=>a});var s=n(601),i=n.n(s),o=n(609),r=n.n(o)()(i());r.push([t.id,"\n/********* light *********/\n\n.sqd-theme-light.sqd-designer {\n\tbackground: #F9F9F9;\n}\n\n/* light > .sqd-toolbox */\n\n.sqd-theme-light .sqd-toolbox {\n\tbackground: #FFF;\n\tbox-shadow: 0 0 8px rgba(0, 0, 0, .15), 0 2px 4px rgba(0, 0, 0, .15);\n}\n.sqd-theme-light .sqd-toolbox-filter {\n\tborder: 1px solid #C3C3C3;\n}\n.sqd-theme-light .sqd-toolbox-filter:focus {\n\tborder-color: #939393;\n}\n.sqd-theme-light .sqd-toolbox-group-title {\n\tbackground: #E5E5E5;\n}\n.sqd-theme-light .sqd-toolbox-item {\n\tborder: 1px solid #C3C3C3;\n\tbox-shadow: 0 2px 2px rgba(0, 0, 0, .15);\n}\n.sqd-theme-light .sqd-toolbox-item:hover {\n\tborder: 1px solid #939393;\n}\n.sqd-theme-light .sqd-toolbox-item-icon.sqd-no-icon {\n\tbackground: #C6C6C6;\n}\n\n/* light > .sqd-control-bar */\n\n.sqd-theme-light .sqd-control-bar {\n\tbackground: #FFF;\n\tbox-shadow: 0 0 8px rgba(0, 0, 0, .15), 0 2px 4px rgba(0, 0, 0, .15);\n}\n.sqd-theme-light .sqd-control-bar-button {\n\tborder: 1px solid #C3C3C3;\n}\n.sqd-theme-light .sqd-control-bar-button:hover {\n\tborder-color: #939393;\n}\n.sqd-theme-light .sqd-control-bar-button.sqd-delete .sqd-icon-path {\n\tfill: #E01A24;\n}\n\n/* light > .sqd-path-bar */\n\n.sqd-theme-light .sqd-path-bar {\n\tbackground: #FFF;\n\tbox-shadow: 0 0 8px rgba(0, 0, 0, .15), 0 2px 4px rgba(0, 0, 0, .15);\n}\n.sqd-theme-light .sqd-path-bar-item:hover {\n\tborder-color: #939393;\n}\n.sqd-theme-light .sqd-path-bar-separator {\n\tcolor: #D0D0D0;\n}\n.sqd-theme-light .sqd-path-bar-reset-button {\n\tborder: 1px solid transparent;\n}\n.sqd-theme-light .sqd-path-bar-reset-button:hover {\n\tborder-color: #939393;\n}\n\n/* light > .sqd-workspace */\n\n.sqd-theme-light .sqd-grid-path {\n\tstroke: #E3E3E3;\n}\n.sqd-theme-light .sqd-join {\n\tstroke: #000;\n}\n\n/* light > .sqd-smart-editor */\n\n.sqd-theme-light .sqd-smart-editor {\n\tbackground: #FFF;\n\tbox-shadow: 0 0 8px rgba(0, 0, 0, .15);\n}\n.sqd-theme-light .sqd-smart-editor-toggle {\n\tbackground: #FFF;\n\tbox-shadow: 0 0 8px rgba(0, 0, 0, .15);\n}\n\n/* light > .sqd-step-task */\n\n.sqd-theme-light .sqd-step-task-rect {\n\tfill: #FFF;\n\tstroke: #C3C3C3;\n\tfilter: drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, .15));\n}\n.sqd-theme-light .sqd-step-task-rect.sqd-selected {\n\tstroke: #ED4800;\n}\n.sqd-theme-light .sqd-step-task-text {\n\tfill: #000;\n}\n.sqd-theme-light .sqd-step-task-empty-icon {\n\tfill: #C6C6C6;\n}\n\n/* light > .sqd-input + .sqd-output */\n\n.sqd-theme-light .sqd-input {\n\tfill: #FFF;\n\tstroke: #000;\n}\n\n.sqd-theme-light .sqd-output {\n\tfill: #000;\n}\n\n/* light > .sqd-region */\n\n.sqd-theme-light .sqd-region {\n\tstroke: #CECECE;\n}\n.sqd-theme-light .sqd-region.sqd-selected {\n\tstroke: #ED4800;\n}\n.sqd-theme-light .sqd-label-rect {\n\tfill: #2411DB;\n}\n.sqd-theme-light .sqd-label-rect.sqd-label-secondary {\n\tfill: #000;\n}\n.sqd-theme-light .sqd-label-text {\n\tfill: #FFF;\n}\n\n/* light > .sqd-step-start-stop */\n\n.sqd-theme-light .sqd-step-start-stop-circle {\n\tfill: #2C18DF;\n}\n.sqd-theme-light .sqd-step-start-stop-icon {\n\tfill: #FFF;\n}\n\n/* light > .sqd-placeholder */\n\n.sqd-theme-light .sqd-placeholder .sqd-placeholder-rect {\n\tfill: #D8D8D8;\n\tstroke: #6A6A6A;\n}\n.sqd-theme-light .sqd-placeholder-icon-path {\n\tfill: #2B2B2B;\n}\n.sqd-theme-light .sqd-placeholder.sqd-hover .sqd-placeholder-rect {\n\tfill: #ED4800;\n}\n.sqd-theme-light .sqd-placeholder.sqd-hover .sqd-placeholder-icon-path {\n\tfill: #FFF;\n}\n\n/* light > .sqd-validation-error */\n\n.sqd-theme-light .sqd-validation-error {\n\tfill: #FFA200;\n}\n",""]);const a=r},446:(t,e,n)=>{n.d(e,{Z:()=>a});var s=n(601),i=n.n(s),o=n(609),r=n.n(o)()(i());r.push([t.id,"\n.sqd-designer {\n\tposition: relative;\n\tdisplay: flex;\n\twidth: 100%;\n\theight: 100%;\n}\n.sqd-designer, .sqd-drag {\n\tfont-size: 13px;\n\tline-height: 1em;\n}\n.sqd-hidden {\n\tdisplay: none !important;\n}\n.sqd-disabled {\n\topacity: 0.25;\n}\n\n/* .sqd-toolbox */\n\n.sqd-toolbox, .sqd-toolbox-filter {\n\tfont-size: 11px;\n\tline-height: 1.2em;\n}\n.sqd-toolbox {\n\tposition: absolute;\n\ttop: 10px;\n\tleft: 10px;\n\tz-index: 20;\n\tbox-sizing: border-box;\n\tborder-radius: 10px;\n\twidth: 130px;\n\tuser-select: none;\n}\n.sqd-toolbox-header {\n\tposition: relative;\n\tpadding: 15px 10px;\n\tcursor: pointer;\n}\n.sqd-toolbox-header-title {\n\tdisplay: block;\n\tfont-size: 1.2em;\n\tline-height: 1em;\n\tfont-weight: bold;\n}\n.sqd-toolbox-toggle-icon {\n\tposition: absolute;\n\ttop: 50%;\n\tright: 10px;\n\twidth: 16px;\n\theight: 16px;\n\tmargin: -8px 0 0;\n}\n.sqd-toolbox-header:hover .sqd-toolbox-toggle-icon {\n\topacity: .6;\n}\n.sqd-scrollbox {\n\tposition: relative;\n\toverflow: hidden;\n}\n.sqd-scrollbox-body {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n}\n.sqd-toolbox-filter {\n\tdisplay: block;\n\tbox-sizing: border-box;\n\tpadding: 6px 8px;\n\toutline: none;\n\twidth: 110px;\n\tmargin: 0 10px 10px;\n\tbox-sizing: border-box;\n\tborder-radius: 10px;\n}\n.sqd-toolbox-group-title {\n\ttext-align: center;\n\tpadding: 5px 0;\n\tmargin: 0 10px 10px;\n\tborder-radius: 10px;\n}\n.sqd-toolbox-item {\n\tposition: relative;\n\tborder-radius: 5px;\n\tbox-sizing: border-box;\n\tmargin: 0 10px 10px;\n\twidth: 110px;\n\tcursor: move;\n}\n.sqd-toolbox-item-icon {\n\tposition: absolute;\n\ttop: 50%;\n\tleft: 5px;\n\tmargin-top: -10px;\n\twidth: 20px;\n\theight: 20px;\n}\n.sqd-toolbox-item-icon.sqd-no-icon {\n\tborder-radius: 4px;\n}\n.sqd-toolbox-item-icon-image {\n\twidth: 100%;\n\theight: 100%;\n}\n.sqd-toolbox-item-text {\n\tposition: relative;\n\tdisplay: block;\n\tpadding: 10px 10px 10px 30px;\n\twhite-space: nowrap;\n\ttext-overflow: ellipsis;\n\toverflow: hidden;\n}\n\n.sqd-drag {\n\tposition: absolute;\n\tz-index: 9999999;\n\tpointer-events: none;\n}\n\n/* .sqd-control-bar */\n\n.sqd-control-bar {\n\tposition: absolute;\n\tbottom: 10px;\n\tleft: 10px;\n\tz-index: 20;\n\tpadding: 8px 0 8px 8px;\n\tborder-radius: 10px;\n\twhite-space: nowrap;\n}\n.sqd-control-bar-button {\n\tdisplay: inline-block;\n\twidth: 30px;\n\theight: 30px;\n\tborder-radius: 5px;\n\tmargin-right: 8px;\n\tcursor: pointer;\n}\n.sqd-control-bar-button-icon {\n\twidth: 24px;\n\theight: 24px;\n\tmargin: 3px 0 0 3px;\n}\n.sqd-control-bar-button.sqd-disabled .sqd-control-bar-button-icon {\n\topacity: .2;\n}\n\n/* .sqd-path-bar */\n\n.sqd-path-bar {\n\tposition: absolute;\n\tbottom: 68px;\n\tpadding: 4px;\n\tleft: 10px;\n\tz-index: 20;\n\tborder-radius: 10px;\n}\n.sqd-path-bar-reset-button {\n\tdisplay: inline-block;\n\tvertical-align: middle;\n\twidth: 26px;\n\theight: 26px;\n\tborder-radius: 5px;\n\tcursor: pointer;\n}\n.sqd-path-bar-reset-button-icon {\n\twidth: 20px;\n\theight: 20px;\n\tmargin: 3px 0 0 3px;\n}\n.sqd-path-bar-items {\n\tmargin-left: 2px;\n\tdisplay: inline-block;\n\tvertical-align: middle;\n}\n.sqd-path-bar-item {\n\tdisplay: inline-block;\n\tpadding: 6px;\n\tborder-radius: 5px;\n\tcursor: pointer;\n\tborder: 1px solid transparent;\n}\n.sqd-path-bar-separator {\n\tdisplay: inline-block;\n\tpadding: 0 2px;\n}\n\n/* .sqd-workspace */\n\n.sqd-workspace {\n\tflex: 1;\n\tposition: relative;\n\tdisplay: block;\n\tuser-select: none;\n}\n.sqd-workspace-canvas {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tcursor: move;\n}\n.sqd-grid-path {\n\tstroke-width: 1;\n}\n.sqd-join {\n\tstroke-width: 2;\n}\n\n/* .sqd-smart-editor */\n\n.sqd-smart-editor-toggle {\n\tposition: absolute;\n\ttop: 0;\n\tz-index: 29;\n\twidth: 36px;\n\theight: 64px;\n\tborder-bottom-left-radius: 10px;\n\tcursor: pointer;\n}\n.sqd-smart-editor-toggle-icon {\n\tposition: absolute;\n\ttop: 50%;\n\tleft: 50%;\n\twidth: 24px;\n\theight: 24px;\n\tmargin: -12px 0 0 -12px;\n}\n.sqd-smart-editor-toggle:hover .sqd-smart-editor-toggle-icon {\n\topacity: .6;\n}\n.sqd-smart-editor {\n\tz-index: 30;\n}\n.sqd-layout-desktop .sqd-smart-editor {\n\tposition: relative;\n\twidth: 300px;\n}\n.sqd-layout-desktop .sqd-smart-editor-toggle {\n\tright: 300px;\n}\n.sqd-layout-desktop .sqd-smart-editor-toggle.sqd-collapsed {\n\tright: 0;\n}\n.sqd-layout-mobile .sqd-smart-editor {\n\tposition: absolute;\n\ttop: 0;\n\tright: 0;\n\tbottom: 0;\n\tleft: 41px;\n}\n.sqd-layout-mobile .sqd-smart-editor-toggle {\n\tleft: 5px;\n}\n.sqd-layout-mobile .sqd-smart-editor-toggle.sqd-collapsed {\n\tleft: auto;\n\tright: 0;\n}\n\n/* .sqd-step-task */\n\n.sqd-step-task-rect {\n\tstroke-width: 1;\n}\n.sqd-step-task-rect.sqd-selected {\n\tstroke-width: 2;\n}\n.sqd-step-task-text {\n\ttext-anchor: left;\n\tdominant-baseline: central;\n}\n\n/* .sqd-input + .sqd-output */\n\n.sqd-input {\n\tstroke-width: 2;\n}\n\n/* .sqd-region */\n\n.sqd-region {\n\tstroke-width: 2;\n\tstroke-dasharray: 3;\n}\n.sqd-region.sqd-selected {\n\tstroke-width: 2;\n\tstroke-dasharray: 0;\n}\n.sqd-label-text {\n\ttext-anchor: middle;\n\tdominant-baseline: central;\n}\n\n/* .sqd-placeholder */\n\n.sqd-placeholder .sqd-placeholder-rect {\n\tstroke-width: 1;\n\tstroke-dasharray: 3;\n}\n",""]);const a=r},609:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",s=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),s&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),s&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,s,i,o){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(s)for(var a=0;a<this.length;a++){var d=this[a][0];null!=d&&(r[d]=!0)}for(var l=0;l<t.length;l++){var h=[].concat(t[l]);s&&r[h[0]]||(void 0!==o&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=o),n&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=n):h[2]=n),i&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=i):h[4]="".concat(i)),e.push(h))}},e}},601:t=>{t.exports=function(t){return t[1]}},62:t=>{var e=[];function n(t){for(var n=-1,s=0;s<e.length;s++)if(e[s].identifier===t){n=s;break}return n}function s(t,s){for(var o={},r=[],a=0;a<t.length;a++){var d=t[a],l=s.base?d[0]+s.base:d[0],h=o[l]||0,c="".concat(l," ").concat(h);o[l]=h+1;var p=n(c),u={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(-1!==p)e[p].references++,e[p].updater(u);else{var g=i(u,s);s.byIndex=a,e.splice(a,0,{identifier:c,updater:g,references:1})}r.push(c)}return r}function i(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,i){var o=s(t=t||[],i=i||{});return function(t){t=t||[];for(var r=0;r<o.length;r++){var a=n(o[r]);e[a].references--}for(var d=s(t,i),l=0;l<o.length;l++){var h=n(o[l]);0===e[h].references&&(e[h].updater(),e.splice(h,1))}o=d}}},793:t=>{var e={};t.exports=function(t,n){var s=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(n)}},173:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},892:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},36:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var s="";n.supports&&(s+="@supports (".concat(n.supports,") {")),n.media&&(s+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(s+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),s+=n.css,i&&(s+="}"),n.media&&(s+="}"),n.supports&&(s+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(s,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},464:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(s){var i=e[s];if(void 0!==i)return i.exports;var o=e[s]={id:s,exports:{}};return t[s](o,o.exports,n),o.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0,(()=>{class t{static svg(e,n){const s=document.createElementNS("http://www.w3.org/2000/svg",e);return n&&t.attrs(s,n),s}static translate(t,e,n){t.setAttribute("transform",`translate(${e}, ${n})`)}static attrs(t,e){Object.keys(e).forEach((n=>{const s=e[n];t.setAttribute(n,"string"==typeof s?s:s.toString())}))}static element(e,n){const s=document.createElement(e);return n&&t.attrs(s,n),s}static toggleClass(t,e,n){e?t.classList.add(n):t.classList.remove(n)}}class e{constructor(t,e){this.x=t,this.y=e}add(t){return new e(this.x+t.x,this.y+t.y)}subtract(t){return new e(this.x-t.x,this.y-t.y)}multiplyByScalar(t){return new e(this.x*t,this.y*t)}divideByScalar(t){return new e(this.x/t,this.y/t)}round(){return new e(Math.round(this.x),Math.round(this.y))}distance(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}}class s{static next(){const t=new Uint8Array(16);return window.crypto.getRandomValues(t),Array.from(t,(t=>t.toString(16).padStart(2,"0"))).join("")}}class i{static appendPath(e,n,s,i){const o=t.svg("g"),r=i/48,a=t.svg("path",{d:s,class:n,transform:`scale(${r})`});return o.appendChild(a),e.appendChild(o),o}static createSvg(e,n){const s=t.svg("svg",{class:e,viewBox:"0 0 48 48"}),i=t.svg("path",{d:n,class:"sqd-icon-path"});return s.appendChild(i),s}}i.dirIn="M42.05 42.25H11.996v-7.12h17.388L6 11.746 11.546 6.2 34.93 29.584V12.196h7.12V42.25z",i.dirOut="M6 6.2h30.054v7.12H18.666L42.05 36.704l-5.546 5.546L13.12 18.866v17.388H6V6.2z",i.center="M9 42q-1.2 0-2.1-.9Q6 40.2 6 39v-8.6h3V39h8.6v3Zm21.4 0v-3H39v-8.6h3V39q0 1.2-.9 2.1-.9.9-2.1.9ZM24 31.15q-3.15 0-5.15-2-2-2-2-5.15 0-3.15 2-5.15 2-2 5.15-2 3.15 0 5.15 2 2 2 2 5.15 0 3.15-2 5.15-2 2-5.15 2ZM6 17.6V9q0-1.2.9-2.1Q7.8 6 9 6h8.6v3H9v8.6Zm33 0V9h-8.6V6H39q1.2 0 2.1.9.9.9.9 2.1v8.6Z",i.zoomIn="M39.8 41.95 26.65 28.8q-1.5 1.3-3.5 2.025-2 .725-4.25.725-5.4 0-9.15-3.75T6 18.75q0-5.3 3.75-9.05 3.75-3.75 9.1-3.75 5.3 0 9.025 3.75 3.725 3.75 3.725 9.05 0 2.15-.7 4.15-.7 2-2.1 3.75L42 39.75Zm-20.95-13.4q4.05 0 6.9-2.875Q28.6 22.8 28.6 18.75t-2.85-6.925Q22.9 8.95 18.85 8.95q-4.1 0-6.975 2.875T9 18.75q0 4.05 2.875 6.925t6.975 2.875ZM17.3 24.3v-4.1h-4.1v-3h4.1v-4.05h3v4.05h4.05v3H20.3v4.1Z",i.zoomOut="M39.8 41.95 26.65 28.8q-1.5 1.3-3.5 2.025-2 .725-4.25.725-5.4 0-9.15-3.75T6 18.75q0-5.3 3.75-9.05 3.75-3.75 9.1-3.75 5.3 0 9.025 3.75 3.725 3.75 3.725 9.05 0 2.15-.7 4.15-.7 2-2.1 3.75L42 39.75Zm-20.95-13.4q4.05 0 6.9-2.875Q28.6 22.8 28.6 18.75t-2.85-6.925Q22.9 8.95 18.85 8.95q-4.1 0-6.975 2.875T9 18.75q0 4.05 2.875 6.925t6.975 2.875Zm-5.1-8.35v-3H23.8v3Z",i.undo="M14 38v-3h14.45q3.5 0 6.025-2.325Q37 30.35 37 26.9t-2.525-5.775Q31.95 18.8 28.45 18.8H13.7l5.7 5.7-2.1 2.1L8 17.3 17.3 8l2.1 2.1-5.7 5.7h14.7q4.75 0 8.175 3.2Q40 22.2 40 26.9t-3.425 7.9Q33.15 38 28.4 38Z",i.redo="M19.6 38q-4.75 0-8.175-3.2Q8 31.6 8 26.9t3.425-7.9q3.425-3.2 8.175-3.2h14.7l-5.7-5.7L30.7 8l9.3 9.3-9.3 9.3-2.1-2.1 5.7-5.7H19.55q-3.5 0-6.025 2.325Q11 23.45 11 26.9t2.525 5.775Q16.05 35 19.55 35H34v3Z",i.move="m24 44-8.15-8.15 2.2-2.2 4.45 4.45v-9.45h3v9.45l4.45-4.45 2.2 2.2ZM11.9 31.9 4 24l7.95-7.95 2.2 2.2L9.9 22.5h9.45v3H9.9l4.2 4.2Zm24.2 0-2.2-2.2 4.2-4.2h-9.4v-3h9.4l-4.2-4.2 2.2-2.2L44 24ZM22.5 19.3V9.9l-4.2 4.2-2.2-2.2L24 4l7.9 7.9-2.2 2.2-4.2-4.2v9.4Z",i.delete="m16.5 33.6 7.5-7.5 7.5 7.5 2.1-2.1-7.5-7.5 7.5-7.5-2.1-2.1-7.5 7.5-7.5-7.5-2.1 2.1 7.5 7.5-7.5 7.5ZM24 44q-4.1 0-7.75-1.575-3.65-1.575-6.375-4.3-2.725-2.725-4.3-6.375Q4 28.1 4 24q0-4.15 1.575-7.8 1.575-3.65 4.3-6.35 2.725-2.7 6.375-4.275Q19.9 4 24 4q4.15 0 7.8 1.575 3.65 1.575 6.35 4.275 2.7 2.7 4.275 6.35Q44 19.85 44 24q0 4.1-1.575 7.75-1.575 3.65-4.275 6.375t-6.35 4.3Q28.15 44 24 44Z",i.folderUp="M22.5 34h3V23.75l3.7 3.7 2.1-2.1-7.3-7.3-7.3 7.3 2.1 2.1 3.7-3.7ZM7.05 40q-1.2 0-2.1-.925-.9-.925-.9-2.075V11q0-1.15.9-2.075Q5.85 8 7.05 8h14l3 3h17q1.15 0 2.075.925.925.925.925 2.075v23q0 1.15-.925 2.075Q42.2 40 41.05 40Zm0-29v26h34V14H22.8l-3-3H7.05Zm0 0v26Z",i.close="m12.45 37.65-2.1-2.1L21.9 24 10.35 12.45l2.1-2.1L24 21.9l11.55-11.55 2.1 2.1L26.1 24l11.55 11.55-2.1 2.1L24 26.1Z",i.options="m19.4 44-1-6.3q-.95-.35-2-.95t-1.85-1.25l-5.9 2.7L4 30l5.4-3.95q-.1-.45-.125-1.025Q9.25 24.45 9.25 24q0-.45.025-1.025T9.4 21.95L4 18l4.65-8.2 5.9 2.7q.8-.65 1.85-1.25t2-.9l1-6.35h9.2l1 6.3q.95.35 2.025.925Q32.7 11.8 33.45 12.5l5.9-2.7L44 18l-5.4 3.85q.1.5.125 1.075.025.575.025 1.075t-.025 1.05q-.025.55-.125 1.05L44 30l-4.65 8.2-5.9-2.7q-.8.65-1.825 1.275-1.025.625-2.025.925l-1 6.3ZM24 30.5q2.7 0 4.6-1.9 1.9-1.9 1.9-4.6 0-2.7-1.9-4.6-1.9-1.9-4.6-1.9-2.7 0-4.6 1.9-1.9 1.9-1.9 4.6 0 2.7 1.9 4.6 1.9 1.9 4.6 1.9Z",i.expand="m24 30.75-12-12 2.15-2.15L24 26.5l9.85-9.85L36 18.8Z";class o{static createRectInput(e,n,s,i){const r=t.svg("g");e.appendChild(r);const a=t.svg("rect",{class:"sqd-input",width:18,height:18,x:n-9,y:s+-9+.5,rx:4,ry:4});if(r.appendChild(a),i){const e=t.svg("image",{href:i,width:14,height:14,x:n-7,y:s+-7});r.appendChild(e)}return new o(r)}static createRoundInput(e,n,s){const i=t.svg("circle",{class:"sqd-input",cx:n,xy:s,r:7});return e.appendChild(i),new o(i)}constructor(t){this.root=t}setIsHidden(e){t.attrs(this.root,{visibility:e?"hidden":"visible"})}}class r{static createStraightJoin(e,n,s){const i=t.svg("line",{class:"sqd-join",x1:n.x,y1:n.y,x2:n.x,y2:n.y+s});e.insertBefore(i,e.firstChild)}static createJoins(t,e,n){const s=n[0],i=Math.abs(s.y-e.y)/2,o=Math.sign(s.y-e.y);switch(n.length){case 1:e.x===n[0].x?r.createStraightJoin(t,e,s.y*o):a(t,e,n,i,o);break;case 2:a(t,e,n,i,o);break;default:{const s=n[0],a=n[n.length-1];d(t,`M ${s.x} ${s.y} q ${.3*i} ${i*-o*.8} ${i} ${i*-o} l ${a.x-s.x-2*i} 0 q ${.8*i} ${-i*-o*.3} ${i} ${-i*-o}`);for(let e=1;e<n.length-1;e++)r.createStraightJoin(t,n[e],i*-o);r.createStraightJoin(t,e,i*o)}}}}function a(t,e,n,s,i){for(const o of n){const n=Math.abs(o.x-e.x)-2*s,r=Math.sign(o.x-e.x);d(t,`M ${e.x} ${e.y} q ${r*s*.3} ${i*s*.8} ${r*s} ${i*s} l ${r*n} 0 q ${r*s*.7} ${i*s*.2} ${r*s} ${i*s}`)}}function d(e,n){const s=t.svg("path",{class:"sqd-join",fill:"none",d:n});e.insertBefore(s,e.firstChild)}class l{static create(e,n,s,i){const o=t.svg("g",{class:"sqd-label"});e.appendChild(o);const r=t.svg("text",{class:"sqd-label-text",y:n+11});r.textContent=s,o.appendChild(r);const a=Math.max(r.getBBox().width+20,50),d=t.svg("rect",{class:`sqd-label-rect sqd-label-${i}`,width:a,height:22,x:-a/2,y:n,rx:10,ry:10});return o.insertBefore(d,r),new l(o,a,22)}constructor(t,e,n){this.g=t,this.width=e,this.height=n}}class h{static create(e,n,s){const i=t.svg("circle",{class:"sqd-output",cx:n,cy:s,r:5});return e.appendChild(i),new h(i)}constructor(t){this.root=t}setIsHidden(e){t.attrs(this.root,{visibility:e?"hidden":"visible"})}}class c{static create(t,e,n){const s=e.reduce(((t,e)=>t+e),0),i=[p(t,0,0,s,0),p(t,0,0,0,n),p(t,0,n,s,n),p(t,s,0,s,n)];let o=e[0];for(let s=1;s<e.length;s++)i.push(p(t,o,0,o,n)),o+=e[s];return new c(i,s,n)}constructor(t,e,n){this.lines=t,this.width=e,this.height=n}getClientPosition(){const t=this.lines[0].getBoundingClientRect();return new e(t.x,t.y)}resolveClick(t){const e=this.getClientPosition(),n=t.position.subtract(e);return n.x>=0&&n.y>=0&&n.x<this.width*t.scale&&n.y<this.height*t.scale}setIsSelected(e){this.lines.forEach((n=>{t.toggleClass(n,e,"sqd-selected")}))}}function p(e,n,s,i,o){const r=t.svg("line",{class:"sqd-region",x1:n,y1:s,x2:i,y2:o});return e.insertBefore(r,e.firstChild),r}class u{static create(e,n,s){const i=t.svg("g",{class:"sqd-hidden"});t.translate(i,n,s);const o=t.svg("path",{class:"sqd-validation-error",d:"M 0 -10 l 10 20 l -20 0 Z"});return i.appendChild(o),e.appendChild(i),new u(i)}constructor(t){this.g=t}setIsHidden(e){t.toggleClass(this.g,e,"sqd-hidden")}}class g{constructor(t,e,n){this.view=t,this.parentSequence=e,this.index=n}getRect(){return this.view.rect.getBoundingClientRect()}setIsHover(t){this.view.setIsHover(t)}}var v;!function(t){t[t.in=1]="in",t[t.out=2]="out"}(v||(v={}));class m{static create(e,n,s,o,r,a){const d=t.svg("g",{visibility:"hidden",class:"sqd-placeholder"});t.translate(d,n,s),e.appendChild(d);const l=t.svg("rect",{class:"sqd-placeholder-rect",width:o,height:r,rx:6,ry:6});if(d.appendChild(l),a){const e=a===v.in?i.dirIn:i.dirOut,n=i.appendPath(d,"sqd-placeholder-icon-path",e,16);t.translate(n,(o-16)/2,(r-16)/2)}return e.appendChild(d),new m(l,d)}constructor(t,e){this.rect=t,this.g=e}setIsHover(e){t.toggleClass(this.g,e,"sqd-hover")}setIsVisible(e){t.attrs(this.g,{visibility:e?"visible":"hidden"})}}const w=24;class f{static create(n,s,i){const o=t.svg("g");n.appendChild(o);const a=s.map((t=>i.stepComponentFactory.create(o,t,s,i))),d=a.length>0?Math.max(...a.map((t=>t.view.joinX))):50,l=a.length>0?Math.max(...a.map((t=>t.view.width))):100;let h=w;const c=[];for(let n=0;n<a.length;n++){const s=a[n],i=d-s.view.joinX;0!==n&&a[n-1].isInterrupted||r.createStraightJoin(o,new e(d,h-w),w),c.push(m.create(o,d-50,h-w,100,w)),t.translate(s.view.g,i,h),h+=s.view.height+w}return 0!==a.length&&a[a.length-1].isInterrupted||r.createStraightJoin(o,new e(d,h-w),w),c.push(m.create(o,d-50,h-w,100,w)),new f(o,l,h,d,c,a)}constructor(t,e,n,s,i,o){this.g=t,this.width=e,this.height=n,this.joinX=s,this.placeholderViews=i,this.components=o}getClientPosition(){throw new Error("Not supported")}setIsDragging(t){this.placeholderViews.forEach((e=>{e.setIsVisible(t)}))}isInterrupted(){return this.components.length>0&&this.components[this.components.length-1].isInterrupted}}class C{static create(t,e,n){const s=f.create(t,e,n);return new C(s,s.isInterrupted(),e)}constructor(t,e,n){this.view=t,this.isInterrupted=e,this.sequence=n}findByClick(t){for(const e of this.view.components){const n=e.findByClick(t);if(n)return n}return null}findById(t){for(const e of this.view.components){const n=e.findById(t);if(n)return n}return null}getPlaceholders(t){this.view.placeholderViews.forEach(((e,n)=>{t.push(new g(e,this.sequence,n))})),this.view.components.forEach((e=>e.getPlaceholders(t)))}setIsDragging(t){this.view.setIsDragging(t),this.view.components.forEach((e=>e.setIsDragging(t)))}validate(){let t=!0;for(const e of this.view.components)t=e.validate()&&t;return t}}var q,b;!function(t){t[t.selectStep=1]="selectStep",t[t.openFolder=2]="openFolder"}(q||(q={}));class x{static create(e,n,s,i){const r=t.svg("g",{class:`sqd-step-task sqd-type-${s.type}`});e.appendChild(r);const a=t.svg("text",{x:46,y:21,class:"sqd-step-task-text"});a.textContent=s.name,r.appendChild(a);const d=58+Math.max(a.getBBox().width,70),l=t.svg("rect",{x:.5,y:.5,class:"sqd-step-task-rect",width:d,height:42,rx:5,ry:5});r.insertBefore(l,a);const c=i.iconUrlProvider?i.iconUrlProvider(s.componentType,s.type):null,p=c?t.svg("image",{href:c}):t.svg("rect",{class:"sqd-step-task-empty-icon",rx:4,ry:4});t.attrs(p,{x:12,y:10,width:22,height:22}),r.appendChild(p);const g=o.createRoundInput(r,d/2,0),v=n?null:h.create(r,d/2,42),m=u.create(r,d,0);return new x(r,d,42,d/2,l,g,v,m)}constructor(t,e,n,s,i,o,r,a){this.g=t,this.width=e,this.height=n,this.joinX=s,this.rect=i,this.inputView=o,this.outputView=r,this.validationErrorView=a}getClientPosition(){const t=this.rect.getBoundingClientRect();return new e(t.x,t.y)}resolveClick(t){return this.g.contains(t.element)?{type:q.selectStep}:null}setIsDragging(t){var e;this.inputView.setIsHidden(t),null===(e=this.outputView)||void 0===e||e.setIsHidden(t)}setIsDisabled(e){t.toggleClass(this.g,e,"sqd-disabled")}setIsSelected(e){t.toggleClass(this.rect,e,"sqd-selected")}setIsValid(t){this.validationErrorView.setIsHidden(t)}}class y{constructor(t,e,n,s,i){this.view=t,this.step=e,this.parentSequence=n,this.isInterrupted=s,this.configuration=i}findByClick(t){const e=this.view.resolveClick(t);return e?{component:this,action:e}:null}findById(t){return this.step.id===t?this:null}getPlaceholders(){}setIsDragging(t){this.view.setIsDragging(t)}setIsDisabled(t){this.view.setIsDisabled(t)}setIsSelected(t){this.view.setIsSelected(t)}validate(){const t=!this.configuration.validator||this.configuration.validator(this.step);return this.view.setIsValid(t),t}}class k{constructor(t){this.extensions=t}create(t,e,n,s){const i=this.extensions[e.componentType];if(!i)throw new Error(`Unknown component type: ${e.componentType}`);return i.createComponent(t,e,n,s)}}class S{static create(t,e){return new S(t,new k(e))}constructor(t,e){this.configuration=t,this.stepComponentFactory=e}}!function(t){t[t.singleSequence=1]="singleSequence",t[t.branches=2]="branches"}(b||(b={}));class I{constructor(){this.listeners=[]}subscribe(t){this.listeners.push(t)}unsubscribe(t){const e=this.listeners.indexOf(t);if(!(e>=0))throw new Error("Unknown listener");this.listeners.splice(e,1)}forward(t){this.listeners.length>0&&this.listeners.forEach((e=>e(t)))}count(){return this.listeners.length}}function P(t){return new e(t.clientX,t.clientY)}function E(t){if(t.touches.length>0){const n=t.touches[0];return new e(n.clientX,n.clientY)}throw new Error("Unknown touch position")}const M="State is not initialized";class D{constructor(){this.onMouseMoveHandler=t=>this.onMouseMove(t),this.onMouseUpHandler=t=>this.onMouseUp(t),this.onTouchMoveHandler=t=>this.onTouchMove(t),this.onTouchEndHandler=t=>this.onTouchEnd(t),this.onTouchStartHandler=t=>this.onTouchStart(t)}start(t,e){this.state?this.stop(!0,null):(this.state={startPosition:t,behavior:e},e.onStart(this.state.startPosition),window.addEventListener("mousemove",this.onMouseMoveHandler,!1),window.addEventListener("touchmove",this.onTouchMoveHandler,!1),window.addEventListener("mouseup",this.onMouseUpHandler,!1),window.addEventListener("touchend",this.onTouchEndHandler,!1),window.addEventListener("touchstart",this.onTouchStartHandler,!1))}onMouseMove(t){t.preventDefault(),this.move(P(t))}onTouchMove(t){t.preventDefault(),this.move(E(t))}onMouseUp(t){t.preventDefault(),this.stop(!1,t.target)}onTouchEnd(t){var e;if(t.preventDefault(),!this.state)throw new Error(M);const n=null!==(e=this.state.lastPosition)&&void 0!==e?e:this.state.startPosition,s=document.elementFromPoint(n.x,n.y);this.stop(!1,s)}onTouchStart(t){t.preventDefault(),1!==t.touches.length&&this.stop(!0,null)}move(t){if(!this.state)throw new Error(M);this.state.lastPosition=t;const e=this.state.startPosition.subtract(t),n=this.state.behavior.onMove(e);n&&(this.state.behavior.onEnd(!0,null),this.state.behavior=n,this.state.startPosition=t,this.state.behavior.onStart(this.state.startPosition))}stop(t,e){if(!this.state)throw new Error(M);window.removeEventListener("mousemove",this.onMouseMoveHandler,!1),window.removeEventListener("touchmove",this.onTouchMoveHandler,!1),window.removeEventListener("mouseup",this.onMouseUpHandler,!1),window.removeEventListener("touchend",this.onTouchEndHandler,!1),window.removeEventListener("touchstart",this.onTouchEndHandler,!1),this.state.behavior.onEnd(t,e),this.state=void 0}}class T{static deepClone(t){return void 0!==window.structuredClone?window.structuredClone(t):JSON.parse(JSON.stringify(t))}}class B{constructor(t){this.stepExtensions=t}getChildren(t){const e=this.stepExtensions[t.componentType];if(!e)throw new Error(`Not supported component type: ${t.componentType}`);return e.getChildren(t)}find(t,e,n,s){if(e&&t===e)return!0;const i=t.length;for(let o=0;o<i;o++){const i=t[o];if(n&&i.id===n)return s.push({step:i,index:o,parentSequence:t}),!0;const r=this.getChildren(i);if(r)switch(r.type){case b.singleSequence:{const t=r.sequences;if(this.find(t,e,n,s))return s.push({step:i,index:o,parentSequence:t}),!0}break;case b.branches:{const t=r.sequences,a=Object.keys(t);for(const r of a){const a=t[r];if(this.find(a,e,n,s))return s.push(r),s.push({step:i,index:o,parentSequence:a}),!0}}break;default:throw new Error(`Step children type ${r.type} is not supported`)}}return!1}getParents(t,e){const n=[],s=Array.isArray(e)?e:null,i=s?null:e.id;if(this.find(t.sequence,s,i,n))return n.reverse(),n.map((t=>"string"==typeof t?t:t.step));throw new Error(i?`Cannot get parents of step: ${i}`:"Cannot get parents of sequence")}findParentSequence(t,e){const n=[];return this.find(t.sequence,null,e,n)?n[0]:null}getParentSequence(t,e){const n=this.findParentSequence(t,e);if(!n)throw new Error(`Cannot find step by id: ${e}`);return n}findById(t,e){const n=this.findParentSequence(t,e);return n?n.step:null}getById(t,e){return this.getParentSequence(t,e).step}getChildAndParentSequences(t,e){const n=this.getParentSequence(t,e),s=this.getChildren(n.step);if(!s||s.type!==b.singleSequence)throw new Error(`Cannot find single sequence in step: ${e}`);const i=s.sequences;return{index:n.index,parentSequence:n.parentSequence,childSequence:i}}}class F{static moveStep(t,e,n,s){const i=t.indexOf(e);if(i<0)throw new Error("Unknown step");const o=t===n;o&&i===s||(t.splice(i,1),o&&i<s&&s--,n.splice(s,0,e))}static insertStep(t,e,n){e.splice(n,0,t)}static deleteStep(t,e){const n=e.indexOf(t);if(n<0)throw new Error("Unknown step");e.splice(n,1)}}var V;!function(t){t[t.stepNameChanged=1]="stepNameChanged",t[t.stepPropertyChanged=2]="stepPropertyChanged",t[t.stepChildrenChanged=3]="stepChildrenChanged",t[t.stepDeleted=4]="stepDeleted",t[t.stepMoved=5]="stepMoved",t[t.stepInserted=6]="stepInserted",t[t.globalPropertyChanged=7]="globalPropertyChanged",t[t.rootReplaced=8]="rootReplaced"}(V||(V={}));class R{constructor(t,n,s,i){this.definition=t,this.isReadonly=n,this.isToolboxCollapsed=s,this.isSmartEditorCollapsed=i,this.onViewPortChanged=new I,this.onSelectedStepIdChanged=new I,this.onFolderPathChanged=new I,this.onIsReadonlyChanged=new I,this.onIsDraggingChanged=new I,this.onIsMoveModeEnabledChanged=new I,this.onIsToolboxCollapsedChanged=new I,this.onIsSmartEditorCollapsedChanged=new I,this.onDefinitionChanged=new I,this.viewPort={position:new e(0,0),scale:1},this.selectedStepId=null,this.folderPath=[],this.isDragging=!1,this.isMoveModeEnabled=!1}setSelectedStepId(t){this.selectedStepId!==t&&(this.selectedStepId=t,this.onSelectedStepIdChanged.forward(t))}pushStepIdToFolderPath(t){this.folderPath.push(t),this.onFolderPathChanged.forward(this.folderPath)}setFolderPath(t){this.folderPath=t,this.onFolderPathChanged.forward(t)}tryGetLastStepIdFromFolderPath(){return this.folderPath.length>0?this.folderPath[this.folderPath.length-1]:null}setDefinition(t){this.definition=t,this.notifyDefinitionChanged(V.rootReplaced,null)}notifyDefinitionChanged(t,e){this.onDefinitionChanged.forward({changeType:t,stepId:e})}setViewPort(t){this.viewPort=t,this.onViewPortChanged.forward(t)}setIsReadonly(t){this.isReadonly!==t&&(this.isReadonly=t,this.onIsReadonlyChanged.forward(t))}setIsDragging(t){this.isDragging!==t&&(this.isDragging=t,this.onIsDraggingChanged.forward(t))}toggleIsMoveModeEnabled(){this.isMoveModeEnabled=!this.isMoveModeEnabled,this.onIsMoveModeEnabledChanged.forward(this.isMoveModeEnabled)}toggleIsToolboxCollapsed(){this.isToolboxCollapsed=!this.isToolboxCollapsed,this.onIsToolboxCollapsedChanged.forward(this.isToolboxCollapsed)}toggleIsSmartEditorCollapsed(){this.isSmartEditorCollapsed=!this.isSmartEditorCollapsed,this.onIsSmartEditorCollapsedChanged.forward(this.isSmartEditorCollapsed)}}class H{constructor(t,e,n){this.stepsTraverser=t,this.state=e,this.configuration=n}tryDelete(t){const e=this.stepsTraverser.getParentSequence(this.state.definition,t);return!(this.configuration.steps.canDeleteStep&&!this.configuration.steps.canDeleteStep(e.step,e.parentSequence)||(F.deleteStep(e.step,e.parentSequence),this.state.notifyDefinitionChanged(V.stepDeleted,e.step.id),this.updateDependantFields(),0))}tryInsert(t,e,n){return!(this.configuration.steps.canInsertStep&&!this.configuration.steps.canInsertStep(t,e,n)||(F.insertStep(t,e,n),this.state.notifyDefinitionChanged(V.stepInserted,t.id),this.state.setSelectedStepId(t.id),0))}tryMove(t,e,n,s){return!(this.configuration.steps.canMoveStep&&!this.configuration.steps.canMoveStep(t,e,n,s)||(F.moveStep(t,e,n,s),this.state.notifyDefinitionChanged(V.stepMoved,e.id),this.state.setSelectedStepId(e.id),0))}replaceDefinition(t){if(!t)throw new Error("Definition is empty");this.state.setDefinition(t),this.updateDependantFields()}updateDependantFields(){this.state.selectedStepId&&(this.stepsTraverser.findById(this.state.definition,this.state.selectedStepId)||this.state.setSelectedStepId(null));for(let t=0;t<this.state.folderPath.length;t++){const e=this.state.folderPath[t];if(!this.stepsTraverser.findById(this.state.definition,e)){const e=this.state.folderPath.slice(0,t);this.state.setFolderPath(e);break}}}}class L{static create(t,e,n){if(!n.undoStackSize||n.undoStackSize<1)throw new Error("Invalid undo stack size");const s=new L(t,e,n.undoStackSize);return s.remember(V.rootReplaced,null),t.onDefinitionChanged.subscribe((t=>{t.changeType!==V.rootReplaced&&s.remember(t.changeType,t.stepId)})),s}constructor(t,e,n){this.state=t,this.definitionModifier=e,this.stackSize=n,this.stack=[],this.currentIndex=0}canUndo(){return this.currentIndex>1}undo(){this.currentIndex--,this.commit()}canRedo(){return this.currentIndex<this.stack.length}redo(){this.currentIndex++,this.commit()}remember(t,e){const n=T.deepClone(this.state.definition);if(this.stack.length>0&&this.currentIndex===this.stack.length){const s=this.stack[this.stack.length-1];if(function(t,e,n){return t.changeType===e&&t.stepId===n}(s,t,e))return void(s.definition=n)}this.stack.splice(this.currentIndex),this.stack.push({definition:n,changeType:t,stepId:e}),this.stack.length>this.stackSize&&this.stack.splice(0,this.stack.length-this.stackSize-1),this.currentIndex=this.stack.length}commit(){const t=T.deepClone(this.stack[this.currentIndex-1].definition);this.definitionModifier.replaceDefinition(t)}}class z{constructor(t){this.parent=t}isMobile(){return this.parent.clientWidth<400}}class Z{set(t){if(this.controller)throw new Error("Controller is already set");this.controller=t}get(){if(!this.controller)throw new Error("Controller is not set");return this.controller}getPlaceholders(){return this.get().getPlaceholders()}getComponentByStepId(t){return this.get().getComponentByStepId(t)}resetViewPort(){this.get().resetViewPort()}zoom(t){this.get().zoom(t)}moveViewPortToStep(t){this.get().moveViewPortToStep(t)}}class A{static create(t,e,n,s){const i=T.deepClone(e),o=new z(t),r=o.isMobile(),a=!!n.isReadonly,d=new R(i,a,r,r),l=new Z,h=new D,c=new B(s),p=new H(c,d,n);let u;return n.undoStackSize&&(u=L.create(d,p,n)),new A(d,c,n,o,l,h,p,u)}constructor(t,e,n,s,i,o,r,a){this.state=t,this.stepsTraverser=e,this.configuration=n,this.layoutController=s,this.workspaceController=i,this.behaviorController=o,this.definitionModifier=r,this.historyController=a}setWorkspaceController(t){this.workspaceController.set(t)}}class U{static create(e,n){const s=t.element("div",{class:"sqd-control-bar"}),o=j(i.center,"Reset");s.appendChild(o);const r=j(i.zoomIn,"Zoom in");s.appendChild(r);const a=j(i.zoomOut,"Zoom out");s.appendChild(a);let d=null,l=null;n&&(d=j(i.undo,"Undo"),s.appendChild(d),l=j(i.redo,"Redo"),s.appendChild(l));const h=j(i.move,"Turn on/off drag and drop");h.classList.add("sqd-disabled"),s.appendChild(h);const c=j(i.delete,"Delete selected step");return c.classList.add("sqd-delete"),c.classList.add("sqd-hidden"),s.appendChild(c),e.appendChild(s),new U(o,r,a,d,l,h,c)}constructor(t,e,n,s,i,o,r){this.resetButton=t,this.zoomInButton=e,this.zoomOutButton=n,this.undoButton=s,this.redoButton=i,this.moveButton=o,this.deleteButton=r}bindResetButtonClick(t){$(this.resetButton,t)}bindZoomInButtonClick(t){$(this.zoomInButton,t)}bindZoomOutButtonClick(t){$(this.zoomOutButton,t)}bindUndoButtonClick(t){if(!this.undoButton)throw new Error("Undo button is disabled");$(this.undoButton,t)}bindRedoButtonClick(t){if(!this.redoButton)throw new Error("Redo button is disabled");$(this.redoButton,t)}bindMoveButtonClick(t){$(this.moveButton,t)}bindDeleteButtonClick(t){$(this.deleteButton,t)}setIsDeleteButtonHidden(e){t.toggleClass(this.deleteButton,e,"sqd-hidden")}setIsMoveButtonDisabled(e){t.toggleClass(this.moveButton,e,"sqd-disabled")}setUndoButtonDisabled(e){if(!this.undoButton)throw new Error("Undo button is disabled");t.toggleClass(this.undoButton,e,"sqd-disabled")}setRedoButtonDisabled(e){if(!this.redoButton)throw new Error("Redo button is disabled");t.toggleClass(this.redoButton,e,"sqd-disabled")}}function $(t,e){t.addEventListener("click",(t=>{t.preventDefault(),e()}),!1)}function j(e,n){const s=t.element("div",{class:"sqd-control-bar-button",title:n}),o=i.createSvg("sqd-control-bar-button-icon",e);return s.appendChild(o),s}class X{static create(t,e){const n=U.create(t,!!e.historyController),s=new X(n,e.state,e.workspaceController,e.historyController,e.definitionModifier);return n.bindResetButtonClick((()=>s.onResetButtonClicked())),n.bindZoomInButtonClick((()=>s.onZoomInButtonClicked())),n.bindZoomOutButtonClick((()=>s.onZoomOutButtonClicked())),n.bindMoveButtonClick((()=>s.onMoveButtonClicked())),n.bindDeleteButtonClick((()=>s.onDeleteButtonClicked())),e.state.onIsReadonlyChanged.subscribe((()=>s.onIsReadonlyChanged())),e.state.onSelectedStepIdChanged.subscribe((()=>s.onSelectedStepIdChanged())),e.state.onIsMoveModeEnabledChanged.subscribe((t=>s.onIsMoveModeEnabledChanged(t))),e.historyController&&(n.bindUndoButtonClick((()=>s.onUndoButtonClicked())),n.bindRedoButtonClick((()=>s.onRedoButtonClicked())),e.state.onDefinitionChanged.subscribe((()=>s.onDefinitionChanged())),s.refreshUndoRedoAvailability()),s}constructor(t,e,n,s,i){this.view=t,this.state=e,this.workspaceController=n,this.historyController=s,this.definitionModifier=i}onResetButtonClicked(){this.workspaceController.resetViewPort()}onZoomInButtonClicked(){this.workspaceController.zoom(!0)}onZoomOutButtonClicked(){this.workspaceController.zoom(!1)}onMoveButtonClicked(){this.state.toggleIsMoveModeEnabled(),this.state.selectedStepId&&this.state.setSelectedStepId(null)}onUndoButtonClicked(){var t;!this.state.isReadonly&&(null===(t=this.historyController)||void 0===t?void 0:t.canUndo())&&this.historyController.undo()}onRedoButtonClicked(){var t;!this.state.isReadonly&&(null===(t=this.historyController)||void 0===t?void 0:t.canRedo())&&this.historyController.redo()}onDeleteButtonClicked(){!this.state.isReadonly&&this.state.selectedStepId&&this.definitionModifier.tryDelete(this.state.selectedStepId)}onIsReadonlyChanged(){this.refreshDeleteButtonVisibility()}onSelectedStepIdChanged(){this.refreshDeleteButtonVisibility()}onIsMoveModeEnabledChanged(t){this.view.setIsMoveButtonDisabled(!t)}onDefinitionChanged(){this.refreshUndoRedoAvailability()}refreshUndoRedoAvailability(){if(!this.historyController)throw new Error("Undo/redo is disabled");const t=this.historyController.canUndo(),e=this.historyController.canRedo();this.view.setUndoButtonDisabled(!t),this.view.setRedoButtonDisabled(!e)}refreshDeleteButtonVisibility(){const t=!this.state.selectedStepId||this.state.isReadonly;this.view.setIsDeleteButtonHidden(t)}}function O(t,e,n,s){const i=[void 0,void 0,void 0],o=new I;let r=!1;return[e,n,s].filter((t=>t)).forEach(((e,n)=>{e.subscribe((e=>{i[n]=e,r||(r=!0,setTimeout((()=>{try{o.forward(i)}finally{r=!1,i.fill(void 0)}}),t))}))})),o}class Q{static create(e){const n=t.element("div",{class:"sqd-path-bar"}),s=t.element("div",{class:"sqd-path-bar-reset-button",title:"Go to top"}),o=i.createSvg("sqd-path-bar-reset-button-icon",i.folderUp),r=t.element("div",{class:"sqd-path-bar-items"});return n.appendChild(s),n.appendChild(r),s.appendChild(o),e.appendChild(n),new Q(n,r,s)}constructor(t,e,n){this.root=t,this.items=e,this.resetButton=n}bindOnItemClick(t){this.onClickHandler=t}bindOnResetClick(t){this.resetButton.addEventListener("click",(e=>{e.preventDefault(),t()}))}reload(e){const n=null===e;if(t.toggleClass(this.root,n,"sqd-hidden"),n)return;this.items.innerHTML="";const s=Math.max(0,e.length-3);for(let n=s;n<e.length;n++){const i=e[n];if(n>0){const e=t.element("span",{class:"sqd-path-bar-separator"});e.innerText=n===s?"...":"/",this.items.appendChild(e)}const o=t.element("span",{class:"sqd-path-bar-item"});o.innerText=i,o.addEventListener("click",(t=>{t.preventDefault(),this.onClickHandler&&this.onClickHandler(n)})),this.items.appendChild(o)}}}class N{static create(t,e){const n=Q.create(t),s=new N(n,e.state,e.stepsTraverser);return O(0,e.state.onFolderPathChanged,e.state.onDefinitionChanged).subscribe((()=>s.reloadPath())),n.bindOnItemClick((t=>s.onItemClicked(t))),n.bindOnResetClick((()=>s.onResetClicked())),s.reloadPath(),s}constructor(t,e,n){this.view=t,this.state=e,this.stepsTraverser=n}onItemClicked(t){const e=this.state.folderPath.splice(0,t+1);this.state.setFolderPath(e)}onResetClicked(){this.state.setFolderPath([])}reloadPath(){if(0===this.state.folderPath.length)return void this.view.reload(null);const t=[];for(const e of this.state.folderPath){const n=this.stepsTraverser.getById(this.state.definition,e);t.push(n.name)}this.view.reload(t)}}class J{static create(e){const n=t.element("div",{class:"sqd-editor sqd-global-editor"});return n.appendChild(e),new J(n)}constructor(t){this.root=t}}class W{static create(t,e){const n={notifyPropertiesChanged:()=>{e.state.notifyDefinitionChanged(V.globalPropertyChanged,null)}},s=e.configuration.editors.globalEditorProvider(t,n),i=J.create(s);return new W(i)}constructor(t){this.view=t}}class K{static create(e){const n=t.element("div",{class:"sqd-smart-editor"}),s=t.element("div",{class:"sqd-smart-editor-toggle",title:"Toggle editor"});return e.appendChild(s),e.appendChild(n),new K(n,s)}constructor(t,e){this.root=t,this.toggle=e}bindToggleIsCollapsedClick(t){this.toggle.addEventListener("click",(e=>{e.preventDefault(),t()}),!1)}setIsCollapsed(e){t.toggleClass(this.root,e,"sqd-hidden"),t.toggleClass(this.toggle,e,"sqd-collapsed"),this.toggleIcon&&this.toggle.removeChild(this.toggleIcon),this.toggleIcon=i.createSvg("sqd-smart-editor-toggle-icon",e?i.options:i.close),this.toggle.appendChild(this.toggleIcon)}setView(t){this.view&&this.root.removeChild(this.view.root),this.root.appendChild(t.root),this.view=t}}class Y{static create(e){const n=t.element("div",{class:"sqd-editor sqd-step-editor"});return n.appendChild(e),new Y(n)}constructor(t){this.root=t}}class G{static create(t,e){const n={notifyPropertiesChanged:()=>{e.state.notifyDefinitionChanged(V.stepPropertyChanged,t.id)},notifyNameChanged:()=>{e.state.notifyDefinitionChanged(V.stepNameChanged,t.id)},notifyChildrenChanged:()=>{e.state.notifyDefinitionChanged(V.stepChildrenChanged,t.id),e.definitionModifier.updateDependantFields()}},s=e.configuration.editors.stepEditorProvider(t,n),i=Y.create(s);return new G(i)}constructor(t){this.view=t}}class _{static create(t,e){const n=K.create(t);n.setIsCollapsed(e.state.isSmartEditorCollapsed);const s=new _(n,e,e.state);return n.bindToggleIsCollapsedClick((()=>s.toggleIsCollapsedClick())),s.tryRender(null),O(0,e.state.onDefinitionChanged,e.state.onSelectedStepIdChanged).subscribe((t=>{const[e,n]=t;e?s.onDefinitionChanged(e):void 0!==n&&s.onSelectedStepIdChanged(n)})),e.state.onIsSmartEditorCollapsedChanged.subscribe((t=>n.setIsCollapsed(t))),s}constructor(t,e,n){this.view=t,this.context=e,this.state=n,this.currentStepId=void 0}toggleIsCollapsedClick(){this.state.toggleIsSmartEditorCollapsed()}onSelectedStepIdChanged(t){this.tryRender(t)}onDefinitionChanged(t){t.changeType===V.rootReplaced?this.render(this.state.selectedStepId):this.tryRender(this.state.selectedStepId)}tryRender(t){this.currentStepId!==t&&this.render(t)}render(t){const e=t?this.context.stepsTraverser.getById(this.context.state.definition,t):null,n=e?G.create(e,this.context):W.create(this.state.definition,this.context);this.currentStepId=t,this.view.setView(n.view)}}class tt{static create(e,n){const s=t.element("div",{class:"sqd-scrollbox"});e.appendChild(s);const i=new tt(s,n);return window.addEventListener("resize",i.onResizeHandler,!1),s.addEventListener("wheel",(t=>i.onWheel(t)),!1),s.addEventListener("touchstart",(t=>i.onTouchStart(t)),!1),s.addEventListener("mousedown",(t=>i.onMouseDown(t)),!1),i}constructor(t,e){this.root=t,this.viewport=e,this.onResizeHandler=()=>this.onResize(),this.onTouchMoveHandler=t=>this.onTouchMove(t),this.onMouseMoveHandler=t=>this.onMouseMove(t),this.onTouchEndHandler=t=>this.onTouchEnd(t),this.onMouseUpHandler=t=>this.onMouseUp(t)}setContent(t){this.content&&this.root.removeChild(this.content.element),t.classList.add("sqd-scrollbox-body"),this.root.appendChild(t),this.reload(t)}refresh(){this.content&&this.reload(this.content.element)}destroy(){window.removeEventListener("resize",this.onResizeHandler,!1)}reload(t){let e=Math.min(.7*this.viewport.clientHeight,t.clientHeight);e=Math.min(e,this.viewport.clientHeight-206),this.root.style.height=e+"px",t.style.top="0px",this.content={element:t,height:e}}onResize(){this.refresh()}onWheel(t){if(t.stopPropagation(),this.content){const e=t.deltaY>0?-25:25,n=this.getScrollTop();this.setScrollTop(n+e)}}onTouchStart(t){t.preventDefault(),this.startScroll(E(t))}onMouseDown(t){this.startScroll(P(t))}onTouchMove(t){t.preventDefault(),this.moveScroll(E(t))}onMouseMove(t){t.preventDefault(),this.moveScroll(P(t))}onTouchEnd(t){t.preventDefault(),this.stopScroll()}onMouseUp(t){t.preventDefault(),this.stopScroll()}startScroll(t){this.scroll||(window.addEventListener("touchmove",this.onTouchMoveHandler,!1),window.addEventListener("mousemove",this.onMouseMoveHandler,!1),window.addEventListener("touchend",this.onTouchEndHandler,!1),window.addEventListener("mouseup",this.onMouseUpHandler,!1)),this.scroll={startPositionY:t.y,startScrollTop:this.getScrollTop()}}moveScroll(t){if(this.scroll){const e=t.y-this.scroll.startPositionY;this.setScrollTop(this.scroll.startScrollTop+e)}}stopScroll(){this.scroll&&(window.removeEventListener("touchmove",this.onTouchMoveHandler,!1),window.removeEventListener("mousemove",this.onMouseMoveHandler,!1),window.removeEventListener("touchend",this.onTouchEndHandler,!1),window.removeEventListener("mouseup",this.onMouseUpHandler,!1),this.scroll=void 0)}getScrollTop(){return this.content&&this.content.element.style.top?parseInt(this.content.element.style.top):0}setScrollTop(t){if(this.content){const e=this.content.element.clientHeight-this.content.height,n=Math.max(Math.min(t,0),-e);this.content.element.style.top=n+"px"}}}class et{static create(e,n,s){const i=n.theme||"light",o=t.element("div",{class:`sqd-drag sqd-theme-${i}`});document.body.appendChild(o);const r=t.svg("svg");o.appendChild(r);const a=s.stepComponentFactory.create(r,e,[],s);return t.attrs(r,{width:a.view.width+20,height:a.view.height+20}),t.translate(a.view.g,10,10),new et(a.view.width,a.view.height,o)}constructor(t,e,n){this.width=t,this.height=e,this.layer=n}setPosition(t){this.layer.style.top=t.y-10+"px",this.layer.style.left=t.x-10+"px"}remove(){document.body.removeChild(this.layer)}}class nt{static create(t,e){const n=new nt(t,e);return e.onViewPortChanged.subscribe(n.clearCacheHandler),window.addEventListener("scroll",n.clearCacheHandler,!1),n}constructor(t,e){this.placeholders=t,this.state=e,this.clearCacheHandler=()=>this.clearCache()}find(t,n,s){var i;this.cache||(this.cache=this.placeholders.map((t=>{const n=t.getRect();return{placeholder:t,lt:new e(n.x,n.y),br:new e(n.x+n.width,n.y+n.height)}})),this.cache.sort(((t,e)=>t.lt.y-e.lt.y)));const o=t.x+n,r=t.y+s;return null===(i=this.cache.find((e=>Math.max(t.x,e.lt.x)<Math.min(o,e.br.x)&&Math.max(t.y,e.lt.y)<Math.min(r,e.br.y))))||void 0===i?void 0:i.placeholder}destroy(){this.state.onViewPortChanged.unsubscribe(this.clearCacheHandler),window.removeEventListener("scroll",this.clearCacheHandler,!1)}clearCache(){this.cache=void 0}}class st{static create(t,e,n,s){const i=et.create(n,t.configuration,e);return new st(i,t.workspaceController,t.state,n,t.definitionModifier,s)}constructor(t,e,n,s,i,o){this.view=t,this.workspaceController=e,this.designerState=n,this.step=s,this.definitionModifier=i,this.draggedStepComponent=o}onStart(t){let n;if(this.draggedStepComponent){this.draggedStepComponent.setIsDisabled(!0);const e=this.draggedStepComponent.view.getClientPosition();n=t.subtract(e)}else n=new e(this.view.width/2,this.view.height/2);this.view.setPosition(t.subtract(n)),this.designerState.setIsDragging(!0),this.state={startPosition:t,finder:nt.create(this.workspaceController.getPlaceholders(),this.designerState),offset:n}}onMove(t){if(this.state){const e=this.state.startPosition.subtract(t).subtract(this.state.offset);this.view.setPosition(e);const n=this.state.finder.find(e,this.view.width,this.view.height);this.currentPlaceholder!==n&&(this.currentPlaceholder&&this.currentPlaceholder.setIsHover(!1),n&&n.setIsHover(!0),this.currentPlaceholder=n)}}onEnd(t){if(!this.state)throw new Error("Invalid state");this.state.finder.destroy(),this.state=void 0,this.view.remove(),this.designerState.setIsDragging(!1);let e=!1;!t&&this.currentPlaceholder&&(e=this.draggedStepComponent?this.definitionModifier.tryMove(this.draggedStepComponent.parentSequence,this.draggedStepComponent.step,this.currentPlaceholder.parentSequence,this.currentPlaceholder.index):this.definitionModifier.tryInsert(this.step,this.currentPlaceholder.parentSequence,this.currentPlaceholder.index)),e||(this.draggedStepComponent&&this.draggedStepComponent.setIsDisabled(!1),this.currentPlaceholder&&this.currentPlaceholder.setIsHover(!1)),this.currentPlaceholder=void 0}}const it=/^[a-zA-Z][a-zA-Z0-9_-]+$/;class ot{static validate(t){if(!it.test(t))throw new Error(`Step type "${t}" contains not allowed characters`)}}class rt{static create(e,n,s){const i=t.element("div",{class:`sqd-toolbox-item sqd-type-${n.type}`,title:n.name}),o=s.iconUrlProvider?s.iconUrlProvider(n.componentType,n.type):null,r=t.element("div",{class:"sqd-toolbox-item-icon"});if(o){const e=t.element("img",{class:"sqd-toolbox-item-icon-image",src:o});r.appendChild(e)}else r.classList.add("sqd-no-icon");const a=t.element("div",{class:"sqd-toolbox-item-text"});return a.textContent=n.name,i.appendChild(r),i.appendChild(a),e.appendChild(i),new rt(i)}constructor(t){this.root=t}bindMousedown(t){this.root.addEventListener("mousedown",t,!1)}bindTouchstart(t){this.root.addEventListener("touchstart",t,!1)}bindContextMenu(t){this.root.addEventListener("contextmenu",t,!1)}}class at{static create(t,e,n,s){ot.validate(e.type);const i=rt.create(t,e,n.configuration.steps),o=new at(e,n.state,n.behaviorController,n,s);return i.bindMousedown((t=>o.onMousedown(t))),i.bindTouchstart((t=>o.onTouchstart(t))),i.bindContextMenu((t=>o.onContextMenu(t))),o}constructor(t,e,n,s,i){this.step=t,this.state=e,this.behaviorController=n,this.designerContext=s,this.componentContext=i}onTouchstart(t){t.preventDefault(),1===t.touches.length&&(t.stopPropagation(),this.startDrag(E(t)))}onMousedown(t){t.stopPropagation(),0===t.button&&this.startDrag(P(t))}onContextMenu(t){t.preventDefault()}startDrag(t){if(!this.state.isReadonly){const e=function(t){const e=T.deepClone(t);return e.id=s.next(),e}(this.step);this.behaviorController.start(t,st.create(this.designerContext,this.componentContext,e))}}}class dt{static create(e,n,s){const i=t.element("div",{class:"sqd-toolbox"}),o=t.element("div",{class:"sqd-toolbox-header"}),r=t.element("div",{class:"sqd-toolbox-header-title"});r.innerText="Toolbox";const a=t.element("div",{class:"sqd-toolbox-body"}),d=t.element("input",{class:"sqd-toolbox-filter",type:"text",placeholder:"Search..."});i.appendChild(o),i.appendChild(a),o.appendChild(r),a.appendChild(d),e.appendChild(i);const l=tt.create(a,e);return new dt(o,a,d,l,n,s)}constructor(t,e,n,s,i,o){this.header=t,this.body=e,this.filterInput=n,this.scrollBoxView=s,this.designerContext=i,this.componentContext=o}bindToggleIsCollapsedClick(t){this.header.addEventListener("click",(function(e){e.preventDefault(),t()}),!1)}bindFilterInputChange(t){function e(e){t(e.target.value)}this.filterInput.addEventListener("keyup",e,!1),this.filterInput.addEventListener("blur",e,!1)}setIsCollapsed(e){t.toggleClass(this.body,e,"sqd-hidden"),this.headerToggleIcon&&this.header.removeChild(this.headerToggleIcon),this.headerToggleIcon=i.createSvg("sqd-toolbox-toggle-icon",e?i.expand:i.close),this.header.appendChild(this.headerToggleIcon),e||this.scrollBoxView.refresh()}setGroups(e){const n=t.element("div");e.forEach((e=>{const s=t.element("div",{class:"sqd-toolbox-group-title"});s.innerText=e.name,n.appendChild(s),e.steps.forEach((t=>at.create(n,t,this.designerContext,this.componentContext)))})),this.scrollBoxView.setContent(n)}destroy(){this.scrollBoxView.destroy()}}class lt{static create(t,e,n){const s=dt.create(t,e,n);s.setIsCollapsed(e.state.isToolboxCollapsed);const i=new lt(s,e.state,e.configuration);return i.render(),e.state.onIsToolboxCollapsedChanged.subscribe((t=>i.onIsToolboxCollapsedChanged(t))),s.bindToggleIsCollapsedClick((()=>i.toggleIsCollapsedClick())),s.bindFilterInputChange((t=>i.onFilterInputChanged(t))),i}constructor(t,e,n){this.view=t,this.state=e,this.configuration=n}destroy(){this.view.destroy()}render(){const t=this.configuration.toolbox.groups.map((t=>({name:t.name,steps:t.steps.filter((t=>!this.filter||t.name.toLowerCase().includes(this.filter)))}))).filter((t=>t.steps.length>0));this.view.setGroups(t)}toggleIsCollapsedClick(){this.state.toggleIsToolboxCollapsed()}onIsToolboxCollapsedChanged(t){this.view.setIsCollapsed(t)}onFilterInputChanged(t){this.filter=t.toLowerCase(),this.render()}}const ht=30;class ct{static create(e,n,s,i){const o=t.svg("g",{class:"sqd-step-start-stop"});e.appendChild(o);const r=C.create(o,n,i),a=r.view,d=a.joinX-15,l=ht+a.height,h=pt(!0);t.translate(h,d,0),o.appendChild(h),t.translate(a.g,0,ht);const c=pt(!1);t.translate(c,d,l),o.appendChild(c);let p=null,u=null;return s&&(p=m.create(o,d,0,ht,ht,v.out),u=m.create(o,d,l,ht,ht,v.out)),new ct(o,a.width,a.height+60,a.joinX,r,p,u)}constructor(t,e,n,s,i,o,r){this.g=t,this.width=e,this.height=n,this.joinX=s,this.component=i,this.startPlaceholderView=o,this.endPlaceholderView=r}getClientPosition(){throw new Error("Not supported")}destroy(){var t;null===(t=this.g.parentNode)||void 0===t||t.removeChild(this.g)}}function pt(e){const n=t.svg("circle",{class:"sqd-step-start-stop-circle",cx:15,cy:15,r:15}),s=t.svg("g");s.appendChild(n);if(e){const e=t.svg("path",{class:"sqd-step-start-stop-icon",transform:"translate(7.5, 7.5)",d:"M 3 0 L 15 7.5 L 3 15 Z"});s.appendChild(e)}else{const e=t.svg("rect",{class:"sqd-step-start-stop-icon",x:7.5,y:7.5,width:15,height:15,rx:4,ry:4});s.appendChild(e)}return s}class ut{static create(t,e,n,s){const i=ct.create(t,e,!!n,s);return new ut(i,n)}constructor(t,e){this.view=t,this.parentSequencePlaceIndicator=e,this.isInterrupted=!1}findByClick(t){return this.view.component.findByClick(t)}findById(t){return this.view.component.findById(t)}getPlaceholders(t){if(this.view.component.getPlaceholders(t),this.parentSequencePlaceIndicator&&this.view.startPlaceholderView&&this.view.endPlaceholderView){const{index:e,sequence:n}=this.parentSequencePlaceIndicator;t.push(new g(this.view.startPlaceholderView,n,e)),t.push(new g(this.view.endPlaceholderView,n,e+1))}}setIsDragging(t){this.view.component.setIsDragging(t),this.view.startPlaceholderView&&this.view.endPlaceholderView&&(this.view.startPlaceholderView.setIsVisible(t),this.view.endPlaceholderView.setIsVisible(t))}validate(){return this.view.component.validate()}destroy(){this.view.destroy()}}let gt=0;class vt{static create(e,n){const s=t.svg("defs"),i="sqd-grid-pattern-"+gt++,o=t.svg("pattern",{id:i,patternUnits:"userSpaceOnUse"}),r=t.svg("path",{class:"sqd-grid-path",fill:"none"});s.appendChild(o),o.appendChild(r);const a=t.svg("g"),d=t.element("div",{class:"sqd-workspace"}),l=t.svg("svg",{class:"sqd-workspace-canvas"});l.appendChild(s),l.appendChild(t.svg("rect",{width:"100%",height:"100%",fill:`url(#${i})`})),l.appendChild(a),d.appendChild(l),e.appendChild(d);const h=new vt(d,l,o,r,a,n);return window.addEventListener("resize",h.onResizeHandler,!1),h}constructor(t,e,n,s,i,o){this.workspace=t,this.canvas=e,this.gridPattern=n,this.gridPatternPath=s,this.foreground=i,this.context=o,this.onResizeHandler=()=>this.onResize()}render(t,e){this.rootComponent&&this.rootComponent.destroy(),this.rootComponent=ut.create(this.foreground,t,e,this.context),this.refreshSize()}setPositionAndScale(e,n){const s=48*n;t.attrs(this.gridPattern,{x:e.x,y:e.y,width:s,height:s}),t.attrs(this.gridPatternPath,{d:`M ${s} 0 L 0 0 0 ${s}`}),t.attrs(this.foreground,{transform:`translate(${e.x}, ${e.y}) scale(${n})`})}getClientPosition(){const t=this.canvas.getBoundingClientRect();return new e(t.x,t.y)}getClientCanvasSize(){return new e(this.canvas.clientWidth,this.canvas.clientHeight)}bindClick(t){this.canvas.addEventListener("mousedown",(e=>{t(P(e),e.target,e.button)}),!1),this.canvas.addEventListener("touchstart",(e=>{e.preventDefault();const n=E(e),s=document.elementFromPoint(n.x,n.y);s&&t(n,s,0)}),!1)}bindContextMenu(t){this.canvas.addEventListener("contextmenu",t,!1)}bindWheel(t){this.canvas.addEventListener("wheel",t,!1)}destroy(){window.removeEventListener("resize",this.onResizeHandler,!1)}refreshSize(){t.attrs(this.canvas,{width:this.workspace.offsetWidth,height:this.workspace.offsetHeight})}onResize(){this.refreshSize()}}class mt{constructor(t){this.state=t}execute(t,e){this.animation&&this.animation.isAlive&&this.animation.stop();const n=this.state.viewPort.position,s=this.state.viewPort.scale,i=n.subtract(t),o=s-e;this.animation=function(t,e){const n=setInterval((function(){const t=Math.min((Date.now()-s)/150,1);e(t),1===t&&i.stop()}),15),s=Date.now(),i={isAlive:!0,stop:()=>{i.isAlive=!1,clearInterval(n)}};return i}(0,(t=>{const e=s-o*t;this.state.setViewPort({position:n.subtract(i.multiplyByScalar(t)),scale:e})}))}}class wt{static create(t){return new wt(t.viewPort.position,t)}constructor(t,e){this.startPosition=t,this.state=e}onStart(){const t=this.state.tryGetLastStepIdFromFolderPath();this.state.setSelectedStepId(t)}onMove(t){const e=this.startPosition.subtract(t);this.state.setViewPort({position:e,scale:this.state.viewPort.scale})}onEnd(){}}class ft{static create(t,e,n){return new ft(t,e,n)}constructor(t,e,n){this.context=t,this.clickedElement=e,this.clickResult=n}onStart(){}onMove(){}onEnd(t,e){if(this.clickedElement===e){const t=this.clickResult.component.step.id;this.context.state.pushStepIdToFolderPath(t)}}}class Ct{static create(t,e,n){return new Ct(t,e,n,e.state)}constructor(t,e,n,s){this.pressedStepComponent=t,this.designerContext=e,this.componentContext=n,this.state=s}onStart(){}onMove(t){if(!this.state.isReadonly&&t.distance()>2)return this.state.setSelectedStepId(null),st.create(this.designerContext,this.componentContext,this.pressedStepComponent.step,this.pressedStepComponent)}onEnd(t){t||this.state.setSelectedStepId(this.pressedStepComponent.step.id)}}class qt{constructor(t,e,n){this.designerContext=t,this.componentContext=e,this.state=n}resolve(t,e,n,s){const i={element:e,position:n,scale:this.state.viewPort.scale},o=s||this.state.isMoveModeEnabled?null:t.findByClick(i);if(!o)return wt.create(this.state);switch(o.action.type){case q.selectStep:return Ct.create(o.component,this.designerContext,this.componentContext);case q.openFolder:return ft.create(this.designerContext,e,o);default:throw new Error("Not supported behavior type")}}}const bt=[.06,.08,.1,.12,.16,.2,.26,.32,.4,.5,.6,.7,.8,.9,1];function xt(t,e){const n=bt.map(((e,n)=>({distance:Math.abs(e-t),index:n})));n.sort(((t,e)=>t.distance-e.distance));let s=n[0].index;return s=e?Math.min(s+1,bt.length-1):Math.max(s-1,0),bt[s]}class yt{static center(t,n){const s=Math.max(t.x-20,0),i=Math.max(t.y-20,0),o=Math.min(Math.min(s/n.width,i/n.height),1),r=n.width*o,a=n.height*o,d=Math.max(0,(t.x-r)/2),l=Math.max(0,(t.y-a)/2);return{position:new e(d,l),scale:o}}static zoom(t,e){const n=xt(t.scale,e);return{position:t.position,scale:n}}static zoomByWheel(t,n,s){const i=new e(n.pageX,n.pageY).subtract(s),o=i.divideByScalar(t.scale).subtract(t.position.divideByScalar(t.scale)),r=xt(t.scale,n.deltaY<0);return{position:o.multiplyByScalar(-r).add(i),scale:r}}}class kt{static create(t,e,n){const s=vt.create(t,n),i=new mt(e.state),o=new qt(e,n,e.state),r=new kt(s,e.stepsTraverser,e.state,e.behaviorController,o,i);return setTimeout((()=>{r.render(),r.resetViewPort()})),e.setWorkspaceController(r),e.state.onViewPortChanged.subscribe((t=>r.onViewPortChanged(t))),e.state.onIsDraggingChanged.subscribe((t=>r.onIsDraggingChanged(t))),e.state.onIsSmartEditorCollapsedChanged.subscribe((()=>r.onIsSmartEditorCollapsedChanged())),O(0,e.state.onDefinitionChanged,e.state.onSelectedStepIdChanged,e.state.onFolderPathChanged).subscribe((t=>{r.onStateChanged(t[0],t[1],t[2])})),s.bindClick(((t,e,n)=>r.onClick(t,e,n))),s.bindContextMenu((t=>r.onContextMenu(t))),s.bindWheel((t=>r.onWheel(t))),r}constructor(t,e,n,s,i,o){this.view=t,this.stepsTraverser=e,this.state=n,this.behaviorController=s,this.clickBehaviorResolver=i,this.viewPortAnimator=o,this.isValid=!1,this.selectedStepComponent=null}render(){let t,e;this.selectedStepComponent=null;const n=this.state.tryGetLastStepIdFromFolderPath();if(n){const s=this.stepsTraverser.getChildAndParentSequences(this.state.definition,n);e=s.childSequence,t={sequence:s.parentSequence,index:s.index}}else e=this.state.definition.sequence,t=null;this.view.render(e,t),this.trySelectStepComponent(this.state.selectedStepId),this.revalidate()}getPlaceholders(){const t=[];return this.getRootComponent().getPlaceholders(t),t}getComponentByStepId(t){const e=this.getRootComponent().findById(t);if(!e)throw new Error(`Cannot find component for step id: ${t}`);return e}resetViewPort(){const t=this.getRootComponent().view,e=this.view.getClientCanvasSize(),n=yt.center(e,t);this.state.setViewPort(n)}zoom(t){const e=yt.zoom(this.state.viewPort,t);this.state.setViewPort(e)}moveViewPortToStep(t){const n=this.state.viewPort,s=t.view.getClientPosition(),i=this.view.getClientCanvasSize(),o=n.position.divideByScalar(n.scale).subtract(s.divideByScalar(n.scale)),r=new e(t.view.width,t.view.height).divideByScalar(2),a=o.add(i.divideByScalar(2)).subtract(r);this.viewPortAnimator.execute(a,1)}destroy(){this.view.destroy()}revalidate(){this.isValid=this.getRootComponent().validate()}onClick(t,e,n){const s=1===n;if(0===n||s){const n=this.getRootComponent(),i=this.clickBehaviorResolver.resolve(n,e,t,s);this.behaviorController.start(t,i)}}onContextMenu(t){t.preventDefault()}onWheel(t){const e=yt.zoomByWheel(this.state.viewPort,t,this.view.getClientPosition());this.state.setViewPort(e)}onIsDraggingChanged(t){this.getRootComponent().setIsDragging(t)}onIsSmartEditorCollapsedChanged(){setTimeout((()=>this.view.refreshSize()))}onViewPortChanged(t){this.view.setPositionAndScale(t.position,t.scale)}onStateChanged(t,e,n){n?(this.render(),this.resetViewPort()):t?t.changeType===V.stepPropertyChanged?this.revalidate():this.render():void 0!==e&&this.trySelectStepComponent(e)}trySelectStepComponent(t){this.selectedStepComponent&&(this.selectedStepComponent.setIsSelected(!1),this.selectedStepComponent=null),t&&(this.selectedStepComponent=this.getRootComponent().findById(t),this.selectedStepComponent&&this.selectedStepComponent.setIsSelected(!0))}getRootComponent(){if(this.view.rootComponent)return this.view.rootComponent;throw new Error("Root component not found")}}class St{static create(e,n,s,i,o){const r=o.theme||"light",a=t.element("div",{class:`sqd-designer sqd-theme-${r}`});e.appendChild(a);const d=kt.create(a,n,s);let l;o.toolbox.isHidden||(l=lt.create(a,n,s)),X.create(a,n),N.create(a,n),o.editors.isHidden||_.create(a,n);const h=new St(a,i,d,l);return h.reloadLayout(),window.addEventListener("resize",h.onResizeHandler,!1),h}constructor(t,e,n,s){this.root=t,this.layoutController=e,this.workspace=n,this.toolbox=s,this.onResizeHandler=()=>this.onResize(),this.onKeyUpHandlers=[]}bindKeyUp(t){document.addEventListener("keyup",t,!1),this.onKeyUpHandlers.push(t)}destroy(){var t,e;window.removeEventListener("resize",this.onResizeHandler,!1),this.onKeyUpHandlers.forEach((t=>document.removeEventListener("keyup",t,!1))),this.workspace.destroy(),null===(t=this.toolbox)||void 0===t||t.destroy(),null===(e=this.root.parentElement)||void 0===e||e.removeChild(this.root)}onResize(){this.reloadLayout()}reloadLayout(){const e=this.layoutController.isMobile();t.toggleClass(this.root,!e,"sqd-layout-desktop"),t.toggleClass(this.root,e,"sqd-layout-mobile")}}class It{static create(n,s,i){const a=t.svg("g",{class:`sqd-step-container sqd-type-${s.type}`});n.appendChild(a);const d=l.create(a,20,s.name,"primary"),h=C.create(a,s.sequence,i),p=d.width/2,g=Math.max(p-h.view.joinX,0)+20,v=Math.max(p-(h.view.width-h.view.joinX),0)+20,m=g+h.view.width+v,w=42+h.view.height,f=h.view.joinX+g;t.translate(d.g,f,0),t.translate(h.view.g,g,42);const q=i.configuration.iconUrlProvider?i.configuration.iconUrlProvider(s.componentType,s.type):null,b=o.createRectInput(a,f,0,q);r.createStraightJoin(a,new e(f,0),20);const x=c.create(a,[m],w),y=u.create(a,m,0);return new It(a,m,w,f,h,b,x,y)}constructor(t,e,n,s,i,o,r,a){this.g=t,this.width=e,this.height=n,this.joinX=s,this.sequenceComponent=i,this.inputView=o,this.regionView=r,this.validationErrorView=a}getClientPosition(){return this.regionView.getClientPosition()}resolveClick(t){return this.regionView.resolveClick(t)||this.g.contains(t.element)}setIsDragging(t){this.inputView.setIsHidden(t),this.sequenceComponent.setIsDragging(t)}setIsSelected(t){this.regionView.setIsSelected(t)}setIsDisabled(e){t.toggleClass(this.g,e,"sqd-disabled")}setIsValid(t){this.validationErrorView.setIsHidden(t)}isInterrupted(){return this.sequenceComponent.isInterrupted}}class Pt{static create(t,e,n,s){const i=It.create(t,e,s);return new Pt(i,e,n,i.isInterrupted(),s.configuration)}constructor(t,e,n,s,i){this.view=t,this.step=e,this.parentSequence=n,this.isInterrupted=s,this.configuration=i,this.isDisabled=!1}findByClick(t){return this.view.sequenceComponent.findByClick(t)||(this.view.resolveClick(t)?{component:this,action:{type:q.selectStep}}:null)}findById(t){return this.view.sequenceComponent.findById(t)||(this.step.id===t?this:null)}getPlaceholders(t){this.isDisabled||this.view.sequenceComponent.getPlaceholders(t)}setIsSelected(t){this.view.setIsSelected(t)}setIsDisabled(t){this.isDisabled=t,this.view.setIsDisabled(t)}setIsDragging(t){this.view.setIsDragging(t)}validate(){const t=!this.configuration.validator||this.configuration.validator(this.step);this.view.setIsValid(t);const e=this.view.sequenceComponent.validate();return t&&e}}class Et{constructor(){this.componentType="container",this.createComponent=Pt.create}getChildren(t){return{type:b.singleSequence,sequences:t.sequence}}}class Mt{static create(n,s,i){const a=t.svg("g",{class:`sqd-step-switch sqd-type-${s.type}`});n.appendChild(a);const d=Object.keys(s.branches),h=d.map((t=>C.create(a,s.branches[t],i))),p=d.map((t=>l.create(a,58,t,"secondary"))),g=l.create(a,20,s.name,"primary");let v=0;const m=h.map(((t,e)=>{const n=Math.max(p[e].width,40)/2,s=Math.max(n-t.view.joinX,0)+20,i=Math.max(n-(t.view.width-t.view.joinX),0)+20,o=t.view.width+s+i,r=t.view.joinX+s,a=v;return v+=o,{width:o,branchOffsetLeft:s,offsetX:a,joinX:r}})),w=Math.floor(d.length/2),f=m[w];let q=f.offsetX;d.length%2!=0&&(q+=f.joinX);const b=m.reduce(((t,e)=>t+e.width),0),x=Math.max(...h.map((t=>t.view.height))),y=g.width/2+40,k=Math.max(y-q,0),S=Math.max(y-(b-q),0),I=k+b+S,P=x+20+44+32,E=k+q;t.translate(g.g,E,0),h.forEach(((n,s)=>{const i=m[s],o=k+i.offsetX+i.branchOffsetLeft;if(t.translate(p[s].g,k+i.offsetX+i.joinX,0),t.translate(n.view.g,o,80),!n.isInterrupted){const t=80+n.view.height,s=P-t-16;s>0&&r.createStraightJoin(a,new e(k+i.offsetX+i.joinX,t),s)}}));const M=i.configuration.iconUrlProvider?i.configuration.iconUrlProvider(s.componentType,s.type):null,D=o.createRectInput(a,E,0,M);r.createStraightJoin(a,new e(E,0),20),r.createJoins(a,new e(E,42),m.map((t=>new e(k+t.offsetX+t.joinX,58))));const T=h.map(((t,e)=>t.isInterrupted?null:e)).filter((t=>null!==t)).map((t=>new e(k+m[t].offsetX+m[t].joinX,80+x)));T.length>0&&r.createJoins(a,new e(E,P),T);const B=m.map((t=>t.width));B[0]+=k,B[B.length-1]+=S;const F=c.create(a,B,P),V=u.create(a,I,0);return new Mt(a,I,P,E,h,F,D,V)}constructor(t,e,n,s,i,o,r,a){this.g=t,this.width=e,this.height=n,this.joinX=s,this.sequenceComponents=i,this.regionView=o,this.inputView=r,this.validationErrorView=a}getClientPosition(){return this.regionView.getClientPosition()}resolveClick(t){return this.regionView.resolveClick(t)||this.g.contains(t.element)}setIsDragging(t){this.inputView.setIsHidden(t)}setIsSelected(t){this.regionView.setIsSelected(t)}setIsDisabled(e){t.toggleClass(this.g,e,"sqd-disabled")}setIsValid(t){this.validationErrorView.setIsHidden(t)}isInterrupted(){return this.sequenceComponents.every((t=>t.isInterrupted))}}class Dt{static create(t,e,n,s){const i=Mt.create(t,e,s);return new Dt(i,e,n,i.isInterrupted(),s.configuration)}constructor(t,e,n,s,i){this.view=t,this.step=e,this.parentSequence=n,this.isInterrupted=s,this.configuration=i,this.isDisabled=!1}findByClick(t){for(const e of this.view.sequenceComponents){const n=e.findByClick(t);if(n)return n}return this.view.resolveClick(t)?{component:this,action:{type:q.selectStep}}:null}findById(t){if(this.step.id===t)return this;for(const e of this.view.sequenceComponents){const n=e.findById(t);if(n)return n}return null}getPlaceholders(t){this.isDisabled||this.view.sequenceComponents.forEach((e=>e.getPlaceholders(t)))}setIsDragging(t){this.isDisabled||this.view.sequenceComponents.forEach((e=>e.setIsDragging(t))),this.view.setIsDragging(t)}setIsDisabled(t){this.isDisabled=t,this.view.setIsDisabled(t)}setIsSelected(t){this.view.setIsSelected(t)}validate(){const t=!this.configuration.validator||this.configuration.validator(this.step);this.view.setIsValid(t);let e=!0;for(const t of this.view.sequenceComponents)e=t.validate()&&e;return t&&e}}class Tt{constructor(){this.componentType="switch",this.createComponent=Dt.create}getChildren(t){return{type:b.branches,sequences:t.branches}}}class Bt{static create(t,e,n,s){const i=x.create(t,!1,e,s.configuration);return new y(i,e,n,!1,s.configuration)}}class Ft{constructor(){this.componentType="task",this.createComponent=Bt.create}getChildren(){return null}}class Vt{static resolve(t){const e={};if(e.task=new Ft,e.switch=new Tt,e.container=new Et,t)for(const n of t)n.steps.forEach((t=>e[t.componentType]=t));return e}}class Rt{static create(t,e,n){const s=Vt.resolve(n.extensions),i=A.create(t,e,n,s),o=S.create(n.steps,s),r=St.create(t,i,o,i.layoutController,n),a=new Rt(r,i.state,i.definitionModifier,i.workspaceController,i.stepsTraverser);return r.bindKeyUp((t=>a.onKeyUp(t))),i.state.onDefinitionChanged.subscribe((()=>a.onDefinitionChanged.forward(i.state.definition))),a}constructor(t,e,n,s,i){this.view=t,this.state=e,this.definitionModifier=n,this.workspaceController=s,this.stepsTraverser=i,this.onDefinitionChanged=new I}getDefinition(){return this.state.definition}isValid(){return this.view.workspace.isValid}isReadonly(){return this.state.isReadonly}setIsReadonly(t){this.state.setIsReadonly(t)}getSelectedStepId(){return this.state.selectedStepId}selectStepById(t){this.state.setSelectedStepId(t)}clearSelectedStep(){this.state.setSelectedStepId(null)}moveViewPortToStep(t){const e=this.workspaceController.getComponentByStepId(t);this.workspaceController.moveViewPortToStep(e)}getStepParents(t){return this.stepsTraverser.getParents(this.state.definition,t)}destroy(){this.view.destroy()}onKeyUp(t){["Backspace","Delete"].includes(t.key)&&(document.activeElement&&["input","textarea"].includes(document.activeElement.tagName.toLowerCase())||!this.state.selectedStepId||this.state.isReadonly||this.state.isDragging||(t.preventDefault(),t.stopPropagation(),this.definitionModifier.tryDelete(this.state.selectedStepId)))}}class Ht{static create(e,n,s,r){const a=t.svg("g",{class:`sqd-step-folder sqd-type-${s.type}`});e.appendChild(a);const d=t.svg("text",{x:46,y:20,class:"sqd-step-folder-name"});d.textContent=s.name,a.appendChild(d);const l=d.getBBox(),c=Math.max(l.width,40),p=function(t){switch(t){case 0:return"no steps";case 1:return"1 step";default:return`${t} steps`}}(s.sequence.length),g=t.svg("text",{class:"sqd-step-folder-button-text",x:52,y:48});g.textContent=p,a.appendChild(g);const w=g.getBBox(),f=i.appendPath(a,"sqd-step-folder-button-icon-path",i.dirIn,14);t.translate(f,58+w.width,41);const C=18+w.width+14,q=t.svg("rect",{class:"sqd-step-folder-button-rect",width:C,height:24,rx:4,ry:4,x:46.5,y:36.5});a.appendChild(q);const b=46+Math.max(c,C)+12,x=b/2,y=t.svg("rect",{x:.5,y:.5,class:"sqd-step-folder-rect",width:b,height:72,rx:5,ry:5});a.insertBefore(y,d);const k=b/4,S=t.svg("rect",{class:"sqd-step-folder-tab-rect",x:12,y:-6,width:k,height:12,rx:5,ry:5});a.insertBefore(S,y);const I=r.iconUrlProvider?r.iconUrlProvider(s.componentType,s.type):null,P=I?t.svg("image",{href:I}):t.svg("rect",{class:"sqd-step-folder-empty-icon",rx:4,ry:4});t.attrs(P,{x:12,y:25,width:22,height:22}),a.appendChild(P);const E=o.createRoundInput(a,x,0),M=n?null:h.create(a,x,72),D=u.create(a,b,0),T=m.create(a,10,10,b-20,52,v.in);return new Ht(a,b,72,x,T,y,S,q,E,M,D)}constructor(t,e,n,s,i,o,r,a,d,l,h){this.g=t,this.width=e,this.height=n,this.joinX=s,this.placeholderView=i,this.rect=o,this.tab=r,this.buttonRect=a,this.inputView=d,this.outputView=l,this.validationErrorView=h}getClientPosition(){const t=this.rect.getBoundingClientRect();return new e(t.x,t.y)}resolveClick(t){return t.element===this.buttonRect?{type:q.openFolder}:this.g.contains(t.element)?{type:q.selectStep}:null}setIsDragging(e){var n;t.toggleClass(this.tab,e,"sqd-hidden"),this.inputView.setIsHidden(e),null===(n=this.outputView)||void 0===n||n.setIsHidden(e)}setIsDisabled(e){t.toggleClass(this.g,e,"sqd-disabled")}setIsSelected(e){t.toggleClass(this.rect,e,"sqd-selected")}setIsValid(t){this.validationErrorView.setIsHidden(t)}}class Lt{static create(t,e,n,s){const i=Ht.create(t,!1,e,s.configuration);return new Lt(i,e,n,!1,s.configuration)}constructor(t,e,n,s,i){this.view=t,this.step=e,this.parentSequence=n,this.isInterrupted=s,this.configuration=i,this.isDisabled=!1}findByClick(t){const e=this.view.resolveClick(t);return e?{component:this,action:e}:null}findById(t){return this.step.id===t?this:null}getPlaceholders(t){if(!this.isDisabled){const e=this.step.sequence;t.push(new g(this.view.placeholderView,e,e.length))}}setIsDragging(t){this.isDisabled||this.view.placeholderView.setIsVisible(t),this.view.setIsDragging(t)}setIsDisabled(t){this.isDisabled=t,this.view.setIsDisabled(t)}setIsSelected(t){this.view.setIsSelected(t)}validate(){const t=!this.configuration.validator||this.configuration.validator(this.step);return this.view.setIsValid(t),t}}class zt{constructor(){this.componentType="folder",this.createComponent=Lt.create}getChildren(t){return{type:b.singleSequence,sequences:t.sequence}}}const Zt=26;class At{static create(e,n,s,i){const r=t.svg("g",{class:`sqd-step-icon sqd-type-${n.type}`});e.appendChild(r);const a=t.svg("circle",{cx:Zt,cy:Zt,r:Zt,class:"sqd-step-icon-circle"});r.appendChild(a);const d=i.iconUrlProvider?i.iconUrlProvider(n.componentType,n.type):null;if(d){const e=t.svg("image",{class:"sqd-step-icon-image",href:d,x:12,y:12,width:28,height:28});r.appendChild(e)}const l=o.createRoundInput(r,Zt,0),c=s?null:h.create(r,Zt,52),p=u.create(r,52,0);return new At(r,52,52,Zt,a,l,c,p)}constructor(t,e,n,s,i,o,r,a){this.g=t,this.width=e,this.height=n,this.joinX=s,this.circle=i,this.inputView=o,this.outputView=r,this.validationErrorView=a}resolveClick(t){return this.g.contains(t.element)?{type:q.selectStep}:null}setIsSelected(e){t.toggleClass(this.circle,e,"sqd-selected")}setIsDisabled(e){t.toggleClass(this.g,e,"sqd-disabled")}setIsValid(t){this.validationErrorView.setIsHidden(t)}getClientPosition(){const t=this.g.getBoundingClientRect();return new e(t.x,t.y)}setIsDragging(t){var e;this.inputView.setIsHidden(t),null===(e=this.outputView)||void 0===e||e.setIsHidden(t)}}class Ut{static create(t,e,n,s){const i=At.create(t,e,!1,s.configuration);return new y(i,e,n,!1,s.configuration)}}class $t{constructor(){this.componentType="icon",this.createComponent=Ut.create}getChildren(){return null}}class jt{static create(t,e,n,s){const i=At.create(t,e,!0,s.configuration);return new y(i,e,n,!0,s.configuration)}}class Xt{constructor(){this.componentType="interruptingIcon",this.createComponent=jt.create}getChildren(){return null}}class Ot{static create(t,e,n,s){const i=x.create(t,!0,e,s.configuration);return new y(i,e,n,!0,s.configuration)}}class Qt{constructor(){this.componentType="interruptingTask",this.createComponent=Ot.create}getChildren(){return null}}class Nt{static create(){return new Nt([new $t,new Xt,new Qt,new zt])}constructor(t){this.steps=t,this.name="pro"}}var Jt=n(62),Wt=n.n(Jt),Kt=n(36),Yt=n.n(Kt),Gt=n(793),_t=n.n(Gt),te=n(892),ee=n.n(te),ne=n(173),se=n.n(ne),ie=n(464),oe=n.n(ie),re=n(446),ae={};ae.styleTagTransform=oe(),ae.setAttributes=ee(),ae.insert=_t().bind(null,"head"),ae.domAPI=Yt(),ae.insertStyleElement=se(),Wt()(re.Z,ae),re.Z&&re.Z.locals&&re.Z.locals;var de=n(929),le={};le.styleTagTransform=oe(),le.setAttributes=ee(),le.insert=_t().bind(null,"head"),le.domAPI=Yt(),le.insertStyleElement=se(),Wt()(de.Z,le),de.Z&&de.Z.locals&&de.Z.locals;var he=n(21),ce={};ce.styleTagTransform=oe(),ce.setAttributes=ee(),ce.insert=_t().bind(null,"head"),ce.domAPI=Yt(),ce.insertStyleElement=se(),Wt()(he.Z,ce),he.Z&&he.Z.locals&&he.Z.locals;var pe=n(279),ue={};ue.styleTagTransform=oe(),ue.setAttributes=ee(),ue.insert=_t().bind(null,"head"),ue.domAPI=Yt(),ue.insertStyleElement=se(),Wt()(pe.Z,ue),pe.Z&&pe.Z.locals&&pe.Z.locals;var ge=n(769),ve={};ve.styleTagTransform=oe(),ve.setAttributes=ee(),ve.insert=_t().bind(null,"head"),ve.domAPI=Yt(),ve.insertStyleElement=se(),Wt()(ge.Z,ve),ge.Z&&ge.Z.locals&&ge.Z.locals;var me=n(946),we={};we.styleTagTransform=oe(),we.setAttributes=ee(),we.insert=_t().bind(null,"head"),we.domAPI=Yt(),we.insertStyleElement=se(),Wt()(me.Z,we),me.Z&&me.Z.locals&&me.Z.locals;class fe{static createSwitchStep(t,e,n){return{id:s.next(),componentType:"switch",type:"switch",name:t,branches:{true:e,false:n},properties:{}}}static createTaskStep(t){return{id:s.next(),componentType:"task",name:t,properties:{},type:"task"}}static createFolderStep(t,e){return{id:s.next(),componentType:"folder",name:t,type:"folder",sequence:e,properties:{}}}}function Ce(t,e){const n=document.createElement("h3");n.innerText=e,t.appendChild(n)}document.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("designer"),e={properties:{},sequence:[fe.createTaskStep("Read table"),fe.createSwitchStep("Is enabled",[fe.createTaskStep("API request"),fe.createFolderStep("Prepare data",[fe.createTaskStep("Read user"),fe.createFolderStep("Save data",[fe.createSwitchStep("Compare",[],[])])])],[fe.createTaskStep("Send e-mail")]),fe.createTaskStep("Publish")]},n={editors:{stepEditorProvider:(t,e)=>{const n=document.createElement("div");Ce(n,`Type: ${t.type}`),Ce(n,`Component type: ${t.componentType}`),Ce(n,"Name");const s=document.createElement("input");s.value=t.name,s.addEventListener("input",(()=>{t.name=s.value,e.notifyNameChanged()})),n.appendChild(s),Ce(n,"Is valid");const i=document.createElement("input");return i.type="checkbox",i.checked=!!t.properties.isValid,i.addEventListener("input",(()=>{t.properties.isValid=i.checked,e.notifyPropertiesChanged()})),n.appendChild(i),n},globalEditorProvider:()=>{const t=document.createElement("div");return t.innerText="Please select any step.",t}},steps:{iconUrlProvider:(t,e)=>`./assets/icon-${e}.svg`,validator:t=>!t.properties.isValid},toolbox:{groups:[("Steps",s=[fe.createTaskStep("Task"),fe.createSwitchStep("If",[],[]),fe.createFolderStep("Folder",[])],{name:"Steps",steps:s})]},extensions:[Nt.create()]};var s;Rt.create(t,e,n)}))})()})();