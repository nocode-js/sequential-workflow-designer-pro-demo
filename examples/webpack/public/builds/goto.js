(()=>{"use strict";var t={769:(t,e,n)=>{n.d(e,{Z:()=>a});var s=n(601),i=n.n(s),o=n(609),r=n.n(o)()(i());r.push([t.id,"\n/* light > .sqd-icon */\n\n.sqd-theme-light .sqd-icon-circle {\n\tfill: #FFF;\n\tstroke: #C3C3C3;\n\tfilter: drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, .15));\n}\n.sqd-theme-light .sqd-icon-circle.sqd-selected {\n\tstroke: #ED4800;\n}\n",""]);const a=r},279:(t,e,n)=>{n.d(e,{Z:()=>a});var s=n(601),i=n.n(s),o=n(609),r=n.n(o)()(i());r.push([t.id,"\n/* .sqd-icon */\n\n.sqd-icon-circle {\n\tstroke-width: 1;\n}\n.sqd-icon-circle.sqd-selected {\n\tstroke-width: 2;\n}\n",""]);const a=r},929:(t,e,n)=>{n.d(e,{Z:()=>a});var s=n(601),i=n.n(s),o=n(609),r=n.n(o)()(i());r.push([t.id,"\n/********* light *********/\n\n.sqd-theme-light.sqd-designer {\n\tbackground: #F9F9F9;\n}\n\n/* light > .sqd-toolbox */\n\n.sqd-theme-light .sqd-toolbox {\n\tbackground: #FFF;\n\tbox-shadow: 0 0 8px rgba(0, 0, 0, .15), 0 2px 4px rgba(0, 0, 0, .15);\n}\n.sqd-theme-light .sqd-toolbox-filter {\n\tborder: 1px solid #C3C3C3;\n}\n.sqd-theme-light .sqd-toolbox-filter:focus {\n\tborder-color: #939393;\n}\n.sqd-theme-light .sqd-toolbox-group-title {\n\tbackground: #E5E5E5;\n}\n.sqd-theme-light .sqd-toolbox-item {\n\tborder: 1px solid #C3C3C3;\n\tbox-shadow: 0 2px 2px rgba(0, 0, 0, .15);\n}\n.sqd-theme-light .sqd-toolbox-item:hover {\n\tborder: 1px solid #939393;\n}\n.sqd-theme-light .sqd-toolbox-item-icon.sqd-no-icon {\n\tbackground: #C6C6C6;\n}\n\n/* light > .sqd-control-bar */\n\n.sqd-theme-light .sqd-control-bar {\n\tbackground: #FFF;\n\tbox-shadow: 0 0 8px rgba(0, 0, 0, .15), 0 2px 4px rgba(0, 0, 0, .15);\n}\n.sqd-theme-light .sqd-control-bar-button {\n\tborder: 1px solid #C3C3C3;\n}\n.sqd-theme-light .sqd-control-bar-button:hover {\n\tborder-color: #939393;\n}\n\n/* light > .sqd-workspace */\n\n.sqd-theme-light .sqd-grid-path {\n\tstroke: #E3E3E3;\n}\n.sqd-theme-light .sqd-join {\n\tstroke: #000;\n}\n\n/* light > .sqd-smart-editor */\n\n.sqd-theme-light .sqd-smart-editor {\n\tbackground: #FFF;\n\tbox-shadow: 0 0 8px rgba(0, 0, 0, .15);\n}\n.sqd-theme-light .sqd-smart-editor-toggle {\n\tbackground: #FFF;\n\tbox-shadow: 0 0 8px rgba(0, 0, 0, .15);\n}\n\n/* light > .sqd-task */\n\n.sqd-theme-light .sqd-task-rect {\n\tfill: #FFF;\n\tstroke: #C3C3C3;\n\tfilter: drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, .15));\n}\n.sqd-theme-light .sqd-task-rect.sqd-selected {\n\tstroke: #ED4800;\n}\n.sqd-theme-light .sqd-task-text {\n\tfill: #000;\n}\n.sqd-theme-light .sqd-task-empty-icon {\n\tfill: #C6C6C6;\n}\n\n/* light > .sqd-input + .sqd-output */\n\n.sqd-theme-light .sqd-input {\n\tfill: #FFF;\n\tstroke: #000;\n}\n\n.sqd-theme-light .sqd-output {\n\tfill: #000;\n}\n\n/* light > .sqd-region */\n\n.sqd-theme-light .sqd-region {\n\tstroke: #CECECE;\n}\n.sqd-theme-light .sqd-region.sqd-selected {\n\tstroke: #ED4800;\n}\n.sqd-theme-light .sqd-label-rect {\n\tfill: #2411DB;\n}\n.sqd-theme-light .sqd-label-rect.sqd-label-secondary {\n\tfill: #000;\n}\n.sqd-theme-light .sqd-label-text {\n\tfill: #FFF;\n}\n\n/* light > .sqd-start-stop */\n\n.sqd-theme-light .sqd-start-stop {\n\tfill: #2C18DF;\n}\n.sqd-theme-light .sqd-start-stop-icon {\n\tfill: #FFF;\n}\n\n/* light > .sqd-placeholder */\n\n.sqd-theme-light .sqd-placeholder {\n\tfill: #D8D8D8;\n\tstroke: #6A6A6A;\n}\n.sqd-theme-light .sqd-placeholder.sqd-hover {\n\tfill: #ED4800;\n}\n\n.sqd-theme-light .sqd-validation-error {\n\tfill: #FFA200;\n}\n",""]);const a=r},446:(t,e,n)=>{n.d(e,{Z:()=>a});var s=n(601),i=n.n(s),o=n(609),r=n.n(o)()(i());r.push([t.id,"\n.sqd-designer {\n\tposition: relative;\n\tdisplay: flex;\n\twidth: 100%;\n\theight: 100%;\n}\n.sqd-designer, .sqd-drag {\n\tfont-size: 13px;\n\tline-height: 1em;\n}\n.sqd-hidden {\n\tdisplay: none !important;\n}\n.sqd-disabled {\n\topacity: 0.25;\n}\n\n/* .sqd-toolbox */\n\n.sqd-toolbox, .sqd-toolbox-filter {\n\tfont-size: 11px;\n\tline-height: 1.2em;\n}\n.sqd-toolbox {\n\tposition: absolute;\n\ttop: 10px;\n\tleft: 10px;\n\tz-index: 20;\n\tbox-sizing: border-box;\n\tborder-radius: 10px;\n\twidth: 130px;\n\tuser-select: none;\n}\n.sqd-toolbox-header {\n\tposition: relative;\n\tpadding: 15px 10px;\n\tcursor: pointer;\n}\n.sqd-toolbox-header-title {\n\tdisplay: block;\n\tfont-size: 1.2em;\n\tline-height: 1em;\n\tfont-weight: bold;\n}\n.sqd-toolbox-toggle-icon {\n\tposition: absolute;\n\ttop: 50%;\n\tright: 10px;\n\twidth: 16px;\n\theight: 16px;\n\tmargin: -8px 0 0;\n}\n.sqd-toolbox-header:hover .sqd-toolbox-toggle-icon {\n\topacity: .6;\n}\n.sqd-scrollbox {\n\tposition: relative;\n\toverflow: hidden;\n}\n.sqd-scrollbox-body {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n}\n.sqd-toolbox-filter {\n\tdisplay: block;\n\tbox-sizing: border-box;\n\tpadding: 6px 8px;\n\toutline: none;\n\twidth: 110px;\n\tmargin: 0 10px 10px;\n\tbox-sizing: border-box;\n\tborder-radius: 10px;\n}\n.sqd-toolbox-group-title {\n\ttext-align: center;\n\tpadding: 5px 0;\n\tmargin: 0 10px 10px;\n\tborder-radius: 10px;\n}\n.sqd-toolbox-item {\n\tposition: relative;\n\tborder-radius: 5px;\n\tbox-sizing: border-box;\n\tmargin: 0 10px 10px;\n\twidth: 110px;\n\tcursor: move;\n}\n.sqd-toolbox-item-icon {\n\tposition: absolute;\n\ttop: 50%;\n\tleft: 5px;\n\tmargin-top: -10px;\n\twidth: 20px;\n\theight: 20px;\n}\n.sqd-toolbox-item-icon.sqd-no-icon {\n\tborder-radius: 4px;\n}\n.sqd-toolbox-item-icon-image {\n\twidth: 100%;\n\theight: 100%;\n}\n.sqd-toolbox-item-text {\n\tposition: relative;\n\tdisplay: block;\n\tpadding: 10px 10px 10px 30px;\n\twhite-space: nowrap;\n\ttext-overflow: ellipsis;\n\toverflow: hidden;\n}\n\n.sqd-drag {\n\tposition: absolute;\n\tz-index: 9999999;\n\tpointer-events: none;\n}\n\n/* .sqd-control-bar */\n\n.sqd-control-bar {\n\tposition: absolute;\n\tbottom: 10px;\n\tleft: 10px;\n\tz-index: 20;\n\tpadding: 8px 0 8px 8px;\n\tborder-radius: 10px;\n\twhite-space: nowrap;\n}\n.sqd-control-bar-button {\n\tdisplay: inline-block;\n\twidth: 30px;\n\theight: 30px;\n\tborder-radius: 5px;\n\tmargin-right: 8px;\n\tcursor: pointer;\n}\n.sqd-control-bar-button-icon {\n\twidth: 24px;\n\theight: 24px;\n\tmargin: 3px 0 0 3px;\n}\n.sqd-control-bar-button.sqd-disabled .sqd-control-bar-button-icon {\n\topacity: .2;\n}\n\n/* .sqd-workspace */\n\n.sqd-workspace {\n\tflex: 1;\n\tposition: relative;\n\tdisplay: block;\n\tuser-select: none;\n}\n.sqd-workspace-canvas {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tcursor: move;\n}\n.sqd-grid-path {\n\tstroke-width: 1;\n}\n.sqd-join {\n\tstroke-width: 2;\n}\n\n/* .sqd-smart-editor */\n\n.sqd-smart-editor-toggle {\n\tposition: absolute;\n\ttop: 0;\n\tz-index: 29;\n\twidth: 36px;\n\theight: 64px;\n\tborder-bottom-left-radius: 10px;\n\tcursor: pointer;\n}\n.sqd-smart-editor-toggle-icon {\n\tposition: absolute;\n\ttop: 50%;\n\tleft: 50%;\n\twidth: 24px;\n\theight: 24px;\n\tmargin: -12px 0 0 -12px;\n}\n.sqd-smart-editor-toggle:hover .sqd-smart-editor-toggle-icon {\n\topacity: .6;\n}\n.sqd-smart-editor {\n\tz-index: 30;\n}\n.sqd-layout-desktop .sqd-smart-editor {\n\tposition: relative;\n\twidth: 300px;\n}\n.sqd-layout-desktop .sqd-smart-editor-toggle {\n\tright: 300px;\n}\n.sqd-layout-desktop .sqd-smart-editor-toggle.sqd-collapsed {\n\tright: 0;\n}\n.sqd-layout-mobile .sqd-smart-editor {\n\tposition: absolute;\n\ttop: 0;\n\tright: 0;\n\tbottom: 0;\n\tleft: 41px;\n}\n.sqd-layout-mobile .sqd-smart-editor-toggle {\n\tleft: 5px;\n}\n.sqd-layout-mobile .sqd-smart-editor-toggle.sqd-collapsed {\n\tleft: auto;\n\tright: 0;\n}\n\n/* .sqd-task */\n\n.sqd-task-rect {\n\tstroke-width: 1;\n}\n.sqd-task-rect.sqd-selected {\n\tstroke-width: 2;\n}\n.sqd-task-text {\n\ttext-anchor: left;\n\tdominant-baseline: central;\n}\n\n/* .sqd-input + .sqd-output */\n\n.sqd-input {\n\tstroke-width: 2;\n}\n\n/* .sqd-region */\n\n.sqd-region {\n\tstroke-width: 2;\n\tstroke-dasharray: 3;\n}\n.sqd-region.sqd-selected {\n\tstroke-width: 2;\n\tstroke-dasharray: 0;\n}\n.sqd-label-text {\n\ttext-anchor: middle;\n\tdominant-baseline: central;\n}\n\n/* .sqd-placeholder */\n\n.sqd-placeholder {\n\tstroke-width: 1;\n\tstroke-dasharray: 3;\n}\n",""]);const a=r},609:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",s=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),s&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),s&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,s,i,o){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(s)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(r[l]=!0)}for(var d=0;d<t.length;d++){var c=[].concat(t[d]);s&&r[c[0]]||(void 0!==o&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=o),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),i&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=i):c[4]="".concat(i)),e.push(c))}},e}},601:t=>{t.exports=function(t){return t[1]}},62:t=>{var e=[];function n(t){for(var n=-1,s=0;s<e.length;s++)if(e[s].identifier===t){n=s;break}return n}function s(t,s){for(var o={},r=[],a=0;a<t.length;a++){var l=t[a],d=s.base?l[0]+s.base:l[0],c=o[d]||0,h="".concat(d," ").concat(c);o[d]=c+1;var p=n(h),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)e[p].references++,e[p].updater(u);else{var g=i(u,s);s.byIndex=a,e.splice(a,0,{identifier:h,updater:g,references:1})}r.push(h)}return r}function i(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,i){var o=s(t=t||[],i=i||{});return function(t){t=t||[];for(var r=0;r<o.length;r++){var a=n(o[r]);e[a].references--}for(var l=s(t,i),d=0;d<o.length;d++){var c=n(o[d]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}o=l}}},793:t=>{var e={};t.exports=function(t,n){var s=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(n)}},173:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},892:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},36:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var s="";n.supports&&(s+="@supports (".concat(n.supports,") {")),n.media&&(s+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(s+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),s+=n.css,i&&(s+="}"),n.media&&(s+="}"),n.supports&&(s+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(s,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},464:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(s){var i=e[s];if(void 0!==i)return i.exports;var o=e[s]={id:s,exports:{}};return t[s](o,o.exports,n),o.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0,(()=>{class t{static svg(e,n){const s=document.createElementNS("http://www.w3.org/2000/svg",e);return n&&t.attrs(s,n),s}static translate(t,e,n){t.setAttribute("transform",`translate(${e}, ${n})`)}static attrs(t,e){Object.keys(e).forEach((n=>{const s=e[n];t.setAttribute(n,"string"==typeof s?s:s.toString())}))}static element(e,n){const s=document.createElement(e);return n&&t.attrs(s,n),s}static toggleClass(t,e,n){e?t.classList.add(n):t.classList.remove(n)}}class e{constructor(t,e){this.x=t,this.y=e}add(t){return new e(this.x+t.x,this.y+t.y)}subtract(t){return new e(this.x-t.x,this.y-t.y)}multiplyByScalar(t){return new e(this.x*t,this.y*t)}divideByScalar(t){return new e(this.x/t,this.y/t)}round(){return new e(Math.round(this.x),Math.round(this.y))}distance(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}}class s{static next(){const t=new Uint8Array(16);return window.crypto.getRandomValues(t),Array.from(t,(t=>t.toString(16).padStart(2,"0"))).join("")}}class i{static createRectInput(e,n,s,o){const r=t.svg("g");e.appendChild(r);const a=t.svg("rect",{class:"sqd-input",width:18,height:18,x:n-9,y:s+-9+.5,rx:4,ry:4});if(r.appendChild(a),o){const e=t.svg("image",{href:o,width:14,height:14,x:n-7,y:s+-7});r.appendChild(e)}return new i(r)}static createRoundInput(e,n,s){const o=t.svg("circle",{class:"sqd-input",cx:n,xy:s,r:7});return e.appendChild(o),new i(o)}constructor(t){this.root=t}setIsHidden(e){t.attrs(this.root,{visibility:e?"hidden":"visible"})}}class o{static createStraightJoin(e,n,s){const i=t.svg("line",{class:"sqd-join",x1:n.x,y1:n.y,x2:n.x,y2:n.y+s});e.insertBefore(i,e.firstChild)}static createJoins(t,e,n){const s=n[0],i=Math.abs(s.y-e.y)/2,l=Math.sign(s.y-e.y);switch(n.length){case 1:e.x===n[0].x?o.createStraightJoin(t,e,s.y*l):r(t,e,n,i,l);break;case 2:r(t,e,n,i,l);break;default:{const s=n[0],r=n[n.length-1];a(t,`M ${s.x} ${s.y} q ${.3*i} ${i*-l*.8} ${i} ${i*-l} l ${r.x-s.x-2*i} 0 q ${.8*i} ${-i*-l*.3} ${i} ${-i*-l}`);for(let e=1;e<n.length-1;e++)o.createStraightJoin(t,n[e],i*-l);o.createStraightJoin(t,e,i*l)}}}}function r(t,e,n,s,i){for(const o of n){const n=Math.abs(o.x-e.x)-2*s,r=Math.sign(o.x-e.x);a(t,`M ${e.x} ${e.y} q ${r*s*.3} ${i*s*.8} ${r*s} ${i*s} l ${r*n} 0 q ${r*s*.7} ${i*s*.2} ${r*s} ${i*s}`)}}function a(e,n){const s=t.svg("path",{class:"sqd-join",fill:"none",d:n});e.insertBefore(s,e.firstChild)}class l{static create(e,n,s,i,o){const r=t.svg("text",{class:"sqd-label-text",x:n,y:s+11});r.textContent=i,e.appendChild(r);const a=Math.max(r.getBBox().width+20,50),l=t.svg("rect",{class:"sqd-label-rect",width:a,height:22,x:n-a/2,y:s,rx:10,ry:10});o&&l.classList.add(`sqd-label-${o}`),e.insertBefore(l,r)}}class d{static create(e,n,s){const i=t.svg("circle",{class:"sqd-output",cx:n,cy:s,r:5});return e.appendChild(i),new d(i)}constructor(t){this.root=t}setIsHidden(e){t.attrs(this.root,{visibility:e?"hidden":"visible"})}}class c{static create(e,n,s){const i=n.reduce(((t,e)=>t+e),0),o=t.svg("rect",{class:"sqd-region",width:i,height:s,fill:"transparent",rx:5,ry:5}),r=[o];e.insertBefore(o,e.firstChild);let a=n[0];for(let i=1;i<n.length;i++){const o=t.svg("line",{class:"sqd-region",x1:a,y1:0,x2:a,y2:s});r.push(o),e.insertBefore(o,e.firstChild),a+=n[i]}return new c(r)}constructor(t){this.regions=t}getClientPosition(){const t=this.regions[0].getBoundingClientRect();return new e(t.x,t.y)}setIsSelected(e){this.regions.forEach((n=>{t.toggleClass(n,e,"sqd-selected")}))}}class h{static create(e,n,s){const i=t.svg("g",{class:"sqd-hidden"});t.translate(i,n,s);const o=t.svg("path",{class:"sqd-validation-error",d:"M 0 -10 l 10 20 l -20 0 Z"});return i.appendChild(o),e.appendChild(i),new h(i)}constructor(t){this.g=t}setIsHidden(e){t.toggleClass(this.g,e,"sqd-hidden")}}class p{constructor(t,e,n){this.element=t,this.parentSequence=e,this.index=n}setIsHover(e){t.toggleClass(this.element,e,"sqd-hover")}}const u=24;class g{static create(n,s,i){const r=t.svg("g");n.appendChild(r);const a=s.map((t=>i.stepComponentFactory.create(r,t,s,i))),l=a.length>0?Math.max(...a.map((t=>t.view.joinX))):50,d=a.length>0?Math.max(...a.map((t=>t.view.width))):100;let c=u;const h=[];for(let n=0;n<a.length;n++){const s=a[n],i=l-s.view.joinX;0!==n&&a[n-1].isInterrupted||o.createStraightJoin(r,new e(l,c-u),u),h.push(v(r,l-50,c-u)),t.translate(s.view.g,i,c),c+=s.view.height+u}return 0!==a.length&&a[a.length-1].isInterrupted||o.createStraightJoin(r,new e(l,c-u),u),h.push(v(r,l-50,c-u)),new g(r,d,c,l,h,a)}constructor(t,e,n,s,i,o){this.g=t,this.width=e,this.height=n,this.joinX=s,this.placeholders=i,this.components=o}getClientPosition(){throw new Error("Not supported")}setIsDragging(e){this.placeholders.forEach((n=>{t.attrs(n,{visibility:e?"visible":"hidden"})}))}isInterrupted(){return this.components.length>0&&this.components[this.components.length-1].isInterrupted}}function v(e,n,s){const i=t.svg("rect",{class:"sqd-placeholder",width:100,height:u,x:n,y:s,rx:6,ry:6,visibility:"hidden"});return e.appendChild(i),i}class w{static create(t,e,n){const s=g.create(t,e,n);return new w(s,s.isInterrupted(),e)}constructor(t,e,n){this.view=t,this.isInterrupted=e,this.sequence=n}findByElement(t){for(const e of this.view.components){const n=e.findByElement(t);if(n)return n}return null}findById(t){for(const e of this.view.components){const n=e.findById(t);if(n)return n}return null}getPlaceholders(t){this.view.placeholders.forEach(((e,n)=>{t.push(new p(e,this.sequence,n))})),this.view.components.forEach((e=>e.getPlaceholders(t)))}setIsDragging(t){this.view.setIsDragging(t),this.view.components.forEach((e=>e.setIsDragging(t)))}validate(){let t=!0;for(const e of this.view.components)t=e.validate()&&t;return t}}class m{static create(e,n,s,o){const r=t.svg("g",{class:`sqd-task-group sqd-type-${s.type}`});e.appendChild(r);const a=t.svg("text",{x:46,y:21,class:"sqd-task-text"});a.textContent=s.name,r.appendChild(a);const l=58+Math.max(a.getBBox().width,70),c=t.svg("rect",{x:.5,y:.5,class:"sqd-task-rect",width:l,height:42,rx:5,ry:5});r.insertBefore(c,a);const p=o.iconUrlProvider?o.iconUrlProvider(s.componentType,s.type):null,u=p?t.svg("image",{href:p}):t.svg("rect",{class:"sqd-task-empty-icon",rx:4,ry:4});t.attrs(u,{x:12,y:10,width:22,height:22}),r.appendChild(u);const g=i.createRoundInput(r,l/2,0),v=n?null:d.create(r,l/2,42),w=h.create(r,l,0);return new m(r,l,42,l/2,c,g,v,w)}constructor(t,e,n,s,i,o,r,a){this.g=t,this.width=e,this.height=n,this.joinX=s,this.rect=i,this.inputView=o,this.outputView=r,this.validationErrorView=a}getClientPosition(){const t=this.rect.getBoundingClientRect();return new e(t.x,t.y)}containsElement(t){return this.g.contains(t)}setIsDragging(t){var e;this.inputView.setIsHidden(t),null===(e=this.outputView)||void 0===e||e.setIsHidden(t)}setIsDisabled(e){t.toggleClass(this.g,e,"sqd-disabled")}setIsSelected(e){t.toggleClass(this.rect,e,"sqd-selected")}setIsValid(t){this.validationErrorView.setIsHidden(t)}}var f,C,b;!function(t){t[t.default=0]="default",t[t.selected=1]="selected",t[t.dragging=2]="dragging"}(f||(f={}));class y{constructor(t,e,n,s,i){this.view=t,this.step=e,this.parentSequence=n,this.isInterrupted=s,this.configuration=i}findByElement(t){return this.view.containsElement(t)?this:null}findById(t){return this.step.id===t?this:null}getPlaceholders(){}setIsDragging(t){this.view.setIsDragging(t)}setState(t){switch(t){case f.default:this.view.setIsDisabled(!1),this.view.setIsSelected(!1);break;case f.selected:this.view.setIsDisabled(!1),this.view.setIsSelected(!0);break;case f.dragging:this.view.setIsDisabled(!0),this.view.setIsSelected(!1)}}validate(){const t=!this.configuration.validator||this.configuration.validator(this.step);return this.view.setIsValid(t),t}}class x{constructor(t){this.extensions=t}create(t,e,n,s){const i=this.extensions[e.componentType];if(!i)throw new Error(`Unknown component type: ${e.componentType}`);return i.createComponent(t,e,n,s)}}class q{static create(t,e){return new q(t,new x(e))}constructor(t,e){this.configuration=t,this.stepComponentFactory=e}}!function(t){t[t.singleSequence=1]="singleSequence",t[t.branches=2]="branches"}(C||(C={}));class S{constructor(){this.listeners=[]}subscribe(t){this.listeners.push(t)}unsubscribe(t){const e=this.listeners.indexOf(t);if(!(e>=0))throw new Error("Unknown listener");this.listeners.splice(e,1)}forward(t){this.listeners.length>0&&this.listeners.forEach((e=>e(t)))}count(){return this.listeners.length}}function I(t){return new e(t.clientX,t.clientY)}function E(t){if(t.touches.length>0){const n=t.touches[0];return new e(n.clientX,n.clientY)}throw new Error("Unknown touch position")}class M{constructor(){this.onMouseMoveHandler=t=>this.onMouseMove(t),this.onMouseUpHandler=t=>this.onMouseUp(t),this.onTouchMoveHandler=t=>this.onTouchMove(t),this.onTouchEndHandler=t=>this.onTouchEnd(t),this.onTouchStartHandler=t=>this.onTouchStart(t)}start(t,e){this.state?this.stop(!0):(this.state={startPosition:t,behavior:e},e.onStart(this.state.startPosition),window.addEventListener("mousemove",this.onMouseMoveHandler,!1),window.addEventListener("touchmove",this.onTouchMoveHandler,!1),window.addEventListener("mouseup",this.onMouseUpHandler,!1),window.addEventListener("touchend",this.onTouchEndHandler,!1),window.addEventListener("touchstart",this.onTouchStartHandler,!1))}onMouseMove(t){t.preventDefault(),this.move(I(t))}onTouchMove(t){t.preventDefault(),this.move(E(t))}onMouseUp(t){t.preventDefault(),this.stop(!1)}onTouchEnd(t){t.preventDefault(),this.stop(!1)}onTouchStart(t){t.preventDefault(),1!==t.touches.length&&this.stop(!0)}move(t){if(!this.state)throw new Error("State is empty");const e=this.state.startPosition.subtract(t),n=this.state.behavior.onMove(e);n&&(this.state.behavior.onEnd(!0),this.state.behavior=n,this.state.startPosition=t,this.state.behavior.onStart(this.state.startPosition))}stop(t){if(!this.state)throw new Error("State is empty");window.removeEventListener("mousemove",this.onMouseMoveHandler,!1),window.removeEventListener("touchmove",this.onTouchMoveHandler,!1),window.removeEventListener("mouseup",this.onMouseUpHandler,!1),window.removeEventListener("touchend",this.onTouchEndHandler,!1),window.removeEventListener("touchstart",this.onTouchEndHandler,!1),this.state.behavior.onEnd(t),this.state=void 0}}class k{static deepClone(t){return void 0!==window.structuredClone?window.structuredClone(t):JSON.parse(JSON.stringify(t))}}class D{constructor(t){this.stepExtensions=t}find(t,e,n,s){for(const i of t){if(n&&i.id===n)return s.push(i),!0;const t=this.stepExtensions[i.componentType];if(!t)throw new Error(`Not supported type: ${i.componentType}`);const o=t.getChildren(i);if(o)switch(o.type){case C.singleSequence:{const t=o.sequences;if(n&&i.id===n||e&&t===e||this.find(t,e,n,s))return s.push(i),!0}break;case C.branches:{const t=o.sequences,r=Object.keys(t);for(const o of r){const r=t[o];if(e&&r===e||this.find(r,e,n,s))return s.push(o),s.push(i),!0}}break;default:throw new Error(`Step children type ${o.type} is not supported`)}}return!1}getParents(t,e){const n=[],s=Array.isArray(e)?e:null,i=s?null:e.id;return this.find(t.sequence,s,i,n)&&n.reverse(),n}findById(t,e){const n=[];return this.find(t.sequence,null,e,n)?n[0]:null}}class P{static moveStep(t,e,n,s){const i=t.indexOf(e);if(i<0)throw new Error("Unknown step");const o=t===n;o&&i===s||(t.splice(i,1),o&&i<s&&s--,n.splice(s,0,e))}static insertStep(t,e,n){e.splice(n,0,t)}static deleteStep(t,e){const n=e.indexOf(t);if(n<0)throw new Error("Unknown step");e.splice(n,1)}}!function(t){t[t.stepNameChanged=1]="stepNameChanged",t[t.stepPropertyChanged=2]="stepPropertyChanged",t[t.stepChildrenChanged=3]="stepChildrenChanged",t[t.stepDeleted=4]="stepDeleted",t[t.stepMoved=5]="stepMoved",t[t.stepInserted=6]="stepInserted",t[t.globalPropertyChanged=7]="globalPropertyChanged",t[t.rootReplaced=8]="rootReplaced"}(b||(b={}));class T{constructor(t,n,s,i){this.definition=t,this.isReadonly=n,this.isToolboxCollapsed=s,this.isSmartEditorCollapsed=i,this.onViewPortChanged=new S,this.onSelectedStepChanged=new S,this.onIsReadonlyChanged=new S,this.onIsDraggingChanged=new S,this.onIsMoveModeEnabledChanged=new S,this.onIsToolboxCollapsedChanged=new S,this.onIsSmartEditorCollapsedChanged=new S,this.onDefinitionChanged=new S,this.viewPort={position:new e(0,0),scale:1},this.selectedStep=null,this.isDragging=!1,this.isMoveModeEnabled=!1}setViewPort(t,e){this.viewPort={position:t,scale:e},this.onViewPortChanged.forward(this.viewPort)}setSelectedStep(t){this.selectedStep!==t&&(this.selectedStep=t,this.onSelectedStepChanged.forward(t))}setIsReadonly(t){this.isReadonly!==t&&(this.isReadonly=t,this.onIsReadonlyChanged.forward(t))}setIsDragging(t){this.isDragging!==t&&(this.isDragging=t,this.onIsDraggingChanged.forward(t))}toggleIsMoveModeEnabled(){this.isMoveModeEnabled=!this.isMoveModeEnabled,this.onIsMoveModeEnabledChanged.forward(this.isMoveModeEnabled)}toggleIsToolboxCollapsed(){this.isToolboxCollapsed=!this.isToolboxCollapsed,this.onIsToolboxCollapsedChanged.forward(this.isToolboxCollapsed)}toggleIsSmartEditorCollapsed(){this.isSmartEditorCollapsed=!this.isSmartEditorCollapsed,this.onIsSmartEditorCollapsedChanged.forward(this.isSmartEditorCollapsed)}setDefinition(t){this.definition=t,this.notifyDefinitionChanged(b.rootReplaced,null)}notifyDefinitionChanged(t,e){this.onDefinitionChanged.forward({changeType:t,stepId:e})}}class B{constructor(t,e,n,s){this.workspaceController=t,this.stepsTraverser=e,this.state=n,this.configuration=s}tryDelete(t){var e;const n=this.workspaceController.getComponentByStepId(t.id);return!(this.configuration.steps.canDeleteStep&&!this.configuration.steps.canDeleteStep(n.step,n.parentSequence)||(P.deleteStep(n.step,n.parentSequence),this.state.notifyDefinitionChanged(b.stepDeleted,n.step.id),(null===(e=this.state.selectedStep)||void 0===e?void 0:e.id)===t.id&&this.state.setSelectedStep(null),0))}tryInsert(t,e,n){return!(this.configuration.steps.canInsertStep&&!this.configuration.steps.canInsertStep(t,e,n)||(P.insertStep(t,e,n),this.state.notifyDefinitionChanged(b.stepInserted,t.id),this.state.setSelectedStep(t),0))}tryMove(t,e,n,s){return!(this.configuration.steps.canMoveStep&&!this.configuration.steps.canMoveStep(t,e,n,s)||(P.moveStep(t,e,n,s),this.state.notifyDefinitionChanged(b.stepMoved,e.id),this.state.setSelectedStep(e),0))}replaceDefinition(t){if(!t)throw new Error("Definition is empty");if(this.state.setDefinition(t),this.state.selectedStep){const e=this.stepsTraverser.findById(t,this.state.selectedStep.id);this.state.setSelectedStep(e)}}}class R{static create(t,e,n){if(!n.undoStackSize||n.undoStackSize<1)throw new Error("Invalid undo stack size");const s=new R(t,e,n.undoStackSize);return s.remember(b.rootReplaced,null),t.onDefinitionChanged.subscribe((t=>{t.changeType!==b.rootReplaced&&s.remember(t.changeType,t.stepId)})),s}constructor(t,e,n){this.state=t,this.definitionModifier=e,this.stackSize=n,this.stack=[],this.currentIndex=0}canUndo(){return this.currentIndex>1}undo(){this.currentIndex--,this.commit()}canRedo(){return this.currentIndex<this.stack.length}redo(){this.currentIndex++,this.commit()}remember(t,e){const n=k.deepClone(this.state.definition);if(this.stack.length>0&&this.currentIndex===this.stack.length){const s=this.stack[this.stack.length-1];if(function(t,e,n){return t.changeType===e&&t.stepId===n}(s,t,e))return void(s.definition=n)}this.stack.splice(this.currentIndex),this.stack.push({definition:n,changeType:t,stepId:e}),this.stack.length>this.stackSize&&this.stack.splice(0,this.stack.length-this.stackSize-1),this.currentIndex=this.stack.length}commit(){const t=k.deepClone(this.stack[this.currentIndex-1].definition);this.definitionModifier.replaceDefinition(t)}}class z{constructor(t){this.parent=t}isMobile(){return this.parent.clientWidth<400}}class H{set(t){if(this.controller)throw new Error("Controller is already set");this.controller=t}get(){if(!this.controller)throw new Error("Controller is not set");return this.controller}getPlaceholders(){return this.get().getPlaceholders()}getComponentByStepId(t){return this.get().getComponentByStepId(t)}resetViewPort(){this.get().resetViewPort()}zoom(t){this.get().zoom(t)}moveViewPortToStep(t){this.get().moveViewPortToStep(t)}}class V{static create(t,e,n,s){const i=k.deepClone(e),o=new z(t),r=o.isMobile(),a=!!n.isReadonly,l=new T(i,a,r,r),d=new H,c=new D(s),h=new B(d,c,l,n);let p;return n.undoStackSize&&(p=R.create(l,h,n)),new V(l,c,n,o,d,new M,h,p)}constructor(t,e,n,s,i,o,r,a){this.state=t,this.stepsTraverser=e,this.configuration=n,this.layoutController=s,this.workspaceController=i,this.behaviorController=o,this.definitionModifier=r,this.historyController=a}setWorkspaceController(t){this.workspaceController.set(t)}}class L{static create(e,n){const s=t.svg("svg",{class:e,viewBox:"0 0 24 24"});return n&&(s.innerHTML=n),s}}L.center='<path d="M4 15c-.55 0-1 .45-1 1v3c0 1.1.9 2 2 2h3c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1-.45-1-1v-2c0-.55-.45-1-1-1zm1-9c0-.55.45-1 1-1h2c.55 0 1-.45 1-1s-.45-1-1-1H5c-1.1 0-2 .9-2 2v3c0 .55.45 1 1 1s1-.45 1-1V6zm14-3h-3c-.55 0-1 .45-1 1s.45 1 1 1h2c.55 0 1 .45 1 1v2c0 .55.45 1 1 1s1-.45 1-1V5c0-1.1-.9-2-2-2zm0 15c0 .55-.45 1-1 1h-2c-.55 0-1 .45-1 1s.45 1 1 1h3c1.1 0 2-.9 2-2v-3c0-.55-.45-1-1-1s-1 .45-1 1v2zM12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>',L.delete='<path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm4.3 14.3a.996.996 0 0 1-1.41 0L12 13.41 9.11 16.3a.996.996 0 1 1-1.41-1.41L10.59 12 7.7 9.11A.996.996 0 1 1 9.11 7.7L12 10.59l2.89-2.89a.996.996 0 1 1 1.41 1.41L13.41 12l2.89 2.89c.38.38.38 1.02 0 1.41z" fill="#E01A24"/>',L.move='<path d="M10.5 9h3c.28 0 .5-.22.5-.5V6h1.79c.45 0 .67-.54.35-.85l-3.79-3.79c-.2-.2-.51-.2-.71 0L7.85 5.15a.5.5 0 0 0 .36.85H10v2.5c0 .28.22.5.5.5zm-2 1H6V8.21c0-.45-.54-.67-.85-.35l-3.79 3.79c-.2.2-.2.51 0 .71l3.79 3.79a.5.5 0 0 0 .85-.36V14h2.5c.28 0 .5-.22.5-.5v-3c0-.28-.22-.5-.5-.5zm14.15 1.65-3.79-3.79a.501.501 0 0 0-.86.35V10h-2.5c-.28 0-.5.22-.5.5v3c0 .28.22.5.5.5H18v1.79c0 .45.54.67.85.35l3.79-3.79c.2-.19.2-.51.01-.7zM13.5 15h-3c-.28 0-.5.22-.5.5V18H8.21c-.45 0-.67.54-.35.85l3.79 3.79c.2.2.51.2.71 0l3.79-3.79a.5.5 0 0 0-.35-.85H14v-2.5c0-.28-.22-.5-.5-.5z"/>',L.options='<path d="M19.5 12c0-.23-.01-.45-.03-.68l1.86-1.41c.4-.3.51-.86.26-1.3l-1.87-3.23a.987.987 0 0 0-1.25-.42l-2.15.91c-.37-.26-.76-.49-1.17-.68l-.29-2.31c-.06-.5-.49-.88-.99-.88h-3.73c-.51 0-.94.38-1 .88l-.29 2.31c-.41.19-.8.42-1.17.68l-2.15-.91c-.46-.2-1-.02-1.25.42L2.41 8.62c-.25.44-.14.99.26 1.3l1.86 1.41a7.343 7.343 0 0 0 0 1.35l-1.86 1.41c-.4.3-.51.86-.26 1.3l1.87 3.23c.25.44.79.62 1.25.42l2.15-.91c.37.26.76.49 1.17.68l.29 2.31c.06.5.49.88.99.88h3.73c.5 0 .93-.38.99-.88l.29-2.31c.41-.19.8-.42 1.17-.68l2.15.91c.46.2 1 .02 1.25-.42l1.87-3.23c.25-.44.14-.99-.26-1.3l-1.86-1.41c.03-.23.04-.45.04-.68zm-7.46 3.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/>',L.close='<path d="M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7A.996.996 0 1 0 5.7 7.11L10.59 12 5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"/>',L.arrowDown='<path d="M8.12 9.29 12 13.17l3.88-3.88a.996.996 0 1 1 1.41 1.41l-4.59 4.59a.996.996 0 0 1-1.41 0L6.7 10.7a.996.996 0 0 1 0-1.41c.39-.38 1.03-.39 1.42 0z"/>',L.zoomIn='<path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2v1z"/>',L.zoomOut='<path d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.26 4.25c.41.41 1.07.41 1.48 0l.01-.01c.41-.41.41-1.07 0-1.48L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14zm-2-5h4c.28 0 .5.22.5.5s-.22.5-.5.5h-4c-.28 0-.5-.22-.5-.5s.22-.5.5-.5z"/>',L.undo='<path d="m14.2905,19.82718l-7.51346,0l0,-1.5653l7.53954,0q1.82619,0 3.14365,-1.21311q1.31746,-1.21311 1.31746,-3.01321t-1.31746,-3.01321q-1.31746,-1.21311 -3.14365,-1.21311l-7.69608,0l2.97408,2.97408l-1.09571,1.09571l-4.85244,-4.85244l4.85244,-4.85244l1.09571,1.09571l-2.97408,2.97408l7.66999,0q2.4784,0 4.26545,1.66966q1.78705,1.66966 1.78705,4.12197t-1.78705,4.12197q-1.78705,1.66966 -4.26545,1.66966z"/>',L.redo='<path d="m9.92177,19.72362l7.32823,0l0,-1.5653l-7.35368,0q-1.78117,0 -3.06615,-1.21311q-1.28498,-1.21311 -1.28498,-3.01321t1.28498,-3.01321q1.28498,-1.21311 3.06615,-1.21311l7.50635,0l-2.90076,2.97408l1.0687,1.09571l4.73282,-4.85244l-4.73282,-4.85244l-1.0687,1.09571l2.90076,2.97408l-7.4809,0q-2.4173,0 -4.1603,1.66966q-1.743,1.66966 -1.743,4.12197t1.743,4.12197q1.743,1.66966 4.1603,1.66966z"/>';class U{static create(e,n){const s=t.element("div",{class:"sqd-control-bar"}),i=F(L.center,"Reset");s.appendChild(i);const o=F(L.zoomIn,"Zoom in");s.appendChild(o);const r=F(L.zoomOut,"Zoom out");s.appendChild(r);let a=null,l=null;n&&(a=F(L.undo,"Undo"),s.appendChild(a),l=F(L.redo,"Redo"),s.appendChild(l));const d=F(L.move,"Turn on/off drag and drop");d.classList.add("sqd-disabled"),s.appendChild(d);const c=F(L.delete,"Delete selected step");return c.classList.add("sqd-hidden"),s.appendChild(c),e.appendChild(s),new U(i,o,r,a,l,d,c)}constructor(t,e,n,s,i,o,r){this.resetButton=t,this.zoomInButton=e,this.zoomOutButton=n,this.undoButton=s,this.redoButton=i,this.moveButton=o,this.deleteButton=r}bindResetButtonClick(t){$(this.resetButton,t)}bindZoomInButtonClick(t){$(this.zoomInButton,t)}bindZoomOutButtonClick(t){$(this.zoomOutButton,t)}bindUndoButtonClick(t){if(!this.undoButton)throw new Error("Undo button is disabled");$(this.undoButton,t)}bindRedoButtonClick(t){if(!this.redoButton)throw new Error("Redo button is disabled");$(this.redoButton,t)}bindMoveButtonClick(t){$(this.moveButton,t)}bindDeleteButtonClick(t){$(this.deleteButton,t)}setIsDeleteButtonHidden(e){t.toggleClass(this.deleteButton,e,"sqd-hidden")}setIsMoveButtonDisabled(e){t.toggleClass(this.moveButton,e,"sqd-disabled")}setUndoButtonDisabled(e){if(!this.undoButton)throw new Error("Undo button is disabled");t.toggleClass(this.undoButton,e,"sqd-disabled")}setRedoButtonDisabled(e){if(!this.redoButton)throw new Error("Redo button is disabled");t.toggleClass(this.redoButton,e,"sqd-disabled")}}function $(t,e){t.addEventListener("click",(t=>{t.preventDefault(),e()}),!1)}function F(e,n){const s=t.element("div",{class:"sqd-control-bar-button",title:n}),i=L.create("sqd-control-bar-button-icon",e);return s.appendChild(i),s}class A{static create(t,e){const n=U.create(t,!!e.historyController),s=new A(n,e.state,e.workspaceController,e.historyController,e.definitionModifier);return n.bindResetButtonClick((()=>s.onResetButtonClicked())),n.bindZoomInButtonClick((()=>s.onZoomInButtonClicked())),n.bindZoomOutButtonClick((()=>s.onZoomOutButtonClicked())),n.bindMoveButtonClick((()=>s.onMoveButtonClicked())),n.bindDeleteButtonClick((()=>s.onDeleteButtonClicked())),e.state.onIsReadonlyChanged.subscribe((()=>s.onIsReadonlyChanged())),e.state.onSelectedStepChanged.subscribe((()=>s.onSelectedStepChanged())),e.state.onIsMoveModeEnabledChanged.subscribe((t=>s.onIsMoveModeEnabledChanged(t))),e.historyController&&(n.bindUndoButtonClick((()=>s.onUndoButtonClicked())),n.bindRedoButtonClick((()=>s.onRedoButtonClicked())),e.state.onDefinitionChanged.subscribe((()=>s.onDefinitionChanged())),s.refreshUndoRedoAvailability()),s}constructor(t,e,n,s,i){this.view=t,this.state=e,this.workspaceController=n,this.historyController=s,this.definitionModifier=i}onResetButtonClicked(){this.workspaceController.resetViewPort()}onZoomInButtonClicked(){this.workspaceController.zoom(!0)}onZoomOutButtonClicked(){this.workspaceController.zoom(!1)}onMoveButtonClicked(){this.state.toggleIsMoveModeEnabled(),this.state.selectedStep&&this.state.setSelectedStep(null)}onUndoButtonClicked(){var t;!this.state.isReadonly&&(null===(t=this.historyController)||void 0===t?void 0:t.canUndo())&&this.historyController.undo()}onRedoButtonClicked(){var t;!this.state.isReadonly&&(null===(t=this.historyController)||void 0===t?void 0:t.canRedo())&&this.historyController.redo()}onDeleteButtonClicked(){!this.state.isReadonly&&this.state.selectedStep&&this.definitionModifier.tryDelete(this.state.selectedStep)}onIsReadonlyChanged(){this.refreshDeleteButtonVisibility()}onSelectedStepChanged(){this.refreshDeleteButtonVisibility()}onIsMoveModeEnabledChanged(t){this.view.setIsMoveButtonDisabled(!t)}onDefinitionChanged(){this.refreshUndoRedoAvailability()}refreshUndoRedoAvailability(){if(!this.historyController)throw new Error("Undo/redo is disabled");const t=this.historyController.canUndo(),e=this.historyController.canRedo();this.view.setUndoButtonDisabled(!t),this.view.setRedoButtonDisabled(!e)}refreshDeleteButtonVisibility(){const t=!this.state.selectedStep||this.state.isReadonly;this.view.setIsDeleteButtonHidden(t)}}function Z(t,e,n){const s=[void 0,void 0],i=new S;let o=!1;return[e,n].filter((t=>t)).forEach(((e,n)=>{e.subscribe((e=>{s[n]=e,o||(o=!0,setTimeout((()=>{try{i.forward(s)}finally{o=!1,s.fill(void 0)}}),t))}))})),i}class j{static create(e){const n=t.element("div",{class:"sqd-global-editor"});return n.appendChild(e),new j(n)}constructor(t){this.root=t}}class O{static create(t,e){const n={notifyPropertiesChanged:()=>{e.state.notifyDefinitionChanged(b.globalPropertyChanged,null)}},s=e.configuration.editors.globalEditorProvider(t,n),i=j.create(s);return new O(i)}constructor(t){this.view=t}}class N{static create(e){const n=t.element("div",{class:"sqd-smart-editor"}),s=t.element("div",{class:"sqd-smart-editor-toggle",title:"Toggle editor"}),i=L.create("sqd-smart-editor-toggle-icon");return s.appendChild(i),e.appendChild(s),e.appendChild(n),new N(n,s,i)}constructor(t,e,n){this.root=t,this.toggle=e,this.toggleIcon=n}bindToggleIsCollapsedClick(t){this.toggle.addEventListener("click",(e=>{e.preventDefault(),t()}),!1)}setIsCollapsed(e){t.toggleClass(this.root,e,"sqd-hidden"),t.toggleClass(this.toggle,e,"sqd-collapsed"),this.toggleIcon.innerHTML=e?L.options:L.close}setView(t){this.view&&this.root.removeChild(this.view.root),this.root.appendChild(t.root),this.view=t}}class X{static create(e){const n=t.element("div",{class:"sqd-step-editor"});return n.appendChild(e),new X(n)}constructor(t){this.root=t}}class J{static create(t,e){const n={notifyPropertiesChanged:()=>{e.state.notifyDefinitionChanged(b.stepPropertyChanged,t.id)},notifyNameChanged:()=>{e.state.notifyDefinitionChanged(b.stepNameChanged,t.id)},notifyChildrenChanged:()=>{e.state.notifyDefinitionChanged(b.stepChildrenChanged,t.id)}},s=e.configuration.editors.stepEditorProvider(t,n),i=X.create(s);return new J(i)}constructor(t){this.view=t}}class W{static create(t,e){const n=N.create(t);n.setIsCollapsed(e.state.isSmartEditorCollapsed);const s=new W(n,e,e.state);return n.bindToggleIsCollapsedClick((()=>s.toggleIsCollapsedClick())),s.tryRender(null),Z(0,e.state.onDefinitionChanged,e.state.onSelectedStepChanged).subscribe((t=>{const[e,n]=t;e?s.onDefinitionChanged(e):void 0!==n&&s.onSelectedStepChanged(n)})),e.state.onIsSmartEditorCollapsedChanged.subscribe((t=>n.setIsCollapsed(t))),s}constructor(t,e,n){this.view=t,this.context=e,this.state=n,this.currentStep=void 0}toggleIsCollapsedClick(){this.state.toggleIsSmartEditorCollapsed()}onSelectedStepChanged(t){this.tryRender(t)}onDefinitionChanged(t){t.changeType===b.rootReplaced?this.render(this.state.selectedStep):this.tryRender(this.state.selectedStep)}tryRender(t){this.currentStep!==t&&this.render(t)}render(t){const e=t?J.create(t,this.context):O.create(this.state.definition,this.context);this.currentStep=t,this.view.setView(e.view)}}class K{static create(e,n){const s=t.element("div",{class:"sqd-scrollbox"});e.appendChild(s);const i=new K(s,n);return window.addEventListener("resize",i.onResizeHandler,!1),s.addEventListener("wheel",(t=>i.onWheel(t)),!1),s.addEventListener("touchstart",(t=>i.onTouchStart(t)),!1),s.addEventListener("mousedown",(t=>i.onMouseDown(t)),!1),i}constructor(t,e){this.root=t,this.viewport=e,this.onResizeHandler=()=>this.onResize(),this.onTouchMoveHandler=t=>this.onTouchMove(t),this.onMouseMoveHandler=t=>this.onMouseMove(t),this.onTouchEndHandler=t=>this.onTouchEnd(t),this.onMouseUpHandler=t=>this.onMouseUp(t)}setContent(t){this.content&&this.root.removeChild(this.content.element),t.classList.add("sqd-scrollbox-body"),this.root.appendChild(t),this.reload(t)}refresh(){this.content&&this.reload(this.content.element)}destroy(){window.removeEventListener("resize",this.onResizeHandler,!1)}reload(t){let e=Math.min(.7*this.viewport.clientHeight,t.clientHeight);e=Math.min(e,this.viewport.clientHeight-200),this.root.style.height=e+"px",t.style.top="0px",this.content={element:t,height:e}}onResize(){this.refresh()}onWheel(t){if(t.stopPropagation(),this.content){const e=t.deltaY>0?-25:25,n=this.getScrollTop();this.setScrollTop(n+e)}}onTouchStart(t){t.preventDefault(),this.startScroll(E(t))}onMouseDown(t){this.startScroll(I(t))}onTouchMove(t){t.preventDefault(),this.moveScroll(E(t))}onMouseMove(t){t.preventDefault(),this.moveScroll(I(t))}onTouchEnd(t){t.preventDefault(),this.stopScroll()}onMouseUp(t){t.preventDefault(),this.stopScroll()}startScroll(t){this.scroll||(window.addEventListener("touchmove",this.onTouchMoveHandler,!1),window.addEventListener("mousemove",this.onMouseMoveHandler,!1),window.addEventListener("touchend",this.onTouchEndHandler,!1),window.addEventListener("mouseup",this.onMouseUpHandler,!1)),this.scroll={startPositionY:t.y,startScrollTop:this.getScrollTop()}}moveScroll(t){if(this.scroll){const e=t.y-this.scroll.startPositionY;this.setScrollTop(this.scroll.startScrollTop+e)}}stopScroll(){this.scroll&&(window.removeEventListener("touchmove",this.onTouchMoveHandler,!1),window.removeEventListener("mousemove",this.onMouseMoveHandler,!1),window.removeEventListener("touchend",this.onTouchEndHandler,!1),window.removeEventListener("mouseup",this.onMouseUpHandler,!1),this.scroll=void 0)}getScrollTop(){return this.content&&this.content.element.style.top?parseInt(this.content.element.style.top):0}setScrollTop(t){if(this.content){const e=this.content.element.clientHeight-this.content.height,n=Math.max(Math.min(t,0),-e);this.content.element.style.top=n+"px"}}}class Y{static create(e,n,s){const i=n.theme||"light",o=t.element("div",{class:`sqd-drag sqd-theme-${i}`});document.body.appendChild(o);const r=t.svg("svg");o.appendChild(r);const a=s.stepComponentFactory.create(r,e,[],s);return t.attrs(r,{width:a.view.width+20,height:a.view.height+20}),t.translate(a.view.g,10,10),new Y(a.view.width,a.view.height,o)}constructor(t,e,n){this.width=t,this.height=e,this.layer=n}setPosition(t){this.layer.style.top=t.y-10+"px",this.layer.style.left=t.x-10+"px"}remove(){document.body.removeChild(this.layer)}}class G{static create(t,e){const n=new G(t,e);return e.onViewPortChanged.subscribe(n.clearCacheHandler),window.addEventListener("scroll",n.clearCacheHandler,!1),n}constructor(t,e){this.placeholders=t,this.state=e,this.clearCacheHandler=()=>this.clearCache()}find(t,n,s){var i;this.cache||(this.cache=this.placeholders.map((t=>{const n=t.element.getBoundingClientRect();return{placeholder:t,lt:new e(n.x,n.y),br:new e(n.x+n.width,n.y+n.height)}})),this.cache.sort(((t,e)=>t.lt.y-e.lt.y)));const o=t.x+n,r=t.y+s;return null===(i=this.cache.find((e=>Math.max(t.x,e.lt.x)<Math.min(o,e.br.x)&&Math.max(t.y,e.lt.y)<Math.min(r,e.br.y))))||void 0===i?void 0:i.placeholder}destroy(){this.state.onViewPortChanged.unsubscribe(this.clearCacheHandler),window.removeEventListener("scroll",this.clearCacheHandler,!1)}clearCache(){this.cache=void 0}}class _{static create(t,e,n,s){const i=Y.create(n,t.configuration,e);return new _(i,t.workspaceController,t.state,n,t.definitionModifier,s)}constructor(t,e,n,s,i,o){this.view=t,this.workspaceController=e,this.designerState=n,this.step=s,this.definitionModifier=i,this.movingStepComponent=o}onStart(t){let n;if(this.movingStepComponent){this.movingStepComponent.setState(f.dragging);const e=this.movingStepComponent.view.getClientPosition();n=t.subtract(e)}else n=new e(this.view.width/2,this.view.height/2);this.view.setPosition(t.subtract(n)),this.designerState.setIsDragging(!0),this.state={startPosition:t,finder:G.create(this.workspaceController.getPlaceholders(),this.designerState),offset:n}}onMove(t){if(this.state){const e=this.state.startPosition.subtract(t).subtract(this.state.offset);this.view.setPosition(e);const n=this.state.finder.find(e,this.view.width,this.view.height);this.currentPlaceholder!==n&&(this.currentPlaceholder&&this.currentPlaceholder.setIsHover(!1),n&&n.setIsHover(!0),this.currentPlaceholder=n)}}onEnd(t){if(!this.state)throw new Error("Invalid state");this.state.finder.destroy(),this.state=void 0,this.view.remove(),this.designerState.setIsDragging(!1);let e=!1;!t&&this.currentPlaceholder&&(e=this.movingStepComponent?this.definitionModifier.tryMove(this.movingStepComponent.parentSequence,this.movingStepComponent.step,this.currentPlaceholder.parentSequence,this.currentPlaceholder.index):this.definitionModifier.tryInsert(this.step,this.currentPlaceholder.parentSequence,this.currentPlaceholder.index)),e||(this.movingStepComponent&&this.movingStepComponent.setState(f.default),this.currentPlaceholder&&this.currentPlaceholder.setIsHover(!1)),this.currentPlaceholder=void 0}}const Q=/^[a-zA-Z][a-zA-Z0-9_-]+$/;class tt{static validate(t){if(!Q.test(t))throw new Error(`Step type "${t}" contains not allowed characters`)}}class et{static create(e,n,s){const i=t.element("div",{class:`sqd-toolbox-item sqd-type-${n.type}`,title:n.name}),o=s.iconUrlProvider?s.iconUrlProvider(n.componentType,n.type):null,r=t.element("div",{class:"sqd-toolbox-item-icon"});if(o){const e=t.element("img",{class:"sqd-toolbox-item-icon-image",src:o});r.appendChild(e)}else r.classList.add("sqd-no-icon");const a=t.element("div",{class:"sqd-toolbox-item-text"});return a.textContent=n.name,i.appendChild(r),i.appendChild(a),e.appendChild(i),new et(i)}constructor(t){this.root=t}bindMousedown(t){this.root.addEventListener("mousedown",t,!1)}bindTouchstart(t){this.root.addEventListener("touchstart",t,!1)}bindContextMenu(t){this.root.addEventListener("contextmenu",t,!1)}}class nt{static create(t,e,n,s){tt.validate(e.type);const i=et.create(t,e,n.configuration.steps),o=new nt(e,n.state,n.behaviorController,n,s);return i.bindMousedown((t=>o.onMousedown(t))),i.bindTouchstart((t=>o.onTouchstart(t))),i.bindContextMenu((t=>o.onContextMenu(t))),o}constructor(t,e,n,s,i){this.step=t,this.state=e,this.behaviorController=n,this.designerContext=s,this.componentContext=i}onTouchstart(t){t.preventDefault(),1===t.touches.length&&(t.stopPropagation(),this.startDrag(E(t)))}onMousedown(t){t.stopPropagation(),0===t.button&&this.startDrag(I(t))}onContextMenu(t){t.preventDefault()}startDrag(t){if(!this.state.isReadonly){const e=function(t){const e=k.deepClone(t);return e.id=s.next(),e}(this.step);this.behaviorController.start(t,_.create(this.designerContext,this.componentContext,e))}}}class st{static create(e,n,s){const i=t.element("div",{class:"sqd-toolbox"}),o=t.element("div",{class:"sqd-toolbox-header"}),r=t.element("div",{class:"sqd-toolbox-header-title"});r.innerText="Toolbox";const a=L.create("sqd-toolbox-toggle-icon"),l=t.element("div",{class:"sqd-toolbox-body"}),d=t.element("input",{class:"sqd-toolbox-filter",type:"text",placeholder:"Search..."});i.appendChild(o),i.appendChild(l),o.appendChild(r),o.appendChild(a),l.appendChild(d),e.appendChild(i);const c=K.create(l,e);return new st(o,a,l,d,c,n,s)}constructor(t,e,n,s,i,o,r){this.header=t,this.headerToggleIcon=e,this.body=n,this.filterInput=s,this.scrollboxView=i,this.designerContext=o,this.componentContext=r}bindToggleIsCollapsedClick(t){this.header.addEventListener("click",(function(e){e.preventDefault(),t()}),!1)}bindFilterInputChange(t){function e(e){t(e.target.value)}this.filterInput.addEventListener("keyup",e,!1),this.filterInput.addEventListener("blur",e,!1)}setIsCollapsed(e){t.toggleClass(this.body,e,"sqd-hidden"),this.headerToggleIcon.innerHTML=e?L.arrowDown:L.close,e||this.scrollboxView.refresh()}setGroups(e){const n=t.element("div");e.forEach((e=>{const s=t.element("div",{class:"sqd-toolbox-group-title"});s.innerText=e.name,n.appendChild(s),e.steps.forEach((t=>nt.create(n,t,this.designerContext,this.componentContext)))})),this.scrollboxView.setContent(n)}destroy(){this.scrollboxView.destroy()}}class it{static create(t,e,n){const s=st.create(t,e,n);s.setIsCollapsed(e.state.isToolboxCollapsed);const i=new it(s,e.state,e.configuration);return i.render(),e.state.onIsToolboxCollapsedChanged.subscribe((t=>i.onIsToolboxCollapsedChanged(t))),s.bindToggleIsCollapsedClick((()=>i.toggleIsCollapsedClick())),s.bindFilterInputChange((t=>i.onFilterInputChanged(t))),i}constructor(t,e,n){this.view=t,this.state=e,this.configuration=n}destroy(){this.view.destroy()}render(){const t=this.configuration.toolbox.groups.map((t=>({name:t.name,steps:t.steps.filter((t=>!this.filter||t.name.toLowerCase().includes(this.filter)))}))).filter((t=>t.steps.length>0));this.view.setGroups(t)}toggleIsCollapsedClick(){this.state.toggleIsToolboxCollapsed()}onIsToolboxCollapsedChanged(t){this.view.setIsCollapsed(t)}onFilterInputChanged(t){this.filter=t.toLowerCase(),this.render()}}class ot{static create(t){return new ot(t.viewPort.position,t)}constructor(t,e){this.startPosition=t,this.state=e}onStart(){this.state.setSelectedStep(null)}onMove(t){const e=this.startPosition.subtract(t);this.state.setViewPort(e,this.state.viewPort.scale)}onEnd(){}}class rt{static create(t,e,n){return new rt(t,e,n,e.state)}constructor(t,e,n,s){this.pressedStepComponent=t,this.designerContext=e,this.componentContext=n,this.state=s}onStart(){}onMove(t){if(!this.state.isReadonly&&t.distance()>2)return this.state.setSelectedStep(null),_.create(this.designerContext,this.componentContext,this.pressedStepComponent.step,this.pressedStepComponent)}onEnd(t){t||this.state.setSelectedStep(this.pressedStepComponent.step)}}class at{static create(e,n,s){const i=t.svg("g");e.appendChild(i);const o=w.create(i,n,s),r=o.view,a=lt(!0);t.translate(a,r.joinX-15,0),i.appendChild(a),t.translate(r.g,0,30);const l=lt(!1);return t.translate(l,r.joinX-15,30+r.height),i.appendChild(l),new at(i,r.width,r.height+60,r.joinX,o)}constructor(t,e,n,s,i){this.g=t,this.width=e,this.height=n,this.joinX=s,this.component=i}getClientPosition(){throw new Error("Not supported")}destroy(){var t;null===(t=this.g.parentNode)||void 0===t||t.removeChild(this.g)}}function lt(e){const n=t.svg("circle",{class:"sqd-start-stop",cx:15,cy:15,r:15}),s=t.svg("g");s.appendChild(n);if(e){const e=t.svg("path",{class:"sqd-start-stop-icon",transform:"translate(7.5, 7.5)",d:"M 3 0 L 15 7.5 L 3 15 Z"});s.appendChild(e)}else{const e=t.svg("rect",{class:"sqd-start-stop-icon",x:7.5,y:7.5,width:15,height:15,rx:4,ry:4});s.appendChild(e)}return s}class dt{static create(t,e,n){const s=at.create(t,e,n);return new dt(s)}constructor(t){this.view=t,this.isInterrupted=!1}findByElement(t){return this.view.component.findByElement(t)}findById(t){return this.view.component.findById(t)}getPlaceholders(t){this.view.component.getPlaceholders(t)}setIsDragging(t){this.view.component.setIsDragging(t)}validate(){return this.view.component.validate()}}let ct=0;class ht{static create(e,n){const s=t.svg("defs"),i="sqd-grid-pattern-"+ct++,o=t.svg("pattern",{id:i,patternUnits:"userSpaceOnUse"}),r=t.svg("path",{class:"sqd-grid-path",fill:"none"});s.appendChild(o),o.appendChild(r);const a=t.svg("g"),l=t.element("div",{class:"sqd-workspace"}),d=t.svg("svg",{class:"sqd-workspace-canvas"});d.appendChild(s),d.appendChild(t.svg("rect",{width:"100%",height:"100%",fill:`url(#${i})`})),d.appendChild(a),l.appendChild(d),e.appendChild(l);const c=new ht(l,d,o,r,a,n);return window.addEventListener("resize",c.onResizeHandler,!1),c}constructor(t,e,n,s,i,o){this.workspace=t,this.canvas=e,this.gridPattern=n,this.gridPatternPath=s,this.foreground=i,this.context=o,this.onResizeHandler=()=>this.onResize()}render(t){this.rootComponent&&this.rootComponent.view.destroy(),this.rootComponent=dt.create(this.foreground,t,this.context),this.refreshSize()}setPositionAndScale(e,n){const s=48*n;t.attrs(this.gridPattern,{x:e.x,y:e.y,width:s,height:s}),t.attrs(this.gridPatternPath,{d:`M ${s} 0 L 0 0 0 ${s}`}),t.attrs(this.foreground,{transform:`translate(${e.x}, ${e.y}) scale(${n})`})}getClientPosition(){const t=this.canvas.getBoundingClientRect();return new e(t.x,t.y)}getClientSize(){return new e(this.canvas.clientWidth,this.canvas.clientHeight)}bindMouseDown(t){this.canvas.addEventListener("mousedown",(e=>t(I(e),e.target,e.button)),!1)}bindTouchStart(t){this.canvas.addEventListener("touchstart",(e=>{e.preventDefault(),t(E(e))}),!1)}bindContextMenu(t){this.canvas.addEventListener("contextmenu",t,!1)}bindWheel(t){this.canvas.addEventListener("wheel",t,!1)}destroy(){window.removeEventListener("resize",this.onResizeHandler,!1)}refreshSize(){t.attrs(this.canvas,{width:this.workspace.offsetWidth,height:this.workspace.offsetHeight})}onResize(){this.refreshSize()}}class pt{constructor(t){this.state=t}execute(t,e){this.animation&&this.animation.isAlive&&this.animation.stop();const n=this.state.viewPort.position,s=this.state.viewPort.scale,i=n.subtract(t),o=s-e;this.animation=function(t,e){const n=setInterval((function(){const t=Math.min((Date.now()-s)/150,1);e(t),1===t&&i.stop()}),15),s=Date.now(),i={isAlive:!0,stop:()=>{i.isAlive=!1,clearInterval(n)}};return i}(0,(t=>{const e=s-o*t;this.state.setViewPort(n.subtract(i.multiplyByScalar(t)),e)}))}}class ut{static create(t,e,n){const s=ht.create(t,n),i=new pt(e.state),o=new ut(s,e,n,e.state,e.behaviorController,i);return setTimeout((()=>{o.render(),o.resetViewPort()})),e.setWorkspaceController(o),e.state.onViewPortChanged.subscribe((t=>o.onViewPortChanged(t))),e.state.onIsDraggingChanged.subscribe((t=>o.onIsDraggingChanged(t))),e.state.onIsSmartEditorCollapsedChanged.subscribe((()=>o.onIsSmartEditorCollapsedChanged())),Z(0,e.state.onDefinitionChanged,e.state.onSelectedStepChanged).subscribe((t=>{const[e,n]=t;e?e.changeType===b.stepPropertyChanged?o.revalidate():o.render():void 0!==n&&o.onSelectedStepChanged(n)})),s.bindMouseDown(((t,e,n)=>o.onMouseDown(t,e,n))),s.bindTouchStart((t=>o.onTouchStart(t))),s.bindContextMenu((t=>o.onContextMenu(t))),s.bindWheel((t=>o.onWheel(t))),o}constructor(t,e,n,s,i,o){this.view=t,this.designerContext=e,this.componentContext=n,this.state=s,this.behaviorController=i,this.viewPortAnimator=o,this.isValid=!1,this.selectedStepComponent=null}render(){this.selectedStepComponent=null,this.view.render(this.state.definition.sequence),this.selectStep(this.state.selectedStep),this.revalidate()}getPlaceholders(){const t=[];return this.getRootComponent().getPlaceholders(t),t}getComponentByStepId(t){const e=this.getRootComponent().findById(t);if(!e)throw new Error(`Cannot find component for step id: ${t}`);return e}resetViewPort(){const t=this.getRootComponent().view,n=this.view.getClientSize(),s=Math.max(0,(n.x-t.width)/2),i=Math.max(0,(n.y-t.height)/2);this.state.setViewPort(new e(s,i),1)}zoom(t){const e=t?.2:-.2,n=this.limitScale(this.state.viewPort.scale+e);this.state.setViewPort(this.state.viewPort.position,n)}moveViewPortToStep(t){const n=this.state.viewPort,s=t.view.getClientPosition(),i=this.view.getClientSize(),o=n.position.divideByScalar(n.scale).subtract(s.divideByScalar(n.scale)),r=new e(t.view.width,t.view.height).divideByScalar(2),a=o.add(i.divideByScalar(2)).subtract(r);this.viewPortAnimator.execute(a,1)}destroy(){this.view.destroy()}revalidate(){this.isValid=this.getRootComponent().validate()}onMouseDown(t,e,n){const s=1===n;(0===n||s)&&this.startBehavior(e,t,s)}onTouchStart(t){const e=document.elementFromPoint(t.x,t.y);e&&this.startBehavior(e,t,!1)}onContextMenu(t){t.preventDefault()}startBehavior(t,e,n){const s=n||this.state.isMoveModeEnabled?null:this.getRootComponent().findByElement(t);s?this.behaviorController.start(e,rt.create(s,this.designerContext,this.componentContext)):this.behaviorController.start(e,ot.create(this.state))}onWheel(t){const n=this.state.viewPort,s=new e(t.pageX,t.pageY).subtract(this.view.getClientPosition()),i=s.divideByScalar(n.scale).subtract(n.position.divideByScalar(n.scale)),o=t.deltaY>0?-.1:.1,r=this.limitScale(n.scale+o),a=i.multiplyByScalar(-r).add(s),l=r;this.state.setViewPort(a,l)}onIsDraggingChanged(t){this.getRootComponent().setIsDragging(t)}onIsSmartEditorCollapsedChanged(){setTimeout((()=>this.view.refreshSize()))}onViewPortChanged(t){this.view.setPositionAndScale(t.position,t.scale)}onSelectedStepChanged(t){this.selectStep(t)}selectStep(t){if(this.selectedStepComponent&&(this.selectedStepComponent.setState(f.default),this.selectedStepComponent=null),t){if(this.selectedStepComponent=this.getRootComponent().findById(t.id),!this.selectedStepComponent)throw new Error(`Cannot find a step's component by id ${t.id}`);this.selectedStepComponent.setState(f.selected)}}limitScale(t){return Math.min(Math.max(t,.1),3)}getRootComponent(){if(this.view.rootComponent)return this.view.rootComponent;throw new Error("Root component not found")}}class gt{static create(e,n,s,i,o){const r=o.theme||"light",a=t.element("div",{class:`sqd-designer sqd-theme-${r}`});e.appendChild(a);const l=ut.create(a,n,s);let d;o.toolbox.isHidden||(d=it.create(a,n,s)),A.create(a,n),o.editors.isHidden||W.create(a,n);const c=new gt(a,i,l,d);return c.reloadLayout(),window.addEventListener("resize",c.onResizeHandler,!1),c}constructor(t,e,n,s){this.root=t,this.layoutController=e,this.workspace=n,this.toolbox=s,this.onResizeHandler=()=>this.onResize(),this.onKeyUpHandlers=[]}bindKeyUp(t){document.addEventListener("keyup",t,!1),this.onKeyUpHandlers.push(t)}destroy(){var t,e;window.removeEventListener("resize",this.onResizeHandler,!1),this.onKeyUpHandlers.forEach((t=>document.removeEventListener("keyup",t,!1))),this.workspace.destroy(),null===(t=this.toolbox)||void 0===t||t.destroy(),null===(e=this.root.parentElement)||void 0===e||e.removeChild(this.root)}onResize(){this.reloadLayout()}reloadLayout(){const e=this.layoutController.isMobile();t.toggleClass(this.root,!e,"sqd-layout-desktop"),t.toggleClass(this.root,e,"sqd-layout-mobile")}}class vt{static create(n,s,r){const a=t.svg("g",{class:`sqd-container-group sqd-type-${s.type}`});n.appendChild(a);const d=w.create(a,s.sequence,r);t.translate(d.view.g,20,42);const p=d.view.width+40,u=d.view.height+20+22,g=d.view.joinX+20;l.create(a,g,20,s.name);const v=r.configuration.iconUrlProvider?r.configuration.iconUrlProvider(s.componentType,s.type):null,m=i.createRectInput(a,g,0,v);o.createStraightJoin(a,new e(g,0),20);const f=c.create(a,[p],u),C=h.create(a,p,0);return new vt(a,p,u,g,d,m,f,C)}constructor(t,e,n,s,i,o,r,a){this.g=t,this.width=e,this.height=n,this.joinX=s,this.sequenceComponent=i,this.inputView=o,this.regionView=r,this.validationErrorView=a}getClientPosition(){return this.regionView.getClientPosition()}containsElement(t){return this.g.contains(t)}setIsDragging(t){this.inputView.setIsHidden(t),this.sequenceComponent.setIsDragging(t)}setIsSelected(t){this.regionView.setIsSelected(t)}setIsDisabled(e){t.toggleClass(this.g,e,"sqd-disabled")}setIsValid(t){this.validationErrorView.setIsHidden(t)}isInterrupted(){return this.sequenceComponent.isInterrupted}}class wt{static create(t,e,n,s){const i=vt.create(t,e,s);return new wt(i,e,n,i.isInterrupted(),s.configuration)}constructor(t,e,n,s,i){this.view=t,this.step=e,this.parentSequence=n,this.isInterrupted=s,this.configuration=i,this.currentState=f.default}findByElement(t){return this.view.sequenceComponent.findByElement(t)||(this.view.containsElement(t)?this:null)}findById(t){return this.view.sequenceComponent.findById(t)||(this.step.id===t?this:null)}getPlaceholders(t){this.currentState!==f.dragging&&this.view.sequenceComponent.getPlaceholders(t)}setState(t){switch(this.currentState=t,t){case f.default:this.view.setIsSelected(!1),this.view.setIsDisabled(!1);break;case f.selected:this.view.setIsSelected(!0),this.view.setIsDisabled(!1);break;case f.dragging:this.view.setIsSelected(!1),this.view.setIsDisabled(!0)}}setIsDragging(t){this.view.setIsDragging(t)}validate(){const t=!this.configuration.validator||this.configuration.validator(this.step);this.view.setIsValid(t);const e=this.view.sequenceComponent.validate();return t&&e}}class mt{constructor(){this.componentType="container",this.createComponent=wt.create}getChildren(t){return{type:C.singleSequence,sequences:t.sequence}}}const ft=20;class Ct{static create(n,s,r){const a=t.svg("g",{class:`sqd-switch-group sqd-type-${s.type}`});n.appendChild(a);const d=Object.keys(s.branches),p=d.map((t=>w.create(a,s.branches[t],r))),u=Math.max(...p.map((t=>t.view.height))),g=p.map((t=>Math.max(t.view.width,50)+40)),v=g.reduce(((t,e)=>t+e),0),m=u+20+44+32,f=[],C=p.map((t=>Math.max(t.view.joinX,25)));let b=0;for(let t=0;t<d.length;t++)f.push(b),b+=g[t];const y=Math.floor(d.length/2);let x=f[y];d.length%2!=0&&(x+=C[y]+ft),d.forEach(((n,s)=>{const i=p[s],r=f[s];l.create(a,r+C[s]+ft,58,n,"secondary");const d=80+i.view.height;if(!i.isInterrupted){const t=m-d-16;t>0&&o.createStraightJoin(a,new e(f[s]+C[s]+ft,d),t)}const c=r+ft+Math.max((50-i.view.width)/2,0);t.translate(i.view.g,c,80)})),l.create(a,x,20,s.name),o.createStraightJoin(a,new e(x,0),20);const q=r.configuration.iconUrlProvider?r.configuration.iconUrlProvider(s.componentType,s.type):null,S=i.createRectInput(a,x,0,q);o.createJoins(a,new e(x,42),f.map(((t,n)=>new e(t+C[n]+ft,58))));const I=p.map(((t,e)=>t.isInterrupted?null:e)).filter((t=>null!==t)).map((t=>new e(f[t]+C[t]+ft,80+u)));I.length>0&&o.createJoins(a,new e(x,m),I);const E=c.create(a,g,m),M=h.create(a,v,0);return new Ct(a,v,m,x,p,E,S,M)}constructor(t,e,n,s,i,o,r,a){this.g=t,this.width=e,this.height=n,this.joinX=s,this.sequenceComponents=i,this.regionView=o,this.inputView=r,this.validationErrorView=a}getClientPosition(){return this.regionView.getClientPosition()}containsElement(t){return this.g.contains(t)}setIsDragging(t){this.inputView.setIsHidden(t)}setIsSelected(t){this.regionView.setIsSelected(t)}setIsDisabled(e){t.toggleClass(this.g,e,"sqd-disabled")}setIsValid(t){this.validationErrorView.setIsHidden(t)}isInterrupted(){return this.sequenceComponents.every((t=>t.isInterrupted))}}class bt{static create(t,e,n,s){const i=Ct.create(t,e,s);return new bt(i,e,n,i.isInterrupted(),s.configuration)}constructor(t,e,n,s,i){this.view=t,this.step=e,this.parentSequence=n,this.isInterrupted=s,this.configuration=i,this.currentState=f.default}findByElement(t){for(const e of this.view.sequenceComponents){const n=e.findByElement(t);if(n)return n}return this.view.containsElement(t)?this:null}findById(t){if(this.step.id===t)return this;for(const e of this.view.sequenceComponents){const n=e.findById(t);if(n)return n}return null}getPlaceholders(t){this.currentState!==f.dragging&&this.view.sequenceComponents.forEach((e=>e.getPlaceholders(t)))}setIsDragging(t){this.currentState!==f.dragging&&this.view.sequenceComponents.forEach((e=>e.setIsDragging(t))),this.view.setIsDragging(t)}setState(t){switch(this.currentState=t,t){case f.default:this.view.setIsSelected(!1),this.view.setIsDisabled(!1);break;case f.selected:this.view.setIsSelected(!0),this.view.setIsDisabled(!1);break;case f.dragging:this.view.setIsSelected(!1),this.view.setIsDisabled(!0)}}validate(){const t=!this.configuration.validator||this.configuration.validator(this.step);this.view.setIsValid(t);let e=!0;for(const t of this.view.sequenceComponents)e=t.validate()&&e;return t&&e}}class yt{constructor(){this.componentType="switch",this.createComponent=bt.create}getChildren(t){return{type:C.branches,sequences:t.branches}}}class xt{static create(t,e,n,s){const i=m.create(t,!1,e,s.configuration);return new y(i,e,n,!1,s.configuration)}}class qt{constructor(){this.componentType="task",this.createComponent=xt.create}getChildren(){return null}}class St{static resolve(t){const e={};if(e.task=new qt,e.switch=new yt,e.container=new mt,t)for(const n of t)n.steps.forEach((t=>e[t.componentType]=t));return e}}class It{static create(t,e,n){const s=St.resolve(n.extensions),i=V.create(t,e,n,s),o=q.create(n.steps,s),r=gt.create(t,i,o,i.layoutController,n),a=new It(r,i.state,i.definitionModifier,i.workspaceController,i.stepsTraverser);return r.bindKeyUp((t=>a.onKeyUp(t))),i.state.onDefinitionChanged.subscribe((()=>a.onDefinitionChanged.forward(i.state.definition))),a}constructor(t,e,n,s,i){this.view=t,this.state=e,this.definitionModifier=n,this.workspaceController=s,this.stepsTraverser=i,this.onDefinitionChanged=new S}getDefinition(){return this.state.definition}isValid(){return this.view.workspace.isValid}isReadonly(){return this.state.isReadonly}setIsReadonly(t){this.state.setIsReadonly(t)}getSelectedStepId(){var t;return(null===(t=this.state.selectedStep)||void 0===t?void 0:t.id)||null}selectStepById(t){const e=this.workspaceController.getComponentByStepId(t);this.state.setSelectedStep(e.step)}clearSelectedStep(){this.state.setSelectedStep(null)}moveViewPortToStep(t){const e=this.workspaceController.getComponentByStepId(t);this.workspaceController.moveViewPortToStep(e)}getStepParents(t){return this.stepsTraverser.getParents(this.state.definition,t)}destroy(){this.view.destroy()}onKeyUp(t){["Backspace","Delete"].includes(t.key)&&(document.activeElement&&["input","textarea"].includes(document.activeElement.tagName.toLowerCase())||!this.state.selectedStep||this.state.isReadonly||this.state.isDragging||(t.preventDefault(),t.stopPropagation(),this.definitionModifier.tryDelete(this.state.selectedStep)))}}const Et=26;class Mt{static create(e,n,s,o){const r=t.svg("g",{class:`sqd-icon-group sqd-type-${n.type}`});e.appendChild(r);const a=t.svg("circle",{cx:Et,cy:Et,r:Et,class:"sqd-icon-circle"});r.appendChild(a);const l=o.iconUrlProvider?o.iconUrlProvider(n.componentType,n.type):null;if(l){const e=t.svg("image",{href:l,x:12,y:12,width:28,height:28});r.appendChild(e)}const c=i.createRoundInput(r,Et,0),p=s?null:d.create(r,Et,52),u=h.create(r,52,0);return new Mt(r,52,52,Et,a,c,p,u)}constructor(t,e,n,s,i,o,r,a){this.g=t,this.width=e,this.height=n,this.joinX=s,this.circle=i,this.inputView=o,this.outputView=r,this.validationErrorView=a}setIsSelected(e){t.toggleClass(this.circle,e,"sqd-selected")}setIsDisabled(e){t.toggleClass(this.g,e,"sqd-disabled")}setIsValid(t){this.validationErrorView.setIsHidden(t)}containsElement(t){return this.g.contains(t)}getClientPosition(){const t=this.g.getBoundingClientRect();return new e(t.x,t.y)}setIsDragging(t){var e;this.inputView.setIsHidden(t),null===(e=this.outputView)||void 0===e||e.setIsHidden(t)}}class kt{static create(t,e,n,s){const i=Mt.create(t,e,!1,s.configuration);return new y(i,e,n,!1,s.configuration)}}class Dt{constructor(){this.componentType="icon",this.createComponent=kt.create}getChildren(){return null}}class Pt{static create(t,e,n,s){const i=Mt.create(t,e,!0,s.configuration);return new y(i,e,n,!0,s.configuration)}}class Tt{constructor(){this.componentType="interruptingIcon",this.createComponent=Pt.create}getChildren(){return null}}class Bt{static create(t,e,n,s){const i=m.create(t,!0,e,s.configuration);return new y(i,e,n,!0,s.configuration)}}class Rt{constructor(){this.componentType="interruptingTask",this.createComponent=Bt.create}getChildren(){return null}}class zt{static create(){return new zt([new Dt,new Tt,new Rt])}constructor(t){this.steps=t,this.name="pro"}}var Ht=n(62),Vt=n.n(Ht),Lt=n(36),Ut=n.n(Lt),$t=n(793),Ft=n.n($t),At=n(892),Zt=n.n(At),jt=n(173),Ot=n.n(jt),Nt=n(464),Xt=n.n(Nt),Jt=n(446),Wt={};Wt.styleTagTransform=Xt(),Wt.setAttributes=Zt(),Wt.insert=Ft().bind(null,"head"),Wt.domAPI=Ut(),Wt.insertStyleElement=Ot(),Vt()(Jt.Z,Wt),Jt.Z&&Jt.Z.locals&&Jt.Z.locals;var Kt=n(929),Yt={};Yt.styleTagTransform=Xt(),Yt.setAttributes=Zt(),Yt.insert=Ft().bind(null,"head"),Yt.domAPI=Ut(),Yt.insertStyleElement=Ot(),Vt()(Kt.Z,Yt),Kt.Z&&Kt.Z.locals&&Kt.Z.locals;var Gt=n(279),_t={};_t.styleTagTransform=Xt(),_t.setAttributes=Zt(),_t.insert=Ft().bind(null,"head"),_t.domAPI=Ut(),_t.insertStyleElement=Ot(),Vt()(Gt.Z,_t),Gt.Z&&Gt.Z.locals&&Gt.Z.locals;var Qt=n(769),te={};function ee(t,e,n){return{id:s.next(),componentType:"switch",type:"switch",name:t,branches:{true:e,false:n},properties:{}}}function ne(t){return{id:s.next(),componentType:"task",name:t,properties:{},type:"task"}}function se(t){return{id:s.next(),componentType:"interruptingTask",name:t,properties:{},type:"goto"}}te.styleTagTransform=Xt(),te.setAttributes=Zt(),te.insert=Ft().bind(null,"head"),te.domAPI=Ut(),te.insertStyleElement=Ot(),Vt()(Qt.Z,te),Qt.Z&&Qt.Z.locals&&Qt.Z.locals,document.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("designer"),e={properties:{},sequence:[ne("Validate"),ee("Is Valid",[ne("Write file"),ne("Send email")],[ne("Run trigger"),se('Goto "Validate"')]),ne("Send email")]},n={editors:{stepEditorProvider:t=>{const e=document.createElement("div");return e.innerText=`Step Editor, type=${t.type}, componentType=${t.componentType}`,e},globalEditorProvider:()=>{const t=document.createElement("div");return t.innerText="Global Editor",t}},steps:{iconUrlProvider:(t,e)=>`./assets/icon-${e}.svg`},toolbox:{groups:[("Steps",s=[ee("Is Valid",[],[]),ne("Validate"),ne("Write file"),ne("Send email"),ne("Run trigger"),se("Goto")],{name:"Steps",steps:s})]},extensions:[zt.create()]};var s;It.create(t,e,n)}))})()})();