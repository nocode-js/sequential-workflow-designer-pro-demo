(()=>{"use strict";var e={715:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(81),o=s.n(i),n=s(645),r=s.n(n)()(o());r.push([e.id,".sqd-theme-light .sqd-toolbox{background:#fff;box-shadow:0 0 8px rgba(0,0,0,.15),0 2px 4px rgba(0,0,0,.15)}.sqd-theme-light .sqd-toolbox-header-title{color:#000}.sqd-theme-light .sqd-toolbox-filter{background:#fff;color:#000;border:1px solid #c3c3c3}.sqd-theme-light .sqd-toolbox-filter:focus{border-color:#939393}.sqd-theme-light .sqd-toolbox-group-title{color:#000;background:#e5e5e5}.sqd-theme-light .sqd-toolbox-item{color:#000;border:1px solid #c3c3c3;box-shadow:0 2px 2px rgba(0,0,0,.15);background:#fff}.sqd-theme-light .sqd-toolbox-item:hover{border-color:#939393;background:#fff}.sqd-theme-light .sqd-toolbox-item .sqd-toolbox-item-icon.sqd-no-icon{background:#c6c6c6}.sqd-theme-light .sqd-control-bar{background:#fff;box-shadow:0 0 8px rgba(0,0,0,.15),0 2px 4px rgba(0,0,0,.15)}.sqd-theme-light .sqd-control-bar-button{border:1px solid #c3c3c3;background:#fff}.sqd-theme-light .sqd-control-bar-button:hover{border-color:#939393;background:#fff}.sqd-theme-light .sqd-control-bar-button .sqd-icon-path{fill:#000}.sqd-theme-light .sqd-control-bar-button.sqd-delete .sqd-icon-path{fill:#e01a24}.sqd-theme-light.sqd-context-menu{background:#fff;box-shadow:0 0 8px rgba(0,0,0,.2)}.sqd-theme-light .sqd-context-menu-group{color:#888}.sqd-theme-light .sqd-context-menu-item{color:#000}.sqd-theme-light .sqd-context-menu-item:hover{background:#eee}.sqd-theme-light.sqd-designer{background:#e3e4e1}.sqd-theme-light .sqd-join{stroke-width:2;stroke:#2d2d2d}.sqd-theme-light .sqd-region{stroke:#c4c8bd;stroke-width:2;stroke-dasharray:0}.sqd-theme-light .sqd-region.sqd-selected{stroke:#ed4800;stroke-width:2;stroke-dasharray:0}.sqd-theme-light .sqd-placeholder .sqd-placeholder-rect{fill:#c4c8bd;stroke:#a4a79e;stroke-width:1;stroke-dasharray:0}.sqd-theme-light .sqd-placeholder.sqd-hover .sqd-placeholder-rect{fill:#fff}.sqd-theme-light .sqd-placeholder-icon-path{fill:#2b2b2b}.sqd-theme-light .sqd-placeholder.sqd-hover .sqd-placeholder-icon-path{fill:#fff}.sqd-theme-light .sqd-validation-error{fill:#ffa200}.sqd-theme-light .sqd-validation-error-icon-path{fill:#000}.sqd-theme-light .sqd-root-start-stop-circle{fill:#2c18df}.sqd-theme-light .sqd-root-start-stop-icon{fill:#fff}.sqd-theme-light .sqd-step-task .sqd-step-task-rect{fill:#fff;stroke-width:1;stroke:#c3c3c3;filter:drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, 0.15))}.sqd-theme-light .sqd-step-task .sqd-step-task-rect.sqd-selected{stroke:#ed4800;stroke-width:2}.sqd-theme-light .sqd-step-task .sqd-step-task-text{fill:#000}.sqd-theme-light .sqd-step-task .sqd-step-task-empty-icon{fill:#c6c6c6}.sqd-theme-light .sqd-step-task .sqd-input{fill:#fff;stroke-width:2;stroke:#000}.sqd-theme-light .sqd-step-task .sqd-output{fill:#000;stroke-width:0}.sqd-theme-light .sqd-step-switch>.sqd-label-primary>.sqd-label-text{fill:#fff}.sqd-theme-light .sqd-step-switch>.sqd-label-primary>.sqd-label-rect{fill:#292d9d;stroke-width:0}.sqd-theme-light .sqd-step-switch>.sqd-label-secondary>.sqd-label-rect{fill:#2d2d2d;stroke-width:0}.sqd-theme-light .sqd-step-switch>.sqd-label-secondary>.sqd-label-text{fill:#fff}.sqd-theme-light .sqd-step-switch>g>.sqd-input{fill:#fff;stroke-width:2;stroke:#000}.sqd-theme-light .sqd-step-container>.sqd-label>.sqd-label-text{fill:#fff}.sqd-theme-light .sqd-step-container>.sqd-label>.sqd-label-rect{fill:#292d9d}.sqd-theme-light .sqd-step-container>g>.sqd-input{fill:#fff;stroke-width:2;stroke:#000}.sqd-theme-light .sqd-grid-dot{fill:#c2c8b7}.sqd-theme-light .sqd-step-icon .sqd-step-icon-circle{fill:#fff;stroke:#c3c3c3;stroke-width:1;filter:drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, 0.15))}.sqd-theme-light .sqd-step-icon .sqd-step-icon-circle.sqd-selected{stroke:#ed4800;stroke-width:2}.sqd-theme-light .sqd-step-icon>.sqd-input{fill:#fff;stroke-width:2;stroke:#000}.sqd-theme-light .sqd-step-icon>.sqd-output{fill:#000;stroke-width:0}.sqd-theme-light .sqd-step-large-task .sqd-large-task-rect{fill:#fff;stroke:#c3c3c3;stroke-width:1;filter:drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, 0.15))}.sqd-theme-light .sqd-step-large-task .sqd-large-task-rect.sqd-selected{stroke:#ed4800;stroke-width:2}.sqd-theme-light .sqd-step-large-task .sqd-large-task-name-text{fill:#000}.sqd-theme-light .sqd-step-large-task .sqd-large-task-description-text{fill:#8b8c91}.sqd-theme-light .sqd-step-large-task .sqd-large-task-circle{stroke:#9da3ae;stroke-width:1}.sqd-theme-light .sqd-step-large-task .sqd-input{fill:#fff;stroke-width:2;stroke:#000}.sqd-theme-light .sqd-step-large-task .sqd-output{fill:#000;stroke-width:0}.sqd-theme-light .sqd-toolbox-item.sqd-type-deleteFile{color:#2c3c3f;border:1px solid #5c7d83;box-shadow:0 2px 2px rgba(0,0,0,.15);background:#cbe7ec}.sqd-theme-light .sqd-toolbox-item.sqd-type-deleteFile:hover{border-color:#080b0b;background:#cbe7ec}.sqd-theme-light .sqd-toolbox-item.sqd-type-deleteFile .sqd-toolbox-item-icon.sqd-no-icon{background:#c6c6c6}.sqd-theme-light .sqd-step-task.sqd-type-deleteFile .sqd-step-task-rect{fill:#cbe7ec;stroke-width:1;stroke:#5c7d83;filter:drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, 0.15))}.sqd-theme-light .sqd-step-task.sqd-type-deleteFile .sqd-step-task-rect.sqd-selected{stroke:#ed4800;stroke-width:2}.sqd-theme-light .sqd-step-task.sqd-type-deleteFile .sqd-step-task-text{fill:#2c3c3f}.sqd-theme-light .sqd-step-task.sqd-type-deleteFile .sqd-step-task-empty-icon{fill:#c6c6c6}.sqd-theme-light .sqd-step-task.sqd-type-deleteFile .sqd-input{fill:#fff;stroke-width:2;stroke:#5c7d83}.sqd-theme-light .sqd-step-task.sqd-type-deleteFile .sqd-output{fill:#fff;stroke-width:2;stroke:#5c7d83}.sqd-theme-light .sqd-toolbox-item.sqd-type-disconnect{color:#f7dcdc;border:1px solid #8e0c0c;box-shadow:0 2px 2px rgba(0,0,0,.15);background:#e35454}.sqd-theme-light .sqd-toolbox-item.sqd-type-disconnect:hover{border-color:#000;background:#e35454}.sqd-theme-light .sqd-toolbox-item.sqd-type-disconnect .sqd-toolbox-item-icon.sqd-no-icon{background:#c6c6c6}.sqd-theme-light .sqd-step-large-task.sqd-type-disconnect .sqd-large-task-rect{fill:#e35454;stroke:#8e0c0c;stroke-width:1;filter:drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, 0.15))}.sqd-theme-light .sqd-step-large-task.sqd-type-disconnect .sqd-large-task-rect.sqd-selected{stroke:#760a0a;stroke-width:2}.sqd-theme-light .sqd-step-large-task.sqd-type-disconnect .sqd-large-task-name-text{fill:#f7dcdc}.sqd-theme-light .sqd-step-large-task.sqd-type-disconnect .sqd-large-task-description-text{fill:#f7dcdc}.sqd-theme-light .sqd-step-large-task.sqd-type-disconnect .sqd-large-task-circle{stroke:#8e0c0c;stroke-width:1}.sqd-theme-light .sqd-step-large-task.sqd-type-disconnect .sqd-input{fill:#f7dcdc;stroke-width:2;stroke:#8e0c0c}.sqd-theme-light .sqd-step-large-task.sqd-type-disconnect .sqd-output{fill:#8e0c0c;stroke-width:0}.sqd-theme-light .sqd-toolbox-item.sqd-type-deleteUser{color:#342038;border:1px solid #7a5283;box-shadow:0 2px 2px rgba(0,0,0,.15);background:#dfb6e8}.sqd-theme-light .sqd-toolbox-item.sqd-type-deleteUser:hover{border-color:#050306;background:#dfb6e8}.sqd-theme-light .sqd-toolbox-item.sqd-type-deleteUser .sqd-toolbox-item-icon.sqd-no-icon{background:#c6c6c6}.sqd-theme-light .sqd-step-icon.sqd-type-deleteUser .sqd-step-icon-circle{fill:#dfb6e8;stroke:#7a5283;stroke-width:1;filter:drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, 0.15))}.sqd-theme-light .sqd-step-icon.sqd-type-deleteUser .sqd-step-icon-circle.sqd-selected{stroke:#ed4800;stroke-width:2}.sqd-theme-light .sqd-step-icon.sqd-type-deleteUser>.sqd-input{fill:#7a5283;stroke-width:0}.sqd-theme-light .sqd-step-icon.sqd-type-deleteUser>.sqd-output{fill:#7a5283;stroke-width:0}.sqd-theme-light .sqd-toolbox-item.sqd-type-parallel{color:#c2dfef;border:1px solid #0c5e8e;box-shadow:0 2px 2px rgba(0,0,0,.15);background:#0c5e8e}.sqd-theme-light .sqd-toolbox-item.sqd-type-parallel:hover{border-color:#0c5e8e;background:#083f5f}.sqd-theme-light .sqd-toolbox-item.sqd-type-parallel .sqd-toolbox-item-icon.sqd-no-icon{background:#c6c6c6}.sqd-theme-light .sqd-step-switch.sqd-type-parallel>.sqd-label-primary>.sqd-label-text{fill:#c2dfef}.sqd-theme-light .sqd-step-switch.sqd-type-parallel>.sqd-label-primary>.sqd-label-rect{fill:#0c5e8e;stroke-width:2;stroke:#0b5580}.sqd-theme-light .sqd-step-switch.sqd-type-parallel>.sqd-label-secondary>.sqd-label-rect{fill:#c2dfef;stroke-width:1;stroke:#0c5e8e}.sqd-theme-light .sqd-step-switch.sqd-type-parallel>.sqd-label-secondary>.sqd-label-text{fill:#0c5e8e}.sqd-theme-light .sqd-step-switch.sqd-type-parallel>g>.sqd-input{fill:#c2dfef;stroke-width:2;stroke:#0c5e8e}.sqd-theme-light .sqd-toolbox-item.sqd-type-while{color:#494949;border:1px solid #bbb;box-shadow:0 2px 2px rgba(0,0,0,.15);background:#bbb}.sqd-theme-light .sqd-toolbox-item.sqd-type-while:hover{border-color:#bbb;background:#a2a2a2}.sqd-theme-light .sqd-toolbox-item.sqd-type-while .sqd-toolbox-item-icon.sqd-no-icon{background:#c6c6c6}.sqd-theme-light .sqd-step-container.sqd-type-while>.sqd-label>.sqd-label-text{fill:#494949}.sqd-theme-light .sqd-step-container.sqd-type-while>.sqd-label>.sqd-label-rect{fill:#bbb}.sqd-theme-light .sqd-step-container.sqd-type-while>g>.sqd-input{fill:#bbb;stroke-width:2;stroke:#bbb}",""]);const a=r},344:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(81),o=s.n(i),n=s(645),r=s.n(n)()(o());r.push([e.id,".sqd-path-bar{position:absolute;bottom:68px;padding:4px;left:10px;z-index:20;border-radius:10px}.sqd-path-bar-reset-button{display:inline-block;vertical-align:middle;width:26px;height:26px;border-radius:5px;cursor:pointer}.sqd-path-bar-reset-button-icon{width:20px;height:20px;margin:3px 0 0 3px}.sqd-path-bar-items{margin-left:2px;display:inline-block;vertical-align:middle}.sqd-path-bar-item{display:inline-block;padding:6px;border-radius:5px;cursor:pointer;border:1px solid rgba(0,0,0,0)}.sqd-path-bar-separator{display:inline-block;padding:0 2px}.sqd-large-task-name-text{text-anchor:left;dominant-baseline:central;font-size:16px}.sqd-large-task-description-text{text-anchor:left;dominant-baseline:central;font-size:12px}.sqd-large-task-circle{fill:none}.sqd-step-folder-name{text-anchor:left;dominant-baseline:central}.sqd-step-folder-button-text{font-size:11px;text-anchor:left;dominant-baseline:central}.sqd-step-folder-button-rect{fill:rgba(0,0,0,0);cursor:pointer}.sqd-grid-dot{stroke:none}.sqd-root-minimal-empty{fill:rgba(0,0,0,0)}.sqd-counter-badge.sqd-clickable{pointer-events:bounding-box;cursor:pointer}.sqd-counter-badge.sqd-clickable:hover{opacity:.7}.sqd-counter-badge-text{font-size:11px;text-anchor:middle;dominant-baseline:central}.sqd-loading-badge-icon-loop{transform-box:fill-box;transform-origin:bottom;animation:sqd-loading-badge-animation 700ms infinite linear}@keyframes sqd-loading-badge-animation{100%{transform:rotate(360deg)}}.sqd-clickable-placeholder{pointer-events:bounding-box;cursor:pointer}",""]);const a=r},375:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(81),o=s.n(i),n=s(645),r=s.n(n)()(o());r.push([e.id,".sqd-designer{position:relative;display:flex;width:100%;height:100%}.sqd-designer,.sqd-drag,.sqd-context-menu{font-size:13px;line-height:1em}.sqd-hidden{display:none !important}.sqd-disabled{opacity:.25}.sqd-toolbox,.sqd-toolbox-filter{font-size:11px;line-height:1.2em}.sqd-toolbox{position:absolute;top:10px;left:10px;z-index:20;box-sizing:border-box;border-radius:10px;width:130px;user-select:none}.sqd-toolbox-header{position:relative;padding:15px 10px;cursor:pointer}.sqd-toolbox-header-title{display:block;font-size:1.2em;line-height:1em;font-weight:bold}.sqd-toolbox-toggle-icon{position:absolute;top:50%;right:10px;width:16px;height:16px;margin:-8px 0 0}.sqd-toolbox-header:hover .sqd-toolbox-toggle-icon{opacity:.6}.sqd-scrollbox{position:relative;overflow:hidden}.sqd-scrollbox-body{position:absolute;top:0;left:0}.sqd-toolbox-filter{display:block;box-sizing:border-box;padding:6px 8px;outline:none;width:110px;margin:0 10px 10px;box-sizing:border-box;border-radius:10px}.sqd-toolbox-group-title{text-align:center;padding:5px 0;margin:0 10px 10px;border-radius:10px}.sqd-toolbox-item{position:relative;border-radius:5px;box-sizing:border-box;margin:0 10px 10px;width:110px;cursor:move}.sqd-toolbox-item-icon{position:absolute;top:50%;left:5px;margin-top:-10px;width:20px;height:20px}.sqd-toolbox-item-icon.sqd-no-icon{border-radius:4px}.sqd-toolbox-item-icon-image{width:100%;height:100%}.sqd-toolbox-item-text{position:relative;display:block;padding:10px 10px 10px 30px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.sqd-drag{position:absolute;z-index:9999999;pointer-events:none}.sqd-control-bar{position:absolute;bottom:10px;left:10px;z-index:20;padding:8px 0 8px 8px;border-radius:10px;white-space:nowrap}.sqd-control-bar-button{display:inline-block;width:32px;height:32px;border-radius:5px;margin-right:8px;cursor:pointer;box-sizing:border-box}.sqd-control-bar-button-icon{width:24px;height:24px;margin:3px 0 0 3px}.sqd-control-bar-button.sqd-disabled .sqd-control-bar-button-icon{opacity:.2}.sqd-smart-editor-toggle{position:absolute;top:0;z-index:29;width:36px;height:64px;border-bottom-left-radius:10px;cursor:pointer}.sqd-smart-editor-toggle-icon{position:absolute;top:50%;left:50%;width:24px;height:24px;margin:-12px 0 0 -12px}.sqd-smart-editor-toggle:hover .sqd-smart-editor-toggle-icon{opacity:.6}.sqd-smart-editor{z-index:30}.sqd-layout-desktop .sqd-smart-editor{position:relative;width:300px}.sqd-layout-desktop .sqd-smart-editor-toggle{right:300px}.sqd-layout-desktop .sqd-smart-editor-toggle.sqd-collapsed{right:0}.sqd-layout-mobile .sqd-smart-editor{position:absolute;top:0;right:0;bottom:0;left:41px}.sqd-layout-mobile .sqd-smart-editor-toggle{left:5px}.sqd-layout-mobile .sqd-smart-editor-toggle.sqd-collapsed{left:auto;right:0}.sqd-context-menu{position:absolute;z-index:2000000000;border-radius:4px;overflow:hidden;padding:5px}.sqd-context-menu-group,.sqd-context-menu-item{width:130px;padding:8px 10px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.sqd-context-menu-group{font-size:11px;line-height:1em}.sqd-context-menu-item{border-radius:5px;cursor:pointer;transition:background 70ms}.sqd-workspace{flex:1;position:relative;display:block;user-select:none}.sqd-workspace-canvas{position:absolute;top:0;left:0;cursor:move}.sqd-label-text{text-anchor:middle;dominant-baseline:central}.sqd-placeholder .sqd-placeholder-rect{transition:fill 100ms}.sqd-step-task-text{text-anchor:left;dominant-baseline:central}",""]);const a=r},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var s="",i=void 0!==t[5];return t[4]&&(s+="@supports (".concat(t[4],") {")),t[2]&&(s+="@media ".concat(t[2]," {")),i&&(s+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),s+=e(t),i&&(s+="}"),t[2]&&(s+="}"),t[4]&&(s+="}"),s})).join("")},t.i=function(e,s,i,o,n){"string"==typeof e&&(e=[[null,e,void 0]]);var r={};if(i)for(var a=0;a<this.length;a++){var d=this[a][0];null!=d&&(r[d]=!0)}for(var l=0;l<e.length;l++){var c=[].concat(e[l]);i&&r[c[0]]||(void 0!==n&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=n),s&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=s):c[2]=s),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),t.push(c))}},t}},81:e=>{e.exports=function(e){return e[1]}},379:e=>{var t=[];function s(e){for(var s=-1,i=0;i<t.length;i++)if(t[i].identifier===e){s=i;break}return s}function i(e,i){for(var n={},r=[],a=0;a<e.length;a++){var d=e[a],l=i.base?d[0]+i.base:d[0],c=n[l]||0,h="".concat(l," ").concat(c);n[l]=c+1;var p=s(h),u={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(-1!==p)t[p].references++,t[p].updater(u);else{var g=o(u,i);i.byIndex=a,t.splice(a,0,{identifier:h,updater:g,references:1})}r.push(h)}return r}function o(e,t){var s=t.domAPI(t);return s.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;s.update(e=t)}else s.remove()}}e.exports=function(e,o){var n=i(e=e||[],o=o||{});return function(e){e=e||[];for(var r=0;r<n.length;r++){var a=s(n[r]);t[a].references--}for(var d=i(e,o),l=0;l<n.length;l++){var c=s(n[l]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}n=d}}},569:e=>{var t={};e.exports=function(e,s){var i=function(e){if(void 0===t[e]){var s=document.querySelector(e);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}t[e]=s}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(s)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,s)=>{e.exports=function(e){var t=s.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(s){!function(e,t,s){var i="";s.supports&&(i+="@supports (".concat(s.supports,") {")),s.media&&(i+="@media ".concat(s.media," {"));var o=void 0!==s.layer;o&&(i+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),i+=s.css,o&&(i+="}"),s.media&&(i+="}"),s.supports&&(i+="}");var n=s.sourceMap;n&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,s)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function s(i){var o=t[i];if(void 0!==o)return o.exports;var n=t[i]={id:i,exports:{}};return e[i](n,n.exports,s),n.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.nc=void 0,(()=>{const e=[function(e){const s=e.sequence;return s?{type:t.sequence,items:s}:null},function(e){const s=e.branches;return s?{type:t.branches,items:s}:null}];var t,i,o,n,r,a;!function(e){e[e.sequence=1]="sequence",e[e.branches=2]="branches"}(t||(t={}));class d{constructor(t){this.resolvers=t?t.concat(e):e}getChildren(e){const t=this.resolvers.length;for(let s=0;s<t;s++){const t=this.resolvers[s](e);if(t)return t}return null}getParents(e,t){const s=[];let i=null,o=null;if(Array.isArray(t)?i=t:o="string"==typeof t?t:t.id,this.find(e.sequence,i,o,s))return s.reverse(),s.map((e=>"string"==typeof e?e:e.step));throw new Error(o?`Cannot get parents of step: ${o}`:"Cannot get parents of sequence")}findParentSequence(e,t){const s=[];return this.find(e.sequence,null,t,s)?s[0]:null}getParentSequence(e,t){const s=this.findParentSequence(e,t);if(!s)throw new Error(`Cannot find step by id: ${t}`);return s}findById(e,t){const s=this.findParentSequence(e,t);return s?s.step:null}getById(e,t){return this.getParentSequence(e,t).step}forEach(e,t){this.iterateSequence(e.sequence,t)}forEachSequence(e,t){this.iterateSequence(e,t)}forEachChildren(e,t){this.iterateStep(e,t)}find(e,s,i,o){if(s&&e===s)return!0;const n=e.length;for(let r=0;r<n;r++){const n=e[r];if(i&&n.id===i)return o.push({step:n,index:r,parentSequence:e}),!0;const a=this.getChildren(n);if(a)switch(a.type){case t.sequence:{const e=a.items;if(this.find(e,s,i,o))return o.push({step:n,index:r,parentSequence:e}),!0}break;case t.branches:{const e=a.items,t=Object.keys(e);for(const a of t){const t=e[a];if(this.find(t,s,i,o))return o.push(a),o.push({step:n,index:r,parentSequence:t}),!0}}break;default:throw new Error(`Not supported step children type: ${a.type}`)}}return!1}iterateSequence(e,t){const s=e.length;for(let i=0;i<s;i++){const s=e[i];if(!1===t(s,i,e))return!1;if(!this.iterateStep(s,t))return!1}return!0}iterateStep(e,s){const i=this.getChildren(e);if(i)switch(i.type){case t.sequence:{const e=i.items;if(!this.iterateSequence(e,s))return!1}break;case t.branches:{const e=Object.values(i.items);for(const t of e)if(!this.iterateSequence(t,s))return!1}break;default:throw new Error(`Not supported step children type: ${i.type}`)}return!0}}class l{constructor(e,t,s,i){this.state=e,this.historyController=t,this.definitionModifier=s,this.viewportApi=i}subscribe(e){this.state.onIsReadonlyChanged.subscribe(e),this.state.onSelectedStepIdChanged.subscribe(e),this.state.onIsDragDisabledChanged.subscribe(e),this.isUndoRedoSupported()&&this.state.onDefinitionChanged.subscribe(e)}resetViewport(){this.viewportApi.resetViewport()}zoomIn(){this.viewportApi.zoom(!0)}zoomOut(){this.viewportApi.zoom(!1)}isDragDisabled(){return this.state.isDragDisabled}toggleIsDragDisabled(){this.state.toggleIsDragDisabled()}isUndoRedoSupported(){return!!this.historyController}tryUndo(){return!(!this.canUndo()||!this.historyController||(this.historyController.undo(),0))}canUndo(){return!!this.historyController&&this.historyController.canUndo()&&!this.state.isReadonly&&!this.state.isDragging}tryRedo(){return!(!this.canRedo()||!this.historyController||(this.historyController.redo(),0))}canRedo(){return!!this.historyController&&this.historyController.canRedo()&&!this.state.isReadonly&&!this.state.isDragging}tryDelete(){return!(!this.canDelete()||!this.state.selectedStepId||(this.definitionModifier.tryDelete(this.state.selectedStepId),0))}canDelete(){return!!this.state.selectedStepId&&!this.state.isReadonly&&!this.state.isDragging&&this.definitionModifier.isDeletable(this.state.selectedStepId)}}class c{constructor(){this.listeners=[]}subscribe(e){this.listeners.push(e)}unsubscribe(e){const t=this.listeners.indexOf(e);if(!(t>=0))throw new Error("Unknown listener");this.listeners.splice(t,1)}forward(e){this.listeners.length>0&&this.listeners.forEach((t=>t(e)))}count(){return this.listeners.length}}class h{constructor(e,t){this.x=e,this.y=t}add(e){return new h(this.x+e.x,this.y+e.y)}subtract(e){return new h(this.x-e.x,this.y-e.y)}multiplyByScalar(e){return new h(this.x*e,this.y*e)}divideByScalar(e){return new h(this.x/e,this.y/e)}round(){return new h(Math.round(this.x),Math.round(this.y))}distance(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}}!function(e){e[e.stepNameChanged=1]="stepNameChanged",e[e.stepPropertyChanged=2]="stepPropertyChanged",e[e.stepChildrenChanged=3]="stepChildrenChanged",e[e.stepDeleted=4]="stepDeleted",e[e.stepMoved=5]="stepMoved",e[e.stepInserted=6]="stepInserted",e[e.globalPropertyChanged=7]="globalPropertyChanged",e[e.rootReplaced=8]="rootReplaced"}(i||(i={}));class p{constructor(e,t,s,i){this.definition=e,this.isReadonly=t,this.isToolboxCollapsed=s,this.isEditorCollapsed=i,this.onViewportChanged=new c,this.onSelectedStepIdChanged=new c,this.onFolderPathChanged=new c,this.onIsReadonlyChanged=new c,this.onIsDraggingChanged=new c,this.onIsDragDisabledChanged=new c,this.onDefinitionChanged=new c,this.onIsToolboxCollapsedChanged=new c,this.onIsEditorCollapsedChanged=new c,this.viewport={position:new h(0,0),scale:1},this.selectedStepId=null,this.folderPath=[],this.isDragging=!1,this.isDragDisabled=!1}setSelectedStepId(e){this.selectedStepId!==e&&(this.selectedStepId=e,this.onSelectedStepIdChanged.forward(e))}pushStepIdToFolderPath(e){this.folderPath.push(e),this.onFolderPathChanged.forward(this.folderPath)}setFolderPath(e){this.folderPath=e,this.onFolderPathChanged.forward(e)}tryGetLastStepIdFromFolderPath(){return this.folderPath.length>0?this.folderPath[this.folderPath.length-1]:null}setDefinition(e){this.definition=e,this.notifyDefinitionChanged(i.rootReplaced,null)}notifyDefinitionChanged(e,t){this.onDefinitionChanged.forward({changeType:e,stepId:t})}setViewport(e){this.viewport=e,this.onViewportChanged.forward(e)}setIsReadonly(e){this.isReadonly!==e&&(this.isReadonly=e,this.onIsReadonlyChanged.forward(e))}setIsDragging(e){this.isDragging!==e&&(this.isDragging=e,this.onIsDraggingChanged.forward(e))}toggleIsDragDisabled(){this.isDragDisabled=!this.isDragDisabled,this.onIsDragDisabledChanged.forward(this.isDragDisabled)}setIsToolboxCollapsed(e){this.isToolboxCollapsed!==e&&(this.isToolboxCollapsed=e,this.onIsToolboxCollapsedChanged.forward(e))}setIsEditorCollapsed(e){this.isEditorCollapsed!==e&&(this.isEditorCollapsed=e,this.onIsEditorCollapsedChanged.forward(e))}}class u{static svg(e,t){const s=document.createElementNS("http://www.w3.org/2000/svg",e);return t&&u.attrs(s,t),s}static translate(e,t,s){e.setAttribute("transform",`translate(${t}, ${s})`)}static attrs(e,t){Object.keys(t).forEach((s=>{const i=t[s];e.setAttribute(s,"string"==typeof i?i:i.toString())}))}static element(e,t){const s=document.createElement(e);return t&&u.attrs(s,t),s}static toggleClass(e,t,s){t?e.classList.add(s):e.classList.remove(s)}}class g{static appendPath(e,t,s,i){const o=u.svg("g"),n=i/48,r=u.svg("path",{d:s,class:t,transform:`scale(${n})`});return o.appendChild(r),e.appendChild(o),o}static createSvg(e,t){const s=u.svg("svg",{class:e,viewBox:"0 0 48 48"}),i=u.svg("path",{d:t,class:"sqd-icon-path"});return s.appendChild(i),s}}g.folderIn="M42.05 42.25H11.996v-7.12h17.388L6 11.746 11.546 6.2 34.93 29.584V12.196h7.12V42.25z",g.folderOut="M6 6.2h30.054v7.12H18.666L42.05 36.704l-5.546 5.546L13.12 18.866v17.388H6V6.2z",g.center="M9 42q-1.2 0-2.1-.9Q6 40.2 6 39v-8.6h3V39h8.6v3Zm21.4 0v-3H39v-8.6h3V39q0 1.2-.9 2.1-.9.9-2.1.9ZM24 31.15q-3.15 0-5.15-2-2-2-2-5.15 0-3.15 2-5.15 2-2 5.15-2 3.15 0 5.15 2 2 2 2 5.15 0 3.15-2 5.15-2 2-5.15 2ZM6 17.6V9q0-1.2.9-2.1Q7.8 6 9 6h8.6v3H9v8.6Zm33 0V9h-8.6V6H39q1.2 0 2.1.9.9.9.9 2.1v8.6Z",g.zoomIn="M39.8 41.95 26.65 28.8q-1.5 1.3-3.5 2.025-2 .725-4.25.725-5.4 0-9.15-3.75T6 18.75q0-5.3 3.75-9.05 3.75-3.75 9.1-3.75 5.3 0 9.025 3.75 3.725 3.75 3.725 9.05 0 2.15-.7 4.15-.7 2-2.1 3.75L42 39.75Zm-20.95-13.4q4.05 0 6.9-2.875Q28.6 22.8 28.6 18.75t-2.85-6.925Q22.9 8.95 18.85 8.95q-4.1 0-6.975 2.875T9 18.75q0 4.05 2.875 6.925t6.975 2.875ZM17.3 24.3v-4.1h-4.1v-3h4.1v-4.05h3v4.05h4.05v3H20.3v4.1Z",g.zoomOut="M39.8 41.95 26.65 28.8q-1.5 1.3-3.5 2.025-2 .725-4.25.725-5.4 0-9.15-3.75T6 18.75q0-5.3 3.75-9.05 3.75-3.75 9.1-3.75 5.3 0 9.025 3.75 3.725 3.75 3.725 9.05 0 2.15-.7 4.15-.7 2-2.1 3.75L42 39.75Zm-20.95-13.4q4.05 0 6.9-2.875Q28.6 22.8 28.6 18.75t-2.85-6.925Q22.9 8.95 18.85 8.95q-4.1 0-6.975 2.875T9 18.75q0 4.05 2.875 6.925t6.975 2.875Zm-5.1-8.35v-3H23.8v3Z",g.undo="M14 38v-3h14.45q3.5 0 6.025-2.325Q37 30.35 37 26.9t-2.525-5.775Q31.95 18.8 28.45 18.8H13.7l5.7 5.7-2.1 2.1L8 17.3 17.3 8l2.1 2.1-5.7 5.7h14.7q4.75 0 8.175 3.2Q40 22.2 40 26.9t-3.425 7.9Q33.15 38 28.4 38Z",g.redo="M19.6 38q-4.75 0-8.175-3.2Q8 31.6 8 26.9t3.425-7.9q3.425-3.2 8.175-3.2h14.7l-5.7-5.7L30.7 8l9.3 9.3-9.3 9.3-2.1-2.1 5.7-5.7H19.55q-3.5 0-6.025 2.325Q11 23.45 11 26.9t2.525 5.775Q16.05 35 19.55 35H34v3Z",g.move="m24 44-8.15-8.15 2.2-2.2 4.45 4.45v-9.45h3v9.45l4.45-4.45 2.2 2.2ZM11.9 31.9 4 24l7.95-7.95 2.2 2.2L9.9 22.5h9.45v3H9.9l4.2 4.2Zm24.2 0-2.2-2.2 4.2-4.2h-9.4v-3h9.4l-4.2-4.2 2.2-2.2L44 24ZM22.5 19.3V9.9l-4.2 4.2-2.2-2.2L24 4l7.9 7.9-2.2 2.2-4.2-4.2v9.4Z",g.delete="m16.5 33.6 7.5-7.5 7.5 7.5 2.1-2.1-7.5-7.5 7.5-7.5-2.1-2.1-7.5 7.5-7.5-7.5-2.1 2.1 7.5 7.5-7.5 7.5ZM24 44q-4.1 0-7.75-1.575-3.65-1.575-6.375-4.3-2.725-2.725-4.3-6.375Q4 28.1 4 24q0-4.15 1.575-7.8 1.575-3.65 4.3-6.35 2.725-2.7 6.375-4.275Q19.9 4 24 4q4.15 0 7.8 1.575 3.65 1.575 6.35 4.275 2.7 2.7 4.275 6.35Q44 19.85 44 24q0 4.1-1.575 7.75-1.575 3.65-4.275 6.375t-6.35 4.3Q28.15 44 24 44Z",g.folderUp="M22.5 34h3V23.75l3.7 3.7 2.1-2.1-7.3-7.3-7.3 7.3 2.1 2.1 3.7-3.7ZM7.05 40q-1.2 0-2.1-.925-.9-.925-.9-2.075V11q0-1.15.9-2.075Q5.85 8 7.05 8h14l3 3h17q1.15 0 2.075.925.925.925.925 2.075v23q0 1.15-.925 2.075Q42.2 40 41.05 40Zm0-29v26h34V14H22.8l-3-3H7.05Zm0 0v26Z",g.close="m12.45 37.65-2.1-2.1L21.9 24 10.35 12.45l2.1-2.1L24 21.9l11.55-11.55 2.1 2.1L26.1 24l11.55 11.55-2.1 2.1L24 26.1Z",g.options="m19.4 44-1-6.3q-.95-.35-2-.95t-1.85-1.25l-5.9 2.7L4 30l5.4-3.95q-.1-.45-.125-1.025Q9.25 24.45 9.25 24q0-.45.025-1.025T9.4 21.95L4 18l4.65-8.2 5.9 2.7q.8-.65 1.85-1.25t2-.9l1-6.35h9.2l1 6.3q.95.35 2.025.925Q32.7 11.8 33.45 12.5l5.9-2.7L44 18l-5.4 3.85q.1.5.125 1.075.025.575.025 1.075t-.025 1.05q-.025.55-.125 1.05L44 30l-4.65 8.2-5.9-2.7q-.8.65-1.825 1.275-1.025.625-2.025.925l-1 6.3ZM24 30.5q2.7 0 4.6-1.9 1.9-1.9 1.9-4.6 0-2.7-1.9-4.6-1.9-1.9-4.6-1.9-2.7 0-4.6 1.9-1.9 1.9-1.9 4.6 0 2.7 1.9 4.6 1.9 1.9 4.6 1.9Z",g.expand="m24 30.75-12-12 2.15-2.15L24 26.5l9.85-9.85L36 18.8Z",g.alert="M24 42q-1.45 0-2.475-1.025Q20.5 39.95 20.5 38.5q0-1.45 1.025-2.475Q22.55 35 24 35q1.45 0 2.475 1.025Q27.5 37.05 27.5 38.5q0 1.45-1.025 2.475Q25.45 42 24 42Zm-3.5-12V6h7v24Z",g.play="M14.75 40.15V7.55l25.6 16.3Z",g.stop="M10.75 37.25V10.7H37.3v26.55Z",g.folder="M7.05 40q-1.2 0-2.1-.925-.9-.925-.9-2.075V11q0-1.15.9-2.075Q5.85 8 7.05 8h14l3 3h17q1.15 0 2.075.925.925.925.925 2.075v23q0 1.15-.925 2.075Q42.2 40 41.05 40Z";class f{static deepClone(e){return void 0!==window.structuredClone?window.structuredClone(e):JSON.parse(JSON.stringify(e))}}class m{static next(){const e=new Uint8Array(16);return window.crypto.getRandomValues(e),Array.from(e,(e=>e.toString(16).padStart(2,"0"))).join("")}}function w(e,t,s,i){const o=[void 0,void 0,void 0],n=new c;let r=!1;return[t,s,i].filter((e=>e)).forEach(((t,s)=>{t.subscribe((t=>{o[s]=t,r||(r=!0,setTimeout((()=>{try{n.forward(o)}finally{r=!1,o.fill(void 0)}}),e))}))})),n}class v{static create(e,t,s){const i=new v(e,t,s);return w(0,e.onDefinitionChanged,e.onSelectedStepIdChanged).subscribe((e=>{const[t,s]=e;t?i.onDefinitionChanged(t):void 0!==s&&i.onSelectedStepIdChanged(s)})),i.tryRender(e.selectedStepId),i}constructor(e,t,s){this.state=e,this.definitionWalker=t,this.handler=s,this.currentStepId=void 0}destroy(){}render(e){const t=e?this.definitionWalker.getById(this.state.definition,e):null;this.currentStepId=e,this.handler(t)}tryRender(e){this.currentStepId!==e&&this.render(e)}onDefinitionChanged(e){e.changeType===i.rootReplaced?this.render(this.state.selectedStepId):this.tryRender(this.state.selectedStepId)}onSelectedStepIdChanged(e){this.tryRender(e)}}class C{constructor(e,t,s){this.state=e,this.definitionWalker=t,this.definitionModifier=s}isCollapsed(){return this.state.isEditorCollapsed}toggleIsCollapsed(){this.state.setIsEditorCollapsed(!this.state.isEditorCollapsed)}subscribeIsCollapsed(e){this.state.onIsEditorCollapsedChanged.subscribe(e)}getDefinition(){return this.state.definition}runRenderer(e){return v.create(this.state,this.definitionWalker,e)}createStepEditorContext(e){if(!e)throw new Error("Step id is empty");return{notifyPropertiesChanged:()=>{this.state.notifyDefinitionChanged(i.stepPropertyChanged,e)},notifyNameChanged:()=>{this.state.notifyDefinitionChanged(i.stepNameChanged,e)},notifyChildrenChanged:()=>{this.state.notifyDefinitionChanged(i.stepChildrenChanged,e),this.definitionModifier.updateDependantFields()}}}createGlobalEditorContext(){return{notifyPropertiesChanged:()=>{this.state.notifyDefinitionChanged(i.globalPropertyChanged,null)}}}}class b{constructor(e,t){this.state=e,this.definitionWalker=t}subscribe(e){w(0,this.state.onFolderPathChanged,this.state.onDefinitionChanged).subscribe(e)}setFolderPath(e){this.state.setFolderPath(e)}getFolderPath(){return this.state.folderPath}getFolderPathStepNames(){return this.state.folderPath.map((e=>this.definitionWalker.getById(this.state.definition,e).name))}}class q{static create(e,t,s){const i=u.element("div",{class:`sqd-drag sqd-theme-${t}`});document.body.appendChild(i);const o=s.services.draggedComponent.create(i,e,s);return new q(o,i)}constructor(e,t){this.component=e,this.layer=t}setPosition(e){this.layer.style.top=e.y+"px",this.layer.style.left=e.x+"px"}remove(){this.component.destroy(),document.body.removeChild(this.layer)}}class x{static create(e,t){const s=new x(e,t);return t.onViewportChanged.subscribe(s.clearCacheHandler),window.addEventListener("scroll",s.clearCacheHandler,!1),s}constructor(e,t){this.placeholders=e,this.state=t,this.clearCacheHandler=()=>this.clearCache()}find(e,t,s){var i;if(!this.cache){const e=new h(window.scrollX,window.scrollY);this.cache=this.placeholders.map((t=>{const s=t.getClientRect();return{placeholder:t,lt:new h(s.x,s.y).add(e),br:new h(s.x+s.width,s.y+s.height).add(e)}})),this.cache.sort(((e,t)=>e.lt.y-t.lt.y))}const o=e.x+t,n=e.y+s;return null===(i=this.cache.find((t=>Math.max(e.x,t.lt.x)<Math.min(o,t.br.x)&&Math.max(e.y,t.lt.y)<Math.min(n,t.br.y))))||void 0===i?void 0:i.placeholder}destroy(){this.state.onViewportChanged.unsubscribe(this.clearCacheHandler),window.removeEventListener("scroll",this.clearCacheHandler,!1)}clearCache(){this.cache=void 0}}class y{static create(e,t,s){const i=q.create(t,e.theme,e.componentContext);return new y(i,e.workspaceController,e.state,t,e.definitionModifier,s)}constructor(e,t,s,i,o,n){this.view=e,this.workspaceController=t,this.designerState=s,this.step=i,this.definitionModifier=o,this.draggedStepComponent=n}onStart(e){let t=null;if(this.draggedStepComponent&&(this.draggedStepComponent.setIsDisabled(!0),this.draggedStepComponent.view.width===this.view.component.width&&this.draggedStepComponent.view.height===this.view.component.height)){const s=new h(window.scrollX,window.scrollY),i=this.draggedStepComponent.view.getClientPosition().add(s);t=e.subtract(i)}t||(t=new h(this.view.component.width,this.view.component.height).divideByScalar(2)),this.view.setPosition(e.subtract(t)),this.designerState.setIsDragging(!0);const s=this.workspaceController.getPlaceholders();this.state={startPosition:e,finder:x.create(s,this.designerState),offset:t}}onMove(e){if(this.state){const t=this.state.startPosition.subtract(e).subtract(this.state.offset);this.view.setPosition(t);const s=this.state.finder.find(t,this.view.component.width,this.view.component.height);this.currentPlaceholder!==s&&(this.currentPlaceholder&&this.currentPlaceholder.setIsHover(!1),s&&s.setIsHover(!0),this.currentPlaceholder=s)}}onEnd(e){if(!this.state)throw new Error("Invalid state");this.state.finder.destroy(),this.state=void 0,this.view.remove(),this.designerState.setIsDragging(!1);let t=!1;!e&&this.currentPlaceholder&&(t=this.draggedStepComponent?this.definitionModifier.tryMove(this.draggedStepComponent.parentSequence,this.draggedStepComponent.step,this.currentPlaceholder.parentSequence,this.currentPlaceholder.index):this.definitionModifier.tryInsert(this.step,this.currentPlaceholder.parentSequence,this.currentPlaceholder.index)),t||(this.draggedStepComponent&&this.draggedStepComponent.setIsDisabled(!1),this.currentPlaceholder&&this.currentPlaceholder.setIsHover(!1)),this.currentPlaceholder=void 0}}class S{constructor(e,t,s,i,o,n){this.state=e,this.designerContext=t,this.behaviorController=s,this.iconProvider=i,this.configuration=o,this.uidGenerator=n}isCollapsed(){return this.state.isToolboxCollapsed}toggleIsCollapsed(){this.state.setIsToolboxCollapsed(!this.state.isToolboxCollapsed)}subscribeIsCollapsed(e){this.state.onIsToolboxCollapsedChanged.subscribe(e)}tryGetIconUrl(e){return this.iconProvider.getIconUrl(e)}getLabel(e){const t=this.getConfiguration().labelProvider;return t?t(e):e.name}filterGroups(e){return this.getConfiguration().groups.map((t=>({name:t.name,steps:t.steps.filter((t=>!e||t.name.toLowerCase().includes(e)))}))).filter((e=>e.steps.length>0))}tryDrag(e,t){if(!this.state.isReadonly){const s=this.activateStep(t);return this.behaviorController.start(e,y.create(this.designerContext,s)),!0}return!1}activateStep(e){const t=f.deepClone(e);return t.id=this.uidGenerator?this.uidGenerator():m.next(),t}getConfiguration(){if(!this.configuration)throw new Error("Toolbox is disabled");return this.configuration}}class k{constructor(e,t){this.workspaceController=e,this.viewportController=t}resetViewport(){this.viewportController.setDefault()}zoom(e){this.viewportController.zoom(e)}moveViewportToStep(e){const t=this.workspaceController.getComponentByStepId(e),s=t.view.getClientPosition(),i=new h(t.view.width,t.view.height);this.viewportController.focusOnComponent(s,i)}}class I{constructor(e,t){this.state=e,this.workspaceController=t}getCanvasPosition(){return this.workspaceController.getCanvasPosition()}getCanvasSize(){return this.workspaceController.getCanvasSize()}getRootComponentSize(){return this.workspaceController.getRootComponentSize()}getViewport(){return this.state.viewport}setViewport(e){this.state.setViewport(e)}updateRootComponent(){this.workspaceController.updateRootComponent()}updateBadges(){this.workspaceController.updateBadges()}updateCanvasSize(){this.workspaceController.updateCanvasSize()}}class D{static create(e){const t=new I(e.state,e.workspaceController),s=e.services.viewportController.create(t),i=new k(e.workspaceController,s);return new D(new l(e.state,e.historyController,e.definitionModifier,i),new S(e.state,e,e.behaviorController,e.componentContext.iconProvider,e.configuration.toolbox,e.configuration.uidGenerator),new C(e.state,e.definitionWalker,e.definitionModifier),t,i,new b(e.state,e.definitionWalker))}constructor(e,t,s,i,o,n){this.controlBar=e,this.toolbox=t,this.editor=s,this.workspace=i,this.viewport=o,this.pathBar=n}}class z{constructor(e,t){this.configuration=e,this.state=t}validateStep(e,t){var s;return!(null===(s=this.configuration)||void 0===s?void 0:s.step)||this.configuration.step(e,t,this.state.definition)}validateRoot(){var e;return!(null===(e=this.configuration)||void 0===e?void 0:e.root)||this.configuration.root(this.state.definition)}}class B{constructor(e){this.configuration=e}getIconUrl(e){return this.configuration.iconUrlProvider?this.configuration.iconUrlProvider(e.componentType,e.type):null}}class E{static createForStep(e,t,s){const i=M(t.g),o=s.services.badges.map((t=>t.createForStep(i,e,s))),n=new h(t.width,0);return new E(i,n,o)}static createForRoot(e,t,s){const i=M(e),o=s.services.badges.map((e=>e.createForRoot?e.createForRoot(i,s):null));return new E(i,t,o)}constructor(e,t,s){this.g=e,this.position=t,this.badges=s}update(e){const t=this.badges.length;for(let s=0;s<t;s++){const t=this.badges[s];t&&(e[s]=t.update(e[s]))}let s=0,i=0,o=0;for(let e=0;e<t;e++){const t=this.badges[e];t&&t.view&&(s+=0===o?t.view.width/2:t.view.width,i=Math.max(i,t.view.height),u.translate(t.view.g,-s,0),s+=4,o++)}u.translate(this.g,this.position.x,this.position.y+-i/2)}resolveClick(e){for(const t of this.badges){const s=t&&t.resolveClick(e);if(s)return s}return null}}function M(e){const t=u.svg("g",{class:"sqd-badges"});return e.appendChild(t),t}(a=o||(o={}))[a.selectStep=1]="selectStep",a[a.rerenderStep=2]="rerenderStep",a[a.openFolder=3]="openFolder",a[a.triggerCustomAction=4]="triggerCustomAction",(r=n||(n={}))[r.none=0]="none",r[r.in=1]="in",r[r.out=2]="out";class P{static create(e,t,s){const i=E.createForStep(t,e,s);return new P(e,t.step,t.parentSequence,e.hasOutput(),i)}constructor(e,t,s,i,o){this.view=e,this.step=t,this.parentSequence=s,this.hasOutput=i,this.badges=o,this.isDisabled=!1}findById(e){if(this.step.id===e)return this;if(this.view.sequenceComponents)for(const t of this.view.sequenceComponents){const s=t.findById(e);if(s)return s}return null}resolveClick(e){if(this.view.sequenceComponents)for(const t of this.view.sequenceComponents){const s=t.resolveClick(e);if(s)return s}const t=this.badges.resolveClick(e);if(t)return t;const s=this.view.resolveClick(e);return s?!0===s?{type:o.selectStep,component:this}:s:null}getPlaceholders(e){this.isDisabled||(this.view.sequenceComponents&&this.view.sequenceComponents.forEach((t=>t.getPlaceholders(e))),this.view.placeholders&&this.view.placeholders.forEach((t=>e.push(t))))}setIsDragging(e){this.isDisabled||(this.view.sequenceComponents&&this.view.sequenceComponents.forEach((t=>t.setIsDragging(e))),this.view.placeholders&&this.view.placeholders.forEach((t=>t.setIsVisible(e)))),this.view.setIsDragging(e)}setIsSelected(e){this.view.setIsSelected(e)}setIsDisabled(e){this.isDisabled=e,this.view.setIsDisabled(e)}updateBadges(e){this.view.sequenceComponents&&this.view.sequenceComponents.forEach((t=>t.updateBadges(e))),this.badges.update(e)}}class T{static create(e,t){return{getStepIconUrl:()=>t.iconProvider.getIconUrl(e.step),createSequenceComponent:(s,i)=>{const o={sequence:i,depth:e.depth+1,isInputConnected:!0,isOutputConnected:e.isOutputConnected};return t.services.sequenceComponent.create(s,o,t)},createPlaceholderForArea:t.services.placeholder.createForArea.bind(t.services.placeholder)}}}class R{constructor(e){this.stepExtensionResolver=e}create(e,t,s){const i=T.create(t,s),o=this.stepExtensionResolver.resolve(t.step.componentType).createComponentView(e,t,i),n=s.services.stepComponentViewWrapper.wrap(o,t);return P.create(n,t,s)}}class L{static create(e,t,s,i,o){const n=new z(t,s),r=new B(e),a=o.placeholderController.create(),d=new R(i);return new L(n,r,a,d,o)}constructor(e,t,s,i,o){this.validator=e,this.iconProvider=t,this.placeholderController=s,this.stepComponentFactory=i,this.services=o}}class H{static create(e){return new H(e)}constructor(e){this.parent=e,this.currentContainer=null}setContent(e,t){const s=u.element("div",{class:t});s.appendChild(e),this.currentContainer&&this.parent.removeChild(this.currentContainer),this.parent.appendChild(s),this.currentContainer=s}destroy(){this.currentContainer&&this.parent.removeChild(this.currentContainer)}}class V{static create(e,t,s,i,o,n){const r=H.create(e),a=t.runRenderer((e=>function(e){const a=t.getDefinition();let d,l;if(e){const o=t.createStepEditorContext(e.id);d=i(e,o,a),l=s}else{const e=t.createGlobalEditorContext();d=n(a,e),l=o}r.setContent(d,l)}(e)));return new V(r,a)}constructor(e,t){this.view=e,this.renderer=t}destroy(){this.view.destroy(),this.renderer.destroy()}}class U{static create(e,t){const s=u.svg("g"),i=t.size/2,o=u.svg("path",{class:"sqd-validation-error",d:`M 0 ${-i} l ${i} ${t.size} l ${-t.size} 0 Z`});u.translate(o,i,i),s.appendChild(o);const n=g.appendPath(s,"sqd-validation-error-icon-path",g.alert,t.iconSize),r=.5*(t.size-t.iconSize),a=1.5*r;return u.translate(n,r,a),e.appendChild(s),new U(e,s,t.size,t.size)}constructor(e,t,s,i){this.parent=e,this.g=t,this.width=s,this.height=i}destroy(){this.parent.removeChild(this.g)}}class F{static createForStep(e,t,s,i){return new F(e,(()=>s.validator.validateStep(t.step,t.parentSequence)),i)}static createForRoot(e,t,s){return new F(e,(()=>t.validator.validateRoot()),s)}constructor(e,t,s){this.parentElement=e,this.validator=t,this.configuration=s,this.view=null}update(e){const t=this.validator();return t?this.view&&(this.view.destroy(),this.view=null):this.view||(this.view=U.create(this.parentElement,this.configuration)),t&&e}resolveClick(){return null}}const O={view:{size:22,iconSize:12}};class A{static create(e){return new A(null!=e?e:O)}constructor(e){this.configuration=e,this.id="validationError",this.createStartValue=()=>!0}createForStep(e,t,s){return F.createForStep(e,t,s,this.configuration.view)}createForRoot(e,t){return F.createForRoot(e,t,this.configuration.view)}}class X{static createRectInput(e,t,s,i,o,n){const r=u.svg("g");e.appendChild(r);const a=u.svg("rect",{class:"sqd-input",width:i,height:i,x:t-i/2,y:s+i/-2+.5,rx:4,ry:4});if(r.appendChild(a),n){const e=u.svg("image",{href:n,width:o,height:o,x:t-o/2,y:s+o/-2});r.appendChild(e)}return new X(r)}static createRoundInput(e,t,s,i){const o=u.svg("circle",{class:"sqd-input",cx:t,xy:s,r:i/2});return e.appendChild(o),new X(o)}constructor(e){this.root=e}setIsHidden(e){u.attrs(this.root,{visibility:e?"hidden":"visible"})}}class ${static createStraightJoin(e,t,s){const i=u.svg("line",{class:"sqd-join",x1:t.x,y1:t.y,x2:t.x,y2:t.y+s});e.insertBefore(i,e.firstChild)}static createJoins(e,t,s){const i=s[0],o=Math.abs(i.y-t.y)/2,n=Math.sign(i.y-t.y);switch(s.length){case 1:t.x===s[0].x?$.createStraightJoin(e,t,i.y*n):Z(e,t,s,o,n);break;case 2:Z(e,t,s,o,n);break;default:{const i=s[0],r=s[s.length-1];W(e,`M ${i.x} ${i.y} q ${.3*o} ${o*-n*.8} ${o} ${o*-n} l ${r.x-i.x-2*o} 0 q ${.8*o} ${-o*-n*.3} ${o} ${-o*-n}`);for(let t=1;t<s.length-1;t++)$.createStraightJoin(e,s[t],o*-n);$.createStraightJoin(e,t,o*n)}}}}function Z(e,t,s,i,o){for(const n of s){const s=Math.abs(n.x-t.x)-2*i,r=Math.sign(n.x-t.x);W(e,`M ${t.x} ${t.y} q ${r*i*.3} ${o*i*.8} ${r*i} ${o*i} l ${r*s} 0 q ${r*i*.7} ${o*i*.2} ${r*i} ${o*i}`)}}function W(e,t){const s=u.svg("path",{class:"sqd-join",fill:"none",d:t});e.insertBefore(s,e.firstChild)}class j{static create(e,t,s,i,o){const n=u.svg("g",{class:`sqd-label sqd-label-${o}`});e.appendChild(n);const r=u.svg("text",{class:"sqd-label-text",y:t+s.height/2});r.textContent=i,n.appendChild(r);const a=Math.max(r.getBBox().width+2*s.paddingX,s.minWidth),d=u.svg("rect",{class:"sqd-label-rect",width:a,height:s.height,x:-a/2+.5,y:t+.5,rx:s.radius,ry:s.radius});return n.insertBefore(d,r),new j(n,a,s.height)}constructor(e,t,s){this.g=e,this.width=t,this.height=s}}class N{static create(e,t,s,i){const o=u.svg("circle",{class:"sqd-output",cx:t,cy:s,r:i/2});return e.appendChild(o),new N(o)}constructor(e){this.root=e}setIsHidden(e){u.attrs(this.root,{visibility:e?"hidden":"visible"})}}class Y{static create(e,t,s){const i=t.reduce(((e,t)=>e+t),0),o=[Q(e,0,0,i,0),Q(e,0,0,0,s),Q(e,0,s,i,s),Q(e,i,0,i,s)];let n=t[0];for(let i=1;i<t.length;i++)o.push(Q(e,n,0,n,s)),n+=t[i];return new Y(o,i,s)}constructor(e,t,s){this.lines=e,this.width=t,this.height=s}getClientPosition(){const e=this.lines[0].getBoundingClientRect();return new h(e.x,e.y)}resolveClick(e){const t=this.getClientPosition(),s=e.position.subtract(t);return s.x>=0&&s.y>=0&&s.x<this.width*e.scale&&s.y<this.height*e.scale}setIsSelected(e){this.lines.forEach((t=>{u.toggleClass(t,e,"sqd-selected")}))}}function Q(e,t,s,i,o){const n=u.svg("line",{class:"sqd-region",x1:t,y1:s,x2:i,y2:o});return e.insertBefore(n,e.firstChild),n}class G{static create(e,t,s,i,o,r){const a=u.svg("g",{visibility:"hidden",class:"sqd-placeholder"});e.appendChild(a);const d=u.svg("rect",{class:"sqd-placeholder-rect",width:t,height:s,rx:i,ry:i});if(a.appendChild(d),r){const e=r===n.in?g.folderIn:g.folderOut,i=g.appendPath(a,"sqd-placeholder-icon-path",e,o);u.translate(i,(t-o)/2,(s-o)/2)}return e.appendChild(a),new G(d,a)}constructor(e,t){this.rect=e,this.g=t}setIsHover(e){u.toggleClass(this.g,e,"sqd-hover")}setIsVisible(e){u.attrs(this.g,{visibility:e?"visible":"hidden"})}}class J{static create(e,t,s){const i=s.services.placeholder.gapSize.x,o=s.services.placeholder.gapSize.y,{sequence:n}=t,r=u.svg("g");e.appendChild(r);const a=[];for(let e=0;e<n.length;e++){const i={parentSequence:t.sequence,step:n[e],depth:t.depth,position:e,isInputConnected:0===e?t.isInputConnected:a[e-1].hasOutput,isOutputConnected:e!==n.length-1||t.isOutputConnected};a[e]=s.stepComponentFactory.create(r,i,s)}let d,l;if(a.length>0){const e=Math.max(...a.map((e=>e.view.width-e.view.joinX)));d=Math.max(...a.map((e=>e.view.joinX))),l=d+e}else d=i/2,l=i;let c=o;const p=[];for(let e=0;e<a.length;e++){const l=a[e],g=d-l.view.joinX;if((0===e&&t.isInputConnected||e>0&&a[e-1].hasOutput)&&$.createStraightJoin(r,new h(d,c-o),o),s.placeholderController.canCreate(n,e)){const t=s.services.placeholder.createForGap(r,n,e);u.translate(t.view.g,d-i/2,c-o),p.push(t)}u.translate(l.view.g,g,c),c+=l.view.height+o}t.isOutputConnected&&(0===a.length||a[a.length-1].hasOutput)&&$.createStraightJoin(r,new h(d,c-o),o);const g=a.length;if(s.placeholderController.canCreate(n,g)){const e=s.services.placeholder.createForGap(r,n,g);u.translate(e.view.g,d-i/2,c-o),p.push(e)}return new J(r,l,c,d,p,a)}constructor(e,t,s,i,o,n){this.g=e,this.width=t,this.height=s,this.joinX=i,this.placeholders=o,this.components=n}setIsDragging(e){this.placeholders.forEach((t=>{t.setIsVisible(e)}))}hasOutput(){return!(this.components.length>0)||this.components[this.components.length-1].hasOutput}}class _{static create(e,t,s){const i=J.create(e,t,s);return new _(i,i.hasOutput())}constructor(e,t){this.view=e,this.hasOutput=t}resolveClick(e){for(const t of this.view.components){const s=t.resolveClick(e);if(s)return s}for(const t of this.view.placeholders){const s=t.resolveClick(e);if(s)return s}return null}findById(e){for(const t of this.view.components){const s=t.findById(e);if(s)return s}return null}getPlaceholders(e){this.view.placeholders.forEach((t=>e.push(t))),this.view.components.forEach((t=>t.getPlaceholders(e)))}setIsDragging(e){this.view.setIsDragging(e),this.view.components.forEach((t=>t.setIsDragging(e)))}updateBadges(e){for(const t of this.view.components)t.updateBadges(e)}}const K=(e,t)=>(s,i,o)=>{const{step:n}=i,r=u.svg("g",{class:`sqd-step-task sqd-type-${n.type}`});s.appendChild(r);const a=2*t.paddingY+t.iconSize,d=u.svg("text",{x:t.paddingLeft+t.iconSize+t.textMarginLeft,y:a/2,class:"sqd-step-task-text"});d.textContent=n.name,r.appendChild(d);const l=Math.max(d.getBBox().width,t.minTextWidth),c=t.iconSize+t.paddingLeft+t.paddingRight+t.textMarginLeft+l,p=u.svg("rect",{x:.5,y:.5,class:"sqd-step-task-rect",width:c,height:a,rx:t.radius,ry:t.radius});r.insertBefore(p,d);const g=o.getStepIconUrl(),f=g?u.svg("image",{href:g}):u.svg("rect",{class:"sqd-step-task-empty-icon",rx:t.radius,ry:t.radius});u.attrs(f,{x:t.paddingLeft,y:t.paddingY,width:t.iconSize,height:t.iconSize}),r.appendChild(f);const m=0===i.depth&&0===i.position&&!i.isInputConnected,w=e,v=m?null:X.createRoundInput(r,c/2,0,t.inputSize),C=w?null:N.create(r,c/2,a,t.outputSize);return{g:r,width:c,height:a,joinX:c/2,sequenceComponents:null,placeholders:null,hasOutput:()=>!!C,getClientPosition(){const e=p.getBoundingClientRect();return new h(e.x,e.y)},resolveClick:e=>!!r.contains(e.element)||null,setIsDragging(e){null==v||v.setIsHidden(e),null==C||C.setIsHidden(e)},setIsDisabled(e){u.toggleClass(r,e,"sqd-disabled")},setIsSelected(e){u.toggleClass(p,e,"sqd-selected")}}};class ee{static center(e,t,s){const i=Math.max(t.x-2*e,0),o=Math.max(t.y-2*e,0),n=Math.min(Math.min(i/s.x,o/s.y),1),r=s.x*n,a=s.y*n,d=Math.max(0,(t.x-r)/2),l=Math.max(0,(t.y-a)/2);return{position:new h(d,l),scale:n}}static focusOnComponent(e,t,s,i){const o=t.position.divideByScalar(t.scale).subtract(s.divideByScalar(t.scale)),n=i.divideByScalar(2);return{position:o.add(e.divideByScalar(2)).subtract(n),scale:1}}}const te=new class{constructor(e){this.values=e}next(e,t){let s,i=0,o=Number.MAX_VALUE;for(let t=0;t<this.values.length;t++){const s=Math.abs(this.values[t]-e);o>s&&(i=t,o=s)}return s=t?Math.min(i+1,this.values.length-1):Math.max(i-1,0),{current:this.values[i],next:this.values[s]}}}([.06,.08,.1,.12,.16,.2,.26,.32,.4,.5,.6,.7,.8,.9,1]);class se{static zoom(e,t){const s=te.next(e.scale,t);return{position:e.position,scale:s.next}}static zoomByWheel(e,t,s){if(0===t.deltaY)return null;const i=te.next(e.scale,t.deltaY<0);let o;const n=Math.abs(t.deltaY);if(n<16){const t=n/16,s=i.next-i.current;o=e.scale+s*t}else o=i.next;const r=new h(t.pageX,t.pageY).subtract(s);return{position:r.divideByScalar(e.scale).subtract(e.position.divideByScalar(e.scale)).multiplyByScalar(-o).add(r),scale:o}}}class ie{static create(e){return new ie(e)}constructor(e){this.api=e}onWheel(e){const t=this.api.getViewport(),s=this.api.getCanvasPosition(),i=se.zoomByWheel(t,e,s);i&&this.api.setViewport(i)}}class oe{constructor(){this.create=ie.create}}class ne{constructor(e){this.api=e}execute(e){this.animation&&this.animation.isAlive&&this.animation.stop();const t=this.api.getViewport(),s=t.position,i=t.scale,o=s.subtract(e.position),n=i-e.scale;this.animation=function(e,t){const s=setInterval((function(){const e=Math.min((Date.now()-i)/150,1);t(e),1===e&&o.stop()}),15),i=Date.now(),o={isAlive:!0,stop:()=>{o.isAlive=!1,clearInterval(s)}};return o}(0,(e=>{const t=i-n*e;this.api.setViewport({position:s.subtract(o.multiplyByScalar(e)),scale:t})}))}}class re{static create(e){return new re(e)}constructor(e){this.api=e,this.animator=new ne(this.api)}setDefault(){const e=this.api.getRootComponentSize(),t=this.api.getCanvasSize(),s=ee.center(10,t,e);this.api.setViewport(s)}zoom(e){const t=this.api.getViewport(),s=se.zoom(t,e);this.api.setViewport(s)}focusOnComponent(e,t){const s=this.api.getViewport(),i=this.api.getCanvasSize(),o=ee.focusOnComponent(i,s,e,t);this.animateTo(o)}animateTo(e){this.animator.execute(e)}}class ae{constructor(){this.create=re.create}}class de{static create(e){const t={};for(let s=e.steps.length-1;s>=0;s--){const i=e.steps[s];t[i.componentType]=i}return new de(t)}constructor(e){this.dict=e}resolve(e){const t=this.dict[e];if(!t)throw new Error(`Not supported component type: ${e}`);return t}}class le{static create(e,t,s,i,o,n){const r=G.create(e,t.x,t.y,n.radius,n.iconSize,s);return new le(r,i,o)}constructor(e,t,s){this.view=e,this.parentSequence=t,this.index=s}getClientRect(){return this.view.rect.getBoundingClientRect()}setIsHover(e){this.view.setIsHover(e)}setIsVisible(e){this.view.setIsVisible(e)}resolveClick(){return null}}function ce(e){return new h(e.pageX,e.pageY)}function he(e){if(e.touches.length>0){const t=e.touches[0];return new h(t.pageX,t.pageY)}throw new Error("Unknown touch position")}const pe="State is not initialized",ue={passive:!1};class ge{constructor(){this.onMouseMove=e=>{e.preventDefault(),this.move(ce(e))},this.onTouchMove=e=>{e.preventDefault(),this.move(he(e))},this.onMouseUp=e=>{e.preventDefault(),this.stop(!1,e.target)},this.onTouchEnd=e=>{var t;if(e.preventDefault(),!this.state)throw new Error(pe);const s=null!==(t=this.state.lastPosition)&&void 0!==t?t:this.state.startPosition,i=document.elementFromPoint(s.x,s.y);this.stop(!1,i)},this.onTouchStart=e=>{e.preventDefault(),1!==e.touches.length&&this.stop(!0,null)}}start(e,t){this.state?this.stop(!0,null):(this.state={startPosition:e,behavior:t},t.onStart(this.state.startPosition),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("touchmove",this.onTouchMove,ue),window.addEventListener("mouseup",this.onMouseUp,!1),window.addEventListener("touchend",this.onTouchEnd,ue),window.addEventListener("touchstart",this.onTouchStart,ue))}move(e){if(!this.state)throw new Error(pe);this.state.lastPosition=e;const t=this.state.startPosition.subtract(e),s=this.state.behavior.onMove(t);s&&(this.state.behavior.onEnd(!0,null),this.state.behavior=s,this.state.startPosition=e,this.state.behavior.onStart(this.state.startPosition))}stop(e,t){if(!this.state)throw new Error(pe);window.removeEventListener("mousemove",this.onMouseMove,!1),window.removeEventListener("touchmove",this.onTouchMove,ue),window.removeEventListener("mouseup",this.onMouseUp,!1),window.removeEventListener("touchend",this.onTouchEnd,ue),window.removeEventListener("touchstart",this.onTouchStart,ue),this.state.behavior.onEnd(e,t),this.state=void 0}}class fe{static tryMoveStep(e,t,s,i){const o=e.indexOf(t);if(o<0)throw new Error("Step not found in source sequence");return e===s&&(o<i&&i--,o===i)?null:function(){e.splice(o,1),s.splice(i,0,t)}}static insertStep(e,t,s){t.splice(s,0,e)}static deleteStep(e,t){const s=t.indexOf(e);if(s<0)throw new Error("Unknown step");t.splice(s,1)}}class me{constructor(e,t){this.uidGenerator=e,this.definitionWalker=t}duplicate(e){const t=f.deepClone(e);return t.id=this.uidGenerator(),this.definitionWalker.forEachChildren(t,(e=>{e.id=this.uidGenerator()})),t}}class we{constructor(e,t,s){this.definitionWalker=e,this.state=t,this.configuration=s}isDeletable(e){if(this.configuration.steps.isDeletable){const t=this.definitionWalker.getParentSequence(this.state.definition,e);return this.configuration.steps.isDeletable(t.step,t.parentSequence)}return!0}tryDelete(e){const t=this.definitionWalker.getParentSequence(this.state.definition,e);return!(this.configuration.steps.canDeleteStep&&!this.configuration.steps.canDeleteStep(t.step,t.parentSequence)||(fe.deleteStep(t.step,t.parentSequence),this.state.notifyDefinitionChanged(i.stepDeleted,t.step.id),this.updateDependantFields(),0))}tryInsert(e,t,s){return!(this.configuration.steps.canInsertStep&&!this.configuration.steps.canInsertStep(e,t,s)||(fe.insertStep(e,t,s),this.state.notifyDefinitionChanged(i.stepInserted,e.id),this.state.setSelectedStepId(e.id),0))}isDraggable(e,t){return!this.configuration.steps.isDraggable||this.configuration.steps.isDraggable(e,t)}tryMove(e,t,s,o){const n=fe.tryMoveStep(e,t,s,o);return!!n&&!(this.configuration.steps.canMoveStep&&!this.configuration.steps.canMoveStep(e,t,s,o)||(n(),this.state.notifyDefinitionChanged(i.stepMoved,t.id),this.state.setSelectedStepId(t.id),0))}isDuplicable(e,t){return!!this.configuration.steps.isDuplicable&&this.configuration.steps.isDuplicable(e,t)}tryDuplicate(e,t){const s=this.configuration.uidGenerator?this.configuration.uidGenerator:m.next,i=new me(s,this.definitionWalker),o=t.indexOf(e),n=i.duplicate(e);return this.tryInsert(n,t,o+1)}replaceDefinition(e){if(!e)throw new Error("Definition is empty");this.state.setDefinition(e),this.updateDependantFields()}updateDependantFields(){this.state.selectedStepId&&(this.definitionWalker.findById(this.state.definition,this.state.selectedStepId)||this.state.setSelectedStepId(null));for(let e=0;e<this.state.folderPath.length;e++){const t=this.state.folderPath[e];if(!this.definitionWalker.findById(this.state.definition,t)){const t=this.state.folderPath.slice(0,e);this.state.setFolderPath(t);break}}}}class ve{static create(e,t,s){if(!s.undoStackSize||s.undoStackSize<1)throw new Error("Invalid undo stack size");const o=new ve(e,t,s.undoStackSize);return o.remember(i.rootReplaced,null),e.onDefinitionChanged.subscribe((e=>{e.changeType!==i.rootReplaced&&o.remember(e.changeType,e.stepId)})),o}constructor(e,t,s){this.state=e,this.definitionModifier=t,this.stackSize=s,this.stack=[],this.currentIndex=0}canUndo(){return this.currentIndex>1}undo(){this.currentIndex--,this.commit()}canRedo(){return this.currentIndex<this.stack.length}redo(){this.currentIndex++,this.commit()}remember(e,t){const s=f.deepClone(this.state.definition);if(this.stack.length>0&&this.currentIndex===this.stack.length){const i=this.stack[this.stack.length-1];if(function(e,t,s){return e.changeType===t&&e.stepId===s}(i,e,t))return void(i.definition=s)}this.stack.splice(this.currentIndex),this.stack.push({definition:s,changeType:e,stepId:t}),this.stack.length>this.stackSize&&this.stack.splice(0,this.stack.length-this.stackSize-1),this.currentIndex=this.stack.length}commit(){const e=f.deepClone(this.stack[this.currentIndex-1].definition);this.definitionModifier.replaceDefinition(e)}}class Ce{constructor(e){this.parent=e}isMobile(){return this.parent.clientWidth<400}}class be{set(e){if(this.controller)throw new Error("Controller is already set");this.controller=e}get(){if(!this.controller)throw new Error("Controller is not set");return this.controller}getPlaceholders(){return this.get().getPlaceholders()}getComponentByStepId(e){return this.get().getComponentByStepId(e)}getCanvasPosition(){return this.get().getCanvasPosition()}getCanvasSize(){return this.get().getCanvasSize()}getRootComponentSize(){return this.get().getRootComponentSize()}updateBadges(){this.get().updateBadges()}updateRootComponent(){this.get().updateRootComponent()}updateCanvasSize(){this.get().updateCanvasSize()}}class qe{static create(e,t,s,i){var o,n,r;const a=f.deepClone(t),l=new Ce(e),c=!!s.isReadonly,h=!!s.toolbox&&(null!==(o=s.toolbox.isCollapsed)&&void 0!==o?o:l.isMobile()),u=!!s.editors&&(null!==(n=s.editors.isCollapsed)&&void 0!==n?n:l.isMobile()),g=s.theme||"light",m=new p(a,c,h,u),w=new be,v=new ge,C=de.create(i),b=null!==(r=s.definitionWalker)&&void 0!==r?r:new d,q=new we(b,m,s);let x;s.undoStackSize&&(x=ve.create(m,q,s));const y=L.create(s.steps,s.validator,m,C,i);return new qe(g,m,s,i,y,b,q,l,w,v,x)}constructor(e,t,s,i,o,n,r,a,d,l,c){this.theme=e,this.state=t,this.configuration=s,this.services=i,this.componentContext=o,this.definitionWalker=n,this.definitionModifier=r,this.layoutController=a,this.workspaceController=d,this.behaviorController=l,this.historyController=c}setWorkspaceController(e){this.workspaceController.set(e)}}let xe=0;class ye{static create(e,t){const s="sqd-grid-pattern-"+xe++,i=u.svg("pattern",{id:s,patternUnits:"userSpaceOnUse"}),o=t.services.grid.create(),n=u.svg("defs");i.appendChild(o.element),n.appendChild(i);const r=u.svg("g"),a=u.element("div",{class:"sqd-workspace"}),d=u.svg("svg",{class:"sqd-workspace-canvas"});d.appendChild(n),d.appendChild(u.svg("rect",{width:"100%",height:"100%",fill:`url(#${s})`})),d.appendChild(r),a.appendChild(d),e.appendChild(a);const l=new ye(a,d,i,o,r,t);return window.addEventListener("resize",l.onResizeHandler,!1),l}constructor(e,t,s,i,o,n){this.workspace=e,this.canvas=t,this.pattern=s,this.gridPattern=i,this.foreground=o,this.context=n,this.onResizeHandler=()=>this.onResize()}render(e,t){this.rootComponent&&this.foreground.removeChild(this.rootComponent.view.g),this.rootComponent=this.context.services.rootComponent.create(this.foreground,e,t,this.context),this.refreshSize()}setPositionAndScale(e,t){const s=this.gridPattern.size.multiplyByScalar(t);u.attrs(this.pattern,{x:e.x,y:e.y,width:s.x,height:s.y}),this.gridPattern.setScale(t,s),u.attrs(this.foreground,{transform:`translate(${e.x}, ${e.y}) scale(${t})`})}getCanvasPosition(){const e=this.canvas.getBoundingClientRect();return new h(e.x+window.scrollX,e.y+window.scrollY)}getCanvasSize(){return new h(this.canvas.clientWidth,this.canvas.clientHeight)}bindClick(e){this.canvas.addEventListener("mousedown",(t=>{t.preventDefault(),e(ce(t),t.target,t.button)}),!1),this.canvas.addEventListener("touchstart",(t=>{t.preventDefault();const s=function(e){if(e.touches.length>0){const t=e.touches[0];return new h(t.clientX,t.clientY)}throw new Error("Unknown touch position")}(t),i=document.elementFromPoint(s.x,s.y);if(i){const s=he(t);e(s,i,0)}}),{passive:!1})}bindContextMenu(e){this.canvas.addEventListener("contextmenu",(t=>{t.preventDefault(),e(ce(t),t.target)}),!1)}bindWheel(e){this.canvas.addEventListener("wheel",e,!1)}destroy(){window.removeEventListener("resize",this.onResizeHandler,!1)}refreshSize(){u.attrs(this.canvas,{width:this.workspace.offsetWidth,height:this.workspace.offsetHeight})}onResize(){this.refreshSize()}}class Se{static create(e,t){return new Se(e.viewport.position,t,e)}constructor(e,t,s){this.startPosition=e,this.resetSelectedStep=t,this.state=s}onStart(){if(this.resetSelectedStep){const e=this.state.tryGetLastStepIdFromFolderPath();this.state.setSelectedStepId(e)}}onMove(e){this.state.setViewport({position:this.startPosition.subtract(e),scale:this.state.viewport.scale})}onEnd(){}}class ke{static create(e,t,s){const i=t||s.state.isDragDisabled||!s.definitionModifier.isDraggable(e.step,e.parentSequence);return new ke(e,i,s,s.state)}constructor(e,t,s,i){this.pressedStepComponent=e,this.isDragDisabled=t,this.context=s,this.state=i}onStart(){}onMove(e){if(e.distance()>2)return this.state.isReadonly||this.isDragDisabled?Se.create(this.state,!1):(this.state.setSelectedStepId(null),y.create(this.context,this.pressedStepComponent.step,this.pressedStepComponent))}onEnd(e){e||this.state.setSelectedStepId(this.pressedStepComponent.step.id)}}class Ie{static create(e,t){return new Ie(e,t)}constructor(e,t){this.clickedElement=e,this.handler=t}onStart(){}onMove(){}onEnd(e,t){!e&&t&&this.clickedElement===t&&this.handler.handle()}}class De{constructor(e){this.designerContext=e}handle(){this.designerContext.workspaceController.updateRootComponent()}}class ze{constructor(e,t){this.command=e,this.designerContext=t}handle(){const e=this.command.step.id;this.designerContext.state.pushStepIdToFolderPath(e)}}class Be{constructor(e,t){this.command=e,this.designerContext=t}handle(){const e=this.designerContext.configuration.customActionHandler;if(!e)return void console.warn(`Custom action handler is not defined (action type: ${this.command.action.type})`);const t=this.createContext();e(this.command.action,this.command.step,this.command.sequence,t)}createContext(){return{notifyStepNameChanged:e=>this.notifyStepChanged(i.stepNameChanged,e),notifyStepPropertiesChanged:e=>this.notifyStepChanged(i.stepPropertyChanged,e),notifyStepInserted:e=>this.notifyStepChanged(i.stepInserted,e),notifyStepMoved:e=>this.notifyStepChanged(i.stepMoved,e),notifyStepDeleted:e=>this.notifyStepChanged(i.stepDeleted,e)}}notifyStepChanged(e,t){if(!t)throw new Error("Step id is empty");this.designerContext.state.notifyDefinitionChanged(e,t)}}class Ee{constructor(e,t){this.designerContext=e,this.state=t}resolve(e,t,s){if(!e)return Se.create(this.state,!0);switch(e.type){case o.selectStep:return ke.create(e.component,s,this.designerContext);case o.rerenderStep:return Ie.create(t,new De(this.designerContext));case o.openFolder:return Ie.create(t,new ze(e,this.designerContext));case o.triggerCustomAction:return Ie.create(t,new Be(e,this.designerContext));default:throw new Error("Not supported behavior type")}}}class Me{static create(e){return e.badges.map((e=>e.createStartValue()))}}function Pe(e){return e.findIndex((e=>"validationError"===e.id))}class Te{static create(e,t,s){const i=document.createElement("div");i.style.left=`${e.x}px`,i.style.top=`${e.y}px`,i.className=`sqd-context-menu sqd-theme-${t}`;const o=[];for(let e=0;e<s.length;e++){const t=s[e],n=document.createElement("div");"string"==typeof t?(n.className="sqd-context-menu-group",n.innerText=t):(n.className="sqd-context-menu-item",n.innerText=t.label),o.push(n),i.appendChild(n)}const n=new Te(i,o,s,Date.now());return document.addEventListener("mousedown",n.mouseDown,!1),document.addEventListener("mouseup",n.mouseUp,!1),document.addEventListener("touchstart",n.mouseDown,!1),document.addEventListener("touchend",n.mouseUp,!1),document.body.appendChild(i),n}constructor(e,t,s,i){this.menu=e,this.elements=t,this.items=s,this.startTime=i,this.isAttached=!0,this.mouseDown=e=>{null===this.findIndex(e.target)?this.tryDestroy():(e.preventDefault(),e.stopPropagation())},this.mouseUp=e=>{if(Date.now()-this.startTime<300)return e.preventDefault(),void e.stopPropagation();try{const t=this.findIndex(e.target);if(null!==t){const e=this.items[t];"string"!=typeof e&&e.callback()}}finally{this.tryDestroy()}}}findIndex(e){for(let t=0;t<this.elements.length;t++)if(this.elements[t].contains(e))return t;return null}tryDestroy(){this.isAttached&&(document.body.removeChild(this.menu),document.removeEventListener("mousedown",this.mouseDown,!1),document.removeEventListener("mouseup",this.mouseUp,!1),document.removeEventListener("touchstart",this.mouseDown,!1),document.removeEventListener("touchend",this.mouseUp,!1),this.isAttached=!1)}}class Re{static build(e,t,s,i){const n=[];if(e&&e.type===o.selectStep){const t=e,o=t.component.step,r=t.component.parentSequence;n.push(o.name),i.selectedStepId===o.id?n.push({label:"Unselect",callback:()=>{i.setSelectedStepId(null)}}):n.push({label:"Select",callback:()=>{i.setSelectedStepId(o.id)}}),i.isReadonly||(s.isDeletable(o.id)&&n.push({label:"Delete",callback:()=>{s.tryDelete(o.id)}}),s.isDuplicable(o,r)&&n.push({label:"Duplicate",callback:()=>{s.tryDuplicate(o,r)}}))}return n.push({label:"Reset view",callback:()=>{t.resetViewport()}}),n}}class Le{constructor(e,t,s,i,o){this.theme=e,this.viewportApi=t,this.definitionModifier=s,this.state=i,this.configuration=o}tryOpen(e,t){if(!1===this.configuration.contextMenu)return;this.last&&this.last.tryDestroy();const s=Re.build(t,this.viewportApi,this.definitionModifier,this.state);this.last=Te.create(e,this.theme,s)}destroy(){this.last&&this.last.tryDestroy()}}class He{static create(e,t,s){const i=ye.create(e,t.componentContext),o=new Ee(t,t.state),n=t.services.wheelController.create(s.workspace),r=new Le(t.theme,s.viewport,t.definitionModifier,t.state,t.configuration),a=new He(i,t.definitionWalker,t.state,t.behaviorController,n,r,o,s.viewport,t.services);return setTimeout((()=>{a.updateRootComponent(),s.viewport.resetViewport(),a.onReady.forward()})),t.setWorkspaceController(a),t.state.onViewportChanged.subscribe((e=>a.onViewportChanged(e))),t.state.onIsDraggingChanged.subscribe((e=>a.onIsDraggingChanged(e))),w(0,t.state.onDefinitionChanged,t.state.onSelectedStepIdChanged,t.state.onFolderPathChanged).subscribe((e=>{a.onStateChanged(e[0],e[1],e[2])})),i.bindClick(((e,t,s)=>a.onClick(e,t,s))),i.bindWheel((e=>a.onWheel(e))),i.bindContextMenu(((e,t)=>a.onContextMenu(e,t))),a}constructor(e,t,s,i,o,n,r,a,d){this.view=e,this.definitionWalker=t,this.state=s,this.behaviorController=i,this.wheelController=o,this.contextMenuController=n,this.clickBehaviorResolver=r,this.viewportApi=a,this.services=d,this.onReady=new c,this.isValid=!1,this.selectedStepComponent=null,this.validationErrorBadgeIndex=null}updateRootComponent(){let e,s;this.selectedStepComponent=null;const i=this.state.tryGetLastStepIdFromFolderPath();if(i){const o=this.definitionWalker.getParentSequence(this.state.definition,i),n=this.definitionWalker.getChildren(o.step);if(!n||n.type!==t.sequence)throw new Error("Cannot find single sequence in folder step");s=n.items,e={sequence:o.parentSequence,index:o.index}}else s=this.state.definition.sequence,e=null;this.view.render(s,e),this.trySelectStepComponent(this.state.selectedStepId),this.updateBadges()}updateBadges(){const e=Me.create(this.services);this.getRootComponent().updateBadges(e),null===this.validationErrorBadgeIndex&&(this.validationErrorBadgeIndex=Pe(this.services.badges)),this.isValid=Boolean(e[this.validationErrorBadgeIndex])}getPlaceholders(){const e=[];return this.getRootComponent().getPlaceholders(e),e}getComponentByStepId(e){const t=this.getRootComponent().findById(e);if(!t)throw new Error(`Cannot find component for step id: ${e}`);return t}getCanvasPosition(){return this.view.getCanvasPosition()}getCanvasSize(){return this.view.getCanvasSize()}getRootComponentSize(){const e=this.getRootComponent().view;return new h(e.width,e.height)}updateCanvasSize(){setTimeout((()=>this.view.refreshSize()))}destroy(){this.contextMenuController.destroy(),this.view.destroy()}onClick(e,t,s){const i=1===s;if(0===s||i){const s=this.resolveClick(t,e),o=i,n=this.clickBehaviorResolver.resolve(s,t,o);this.behaviorController.start(e,n)}}onWheel(e){e.preventDefault(),e.stopPropagation(),this.wheelController.onWheel(e)}onContextMenu(e,t){const s=this.resolveClick(t,e);this.contextMenuController.tryOpen(e,s)}onIsDraggingChanged(e){this.getRootComponent().setIsDragging(e)}onViewportChanged(e){this.view.setPositionAndScale(e.position,e.scale)}onStateChanged(e,t,s){s?(this.updateRootComponent(),this.viewportApi.resetViewport()):e?e.changeType===i.stepPropertyChanged?this.updateBadges():this.updateRootComponent():void 0!==t&&this.trySelectStepComponent(t)}trySelectStepComponent(e){this.selectedStepComponent&&(this.selectedStepComponent.setIsSelected(!1),this.selectedStepComponent=null),e&&(this.selectedStepComponent=this.getRootComponent().findById(e),this.selectedStepComponent&&this.selectedStepComponent.setIsSelected(!0))}resolveClick(e,t){const s={element:e,position:t,scale:this.state.viewport.scale};return this.getRootComponent().resolveClick(s)}getRootComponent(){if(this.view.rootComponent)return this.view.rootComponent;throw new Error("Root component not found")}}class Ve{static create(e,t,s){const i=u.element("div",{class:`sqd-designer sqd-theme-${t.theme}`});e.appendChild(i);const o=He.create(i,t,s),n=t.services.uiComponents.map((e=>e.create(i,s))),r=t.services.daemons.map((e=>e.create(s))),a=new Ve(i,t.layoutController,o,n,r);return a.reloadLayout(),window.addEventListener("resize",a.onResizeHandler,!1),a}constructor(e,t,s,i,o){this.root=e,this.layoutController=t,this.workspace=s,this.uiComponents=i,this.daemons=o,this.onResizeHandler=()=>this.onResize()}destroy(){var e;window.removeEventListener("resize",this.onResizeHandler,!1),this.workspace.destroy(),this.uiComponents.forEach((e=>e.destroy())),this.daemons.forEach((e=>e.destroy())),null===(e=this.root.parentElement)||void 0===e||e.removeChild(this.root)}onResize(){this.reloadLayout()}reloadLayout(){const e=this.layoutController.isMobile();u.toggleClass(this.root,!e,"sqd-layout-desktop"),u.toggleClass(this.root,e,"sqd-layout-mobile")}}class Ue{static create(e,t,s){const i=u.svg("svg");i.style.marginLeft="-10px",i.style.marginTop="-10px",e.appendChild(i);const o={parentSequence:[],step:t,depth:0,position:0,isInputConnected:!0,isOutputConnected:!0},n=s.stepComponentFactory.create(i,o,s);return u.attrs(i,{width:n.view.width+20,height:n.view.height+20}),u.translate(n.view.g,10,10),new Ue(n.view.width,n.view.height)}constructor(e,t){this.width=e,this.height=t}destroy(){}}class Fe{constructor(){this.create=Ue.create}}class Oe{static create(e,t){const s=u.element("div",{class:"sqd-control-bar"}),i=Xe(g.center,"Reset view");s.appendChild(i);const o=Xe(g.zoomIn,"Zoom in");s.appendChild(o);const n=Xe(g.zoomOut,"Zoom out");s.appendChild(n);let r=null,a=null;t&&(r=Xe(g.undo,"Undo"),s.appendChild(r),a=Xe(g.redo,"Redo"),s.appendChild(a));const d=Xe(g.move,"Turn on/off drag and drop");d.classList.add("sqd-disabled"),s.appendChild(d);const l=Xe(g.delete,"Delete selected step");return l.classList.add("sqd-delete"),l.classList.add("sqd-hidden"),s.appendChild(l),e.appendChild(s),new Oe(i,o,n,r,a,d,l)}constructor(e,t,s,i,o,n,r){this.resetButton=e,this.zoomInButton=t,this.zoomOutButton=s,this.undoButton=i,this.redoButton=o,this.disableDragButton=n,this.deleteButton=r}bindResetButtonClick(e){Ae(this.resetButton,e)}bindZoomInButtonClick(e){Ae(this.zoomInButton,e)}bindZoomOutButtonClick(e){Ae(this.zoomOutButton,e)}bindUndoButtonClick(e){if(!this.undoButton)throw new Error("Undo button is disabled");Ae(this.undoButton,e)}bindRedoButtonClick(e){if(!this.redoButton)throw new Error("Redo button is disabled");Ae(this.redoButton,e)}bindDisableDragButtonClick(e){Ae(this.disableDragButton,e)}bindDeleteButtonClick(e){Ae(this.deleteButton,e)}setIsDeleteButtonHidden(e){u.toggleClass(this.deleteButton,e,"sqd-hidden")}setDisableDragButtonDisabled(e){u.toggleClass(this.disableDragButton,e,"sqd-disabled")}setUndoButtonDisabled(e){if(!this.undoButton)throw new Error("Undo button is disabled");u.toggleClass(this.undoButton,e,"sqd-disabled")}setRedoButtonDisabled(e){if(!this.redoButton)throw new Error("Redo button is disabled");u.toggleClass(this.redoButton,e,"sqd-disabled")}}function Ae(e,t){e.addEventListener("click",(e=>{e.preventDefault(),t()}),!1)}function Xe(e,t){const s=u.element("div",{class:"sqd-control-bar-button",title:t}),i=g.createSvg("sqd-control-bar-button-icon",e);return s.appendChild(i),s}class $e{static create(e,t){const s=t.controlBar.isUndoRedoSupported(),i=Oe.create(e,s),o=new $e(i,t.controlBar,s);return i.bindResetButtonClick((()=>o.onResetButtonClicked())),i.bindZoomInButtonClick((()=>o.onZoomInButtonClicked())),i.bindZoomOutButtonClick((()=>o.onZoomOutButtonClicked())),i.bindDisableDragButtonClick((()=>o.onMoveButtonClicked())),i.bindDeleteButtonClick((()=>o.onDeleteButtonClicked())),t.controlBar.subscribe((()=>o.refreshButtons())),s&&(i.bindUndoButtonClick((()=>o.onUndoButtonClicked())),i.bindRedoButtonClick((()=>o.onRedoButtonClicked()))),o.refreshButtons(),o}constructor(e,t,s){this.view=e,this.controlBarApi=t,this.isUndoRedoSupported=s}destroy(){}onResetButtonClicked(){this.controlBarApi.resetViewport()}onZoomInButtonClicked(){this.controlBarApi.zoomIn()}onZoomOutButtonClicked(){this.controlBarApi.zoomOut()}onMoveButtonClicked(){this.controlBarApi.toggleIsDragDisabled()}onUndoButtonClicked(){this.controlBarApi.tryUndo()}onRedoButtonClicked(){this.controlBarApi.tryRedo()}onDeleteButtonClicked(){this.controlBarApi.tryDelete()}refreshButtons(){this.refreshDeleteButtonVisibility(),this.refreshIsDragDisabled(),this.isUndoRedoSupported&&this.refreshUndoRedoAvailability()}refreshIsDragDisabled(){const e=this.controlBarApi.isDragDisabled();this.view.setDisableDragButtonDisabled(!e)}refreshUndoRedoAvailability(){const e=this.controlBarApi.canUndo(),t=this.controlBarApi.canRedo();this.view.setUndoButtonDisabled(!e),this.view.setRedoButtonDisabled(!t)}refreshDeleteButtonVisibility(){const e=this.controlBarApi.canDelete();this.view.setIsDeleteButtonHidden(!e)}}class Ze{constructor(){this.create=$e.create}}const We=["Backspace","Delete"],je=["INPUT","TEXTAREA"];class Ne{static create(e){const t=new Ne(e.controlBar);return document.addEventListener("keyup",t.onKeyUp,!1),t}constructor(e){this.controlBarApi=e,this.onKeyUp=e=>{We.includes(e.key)&&(document.activeElement&&je.includes(document.activeElement.tagName)||this.controlBarApi.canDelete()&&(e.preventDefault(),e.stopPropagation(),this.controlBarApi.tryDelete()))}}destroy(){document.removeEventListener("keyup",this.onKeyUp,!1)}}class Ye{constructor(){this.create=Ne.create}}class Qe{static create(e,t,s){const i=u.element("div",{class:"sqd-smart-editor"}),o=u.element("div",{class:"sqd-smart-editor-toggle",title:"Toggle editor"});e.appendChild(o),e.appendChild(i);const n=V.create(i,t,"sqd-editor sqd-step-editor",s.stepEditorProvider,"sqd-editor sqd-global-editor",s.globalEditorProvider);return new Qe(i,o,n)}constructor(e,t,s){this.root=e,this.toggle=t,this.editor=s}bindToggleClick(e){this.toggle.addEventListener("click",(t=>{t.preventDefault(),e()}),!1)}setIsCollapsed(e){u.toggleClass(this.root,e,"sqd-hidden"),u.toggleClass(this.toggle,e,"sqd-collapsed"),this.toggleIcon&&this.toggle.removeChild(this.toggleIcon),this.toggleIcon=g.createSvg("sqd-smart-editor-toggle-icon",e?g.options:g.close),this.toggle.appendChild(this.toggleIcon)}destroy(){this.editor.destroy()}}class Ge{static create(e,t,s){const i=Qe.create(e,t.editor,s),o=new Ge(i,t.editor,t.workspace);return o.updateVisibility(),i.bindToggleClick((()=>o.onToggleClicked())),t.editor.subscribeIsCollapsed((()=>o.onIsCollapsedChanged())),o}constructor(e,t,s){this.view=e,this.editorApi=t,this.workspaceApi=s}onToggleClicked(){this.editorApi.toggleIsCollapsed()}setIsCollapsed(e){this.view.setIsCollapsed(e)}onIsCollapsedChanged(){this.updateVisibility(),this.workspaceApi.updateCanvasSize()}updateVisibility(){this.setIsCollapsed(this.editorApi.isCollapsed())}destroy(){this.view.destroy()}}class Je{constructor(e){this.configuration=e}create(e,t){return Ge.create(e,t,this.configuration)}}const _e={passive:!1};class Ke{static create(e,t){const s=u.element("div",{class:"sqd-scrollbox"});e.appendChild(s);const i=new Ke(s,t);return window.addEventListener("resize",i.onResize,!1),s.addEventListener("wheel",(e=>i.onWheel(e)),!1),s.addEventListener("touchstart",(e=>i.onTouchStart(e)),_e),s.addEventListener("mousedown",(e=>i.onMouseDown(e)),!1),i}constructor(e,t){this.root=e,this.viewport=t,this.onResize=()=>{this.refresh()},this.onTouchStart=e=>{e.preventDefault(),this.startScroll(he(e))},this.onMouseDown=e=>{this.startScroll(ce(e))},this.onTouchMove=e=>{e.preventDefault(),this.moveScroll(he(e))},this.onMouseMove=e=>{e.preventDefault(),this.moveScroll(ce(e))},this.onTouchEnd=e=>{e.preventDefault(),this.stopScroll()},this.onMouseUp=e=>{e.preventDefault(),this.stopScroll()}}setContent(e){this.content&&this.root.removeChild(this.content.element),e.classList.add("sqd-scrollbox-body"),this.root.appendChild(e),this.reload(e)}refresh(){this.content&&this.reload(this.content.element)}destroy(){window.removeEventListener("resize",this.onResize,!1)}reload(e){let t=Math.min(.7*this.viewport.clientHeight,e.clientHeight);t=Math.min(t,this.viewport.clientHeight-206),this.root.style.height=t+"px",e.style.top="0px",this.content={element:e,height:t}}onWheel(e){if(e.stopPropagation(),this.content){const t=e.deltaY>0?-25:25,s=this.getScrollTop();this.setScrollTop(s+t)}}startScroll(e){this.scroll||(window.addEventListener("touchmove",this.onTouchMove,_e),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("touchend",this.onTouchEnd,_e),window.addEventListener("mouseup",this.onMouseUp,!1)),this.scroll={startPositionY:e.y,startScrollTop:this.getScrollTop()}}moveScroll(e){if(this.scroll){const t=e.y-this.scroll.startPositionY;this.setScrollTop(this.scroll.startScrollTop+t)}}stopScroll(){this.scroll&&(window.removeEventListener("touchmove",this.onTouchMove,_e),window.removeEventListener("mousemove",this.onMouseMove,!1),window.removeEventListener("touchend",this.onTouchEnd,_e),window.removeEventListener("mouseup",this.onMouseUp,!1),this.scroll=void 0)}getScrollTop(){return this.content&&this.content.element.style.top?parseInt(this.content.element.style.top):0}setScrollTop(e){if(this.content){const t=this.content.element.clientHeight-this.content.height,s=Math.max(Math.min(e,0),-t);this.content.element.style.top=s+"px"}}}const et=/^[a-zA-Z][a-zA-Z0-9_-]+$/;class tt{static validate(e){if(!et.test(e))throw new Error(`Step type "${e}" contains not allowed characters`)}}class st{static create(e,t,s){const i=s.getLabel(t),o=u.element("div",{class:`sqd-toolbox-item sqd-type-${t.type}`,title:i}),n=s.tryGetIconUrl(t),r=u.element("div",{class:"sqd-toolbox-item-icon"});if(n){const e=u.element("img",{class:"sqd-toolbox-item-icon-image",src:n});r.appendChild(e)}else r.classList.add("sqd-no-icon");const a=u.element("div",{class:"sqd-toolbox-item-text"});return a.textContent=i,o.appendChild(r),o.appendChild(a),e.appendChild(o),new st(o)}constructor(e){this.root=e}bindMousedown(e){this.root.addEventListener("mousedown",e,!1)}bindTouchstart(e){this.root.addEventListener("touchstart",e,!1)}bindContextMenu(e){this.root.addEventListener("contextmenu",e,!1)}}class it{static create(e,t,s){tt.validate(t.type);const i=st.create(e,t,s),o=new it(t,s);return i.bindMousedown((e=>o.onMousedown(e))),i.bindTouchstart((e=>o.onTouchstart(e))),i.bindContextMenu((e=>o.onContextMenu(e))),o}constructor(e,t){this.step=e,this.api=t}onTouchstart(e){e.preventDefault(),1===e.touches.length&&(e.stopPropagation(),this.tryDrag(he(e)))}onMousedown(e){e.stopPropagation(),0===e.button&&this.tryDrag(ce(e))}onContextMenu(e){e.preventDefault()}tryDrag(e){this.api.tryDrag(e,this.step)}}class ot{static create(e,t){const s=u.element("div",{class:"sqd-toolbox"}),i=u.element("div",{class:"sqd-toolbox-header"}),o=u.element("div",{class:"sqd-toolbox-header-title"});o.innerText="Toolbox";const n=u.element("div",{class:"sqd-toolbox-body"}),r=u.element("input",{class:"sqd-toolbox-filter",type:"text",placeholder:"Search..."});s.appendChild(i),s.appendChild(n),i.appendChild(o),n.appendChild(r),e.appendChild(s);const a=Ke.create(n,e);return new ot(i,n,r,a,t)}constructor(e,t,s,i,o){this.header=e,this.body=t,this.filterInput=s,this.scrollBoxView=i,this.api=o}bindToggleClick(e){this.header.addEventListener("click",(function(t){t.preventDefault(),e()}),!1)}bindFilterInputChange(e){function t(t){e(t.target.value)}this.filterInput.addEventListener("keyup",t,!1),this.filterInput.addEventListener("blur",t,!1)}setIsCollapsed(e){u.toggleClass(this.body,e,"sqd-hidden"),this.headerToggleIcon&&this.header.removeChild(this.headerToggleIcon),this.headerToggleIcon=g.createSvg("sqd-toolbox-toggle-icon",e?g.expand:g.close),this.header.appendChild(this.headerToggleIcon),e||this.scrollBoxView.refresh()}setGroups(e){const t=u.element("div");e.forEach((e=>{const s=u.element("div",{class:"sqd-toolbox-group-title"});s.innerText=e.name,t.appendChild(s),e.steps.forEach((e=>it.create(t,e,this.api)))})),this.scrollBoxView.setContent(t)}destroy(){this.scrollBoxView.destroy()}}class nt{static create(e,t){const s=ot.create(e,t),i=new nt(s,t);return i.render(),i.onIsCollapsedChanged(),s.bindToggleClick((()=>i.onToggleClicked())),s.bindFilterInputChange((e=>i.onFilterInputChanged(e))),t.subscribeIsCollapsed((()=>i.onIsCollapsedChanged())),i}constructor(e,t){this.view=e,this.api=t}destroy(){this.view.destroy()}render(){const e=this.api.filterGroups(this.filter);this.view.setGroups(e)}onIsCollapsedChanged(){this.view.setIsCollapsed(this.api.isCollapsed())}onToggleClicked(){this.api.toggleIsCollapsed()}onFilterInputChanged(e){this.filter=e.toLowerCase(),this.render()}}class rt{create(e,t){return nt.create(e,t.toolbox)}}const at={view:{paddingTop:20,paddingX:20,inputSize:18,inputIconSize:14,label:{height:22,paddingX:10,minWidth:50,radius:10}}};class dt{static create(e){return new dt(null!=e?e:at)}constructor(e){var t;this.configuration=e,this.componentType="container",this.createComponentView=(t=this.configuration.view,(e,s,i)=>{const{step:o}=s,n=u.svg("g",{class:`sqd-step-container sqd-type-${o.type}`});e.appendChild(n);const r=j.create(n,t.paddingTop,t.label,o.name,"primary"),a=i.createSequenceComponent(n,o.sequence),d=r.width/2,l=Math.max(d-a.view.joinX,0)+t.paddingX,c=Math.max(d-(a.view.width-a.view.joinX),0)+t.paddingX,p=l+a.view.width+c,g=t.paddingTop+t.label.height+a.view.height,f=a.view.joinX+l;u.translate(r.g,f,0),u.translate(a.view.g,l,t.paddingTop+t.label.height);const m=i.getStepIconUrl(),w=X.createRectInput(n,f,0,t.inputSize,t.inputIconSize,m);$.createStraightJoin(n,new h(f,0),t.paddingTop);const v=Y.create(n,[p],g);return{g:n,width:p,height:g,joinX:f,placeholders:null,sequenceComponents:[a],getClientPosition:()=>v.getClientPosition(),resolveClick:e=>!(!v.resolveClick(e)&&!n.contains(e.element))||null,setIsDragging(e){w.setIsHidden(e)},setIsSelected(e){v.setIsSelected(e)},setIsDisabled(e){u.toggleClass(n,e,"sqd-disabled")},hasOutput:()=>a.hasOutput}})}}class lt{create(){return{canCreate:()=>!0}}}const ct={gapWidth:100,gapHeight:24,radius:6,iconSize:16};class ht{static create(e){return new ht(null!=e?e:ct)}constructor(e){this.configuration=e,this.gapSize=new h(this.configuration.gapWidth,this.configuration.gapHeight)}createForGap(e,t,s){return le.create(e,this.gapSize,n.none,t,s,this.configuration)}createForArea(e,t,s,i,o){return le.create(e,t,s,i,o,this.configuration)}}const pt=30;class ut{static create(e,t,s,i){const o=u.svg("g",{class:"sqd-root-start-stop"});e.appendChild(o);const r=_.create(o,{sequence:t,depth:0,isInputConnected:!0,isOutputConnected:!0},i),a=r.view,d=a.joinX-15,l=pt+a.height,c=s?18:22,p=gt(s?g.folder:g.play,c);u.translate(p,d,0),o.appendChild(p),u.translate(a.g,0,pt);const f=gt(s?g.folder:g.stop,c);u.translate(f,d,l),o.appendChild(f);let m=null,w=null;if(s){const e=new h(pt,pt);m=i.services.placeholder.createForArea(o,e,n.out,s.sequence,s.index),w=i.services.placeholder.createForArea(o,e,n.out,s.sequence,s.index),u.translate(m.view.g,d,0),u.translate(w.view.g,d,l)}const v=E.createForRoot(o,new h(d+pt,0),i);return new ut(o,a.width,a.height+60,a.joinX,r,m,w,v)}constructor(e,t,s,i,o,n,r,a){this.g=e,this.width=t,this.height=s,this.joinX=i,this.component=o,this.startPlaceholder=n,this.endPlaceholder=r,this.badges=a}destroy(){var e;null===(e=this.g.parentNode)||void 0===e||e.removeChild(this.g)}}function gt(e,t){const s=u.svg("circle",{class:"sqd-root-start-stop-circle",cx:15,cy:15,r:15}),i=u.svg("g");i.appendChild(s);const o=(pt-t)/2,n=g.appendPath(i,"sqd-root-start-stop-icon",e,t);return u.translate(n,o,o),i}class ft{static create(e,t,s,i){const o=ut.create(e,t,s,i);return new ft(o)}constructor(e){this.view=e}resolveClick(e){return this.view.component.resolveClick(e)}findById(e){return this.view.component.findById(e)}getPlaceholders(e){this.view.component.getPlaceholders(e),this.view.startPlaceholder&&this.view.endPlaceholder&&(e.push(this.view.startPlaceholder),e.push(this.view.endPlaceholder))}setIsDragging(e){this.view.component.setIsDragging(e),this.view.startPlaceholder&&this.view.endPlaceholder&&(this.view.startPlaceholder.setIsVisible(e),this.view.endPlaceholder.setIsVisible(e))}updateBadges(e){this.view.badges.update(e),this.view.component.updateBadges(e)}}class mt{constructor(){this.create=ft.create}}const wt={view:{minContainerWidth:40,paddingX:20,paddingTop:20,connectionHeight:16,inputSize:18,inputIconSize:14,branchNameLabel:{height:22,paddingX:10,minWidth:50,radius:10},nameLabel:{height:22,paddingX:10,minWidth:50,radius:10}}};class vt{static create(e){return new vt(null!=e?e:wt)}constructor(e){var t;this.configuration=e,this.componentType="switch",this.createComponentView=(t=this.configuration.view,(e,s,i)=>{const{step:o}=s,n=u.svg("g",{class:`sqd-step-switch sqd-type-${o.type}`});e.appendChild(n);const r=Object.keys(o.branches),a=r.map((e=>i.createSequenceComponent(n,o.branches[e]))),d=r.map((e=>{const s=t.paddingTop+t.nameLabel.height+t.connectionHeight;return j.create(n,s,t.branchNameLabel,e,"secondary")})),l=j.create(n,t.paddingTop,t.nameLabel,o.name,"primary");let c=0;const p=a.map(((e,s)=>{const i=Math.max(d[s].width,t.minContainerWidth)/2,o=Math.max(i-e.view.joinX,0)+t.paddingX,n=Math.max(i-(e.view.width-e.view.joinX),0)+t.paddingX,r=e.view.width+o+n,a=e.view.joinX+o,l=c;return c+=r,{width:r,branchOffsetLeft:o,offsetX:l,joinX:a}})),g=Math.floor(r.length/2),f=p[g];let m=f.offsetX;r.length%2!=0&&(m+=f.joinX);const w=p.reduce(((e,t)=>e+t.width),0),v=Math.max(...a.map((e=>e.view.height))),C=l.width/2+t.paddingX,b=Math.max(C-m,0),q=Math.max(C-(w-m),0),x=b+w+q,y=v+t.paddingTop+t.nameLabel.height+t.branchNameLabel.height+2*t.connectionHeight,S=b+m;u.translate(l.g,S,0);const k=t.paddingTop+t.nameLabel.height+t.branchNameLabel.height+t.connectionHeight;a.forEach(((e,i)=>{const o=p[i],r=b+o.offsetX+o.branchOffsetLeft;if(u.translate(d[i].g,b+o.offsetX+o.joinX,0),u.translate(e.view.g,r,k),e.hasOutput&&s.isOutputConnected){const s=t.paddingTop+t.nameLabel.height+t.branchNameLabel.height+t.connectionHeight+e.view.height,i=y-s-t.connectionHeight;i>0&&$.createStraightJoin(n,new h(b+o.offsetX+o.joinX,s),i)}}));let I=null;if(t.inputSize>0){const e=i.getStepIconUrl();I=X.createRectInput(n,S,0,t.inputSize,t.inputIconSize,e)}if($.createStraightJoin(n,new h(S,0),t.paddingTop),$.createJoins(n,new h(S,t.paddingTop+t.nameLabel.height),p.map((e=>new h(b+e.offsetX+e.joinX,t.paddingTop+t.nameLabel.height+t.connectionHeight)))),s.isOutputConnected){const e=a.map(((e,t)=>e.hasOutput?t:null)).filter((e=>null!==e)).map((e=>new h(b+p[e].offsetX+p[e].joinX,t.paddingTop+t.connectionHeight+t.nameLabel.height+t.branchNameLabel.height+v)));e.length>0&&$.createJoins(n,new h(S,y),e)}const D=p.map((e=>e.width));D[0]+=b,D[D.length-1]+=q;const z=Y.create(n,D,y);return{g:n,width:x,height:y,joinX:S,placeholders:null,sequenceComponents:a,getClientPosition:()=>z.getClientPosition(),resolveClick:e=>!(!z.resolveClick(e)&&!n.contains(e.element))||null,setIsDragging(e){null==I||I.setIsHidden(e)},setIsSelected(e){z.setIsSelected(e)},setIsDisabled(e){u.toggleClass(n,e,"sqd-disabled")},hasOutput:()=>a.some((e=>e.hasOutput))}})}}const Ct={view:{paddingLeft:12,paddingRight:12,paddingY:10,textMarginLeft:12,minTextWidth:70,iconSize:22,radius:5,inputSize:14,outputSize:10}};class bt{static create(e){return new bt(null!=e?e:Ct)}constructor(e){this.configuration=e,this.componentType="task",this.createComponentView=K(!1,this.configuration.view)}}class qt{constructor(){this.create=_.create}}class xt{constructor(){this.wrap=e=>e}}class yt{static create(e){const t=u.svg("path",{class:"sqd-line-grid-path",fill:"none"});return new yt(e,t)}constructor(e,t){this.size=e,this.element=t}setScale(e,t){u.attrs(this.element,{d:`M ${t.x} 0 L 0 0 0 ${t.y}`})}}const St={gridSizeX:48,gridSizeY:48};class kt{static create(e){return new kt(null!=e?e:St)}constructor(e){this.configuration=e}create(){const e=new h(this.configuration.gridSizeX,this.configuration.gridSizeY);return yt.create(e)}}class It{static resolve(e,t){const s={};return function(e,t){for(const s of t)s.steps&&(e.steps=(e.steps||[]).concat(s.steps)),s.stepComponentViewWrapper&&(e.stepComponentViewWrapper=s.stepComponentViewWrapper),s.badges&&(e.badges=(e.badges||[]).concat(s.badges)),s.uiComponents&&(e.uiComponents=(e.uiComponents||[]).concat(s.uiComponents)),s.draggedComponent&&(e.draggedComponent=s.draggedComponent),s.wheelController&&(e.wheelController=s.wheelController),s.placeholderController&&(e.placeholderController=s.placeholderController),s.placeholder&&(e.placeholder=s.placeholder),s.viewportController&&(e.viewportController=s.viewportController),s.grid&&(e.grid=s.grid),s.rootComponent&&(e.rootComponent=s.rootComponent),s.sequenceComponent&&(e.sequenceComponent=s.sequenceComponent),s.daemons&&(e.daemons=(e.daemons||[]).concat(s.daemons))}(s,e||[]),function(e,t){e.steps||(e.steps=[]),e.steps.push(dt.create()),e.steps.push(vt.create()),e.steps.push(bt.create()),e.stepComponentViewWrapper||(e.stepComponentViewWrapper=new xt),e.badges||(e.badges=[]),Pe(e.badges)<0&&e.badges.push(A.create()),e.draggedComponent||(e.draggedComponent=new Fe),e.uiComponents||(e.uiComponents=[]),t.controlBar&&e.uiComponents.push(new Ze),t.editors&&e.uiComponents.push(new Je(t.editors)),t.toolbox&&e.uiComponents.push(new rt),e.wheelController||(e.wheelController=new oe),e.placeholderController||(e.placeholderController=new lt),e.placeholder||(e.placeholder=ht.create()),e.viewportController||(e.viewportController=new ae),e.grid||(e.grid=kt.create()),e.rootComponent||(e.rootComponent=new mt),e.sequenceComponent||(e.sequenceComponent=new qt),e.daemons||(e.daemons=[]),e.daemons.push(new Ye)}(s,t),s}}function Dt(e,t){throw new Error(`The "${e}" property in the "${t}" configuration is depreciated`)}class zt{static create(e,t,s){if(!e)throw new Error("Placeholder is not set");if(i=e,document.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_DISCONNECTED)throw new Error("Placeholder is not attached to the DOM");var i;if(!t)throw new Error("Start definition is not set");if(!s)throw new Error("Configuration is not set");const o=s;!function(e){if(void 0===e.controlBar)throw new Error('The "controlBar" property is not defined in the configuration');e.toolbox&&void 0!==e.toolbox.isHidden&&Dt("isHidden","toolbox"),e.editors&&void 0!==e.editors.isHidden&&Dt("isHidden","editors"),e.steps.validator&&Dt("validator","steps")}(o);const n=It.resolve(s.extensions,o),r=qe.create(e,t,o,n),a=D.create(r),d=Ve.create(e,r,a),l=new zt(d,r.state,r.definitionWalker,a);return d.workspace.onReady.subscribe((()=>l.onReady.forward())),r.state.onDefinitionChanged.subscribe((()=>{setTimeout((()=>l.onDefinitionChanged.forward(r.state.definition)))})),r.state.onSelectedStepIdChanged.subscribe((()=>l.onSelectedStepIdChanged.forward(r.state.selectedStepId))),l.state.onIsToolboxCollapsedChanged.subscribe((e=>{l.onIsToolboxCollapsedChanged.forward(e)})),l.state.onIsEditorCollapsedChanged.subscribe((e=>{l.onIsEditorCollapsedChanged.forward(e)})),l}constructor(e,t,s,i){this.view=e,this.state=t,this.walker=s,this.api=i,this.onReady=new c,this.onDefinitionChanged=new c,this.onSelectedStepIdChanged=new c,this.onIsToolboxCollapsedChanged=new c,this.onIsEditorCollapsedChanged=new c}getDefinition(){return this.state.definition}isValid(){return this.view.workspace.isValid}isReadonly(){return this.state.isReadonly}setIsReadonly(e){this.state.setIsReadonly(e)}getSelectedStepId(){return this.state.selectedStepId}selectStepById(e){this.state.setSelectedStepId(e)}clearSelectedStep(){this.state.setSelectedStepId(null)}moveViewportToStep(e){this.api.viewport.moveViewportToStep(e)}moveViewPortToStep(e){this.moveViewportToStep(e)}updateRootComponent(){this.api.workspace.updateRootComponent()}updateBadges(){this.api.workspace.updateBadges()}isToolboxCollapsed(){return this.state.isToolboxCollapsed}setIsToolboxCollapsed(e){this.state.setIsToolboxCollapsed(e)}isEditorCollapsed(){return this.state.isEditorCollapsed}setIsEditorCollapsed(e){this.state.setIsEditorCollapsed(e)}getStepParents(e){return this.walker.getParents(this.state.definition,e)}destroy(){this.view.destroy()}}var Bt;!function(e){e[e.loading=1]="loading",e[e.loaded=2]="loaded",e[e.error=3]="error"}(Bt||(Bt={}));const Et=e=>(t,s,i)=>{const{step:r}=s,a=u.svg("g",{class:`sqd-step-folder sqd-type-${r.type}`});t.appendChild(a);const d=2*e.paddingX+e.iconSize,l=u.svg("text",{x:d,y:e.nameHeight1,class:"sqd-step-folder-name"});l.textContent=r.name,a.appendChild(l);const c=l.getBBox(),p=Math.max(c.width,e.minNameWidth),f=e.nameHeight1+e.nameHeight2,m=function(e){switch(e){case 0:return"no steps";case 1:return"1 step";default:return`${e} steps`}}(r.sequence.length),w=u.svg("text",{class:"sqd-step-folder-button-text",x:d+e.buttonPaddingX,y:f+e.buttonHeight/2});w.textContent=m,a.appendChild(w);const v=w.getBBox(),C=g.appendPath(a,"sqd-step-folder-button-icon-path",g.folderIn,e.buttonIconSize);u.translate(C,d+2*e.buttonPaddingX+v.width,f+(e.buttonHeight-e.buttonIconSize)/2);const b=3*e.buttonPaddingX+v.width+e.buttonIconSize,q=u.svg("rect",{class:"sqd-step-folder-button-rect",width:b,height:e.buttonHeight,rx:4,ry:4,x:d+.5,y:f+.5});a.appendChild(q);const x=f+e.buttonHeight+e.paddingBottom,y=d+Math.max(p,b)+e.paddingX,S=y/2,k=u.svg("rect",{x:.5,y:.5,class:"sqd-step-folder-rect",width:y,height:x,rx:e.rectRadius,ry:e.rectRadius});a.insertBefore(k,l);const I=y/4,D=u.svg("rect",{class:"sqd-step-folder-tab-rect",x:e.paddingX,y:-6,width:I,height:12,rx:e.rectRadius,ry:e.rectRadius});a.insertBefore(D,k);const z=i.getStepIconUrl(),B=z?u.svg("image",{href:z}):u.svg("rect",{class:"sqd-step-folder-empty-icon",rx:4,ry:4});u.attrs(B,{x:e.paddingX,y:(x-e.iconSize)/2,width:e.iconSize,height:e.iconSize}),a.appendChild(B);const E=X.createRoundInput(a,S,0,e.inputSize),M=N.create(a,S,x,e.outputSize),P=new h(y-2*e.placeholderMargin,x-2*e.placeholderMargin),T=i.createPlaceholderForArea(a,P,n.in,s.step.sequence,s.step.sequence.length);return u.translate(T.view.g,e.placeholderMargin,e.placeholderMargin),{g:a,width:y,height:x,joinX:S,placeholders:[T],sequenceComponents:null,getClientPosition(){const e=k.getBoundingClientRect();return new h(e.x,e.y)},resolveClick(e){return e.element===q?{type:o.openFolder,step:s.step}:!!this.g.contains(e.element)||null},setIsDragging(e){u.toggleClass(D,e,"sqd-hidden"),E.setIsHidden(e),M.setIsHidden(e)},setIsDisabled(e){u.toggleClass(a,e,"sqd-disabled")},setIsSelected(e){u.toggleClass(k,e,"sqd-selected")},hasOutput:()=>!0}},Mt=(e,t)=>(s,i,o)=>{const{step:n}=i,r=u.svg("g",{class:`sqd-step-icon sqd-type-${n.type}`});s.appendChild(r);const a=t.size/2,d=u.svg("circle",{cx:a,cy:a,r:a,class:"sqd-step-icon-circle"});r.appendChild(d);const l=o.getStepIconUrl();if(l){const e=u.svg("image",{class:"sqd-step-icon-image",href:l,x:(t.size-t.iconSize)/2,y:(t.size-t.iconSize)/2,width:t.iconSize,height:t.iconSize});r.appendChild(e)}const c=0===i.depth&&0===i.position&&!i.isInputConnected,p=e,g=c?null:X.createRoundInput(r,a,0,t.inputSize),f=p?null:N.create(r,a,t.size,t.outputSize);return{g:r,width:t.size,height:t.size,joinX:a,placeholders:null,sequenceComponents:null,resolveClick(e){return!!this.g.contains(e.element)||null},setIsSelected(e){u.toggleClass(d,e,"sqd-selected")},setIsDisabled(e){u.toggleClass(this.g,e,"sqd-disabled")},getClientPosition(){const e=this.g.getBoundingClientRect();return new h(e.x,e.y)},setIsDragging(e){null==g||g.setIsHidden(e),null==f||f.setIsHidden(e)},hasOutput:()=>!!f}},Pt=(e,t)=>(s,i,o)=>{const n=u.svg("g",{class:`sqd-step-large-task sqd-type-${i.step.type}`});s.appendChild(n);const r=e.paddingLeft+e.circleSize+e.textMarginLeft,a=u.svg("text",{class:"sqd-large-task-name-text",x:r,y:e.nameY});a.textContent=i.step.name,n.appendChild(a);const d=a.getBBox(),l=u.svg("text",{class:"sqd-large-task-description-text",x:r,y:e.descriptionY});l.textContent=t(i.step),n.appendChild(l);const c=l.getBBox(),p=u.svg("circle",{class:"sqd-large-task-circle",cx:e.paddingLeft+e.circleSize/2,cy:e.paddingY+e.circleSize/2,r:e.circleSize/2});n.appendChild(p);const g=Math.max(d.width,c.width,e.minTextWidth),f=e.circleSize+g+e.paddingLeft+e.paddingRight+e.textMarginLeft,m=e.circleSize+2*e.paddingY,w=o.getStepIconUrl();if(w){const t=u.svg("image",{href:w,width:e.iconSize,height:e.iconSize,x:e.paddingLeft+e.circleSize/2-e.iconSize/2,y:e.paddingY+e.circleSize/2-e.iconSize/2});n.appendChild(t)}const v=0!==i.depth||0!==i.position||i.isInputConnected?X.createRoundInput(n,f/2,0,e.inputSize):null,C=N.create(n,f/2,m,e.outputSize),b=u.svg("rect",{class:"sqd-large-task-rect",x:.5,y:.5,width:f,height:m,rx:e.radius,ry:e.radius});return n.insertBefore(b,a),{g:n,width:f,height:m,joinX:f/2,placeholders:null,sequenceComponents:null,resolveClick(e){return!!this.g.contains(e.element)||null},setIsSelected(e){u.toggleClass(b,e,"sqd-selected")},setIsDisabled(e){u.toggleClass(n,e,"sqd-disabled")},getClientPosition(){const e=n.getBoundingClientRect();return new h(e.x,e.y)},setIsDragging(e){null==v||v.setIsHidden(e),null==C||C.setIsHidden(e)},hasOutput:()=>!0}};class Tt{}Tt.plus="M21.712 43.8V25.987H3.9v-4.275h17.812V3.9h4.275v17.813H43.8v4.274H25.987V43.8h-4.275z",Tt.done="M18.137 38.6 4.3 24.763l3.794-3.794 10.043 10.043 21.369-21.37 3.794 3.795L18.137 38.6z",Tt.loading="M24 8c7.83 0 14.51 5.67 15.78 13.4a3.057 3.057 0 0 0 2.98 2.6c.88 0 1.72-.39 2.29-1.06.58-.68.82-1.57.67-2.44C44 9.84 34.8 2 24 2 13.2 2 4 9.84 2.28 20.5c-.15.87.1 1.76.67 2.44.57.67 1.41 1.06 2.29 1.06a3.057 3.057 0 0 0 2.98-2.6C9.49 13.67 16.17 8 24 8zm0 0",Tt.error="M24.045 43.071q-1.549 0-2.647-1.103-1.098-1.102-1.098-2.651 0-1.55 1.103-2.647 1.103-1.099 2.652-1.099 1.549 0 2.647 1.103 1.098 1.103 1.098 2.652 0 1.549-1.103 2.647-1.103 1.098-2.652 1.098zM20.3 30.214V4.5h7.5v25.714h-7.5z";class Rt{static create(e){const t=u.svg("circle",{class:"sqd-grid-dot"}),s=new h(e.gridSizeX,e.gridSizeY);return new Rt(s,t,e.dotR)}constructor(e,t,s){this.size=e,this.element=t,this.r=s}setScale(e){const t=this.r*e;u.attrs(this.element,{r:t,cx:t/2+.5,cy:t/2+.5})}}const Lt={gridSizeX:16,gridSizeY:16,dotR:1};class Ht{static create(e){return new Ht(null!=e?e:Lt)}constructor(e){this.configuration=e}create(){return Rt.create(this.configuration)}}class Vt{static create(e){const t=Ht.create(e);return new Vt(t)}constructor(e){this.grid=e}}class Ut{static create(e,t,s,i){const o=u.svg("g",{class:"sqd-root-minimal"});e.appendChild(o);const n={sequence:t,depth:0,isInputConnected:!1,isOutputConnected:!1},r=s.services.sequenceComponent.create(o,n,s),a=r.view;if(u.translate(a.g,0,i.badgesHeight),0===t.length){const e=u.svg("rect",{class:"sqd-root-minimal-empty",rx:4,ry:4,width:a.width,height:a.height});u.translate(e,0,i.badgesHeight),o.insertBefore(e,a.g)}const d=E.createForRoot(o,new h(a.joinX,i.badgesHeight/2),s),l=a.height+2*i.badgesHeight;return new Ut(o,a.width,l,a.joinX,r,d)}constructor(e,t,s,i,o,n){this.g=e,this.width=t,this.height=s,this.joinX=i,this.component=o,this.badges=n}getClientPosition(){throw new Error("Not supported")}}class Ft{static create(e,t,s,i){const o=Ut.create(e,t,s,i);return new Ft(o)}constructor(e){this.view=e}resolveClick(e){return this.view.component.resolveClick(e)}findById(e){return this.view.component.findById(e)}getPlaceholders(e){this.view.component.getPlaceholders(e)}setIsDragging(e){this.view.component.setIsDragging(e)}updateBadges(e){this.view.badges.update(e),this.view.component.updateBadges(e)}}const Ot={view:{badgesHeight:32}};class At{static create(e){return new At(null!=e?e:Ot)}constructor(e){this.configuration=e}create(e,t,s,i){return Ft.create(e,t,i,this.configuration.view)}}class Xt{static create(e){return new Xt(e)}constructor(e){this.configuration=e,this.rootComponent=At.create(this.configuration)}}class $t{static create(e){const t=u.element("div",{class:"sqd-path-bar"}),s=u.element("div",{class:"sqd-path-bar-reset-button",title:"Go to top"}),i=g.createSvg("sqd-path-bar-reset-button-icon",g.folderUp),o=u.element("div",{class:"sqd-path-bar-items"});return t.appendChild(s),t.appendChild(o),s.appendChild(i),e.appendChild(t),new $t(t,o,s)}constructor(e,t,s){this.root=e,this.items=t,this.resetButton=s}bindOnItemClick(e){this.onClickHandler=e}bindOnResetClick(e){this.resetButton.addEventListener("click",(t=>{t.preventDefault(),e()}))}reload(e){const t=null===e;if(u.toggleClass(this.root,t,"sqd-hidden"),t)return;this.items.innerHTML="";const s=Math.max(0,e.length-3);for(let t=s;t<e.length;t++){const i=e[t];if(t>0){const e=u.element("span",{class:"sqd-path-bar-separator"});e.innerText=t===s?"...":"/",this.items.appendChild(e)}const o=u.element("span",{class:"sqd-path-bar-item"});o.innerText=i,o.addEventListener("click",(e=>{e.preventDefault(),this.onClickHandler&&this.onClickHandler(t)})),this.items.appendChild(o)}}}class Zt{static create(e,t){const s=$t.create(e),i=new Zt(s,t.pathBar);return t.pathBar.subscribe((()=>i.reloadPath())),s.bindOnItemClick((e=>i.onItemClicked(e))),s.bindOnResetClick((()=>i.onResetClicked())),i.reloadPath(),i}constructor(e,t){this.view=e,this.api=t}destroy(){}onItemClicked(e){const t=this.api.getFolderPath().splice(0,e+1);this.api.setFolderPath(t)}onResetClicked(){this.api.setFolderPath([])}reloadPath(){const e=this.api.getFolderPathStepNames();this.view.reload(0===e.length?null:e)}}class Wt{constructor(){this.create=Zt.create}}const jt={view:{rectRadius:5,nameHeight1:20,nameHeight2:16,paddingX:12,paddingBottom:12,iconSize:22,buttonHeight:24,buttonPaddingX:6,buttonIconSize:14,minNameWidth:40,placeholderMargin:10,inputSize:14,outputSize:10}};class Nt{static create(e){return new Nt(null!=e?e:jt)}constructor(e){this.configuration=e,this.componentType="folder",this.createComponentView=Et(this.configuration.view)}}const Yt={view:{size:52,iconSize:28,inputSize:14,outputSize:10}};class Qt{static create(e){return new Qt(null!=e?e:Yt)}constructor(e){this.configuration=e,this.componentType="icon",this.createComponentView=Mt(!1,this.configuration.view)}}const Gt={view:{size:52,iconSize:28,inputSize:14,outputSize:10}};class Jt{static create(e){return new Jt(null!=e?e:Gt)}constructor(e){this.configuration=e,this.componentType="interruptingIcon",this.createComponentView=Mt(!0,this.configuration.view)}}const _t={view:{paddingLeft:12,paddingRight:12,paddingY:10,textMarginLeft:12,minTextWidth:70,iconSize:22,radius:5,inputSize:14,outputSize:10}};class Kt{static create(e){return new Kt(null!=e?e:_t)}constructor(e){this.configuration=e,this.componentType="interruptingTask",this.createComponentView=K(!0,this.configuration.view)}}const es=e=>`Task type: ${e.type}`,ts={textMarginLeft:12,minTextWidth:140,nameY:22,descriptionY:44,paddingLeft:12,paddingRight:12,paddingY:12,circleSize:40,iconSize:22,inputSize:14,outputSize:10,radius:4},ss={view:ts,descriptionProvider:es};class is{static create(e){return new is(null!=e?e:ss)}constructor(e){var t,s;this.configuration=e,this.componentType="largeTask",this.createComponentView=Pt(null!==(t=this.configuration.view)&&void 0!==t?t:ts,null!==(s=this.configuration.descriptionProvider)&&void 0!==s?s:es)}}class os{static create(e){return new os([Qt.create(null==e?void 0:e.icon),Jt.create(null==e?void 0:e.interruptingIcon),Kt.create(null==e?void 0:e.interruptingTask),Nt.create(null==e?void 0:e.folder),is.create(null==e?void 0:e.largeTask)])}constructor(e){this.steps=e,this.uiComponents=[new Wt]}}var ns=s(379),rs=s.n(ns),as=s(795),ds=s.n(as),ls=s(569),cs=s.n(ls),hs=s(565),ps=s.n(hs),us=s(216),gs=s.n(us),fs=s(589),ms=s.n(fs),ws=s(375),vs={};vs.styleTagTransform=ms(),vs.setAttributes=ps(),vs.insert=cs().bind(null,"head"),vs.domAPI=ds(),vs.insertStyleElement=gs(),rs()(ws.Z,vs),ws.Z&&ws.Z.locals&&ws.Z.locals;var Cs=s(344),bs={};bs.styleTagTransform=ms(),bs.setAttributes=ps(),bs.insert=cs().bind(null,"head"),bs.domAPI=ds(),bs.insertStyleElement=gs(),rs()(Cs.Z,bs),Cs.Z&&Cs.Z.locals&&Cs.Z.locals;var qs=s(715),xs={};function ys(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Ss(e){return{id:m.next(),componentType:"task",name:ys(e),properties:{},type:e}}function ks(e){return{id:m.next(),componentType:"largeTask",name:ys(e),properties:{},type:e}}function Is(e){return{id:m.next(),componentType:"icon",name:ys(e),properties:{},type:e}}function Ds(e){return{id:m.next(),componentType:"switch",name:ys(e),branches:{true:[],false:[]},properties:{},type:e}}function zs(e){return{id:m.next(),componentType:"container",name:ys(e),properties:{},sequence:[],type:e}}xs.styleTagTransform=ms(),xs.setAttributes=ps(),xs.insert=cs().bind(null,"head"),xs.domAPI=ds(),xs.insertStyleElement=gs(),rs()(qs.Z,xs),qs.Z&&qs.Z.locals&&qs.Z.locals;const Bs=[{name:"Task",steps:[Ss("createFile"),Ss("deleteFile")]},{name:"Large task",steps:[ks("connect"),ks("disconnect")]},{name:"Icon",steps:[Is("createUser"),Is("deleteUser")]},{name:"Switch",steps:[Ds("if"),Ds("parallel")]},{name:"Container",steps:[zs("for"),zs("while")]}];document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("designer"),t={properties:{},sequence:Bs.map((e=>e.steps)).flat()},s={editors:!1,steps:{iconUrlProvider:()=>"./assets/icon-task.svg"},toolbox:{groups:Bs},controlBar:!0,extensions:[os.create(),Xt.create(),Vt.create({dotR:1,gridSizeX:28,gridSizeY:28})]};zt.create(e,t,s)}))})()})();