(()=>{"use strict";var t={929:(t,e,s)=>{s.d(e,{Z:()=>a});var n=s(601),o=s.n(n),i=s(609),r=s.n(i)()(o());r.push([t.id,"\n/********* light *********/\n\n.sqd-theme-light.sqd-designer {\n\tbackground: #F9F9F9;\n}\n\n/* light > .sqd-toolbox */\n\n.sqd-theme-light .sqd-toolbox {\n\tbackground: #FFF;\n\tbox-shadow: 0 0 8px rgba(0, 0, 0, .15), 0 2px 4px rgba(0, 0, 0, .15);\n}\n.sqd-theme-light .sqd-toolbox-filter {\n\tborder: 1px solid #C3C3C3;\n}\n.sqd-theme-light .sqd-toolbox-filter:focus {\n\tborder-color: #939393;\n}\n.sqd-theme-light .sqd-toolbox-group-title {\n\tbackground: #E5E5E5;\n}\n.sqd-theme-light .sqd-toolbox-item {\n\tborder: 1px solid #C3C3C3;\n\tbox-shadow: 0 2px 2px rgba(0, 0, 0, .15);\n}\n.sqd-theme-light .sqd-toolbox-item:hover {\n\tborder: 1px solid #939393;\n}\n.sqd-theme-light .sqd-toolbox-item-icon.sqd-no-icon {\n\tbackground: #C6C6C6;\n}\n\n/* light > .sqd-control-bar */\n\n.sqd-theme-light .sqd-control-bar {\n\tbackground: #FFF;\n\tbox-shadow: 0 0 8px rgba(0, 0, 0, .15), 0 2px 4px rgba(0, 0, 0, .15);\n}\n.sqd-theme-light .sqd-control-bar-button {\n\tborder: 1px solid #C3C3C3;\n}\n.sqd-theme-light .sqd-control-bar-button:hover {\n\tborder-color: #939393;\n}\n.sqd-theme-light .sqd-control-bar-button.sqd-delete .sqd-icon-path {\n\tfill: #E01A24;\n}\n\n/* light > .sqd-workspace */\n\n.sqd-theme-light .sqd-grid-path {\n\tstroke: #E3E3E3;\n}\n.sqd-theme-light .sqd-join {\n\tstroke: #000;\n}\n\n/* light > .sqd-smart-editor */\n\n.sqd-theme-light .sqd-smart-editor {\n\tbackground: #FFF;\n\tbox-shadow: 0 0 8px rgba(0, 0, 0, .15);\n}\n.sqd-theme-light .sqd-smart-editor-toggle {\n\tbackground: #FFF;\n\tbox-shadow: 0 0 8px rgba(0, 0, 0, .15);\n}\n\n/* light > .sqd-step-task */\n\n.sqd-theme-light .sqd-step-task-rect {\n\tfill: #FFF;\n\tstroke: #C3C3C3;\n\tfilter: drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, .15));\n}\n.sqd-theme-light .sqd-step-task-rect.sqd-selected {\n\tstroke: #ED4800;\n}\n.sqd-theme-light .sqd-step-task-text {\n\tfill: #000;\n}\n.sqd-theme-light .sqd-step-task-empty-icon {\n\tfill: #C6C6C6;\n}\n\n/* light > .sqd-input + .sqd-output */\n\n.sqd-theme-light .sqd-input {\n\tfill: #FFF;\n\tstroke: #000;\n}\n\n.sqd-theme-light .sqd-output {\n\tfill: #000;\n}\n\n/* light > .sqd-region */\n\n.sqd-theme-light .sqd-region {\n\tstroke: #CECECE;\n}\n.sqd-theme-light .sqd-region.sqd-selected {\n\tstroke: #ED4800;\n}\n.sqd-theme-light .sqd-label-rect {\n\tfill: #2411DB;\n}\n.sqd-theme-light .sqd-label-rect.sqd-label-secondary {\n\tfill: #000;\n}\n.sqd-theme-light .sqd-label-text {\n\tfill: #FFF;\n}\n\n/* light > .sqd-root-start-stop */\n\n.sqd-theme-light .sqd-root-start-stop-circle {\n\tfill: #2C18DF;\n}\n.sqd-theme-light .sqd-root-start-stop-icon {\n\tfill: #FFF;\n}\n\n/* light > .sqd-placeholder */\n\n.sqd-theme-light .sqd-placeholder .sqd-placeholder-rect {\n\tfill: #D8D8D8;\n\tstroke: #6A6A6A;\n}\n.sqd-theme-light .sqd-placeholder-icon-path {\n\tfill: #2B2B2B;\n}\n.sqd-theme-light .sqd-placeholder.sqd-hover .sqd-placeholder-rect {\n\tfill: #ED4800;\n}\n.sqd-theme-light .sqd-placeholder.sqd-hover .sqd-placeholder-icon-path {\n\tfill: #FFF;\n}\n\n/* light > .sqd-validation-error */\n\n.sqd-theme-light .sqd-validation-error {\n\tfill: #FFA200;\n}\n.sqd-theme-light .sqd-validation-error-icon-path {\n\tfill: #000;\n}\n",""]);const a=r},446:(t,e,s)=>{s.d(e,{Z:()=>a});var n=s(601),o=s.n(n),i=s(609),r=s.n(i)()(o());r.push([t.id,"\n.sqd-designer {\n\tposition: relative;\n\tdisplay: flex;\n\twidth: 100%;\n\theight: 100%;\n}\n.sqd-designer, .sqd-drag {\n\tfont-size: 13px;\n\tline-height: 1em;\n}\n.sqd-hidden {\n\tdisplay: none !important;\n}\n.sqd-disabled {\n\topacity: 0.25;\n}\n\n/* .sqd-toolbox */\n\n.sqd-toolbox, .sqd-toolbox-filter {\n\tfont-size: 11px;\n\tline-height: 1.2em;\n}\n.sqd-toolbox {\n\tposition: absolute;\n\ttop: 10px;\n\tleft: 10px;\n\tz-index: 20;\n\tbox-sizing: border-box;\n\tborder-radius: 10px;\n\twidth: 130px;\n\tuser-select: none;\n}\n.sqd-toolbox-header {\n\tposition: relative;\n\tpadding: 15px 10px;\n\tcursor: pointer;\n}\n.sqd-toolbox-header-title {\n\tdisplay: block;\n\tfont-size: 1.2em;\n\tline-height: 1em;\n\tfont-weight: bold;\n}\n.sqd-toolbox-toggle-icon {\n\tposition: absolute;\n\ttop: 50%;\n\tright: 10px;\n\twidth: 16px;\n\theight: 16px;\n\tmargin: -8px 0 0;\n}\n.sqd-toolbox-header:hover .sqd-toolbox-toggle-icon {\n\topacity: .6;\n}\n.sqd-scrollbox {\n\tposition: relative;\n\toverflow: hidden;\n}\n.sqd-scrollbox-body {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n}\n.sqd-toolbox-filter {\n\tdisplay: block;\n\tbox-sizing: border-box;\n\tpadding: 6px 8px;\n\toutline: none;\n\twidth: 110px;\n\tmargin: 0 10px 10px;\n\tbox-sizing: border-box;\n\tborder-radius: 10px;\n}\n.sqd-toolbox-group-title {\n\ttext-align: center;\n\tpadding: 5px 0;\n\tmargin: 0 10px 10px;\n\tborder-radius: 10px;\n}\n.sqd-toolbox-item {\n\tposition: relative;\n\tborder-radius: 5px;\n\tbox-sizing: border-box;\n\tmargin: 0 10px 10px;\n\twidth: 110px;\n\tcursor: move;\n}\n.sqd-toolbox-item-icon {\n\tposition: absolute;\n\ttop: 50%;\n\tleft: 5px;\n\tmargin-top: -10px;\n\twidth: 20px;\n\theight: 20px;\n}\n.sqd-toolbox-item-icon.sqd-no-icon {\n\tborder-radius: 4px;\n}\n.sqd-toolbox-item-icon-image {\n\twidth: 100%;\n\theight: 100%;\n}\n.sqd-toolbox-item-text {\n\tposition: relative;\n\tdisplay: block;\n\tpadding: 10px 10px 10px 30px;\n\twhite-space: nowrap;\n\ttext-overflow: ellipsis;\n\toverflow: hidden;\n}\n\n.sqd-drag {\n\tposition: absolute;\n\tz-index: 9999999;\n\tpointer-events: none;\n}\n\n/* .sqd-control-bar */\n\n.sqd-control-bar {\n\tposition: absolute;\n\tbottom: 10px;\n\tleft: 10px;\n\tz-index: 20;\n\tpadding: 8px 0 8px 8px;\n\tborder-radius: 10px;\n\twhite-space: nowrap;\n}\n.sqd-control-bar-button {\n\tdisplay: inline-block;\n\twidth: 30px;\n\theight: 30px;\n\tborder-radius: 5px;\n\tmargin-right: 8px;\n\tcursor: pointer;\n}\n.sqd-control-bar-button-icon {\n\twidth: 24px;\n\theight: 24px;\n\tmargin: 3px 0 0 3px;\n}\n.sqd-control-bar-button.sqd-disabled .sqd-control-bar-button-icon {\n\topacity: .2;\n}\n\n/* .sqd-workspace */\n\n.sqd-workspace {\n\tflex: 1;\n\tposition: relative;\n\tdisplay: block;\n\tuser-select: none;\n}\n.sqd-workspace-canvas {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tcursor: move;\n}\n.sqd-grid-path {\n\tstroke-width: 1;\n}\n.sqd-join {\n\tstroke-width: 2;\n}\n\n/* .sqd-smart-editor */\n\n.sqd-smart-editor-toggle {\n\tposition: absolute;\n\ttop: 0;\n\tz-index: 29;\n\twidth: 36px;\n\theight: 64px;\n\tborder-bottom-left-radius: 10px;\n\tcursor: pointer;\n}\n.sqd-smart-editor-toggle-icon {\n\tposition: absolute;\n\ttop: 50%;\n\tleft: 50%;\n\twidth: 24px;\n\theight: 24px;\n\tmargin: -12px 0 0 -12px;\n}\n.sqd-smart-editor-toggle:hover .sqd-smart-editor-toggle-icon {\n\topacity: .6;\n}\n.sqd-smart-editor {\n\tz-index: 30;\n}\n.sqd-layout-desktop .sqd-smart-editor {\n\tposition: relative;\n\twidth: 300px;\n}\n.sqd-layout-desktop .sqd-smart-editor-toggle {\n\tright: 300px;\n}\n.sqd-layout-desktop .sqd-smart-editor-toggle.sqd-collapsed {\n\tright: 0;\n}\n.sqd-layout-mobile .sqd-smart-editor {\n\tposition: absolute;\n\ttop: 0;\n\tright: 0;\n\tbottom: 0;\n\tleft: 41px;\n}\n.sqd-layout-mobile .sqd-smart-editor-toggle {\n\tleft: 5px;\n}\n.sqd-layout-mobile .sqd-smart-editor-toggle.sqd-collapsed {\n\tleft: auto;\n\tright: 0;\n}\n\n/* .sqd-step-task */\n\n.sqd-step-task-rect {\n\tstroke-width: 1;\n}\n.sqd-step-task-rect.sqd-selected {\n\tstroke-width: 2;\n}\n.sqd-step-task-text {\n\ttext-anchor: left;\n\tdominant-baseline: central;\n}\n\n/* .sqd-input + .sqd-output */\n\n.sqd-input {\n\tstroke-width: 2;\n}\n\n/* .sqd-region */\n\n.sqd-region {\n\tstroke-width: 2;\n\tstroke-dasharray: 3;\n}\n.sqd-region.sqd-selected {\n\tstroke-width: 2;\n\tstroke-dasharray: 0;\n}\n.sqd-label-text {\n\ttext-anchor: middle;\n\tdominant-baseline: central;\n}\n\n/* .sqd-placeholder */\n\n.sqd-placeholder .sqd-placeholder-rect {\n\tstroke-width: 1;\n\tstroke-dasharray: 3;\n}\n",""]);const a=r},609:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var s="",n=void 0!==e[5];return e[4]&&(s+="@supports (".concat(e[4],") {")),e[2]&&(s+="@media ".concat(e[2]," {")),n&&(s+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),s+=t(e),n&&(s+="}"),e[2]&&(s+="}"),e[4]&&(s+="}"),s})).join("")},e.i=function(t,s,n,o,i){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(n)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(r[l]=!0)}for(var d=0;d<t.length;d++){var c=[].concat(t[d]);n&&r[c[0]]||(void 0!==i&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=i),s&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=s):c[2]=s),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),e.push(c))}},e}},601:t=>{t.exports=function(t){return t[1]}},62:t=>{var e=[];function s(t){for(var s=-1,n=0;n<e.length;n++)if(e[n].identifier===t){s=n;break}return s}function n(t,n){for(var i={},r=[],a=0;a<t.length;a++){var l=t[a],d=n.base?l[0]+n.base:l[0],c=i[d]||0,h="".concat(d," ").concat(c);i[d]=c+1;var p=s(h),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)e[p].references++,e[p].updater(u);else{var g=o(u,n);n.byIndex=a,e.splice(a,0,{identifier:h,updater:g,references:1})}r.push(h)}return r}function o(t,e){var s=e.domAPI(e);return s.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;s.update(t=e)}else s.remove()}}t.exports=function(t,o){var i=n(t=t||[],o=o||{});return function(t){t=t||[];for(var r=0;r<i.length;r++){var a=s(i[r]);e[a].references--}for(var l=n(t,o),d=0;d<i.length;d++){var c=s(i[d]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}i=l}}},793:t=>{var e={};t.exports=function(t,s){var n=function(t){if(void 0===e[t]){var s=document.querySelector(t);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(t){s=null}e[t]=s}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(s)}},173:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},892:(t,e,s)=>{t.exports=function(t){var e=s.nc;e&&t.setAttribute("nonce",e)}},36:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(s){!function(t,e,s){var n="";s.supports&&(n+="@supports (".concat(s.supports,") {")),s.media&&(n+="@media ".concat(s.media," {"));var o=void 0!==s.layer;o&&(n+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),n+=s.css,o&&(n+="}"),s.media&&(n+="}"),s.supports&&(n+="}");var i=s.sourceMap;i&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,s)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},464:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function s(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={id:n,exports:{}};return t[n](i,i.exports,s),i.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.nc=void 0,(()=>{class t{constructor(t,e,s,n){this.state=t,this.historyController=e,this.definitionModifier=s,this.viewportApi=n}subscribe(t){this.state.onIsReadonlyChanged.subscribe(t),this.state.onSelectedStepIdChanged.subscribe(t),this.state.onIsDragDisabledChanged.subscribe(t),this.isUndoRedoSupported()&&this.state.onDefinitionChanged.subscribe(t)}resetViewport(){this.viewportApi.resetViewport()}zoomIn(){this.viewportApi.zoom(!0)}zoomOut(){this.viewportApi.zoom(!1)}isDragDisabled(){return this.state.isDragDisabled}toggleIsDragDisabled(){this.state.toggleIsDragDisabled()}isUndoRedoSupported(){return!!this.historyController}tryUndo(){return!(!this.canUndo()||!this.historyController||(this.historyController.undo(),0))}canUndo(){return!!this.historyController&&this.historyController.canUndo()&&!this.state.isReadonly&&!this.state.isDragging}tryRedo(){return!(!this.canRedo()||!this.historyController||(this.historyController.redo(),0))}canRedo(){return!!this.historyController&&this.historyController.canRedo()&&!this.state.isReadonly&&!this.state.isDragging}tryDelete(){return!(!this.canDelete()||!this.state.selectedStepId||(this.definitionModifier.tryDelete(this.state.selectedStepId),0))}canDelete(){return!!this.state.selectedStepId&&!this.state.isReadonly&&!this.state.isDragging&&this.definitionModifier.isDeletable(this.state.selectedStepId)}}class e{constructor(){this.listeners=[]}subscribe(t){this.listeners.push(t)}unsubscribe(t){const e=this.listeners.indexOf(t);if(!(e>=0))throw new Error("Unknown listener");this.listeners.splice(e,1)}forward(t){this.listeners.length>0&&this.listeners.forEach((e=>e(t)))}count(){return this.listeners.length}}class n{constructor(t,e){this.x=t,this.y=e}add(t){return new n(this.x+t.x,this.y+t.y)}subtract(t){return new n(this.x-t.x,this.y-t.y)}multiplyByScalar(t){return new n(this.x*t,this.y*t)}divideByScalar(t){return new n(this.x/t,this.y/t)}round(){return new n(Math.round(this.x),Math.round(this.y))}distance(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}}var o,i,r;!function(t){t[t.stepNameChanged=1]="stepNameChanged",t[t.stepPropertyChanged=2]="stepPropertyChanged",t[t.stepChildrenChanged=3]="stepChildrenChanged",t[t.stepDeleted=4]="stepDeleted",t[t.stepMoved=5]="stepMoved",t[t.stepInserted=6]="stepInserted",t[t.globalPropertyChanged=7]="globalPropertyChanged",t[t.rootReplaced=8]="rootReplaced"}(o||(o={}));class a{constructor(t,s){this.definition=t,this.isReadonly=s,this.onViewportChanged=new e,this.onSelectedStepIdChanged=new e,this.onFolderPathChanged=new e,this.onIsReadonlyChanged=new e,this.onIsDraggingChanged=new e,this.onIsDragDisabledChanged=new e,this.onDefinitionChanged=new e,this.viewport={position:new n(0,0),scale:1},this.selectedStepId=null,this.folderPath=[],this.isDragging=!1,this.isDragDisabled=!1}setSelectedStepId(t){this.selectedStepId!==t&&(this.selectedStepId=t,this.onSelectedStepIdChanged.forward(t))}pushStepIdToFolderPath(t){this.folderPath.push(t),this.onFolderPathChanged.forward(this.folderPath)}setFolderPath(t){this.folderPath=t,this.onFolderPathChanged.forward(t)}tryGetLastStepIdFromFolderPath(){return this.folderPath.length>0?this.folderPath[this.folderPath.length-1]:null}setDefinition(t){this.definition=t,this.notifyDefinitionChanged(o.rootReplaced,null)}notifyDefinitionChanged(t,e){this.onDefinitionChanged.forward({changeType:t,stepId:e})}setViewport(t){this.viewport=t,this.onViewportChanged.forward(t)}setIsReadonly(t){this.isReadonly!==t&&(this.isReadonly=t,this.onIsReadonlyChanged.forward(t))}setIsDragging(t){this.isDragging!==t&&(this.isDragging=t,this.onIsDraggingChanged.forward(t))}toggleIsDragDisabled(){this.isDragDisabled=!this.isDragDisabled,this.onIsDragDisabledChanged.forward(this.isDragDisabled)}}class l{static svg(t,e){const s=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&l.attrs(s,e),s}static translate(t,e,s){t.setAttribute("transform",`translate(${e}, ${s})`)}static attrs(t,e){Object.keys(e).forEach((s=>{const n=e[s];t.setAttribute(s,"string"==typeof n?n:n.toString())}))}static element(t,e){const s=document.createElement(t);return e&&l.attrs(s,e),s}static toggleClass(t,e,s){e?t.classList.add(s):t.classList.remove(s)}}class d{static appendPath(t,e,s,n){const o=l.svg("g"),i=n/48,r=l.svg("path",{d:s,class:e,transform:`scale(${i})`});return o.appendChild(r),t.appendChild(o),o}static createSvg(t,e){const s=l.svg("svg",{class:t,viewBox:"0 0 48 48"}),n=l.svg("path",{d:e,class:"sqd-icon-path"});return s.appendChild(n),s}}d.folderIn="M42.05 42.25H11.996v-7.12h17.388L6 11.746 11.546 6.2 34.93 29.584V12.196h7.12V42.25z",d.folderOut="M6 6.2h30.054v7.12H18.666L42.05 36.704l-5.546 5.546L13.12 18.866v17.388H6V6.2z",d.center="M9 42q-1.2 0-2.1-.9Q6 40.2 6 39v-8.6h3V39h8.6v3Zm21.4 0v-3H39v-8.6h3V39q0 1.2-.9 2.1-.9.9-2.1.9ZM24 31.15q-3.15 0-5.15-2-2-2-2-5.15 0-3.15 2-5.15 2-2 5.15-2 3.15 0 5.15 2 2 2 2 5.15 0 3.15-2 5.15-2 2-5.15 2ZM6 17.6V9q0-1.2.9-2.1Q7.8 6 9 6h8.6v3H9v8.6Zm33 0V9h-8.6V6H39q1.2 0 2.1.9.9.9.9 2.1v8.6Z",d.zoomIn="M39.8 41.95 26.65 28.8q-1.5 1.3-3.5 2.025-2 .725-4.25.725-5.4 0-9.15-3.75T6 18.75q0-5.3 3.75-9.05 3.75-3.75 9.1-3.75 5.3 0 9.025 3.75 3.725 3.75 3.725 9.05 0 2.15-.7 4.15-.7 2-2.1 3.75L42 39.75Zm-20.95-13.4q4.05 0 6.9-2.875Q28.6 22.8 28.6 18.75t-2.85-6.925Q22.9 8.95 18.85 8.95q-4.1 0-6.975 2.875T9 18.75q0 4.05 2.875 6.925t6.975 2.875ZM17.3 24.3v-4.1h-4.1v-3h4.1v-4.05h3v4.05h4.05v3H20.3v4.1Z",d.zoomOut="M39.8 41.95 26.65 28.8q-1.5 1.3-3.5 2.025-2 .725-4.25.725-5.4 0-9.15-3.75T6 18.75q0-5.3 3.75-9.05 3.75-3.75 9.1-3.75 5.3 0 9.025 3.75 3.725 3.75 3.725 9.05 0 2.15-.7 4.15-.7 2-2.1 3.75L42 39.75Zm-20.95-13.4q4.05 0 6.9-2.875Q28.6 22.8 28.6 18.75t-2.85-6.925Q22.9 8.95 18.85 8.95q-4.1 0-6.975 2.875T9 18.75q0 4.05 2.875 6.925t6.975 2.875Zm-5.1-8.35v-3H23.8v3Z",d.undo="M14 38v-3h14.45q3.5 0 6.025-2.325Q37 30.35 37 26.9t-2.525-5.775Q31.95 18.8 28.45 18.8H13.7l5.7 5.7-2.1 2.1L8 17.3 17.3 8l2.1 2.1-5.7 5.7h14.7q4.75 0 8.175 3.2Q40 22.2 40 26.9t-3.425 7.9Q33.15 38 28.4 38Z",d.redo="M19.6 38q-4.75 0-8.175-3.2Q8 31.6 8 26.9t3.425-7.9q3.425-3.2 8.175-3.2h14.7l-5.7-5.7L30.7 8l9.3 9.3-9.3 9.3-2.1-2.1 5.7-5.7H19.55q-3.5 0-6.025 2.325Q11 23.45 11 26.9t2.525 5.775Q16.05 35 19.55 35H34v3Z",d.move="m24 44-8.15-8.15 2.2-2.2 4.45 4.45v-9.45h3v9.45l4.45-4.45 2.2 2.2ZM11.9 31.9 4 24l7.95-7.95 2.2 2.2L9.9 22.5h9.45v3H9.9l4.2 4.2Zm24.2 0-2.2-2.2 4.2-4.2h-9.4v-3h9.4l-4.2-4.2 2.2-2.2L44 24ZM22.5 19.3V9.9l-4.2 4.2-2.2-2.2L24 4l7.9 7.9-2.2 2.2-4.2-4.2v9.4Z",d.delete="m16.5 33.6 7.5-7.5 7.5 7.5 2.1-2.1-7.5-7.5 7.5-7.5-2.1-2.1-7.5 7.5-7.5-7.5-2.1 2.1 7.5 7.5-7.5 7.5ZM24 44q-4.1 0-7.75-1.575-3.65-1.575-6.375-4.3-2.725-2.725-4.3-6.375Q4 28.1 4 24q0-4.15 1.575-7.8 1.575-3.65 4.3-6.35 2.725-2.7 6.375-4.275Q19.9 4 24 4q4.15 0 7.8 1.575 3.65 1.575 6.35 4.275 2.7 2.7 4.275 6.35Q44 19.85 44 24q0 4.1-1.575 7.75-1.575 3.65-4.275 6.375t-6.35 4.3Q28.15 44 24 44Z",d.folderUp="M22.5 34h3V23.75l3.7 3.7 2.1-2.1-7.3-7.3-7.3 7.3 2.1 2.1 3.7-3.7ZM7.05 40q-1.2 0-2.1-.925-.9-.925-.9-2.075V11q0-1.15.9-2.075Q5.85 8 7.05 8h14l3 3h17q1.15 0 2.075.925.925.925.925 2.075v23q0 1.15-.925 2.075Q42.2 40 41.05 40Zm0-29v26h34V14H22.8l-3-3H7.05Zm0 0v26Z",d.close="m12.45 37.65-2.1-2.1L21.9 24 10.35 12.45l2.1-2.1L24 21.9l11.55-11.55 2.1 2.1L26.1 24l11.55 11.55-2.1 2.1L24 26.1Z",d.options="m19.4 44-1-6.3q-.95-.35-2-.95t-1.85-1.25l-5.9 2.7L4 30l5.4-3.95q-.1-.45-.125-1.025Q9.25 24.45 9.25 24q0-.45.025-1.025T9.4 21.95L4 18l4.65-8.2 5.9 2.7q.8-.65 1.85-1.25t2-.9l1-6.35h9.2l1 6.3q.95.35 2.025.925Q32.7 11.8 33.45 12.5l5.9-2.7L44 18l-5.4 3.85q.1.5.125 1.075.025.575.025 1.075t-.025 1.05q-.025.55-.125 1.05L44 30l-4.65 8.2-5.9-2.7q-.8.65-1.825 1.275-1.025.625-2.025.925l-1 6.3ZM24 30.5q2.7 0 4.6-1.9 1.9-1.9 1.9-4.6 0-2.7-1.9-4.6-1.9-1.9-4.6-1.9-2.7 0-4.6 1.9-1.9 1.9-1.9 4.6 0 2.7 1.9 4.6 1.9 1.9 4.6 1.9Z",d.expand="m24 30.75-12-12 2.15-2.15L24 26.5l9.85-9.85L36 18.8Z",d.alert="M24 42q-1.45 0-2.475-1.025Q20.5 39.95 20.5 38.5q0-1.45 1.025-2.475Q22.55 35 24 35q1.45 0 2.475 1.025Q27.5 37.05 27.5 38.5q0 1.45-1.025 2.475Q25.45 42 24 42Zm-3.5-12V6h7v24Z",d.play="M14.75 40.15V7.55l25.6 16.3Z",d.stop="M10.75 37.25V10.7H37.3v26.55Z",d.folder="M7.05 40q-1.2 0-2.1-.925-.9-.925-.9-2.075V11q0-1.15.9-2.075Q5.85 8 7.05 8h14l3 3h17q1.15 0 2.075.925.925.925.925 2.075v23q0 1.15-.925 2.075Q42.2 40 41.05 40Z";class c{static deepClone(t){return void 0!==window.structuredClone?window.structuredClone(t):JSON.parse(JSON.stringify(t))}}class h{static next(){const t=new Uint8Array(16);return window.crypto.getRandomValues(t),Array.from(t,(t=>t.toString(16).padStart(2,"0"))).join("")}}(r=i||(i={}))[r.singleSequence=1]="singleSequence",r[r.branches=2]="branches";class p{constructor(t){this.stepExtensionResolver=t}getChildren(t){return this.stepExtensionResolver.resolve(t.componentType).getChildren(t)}find(t,e,s,n){if(e&&t===e)return!0;const o=t.length;for(let r=0;r<o;r++){const o=t[r];if(s&&o.id===s)return n.push({step:o,index:r,parentSequence:t}),!0;const a=this.getChildren(o);if(a)switch(a.type){case i.singleSequence:{const t=a.sequences;if(this.find(t,e,s,n))return n.push({step:o,index:r,parentSequence:t}),!0}break;case i.branches:{const t=a.sequences,i=Object.keys(t);for(const a of i){const i=t[a];if(this.find(i,e,s,n))return n.push(a),n.push({step:o,index:r,parentSequence:i}),!0}}break;default:throw new Error(`Step children type ${a.type} is not supported`)}}return!1}getParents(t,e){const s=[],n=Array.isArray(e)?e:null,o=n?null:e.id;if(this.find(t.sequence,n,o,s))return s.reverse(),s.map((t=>"string"==typeof t?t:t.step));throw new Error(o?`Cannot get parents of step: ${o}`:"Cannot get parents of sequence")}findParentSequence(t,e){const s=[];return this.find(t.sequence,null,e,s)?s[0]:null}getParentSequence(t,e){const s=this.findParentSequence(t,e);if(!s)throw new Error(`Cannot find step by id: ${e}`);return s}findById(t,e){const s=this.findParentSequence(t,e);return s?s.step:null}getById(t,e){return this.getParentSequence(t,e).step}getChildAndParentSequences(t,e){const s=this.getParentSequence(t,e),n=this.getChildren(s.step);if(!n||n.type!==i.singleSequence)throw new Error(`Cannot find single sequence in step: ${e}`);const o=n.sequences;return{index:s.index,parentSequence:s.parentSequence,childSequence:o}}}function u(t,s,n,o){const i=[void 0,void 0,void 0],r=new e;let a=!1;return[s,n,o].filter((t=>t)).forEach(((e,s)=>{e.subscribe((e=>{i[s]=e,a||(a=!0,setTimeout((()=>{try{r.forward(i)}finally{a=!1,i.fill(void 0)}}),t))}))})),r}class g{static create(t,e,s){const n=new g(t,e,s);return u(0,t.onDefinitionChanged,t.onSelectedStepIdChanged).subscribe((t=>{const[e,s]=t;e?n.onDefinitionChanged(e):void 0!==s&&n.onSelectedStepIdChanged(s)})),n.tryRender(t.selectedStepId),n}constructor(t,e,s){this.state=t,this.stepsTraverser=e,this.handler=s,this.currentStepId=void 0}destroy(){}render(t){const e=t?this.stepsTraverser.getById(this.state.definition,t):null;this.currentStepId=t,this.handler(e)}tryRender(t){this.currentStepId!==t&&this.render(t)}onDefinitionChanged(t){t.changeType===o.rootReplaced?this.render(this.state.selectedStepId):this.tryRender(this.state.selectedStepId)}onSelectedStepIdChanged(t){this.tryRender(t)}}class v{constructor(t,e,s,n){this.state=t,this.stepsTraverser=e,this.layoutController=s,this.definitionModifier=n}isVisibleAtStart(){return this.layoutController.isMobile()}getDefinition(){return this.state.definition}runRenderer(t){return g.create(this.state,this.stepsTraverser,t)}createStepEditorContext(t){return{notifyPropertiesChanged:()=>{this.state.notifyDefinitionChanged(o.stepPropertyChanged,t)},notifyNameChanged:()=>{this.state.notifyDefinitionChanged(o.stepNameChanged,t)},notifyChildrenChanged:()=>{this.state.notifyDefinitionChanged(o.stepChildrenChanged,t),this.definitionModifier.updateDependantFields()}}}createGlobalEditorContext(){return{notifyPropertiesChanged:()=>{this.state.notifyDefinitionChanged(o.globalPropertyChanged,null)}}}}class w{constructor(t,e){this.state=t,this.stepsTraverser=e}subscribe(t){u(0,this.state.onFolderPathChanged,this.state.onDefinitionChanged).subscribe(t)}setFolderPath(t){this.state.setFolderPath(t)}getFolderPath(){return this.state.folderPath}getFolderPathStepNames(){return this.state.folderPath.map((t=>this.stepsTraverser.getById(this.state.definition,t).name))}}class m{static create(t,e,s){const n=e.theme||"light",o=l.element("div",{class:`sqd-drag sqd-theme-${n}`});document.body.appendChild(o);const i=s.services.draggedComponent.create(o,t,s);return new m(i,o)}constructor(t,e){this.component=t,this.layer=e}setPosition(t){this.layer.style.top=t.y+"px",this.layer.style.left=t.x+"px"}remove(){this.component.destroy(),document.body.removeChild(this.layer)}}class C{static create(t,e){const s=new C(t,e);return e.onViewportChanged.subscribe(s.clearCacheHandler),window.addEventListener("scroll",s.clearCacheHandler,!1),s}constructor(t,e){this.placeholders=t,this.state=e,this.clearCacheHandler=()=>this.clearCache()}find(t,e,s){var o;this.cache||(this.cache=this.placeholders.map((t=>{const e=t.getRect();return{placeholder:t,lt:new n(e.x,e.y),br:new n(e.x+e.width,e.y+e.height)}})),this.cache.sort(((t,e)=>t.lt.y-e.lt.y)));const i=t.x+e,r=t.y+s;return null===(o=this.cache.find((e=>Math.max(t.x,e.lt.x)<Math.min(i,e.br.x)&&Math.max(t.y,e.lt.y)<Math.min(r,e.br.y))))||void 0===o?void 0:o.placeholder}destroy(){this.state.onViewportChanged.unsubscribe(this.clearCacheHandler),window.removeEventListener("scroll",this.clearCacheHandler,!1)}clearCache(){this.cache=void 0}}class f{static create(t,e,s){const n=m.create(e,t.configuration,t.componentContext);return new f(n,t.workspaceController,t.state,e,t.definitionModifier,s)}constructor(t,e,s,n,o,i){this.view=t,this.workspaceController=e,this.designerState=s,this.step=n,this.definitionModifier=o,this.draggedStepComponent=i}onStart(t){let e=null;if(this.draggedStepComponent&&(this.draggedStepComponent.setIsDisabled(!0),this.draggedStepComponent.view.width===this.view.component.width&&this.draggedStepComponent.view.height===this.view.component.height)){const s=this.draggedStepComponent.view.getClientPosition();e=t.subtract(s)}e||(e=new n(this.view.component.width,this.view.component.height).divideByScalar(2)),this.view.setPosition(t.subtract(e)),this.designerState.setIsDragging(!0);const s=this.workspaceController.getPlaceholders();this.state={startPosition:t,finder:C.create(s,this.designerState),offset:e}}onMove(t){if(this.state){const e=this.state.startPosition.subtract(t).subtract(this.state.offset);this.view.setPosition(e);const s=this.state.finder.find(e,this.view.component.width,this.view.component.height);this.currentPlaceholder!==s&&(this.currentPlaceholder&&this.currentPlaceholder.setIsHover(!1),s&&s.setIsHover(!0),this.currentPlaceholder=s)}}onEnd(t){if(!this.state)throw new Error("Invalid state");this.state.finder.destroy(),this.state=void 0,this.view.remove(),this.designerState.setIsDragging(!1);let e=!1;!t&&this.currentPlaceholder&&(e=this.draggedStepComponent?this.definitionModifier.tryMove(this.draggedStepComponent.parentSequence,this.draggedStepComponent.step,this.currentPlaceholder.parentSequence,this.currentPlaceholder.index):this.definitionModifier.tryInsert(this.step,this.currentPlaceholder.parentSequence,this.currentPlaceholder.index)),e||(this.draggedStepComponent&&this.draggedStepComponent.setIsDisabled(!1),this.currentPlaceholder&&this.currentPlaceholder.setIsHover(!1)),this.currentPlaceholder=void 0}}class b{constructor(t,e,s,n,o){this.state=t,this.designerContext=e,this.behaviorController=s,this.layoutController=n,this.configuration=o}isVisibleAtStart(){return this.layoutController.isMobile()}tryGetIconUrl(t){return this.configuration.iconUrlProvider?this.configuration.iconUrlProvider(t.componentType,t.type):null}tryDrag(t,e){if(!this.state.isReadonly){const s=function(t){const e=c.deepClone(t);return e.id=h.next(),e}(e);return this.behaviorController.start(t,f.create(this.designerContext,s)),!0}return!1}}class y{constructor(t,e){this.workspaceController=t,this.viewportController=e}resetViewport(){this.viewportController.setDefault()}zoom(t){this.viewportController.zoom(t)}moveViewportToStep(t){const e=this.workspaceController.getComponentByStepId(t),s=e.view.getClientPosition(),o=new n(e.view.width,e.view.height);this.viewportController.focusOnComponent(s,o)}}class q{constructor(t,e){this.state=t,this.workspaceController=e}getCanvasPosition(){return this.workspaceController.getCanvasPosition()}getCanvasSize(){return this.workspaceController.getCanvasSize()}getRootComponentSize(){return this.workspaceController.getRootComponentSize()}getViewport(){return this.state.viewport}setViewport(t){this.state.setViewport(t)}updateBadges(){this.workspaceController.updateBadges()}updateSize(){this.workspaceController.updateSize()}}class x{static create(e){const s=new q(e.state,e.workspaceController),n=e.services.viewportController.create(s),o=new y(e.workspaceController,n);return new x(new t(e.state,e.historyController,e.definitionModifier,o),new b(e.state,e,e.behaviorController,e.layoutController,e.configuration.steps),new v(e.state,e.stepsTraverser,e.layoutController,e.definitionModifier),s,o,new w(e.state,e.stepsTraverser))}constructor(t,e,s,n,o,i){this.controlBar=t,this.toolbox=e,this.editor=s,this.workspace=n,this.viewport=o,this.pathBar=i}}class S{static create(t,e,s){const n=l.svg("g",{class:"sqd-badges"});e.g.appendChild(n);const o=s.services.badges.map((e=>e.createBadge(n,t,s)));return new S(n,e,o)}constructor(t,e,s){this.g=t,this.view=e,this.badges=s}update(t){const e=this.badges.length;for(let s=0;s<e;s++)t[s]=this.badges[s].update(t[s]);let s=0,n=0,o=0;for(let t=0;t<e;t++){const e=this.badges[t];e.view&&(s+=0===o?e.view.width/2:e.view.width,n=Math.max(n,e.view.height),l.translate(e.view.g,-s,0),s+=4,o++)}l.translate(this.g,this.view.width,-n/2)}resolveClick(t){for(const e of this.badges){const s=e.resolveClick(t);if(s)return s}return null}}class I{static create(t,e,s){const n=S.create(e,t,s);return new I(t,e.step,e.parentSequence,t.hasOutput(),n)}constructor(t,e,s,n,o){this.view=t,this.step=e,this.parentSequence=s,this.hasOutput=n,this.badges=o,this.isDisabled=!1}findById(t){if(this.step.id===t)return this;if(this.view.sequenceComponents)for(const e of this.view.sequenceComponents){const s=e.findById(t);if(s)return s}return null}resolveClick(t){if(this.view.sequenceComponents)for(const e of this.view.sequenceComponents){const s=e.resolveClick(t);if(s)return s}const e=this.badges.resolveClick(t)||this.view.resolveClick(t);return e?{component:this,command:e}:null}getPlaceholders(t){this.isDisabled||(this.view.sequenceComponents&&this.view.sequenceComponents.forEach((e=>e.getPlaceholders(t))),this.view.placeholders&&this.view.placeholders.forEach((e=>t.push(e))))}setIsDragging(t){!this.isDisabled&&this.view.sequenceComponents&&this.view.sequenceComponents.forEach((e=>e.setIsDragging(t))),this.view.setIsDragging(t)}setIsSelected(t){this.view.setIsSelected(t)}setIsDisabled(t){this.isDisabled=t,this.view.setIsDisabled(t)}updateBadges(t){this.view.sequenceComponents&&this.view.sequenceComponents.forEach((e=>e.updateBadges(t))),this.badges.update(t)}}class D{constructor(t){this.stepExtensionResolver=t}create(t,e,s){const n=this.stepExtensionResolver.resolve(e.step.componentType).createComponentView(t,e,s);return I.create(n,e,s)}}class k{static create(t,e,s){const n=s.placeholderController.create(),o=new D(e);return new k(t,n,o,s)}constructor(t,e,s,n){this.configuration=t,this.placeholderController=e,this.stepComponentFactory=s,this.services=n}}class E{static create(t){return new E(t)}constructor(t){this.parent=t,this.currentContainer=null}setContent(t,e){const s=l.element("div",{class:e});s.appendChild(t),this.currentContainer&&this.parent.removeChild(this.currentContainer),this.parent.appendChild(s),this.currentContainer=s}destroy(){this.currentContainer&&this.parent.removeChild(this.currentContainer)}}class P{static create(t,e,s,n,o,i){const r=E.create(t),a=e.editor.runRenderer((t=>function(t){let a,l;if(t){const o=e.editor.createStepEditorContext(t.id);a=n(t,o),l=s}else{const t=e.editor.createGlobalEditorContext();a=i(e.editor.getDefinition(),t),l=o}r.setContent(a,l)}(t)));return new P(r,a)}constructor(t,e){this.view=t,this.renderer=e}destroy(){this.view.destroy(),this.renderer.destroy()}}class M{static createRectInput(t,e,s,n){const o=l.svg("g");t.appendChild(o);const i=l.svg("rect",{class:"sqd-input",width:18,height:18,x:e-9,y:s+-9+.5,rx:4,ry:4});if(o.appendChild(i),n){const t=l.svg("image",{href:n,width:14,height:14,x:e-7,y:s+-7});o.appendChild(t)}return new M(o)}static createRoundInput(t,e,s){const n=l.svg("circle",{class:"sqd-input",cx:e,xy:s,r:7});return t.appendChild(n),new M(n)}constructor(t){this.root=t}setIsHidden(t){l.attrs(this.root,{visibility:t?"hidden":"visible"})}}class B{static createStraightJoin(t,e,s){const n=l.svg("line",{class:"sqd-join",x1:e.x,y1:e.y,x2:e.x,y2:e.y+s});t.insertBefore(n,t.firstChild)}static createJoins(t,e,s){const n=s[0],o=Math.abs(n.y-e.y)/2,i=Math.sign(n.y-e.y);switch(s.length){case 1:e.x===s[0].x?B.createStraightJoin(t,e,n.y*i):T(t,e,s,o,i);break;case 2:T(t,e,s,o,i);break;default:{const n=s[0],r=s[s.length-1];R(t,`M ${n.x} ${n.y} q ${.3*o} ${o*-i*.8} ${o} ${o*-i} l ${r.x-n.x-2*o} 0 q ${.8*o} ${-o*-i*.3} ${o} ${-o*-i}`);for(let e=1;e<s.length-1;e++)B.createStraightJoin(t,s[e],o*-i);B.createStraightJoin(t,e,o*i)}}}}function T(t,e,s,n,o){for(const i of s){const s=Math.abs(i.x-e.x)-2*n,r=Math.sign(i.x-e.x);R(t,`M ${e.x} ${e.y} q ${r*n*.3} ${o*n*.8} ${r*n} ${o*n} l ${r*s} 0 q ${r*n*.7} ${o*n*.2} ${r*n} ${o*n}`)}}function R(t,e){const s=l.svg("path",{class:"sqd-join",fill:"none",d:e});t.insertBefore(s,t.firstChild)}class V{static create(t,e,s,n){const o=l.svg("g",{class:"sqd-label"});t.appendChild(o);const i=l.svg("text",{class:"sqd-label-text",y:e+11});i.textContent=s,o.appendChild(i);const r=Math.max(i.getBBox().width+20,50),a=l.svg("rect",{class:`sqd-label-rect sqd-label-${n}`,width:r,height:22,x:-r/2,y:e,rx:10,ry:10});return o.insertBefore(a,i),new V(o,r,22)}constructor(t,e,s){this.g=t,this.width=e,this.height=s}}class z{static create(t,e,s){const n=l.svg("circle",{class:"sqd-output",cx:e,cy:s,r:5});return t.appendChild(n),new z(n)}constructor(t){this.root=t}setIsHidden(t){l.attrs(this.root,{visibility:t?"hidden":"visible"})}}class L{static create(t,e,s){const n=e.reduce(((t,e)=>t+e),0),o=[A(t,0,0,n,0),A(t,0,0,0,s),A(t,0,s,n,s),A(t,n,0,n,s)];let i=e[0];for(let n=1;n<e.length;n++)o.push(A(t,i,0,i,s)),i+=e[n];return new L(o,n,s)}constructor(t,e,s){this.lines=t,this.width=e,this.height=s}getClientPosition(){const t=this.lines[0].getBoundingClientRect();return new n(t.x,t.y)}resolveClick(t){const e=this.getClientPosition(),s=t.position.subtract(e);return s.x>=0&&s.y>=0&&s.x<this.width*t.scale&&s.y<this.height*t.scale}setIsSelected(t){this.lines.forEach((e=>{l.toggleClass(e,t,"sqd-selected")}))}}function A(t,e,s,n,o){const i=l.svg("line",{class:"sqd-region",x1:e,y1:s,x2:n,y2:o});return t.insertBefore(i,t.firstChild),i}var H,F;(F=H||(H={}))[F.none=0]="none",F[F.in=1]="in",F[F.out=2]="out";class O{static create(t,e,s,n,o,i){const r=l.svg("g",{visibility:"hidden",class:"sqd-placeholder"});l.translate(r,e,s),t.appendChild(r);const a=l.svg("rect",{class:"sqd-placeholder-rect",width:n,height:o,rx:6,ry:6});if(r.appendChild(a),i){const t=i===H.in?d.folderIn:d.folderOut,e=d.appendPath(r,"sqd-placeholder-icon-path",t,16);l.translate(e,(n-16)/2,(o-16)/2)}return t.appendChild(r),new O(a,r)}constructor(t,e){this.rect=t,this.g=e}setIsHover(t){l.toggleClass(this.g,t,"sqd-hover")}setIsVisible(t){l.attrs(this.g,{visibility:t?"visible":"hidden"})}}const U=24;class Z{static create(t,e,s){const{sequence:o}=e,i=l.svg("g");t.appendChild(i);const r=[];for(let t=0;t<o.length;t++){const n={parentSequence:e.sequence,step:o[t],depth:e.depth,position:t,isInputConnected:0===t?e.isInputConnected:r[t-1].hasOutput,isOutputConnected:t!==o.length-1||e.isOutputConnected};r[t]=s.stepComponentFactory.create(i,n,s)}const a=r.length>0?Math.max(...r.map((t=>t.view.joinX))):50,d=r.length>0?Math.max(...r.map((t=>t.view.width))):100;let c=U;const h=[];for(let t=0;t<r.length;t++){const d=r[t],p=a-d.view.joinX;if((0===t&&e.isInputConnected||t>0&&r[t-1].hasOutput)&&B.createStraightJoin(i,new n(a,c-U),U),s.placeholderController.canCreate(o,t)){const e=O.create(i,a-50,c-U,100,U,H.none);h.push({view:e,index:t})}l.translate(d.view.g,p,c),c+=d.view.height+U}e.isOutputConnected&&(0===r.length||r[r.length-1].hasOutput)&&B.createStraightJoin(i,new n(a,c-U),U);const p=r.length;if(s.placeholderController.canCreate(o,p)){const t=O.create(i,a-50,c-U,100,U,H.none);h.push({view:t,index:p})}return new Z(i,d,c,a,h,r)}constructor(t,e,s,n,o,i){this.g=t,this.width=e,this.height=s,this.joinX=n,this.placeholders=o,this.components=i}setIsDragging(t){this.placeholders.forEach((e=>{e.view.setIsVisible(t)}))}hasOutput(){return!(this.components.length>0)||this.components[this.components.length-1].hasOutput}}class ${constructor(t,e,s){this.view=t,this.parentSequence=e,this.index=s}getRect(){return this.view.rect.getBoundingClientRect()}setIsHover(t){this.view.setIsHover(t)}}class X{static create(t,e,s){const n=Z.create(t,e,s);return new X(n,n.hasOutput(),e.sequence)}constructor(t,e,s){this.view=t,this.hasOutput=e,this.sequence=s}resolveClick(t){for(const e of this.view.components){const s=e.resolveClick(t);if(s)return s}return null}findById(t){for(const e of this.view.components){const s=e.findById(t);if(s)return s}return null}getPlaceholders(t){this.view.placeholders.forEach((e=>{t.push(new $(e.view,this.sequence,e.index))})),this.view.components.forEach((e=>e.getPlaceholders(t)))}setIsDragging(t){this.view.setIsDragging(t),this.view.components.forEach((e=>e.setIsDragging(t)))}updateBadges(t){for(const e of this.view.components)e.updateBadges(t)}}var j,Q;(Q=j||(j={}))[Q.selectStep=1]="selectStep",Q[Q.openFolder=2]="openFolder",Q[Q.triggerCustomAction=3]="triggerCustomAction";class N{static create(t,e,s,n){const{step:o}=e,i=l.svg("g",{class:`sqd-step-task sqd-type-${o.type}`});t.appendChild(i);const r=l.svg("text",{x:46,y:21,class:"sqd-step-task-text"});r.textContent=o.name,i.appendChild(r);const a=58+Math.max(r.getBBox().width,70),d=l.svg("rect",{x:.5,y:.5,class:"sqd-step-task-rect",width:a,height:42,rx:5,ry:5});i.insertBefore(d,r);const c=s.iconUrlProvider?s.iconUrlProvider(o.componentType,o.type):null,h=c?l.svg("image",{href:c}):l.svg("rect",{class:"sqd-step-task-empty-icon",rx:4,ry:4});l.attrs(h,{x:12,y:10,width:22,height:22}),i.appendChild(h);const p=n,u=0!==e.depth||0!==e.position||e.isInputConnected?M.createRoundInput(i,a/2,0):null,g=p?null:z.create(i,a/2,42);return new N(i,a,42,a/2,d,u,g)}constructor(t,e,s,n,o,i,r){this.g=t,this.width=e,this.height=s,this.joinX=n,this.rect=o,this.inputView=i,this.outputView=r,this.sequenceComponents=null,this.placeholders=null}hasOutput(){return!!this.outputView}getClientPosition(){const t=this.rect.getBoundingClientRect();return new n(t.x,t.y)}resolveClick(t){return this.g.contains(t.element)?{type:j.selectStep}:null}setIsDragging(t){var e,s;null===(e=this.inputView)||void 0===e||e.setIsHidden(t),null===(s=this.outputView)||void 0===s||s.setIsHidden(t)}setIsDisabled(t){l.toggleClass(this.g,t,"sqd-disabled")}setIsSelected(t){l.toggleClass(this.rect,t,"sqd-selected")}}class J{static center(t,e,s){const o=Math.max(e.x-2*t,0),i=Math.max(e.y-2*t,0),r=Math.min(Math.min(o/s.x,i/s.y),1),a=s.x*r,l=s.y*r,d=Math.max(0,(e.x-a)/2),c=Math.max(0,(e.y-l)/2);return{position:new n(d,c),scale:r}}static focusOnComponent(t,e,s,n){const o=e.position.divideByScalar(e.scale).subtract(s.divideByScalar(e.scale)),i=n.divideByScalar(2);return{position:o.add(t.divideByScalar(2)).subtract(i),scale:1}}}const W=new class{constructor(t){this.values=t}next(t,e){let s,n=0,o=Number.MAX_VALUE;for(let e=0;e<this.values.length;e++){const s=Math.abs(this.values[e]-t);o>s&&(n=e,o=s)}return s=e?Math.min(n+1,this.values.length-1):Math.max(n-1,0),{current:this.values[n],next:this.values[s]}}}([.06,.08,.1,.12,.16,.2,.26,.32,.4,.5,.6,.7,.8,.9,1]);class Y{static zoom(t,e){const s=W.next(t.scale,e);return{position:t.position,scale:s.next}}static zoomByWheel(t,e,s){if(0===e.deltaY)return null;const o=W.next(t.scale,e.deltaY<0);let i;const r=Math.abs(e.deltaY);if(r<16){const e=r/16,s=o.next-o.current;i=t.scale+s*e}else i=o.next;const a=new n(e.pageX,e.pageY).subtract(s);return{position:a.divideByScalar(t.scale).subtract(t.position.divideByScalar(t.scale)).multiplyByScalar(-i).add(a),scale:i}}}class G{static create(t){return new G(t)}constructor(t){this.api=t}onWheel(t){const e=this.api.getViewport(),s=this.api.getCanvasPosition(),n=Y.zoomByWheel(e,t,s);n&&this.api.setViewport(n)}}class _{constructor(){this.create=G.create}}class K{constructor(t){this.api=t}execute(t){this.animation&&this.animation.isAlive&&this.animation.stop();const e=this.api.getViewport(),s=e.position,n=e.scale,o=s.subtract(t.position),i=n-t.scale;this.animation=function(t,e){const s=setInterval((function(){const t=Math.min((Date.now()-n)/150,1);e(t),1===t&&o.stop()}),15),n=Date.now(),o={isAlive:!0,stop:()=>{o.isAlive=!1,clearInterval(s)}};return o}(0,(t=>{const e=n-i*t;this.api.setViewport({position:s.subtract(o.multiplyByScalar(t)),scale:e})}))}}class tt{static create(t){return new tt(t)}constructor(t){this.api=t,this.animator=new K(this.api)}setDefault(){const t=this.api.getRootComponentSize(),e=this.api.getCanvasSize(),s=J.center(10,e,t);this.api.setViewport(s)}zoom(t){const e=this.api.getViewport(),s=Y.zoom(e,t);this.api.setViewport(s)}focusOnComponent(t,e){const s=this.api.getViewport(),n=this.api.getCanvasSize(),o=J.focusOnComponent(n,s,t,e);this.animateTo(o)}animateTo(t){this.animator.execute(t)}}class et{constructor(){this.create=tt.create}}class st{static create(t){const e={};for(let s=t.steps.length-1;s>=0;s--){const n=t.steps[s];e[n.componentType]=n}return new st(e)}constructor(t){this.dict=t}resolve(t){const e=this.dict[t];if(!e)throw new Error(`Not supported component type: ${t}`);return e}}function nt(t){return new n(t.clientX,t.clientY)}function ot(t){if(t.touches.length>0){const e=t.touches[0];return new n(e.clientX,e.clientY)}throw new Error("Unknown touch position")}const it="State is not initialized";class rt{constructor(){this.onMouseMoveHandler=t=>this.onMouseMove(t),this.onMouseUpHandler=t=>this.onMouseUp(t),this.onTouchMoveHandler=t=>this.onTouchMove(t),this.onTouchEndHandler=t=>this.onTouchEnd(t),this.onTouchStartHandler=t=>this.onTouchStart(t)}start(t,e){this.state?this.stop(!0,null):(this.state={startPosition:t,behavior:e},e.onStart(this.state.startPosition),window.addEventListener("mousemove",this.onMouseMoveHandler,!1),window.addEventListener("touchmove",this.onTouchMoveHandler,!1),window.addEventListener("mouseup",this.onMouseUpHandler,!1),window.addEventListener("touchend",this.onTouchEndHandler,!1),window.addEventListener("touchstart",this.onTouchStartHandler,!1))}onMouseMove(t){t.preventDefault(),this.move(nt(t))}onTouchMove(t){t.preventDefault(),this.move(ot(t))}onMouseUp(t){t.preventDefault(),this.stop(!1,t.target)}onTouchEnd(t){var e;if(t.preventDefault(),!this.state)throw new Error(it);const s=null!==(e=this.state.lastPosition)&&void 0!==e?e:this.state.startPosition,n=document.elementFromPoint(s.x,s.y);this.stop(!1,n)}onTouchStart(t){t.preventDefault(),1!==t.touches.length&&this.stop(!0,null)}move(t){if(!this.state)throw new Error(it);this.state.lastPosition=t;const e=this.state.startPosition.subtract(t),s=this.state.behavior.onMove(e);s&&(this.state.behavior.onEnd(!0,null),this.state.behavior=s,this.state.startPosition=t,this.state.behavior.onStart(this.state.startPosition))}stop(t,e){if(!this.state)throw new Error(it);window.removeEventListener("mousemove",this.onMouseMoveHandler,!1),window.removeEventListener("touchmove",this.onTouchMoveHandler,!1),window.removeEventListener("mouseup",this.onMouseUpHandler,!1),window.removeEventListener("touchend",this.onTouchEndHandler,!1),window.removeEventListener("touchstart",this.onTouchEndHandler,!1),this.state.behavior.onEnd(t,e),this.state=void 0}}class at{static moveStep(t,e,s,n){const o=t.indexOf(e);if(o<0)throw new Error("Unknown step");const i=t===s;i&&o===n||(t.splice(o,1),i&&o<n&&n--,s.splice(n,0,e))}static insertStep(t,e,s){e.splice(s,0,t)}static deleteStep(t,e){const s=e.indexOf(t);if(s<0)throw new Error("Unknown step");e.splice(s,1)}}class lt{constructor(t,e,s){this.stepsTraverser=t,this.state=e,this.configuration=s}isDeletable(t){if(this.configuration.steps.isDeletable){const e=this.stepsTraverser.getParentSequence(this.state.definition,t);return this.configuration.steps.isDeletable(e.step,e.parentSequence)}return!0}tryDelete(t){const e=this.stepsTraverser.getParentSequence(this.state.definition,t);return!(this.configuration.steps.canDeleteStep&&!this.configuration.steps.canDeleteStep(e.step,e.parentSequence)||(at.deleteStep(e.step,e.parentSequence),this.state.notifyDefinitionChanged(o.stepDeleted,e.step.id),this.updateDependantFields(),0))}tryInsert(t,e,s){return!(this.configuration.steps.canInsertStep&&!this.configuration.steps.canInsertStep(t,e,s)||(at.insertStep(t,e,s),this.state.notifyDefinitionChanged(o.stepInserted,t.id),this.state.setSelectedStepId(t.id),0))}isDraggable(t,e){return!this.configuration.steps.isDraggable||this.configuration.steps.isDraggable(t,e)}tryMove(t,e,s,n){return!(this.configuration.steps.canMoveStep&&!this.configuration.steps.canMoveStep(t,e,s,n)||(at.moveStep(t,e,s,n),this.state.notifyDefinitionChanged(o.stepMoved,e.id),this.state.setSelectedStepId(e.id),0))}replaceDefinition(t){if(!t)throw new Error("Definition is empty");this.state.setDefinition(t),this.updateDependantFields()}updateDependantFields(){this.state.selectedStepId&&(this.stepsTraverser.findById(this.state.definition,this.state.selectedStepId)||this.state.setSelectedStepId(null));for(let t=0;t<this.state.folderPath.length;t++){const e=this.state.folderPath[t];if(!this.stepsTraverser.findById(this.state.definition,e)){const e=this.state.folderPath.slice(0,t);this.state.setFolderPath(e);break}}}}class dt{static create(t,e,s){if(!s.undoStackSize||s.undoStackSize<1)throw new Error("Invalid undo stack size");const n=new dt(t,e,s.undoStackSize);return n.remember(o.rootReplaced,null),t.onDefinitionChanged.subscribe((t=>{t.changeType!==o.rootReplaced&&n.remember(t.changeType,t.stepId)})),n}constructor(t,e,s){this.state=t,this.definitionModifier=e,this.stackSize=s,this.stack=[],this.currentIndex=0}canUndo(){return this.currentIndex>1}undo(){this.currentIndex--,this.commit()}canRedo(){return this.currentIndex<this.stack.length}redo(){this.currentIndex++,this.commit()}remember(t,e){const s=c.deepClone(this.state.definition);if(this.stack.length>0&&this.currentIndex===this.stack.length){const n=this.stack[this.stack.length-1];if(function(t,e,s){return t.changeType===e&&t.stepId===s}(n,t,e))return void(n.definition=s)}this.stack.splice(this.currentIndex),this.stack.push({definition:s,changeType:t,stepId:e}),this.stack.length>this.stackSize&&this.stack.splice(0,this.stack.length-this.stackSize-1),this.currentIndex=this.stack.length}commit(){const t=c.deepClone(this.stack[this.currentIndex-1].definition);this.definitionModifier.replaceDefinition(t)}}class ct{constructor(t){this.parent=t}isMobile(){return this.parent.clientWidth<400}}class ht{set(t){if(this.controller)throw new Error("Controller is already set");this.controller=t}get(){if(!this.controller)throw new Error("Controller is not set");return this.controller}getPlaceholders(){return this.get().getPlaceholders()}getComponentByStepId(t){return this.get().getComponentByStepId(t)}getCanvasPosition(){return this.get().getCanvasPosition()}getCanvasSize(){return this.get().getCanvasSize()}getRootComponentSize(){return this.get().getRootComponentSize()}updateBadges(){this.get().updateBadges()}updateSize(){this.get().updateSize()}}class pt{static create(t,e,s,n){const o=c.deepClone(e),i=new ct(t),r=!!s.isReadonly,l=new a(o,r),d=new ht,h=new rt,u=st.create(n),g=new p(u),v=new lt(g,l,s);let w;s.undoStackSize&&(w=dt.create(l,v,s));const m=k.create(s.steps,u,n);return new pt(l,s,n,m,g,v,i,d,h,w)}constructor(t,e,s,n,o,i,r,a,l,d){this.state=t,this.configuration=e,this.services=s,this.componentContext=n,this.stepsTraverser=o,this.definitionModifier=i,this.layoutController=r,this.workspaceController=a,this.behaviorController=l,this.historyController=d}setWorkspaceController(t){this.workspaceController.set(t)}}let ut=0;class gt{static create(t,e){const s=l.svg("defs"),n="sqd-grid-pattern-"+ut++,o=l.svg("pattern",{id:n,patternUnits:"userSpaceOnUse"}),i=l.svg("path",{class:"sqd-grid-path",fill:"none"});s.appendChild(o),o.appendChild(i);const r=l.svg("g"),a=l.element("div",{class:"sqd-workspace"}),d=l.svg("svg",{class:"sqd-workspace-canvas"});d.appendChild(s),d.appendChild(l.svg("rect",{width:"100%",height:"100%",fill:`url(#${n})`})),d.appendChild(r),a.appendChild(d),t.appendChild(a);const c=new gt(a,d,o,i,r,e);return window.addEventListener("resize",c.onResizeHandler,!1),c}constructor(t,e,s,n,o,i){this.workspace=t,this.canvas=e,this.gridPattern=s,this.gridPatternPath=n,this.foreground=o,this.context=i,this.onResizeHandler=()=>this.onResize()}render(t,e){this.rootComponent&&this.foreground.removeChild(this.rootComponent.view.g),this.rootComponent=this.context.services.rootComponent.create(this.foreground,t,e,this.context),this.refreshSize()}setPositionAndScale(t,e){const s=48*e;l.attrs(this.gridPattern,{x:t.x,y:t.y,width:s,height:s}),l.attrs(this.gridPatternPath,{d:`M ${s} 0 L 0 0 0 ${s}`}),l.attrs(this.foreground,{transform:`translate(${t.x}, ${t.y}) scale(${e})`})}getCanvasPosition(){const t=this.canvas.getBoundingClientRect();return new n(t.x,t.y)}getCanvasSize(){return new n(this.canvas.clientWidth,this.canvas.clientHeight)}bindClick(t){this.canvas.addEventListener("mousedown",(e=>{t(nt(e),e.target,e.button)}),!1),this.canvas.addEventListener("touchstart",(e=>{e.preventDefault();const s=ot(e),n=document.elementFromPoint(s.x,s.y);n&&t(s,n,0)}),!1)}bindContextMenu(t){this.canvas.addEventListener("contextmenu",t,!1)}bindWheel(t){this.canvas.addEventListener("wheel",t,!1)}destroy(){window.removeEventListener("resize",this.onResizeHandler,!1)}refreshSize(){l.attrs(this.canvas,{width:this.workspace.offsetWidth,height:this.workspace.offsetHeight})}onResize(){this.refreshSize()}}class vt{static create(t,e){return new vt(t.viewport.position,e,t)}constructor(t,e,s){this.startPosition=t,this.resetSelectedStep=e,this.state=s}onStart(){if(this.resetSelectedStep){const t=this.state.tryGetLastStepIdFromFolderPath();this.state.setSelectedStepId(t)}}onMove(t){this.state.setViewport({position:this.startPosition.subtract(t),scale:this.state.viewport.scale})}onEnd(){}}class wt{static create(t,e,s){return new wt(e,s,t.configuration.customActionHandler)}constructor(t,e,s){this.clickedElement=t,this.resolvedClick=e,this.customActionHandler=s}onStart(){}onMove(){}onEnd(t,e){if(this.clickedElement!==e)return;if(!this.customActionHandler)return void console.warn("Custom action handler is not defined");const s=this.resolvedClick.command.action;this.customActionHandler(s,this.resolvedClick.component.step)}}class mt{static create(t,e,s){return new mt(t,e,s,s.state)}constructor(t,e,s,n){this.pressedStepComponent=t,this.isDragDisabled=e,this.designerContext=s,this.state=n}onStart(){}onMove(t){if(t.distance()>2)return this.state.isReadonly||this.isDragDisabled?vt.create(this.state,!1):(this.state.setSelectedStepId(null),f.create(this.designerContext,this.pressedStepComponent.step,this.pressedStepComponent))}onEnd(t){t||this.state.setSelectedStepId(this.pressedStepComponent.step.id)}}class Ct{static create(t,e,s){return new Ct(t,e,s)}constructor(t,e,s){this.context=t,this.clickedElement=e,this.resolvedClick=s}onStart(){}onMove(){}onEnd(t,e){if(this.clickedElement===e){const t=this.resolvedClick.component.step.id;this.context.state.pushStepIdToFolderPath(t)}}}class ft{constructor(t,e){this.designerContext=t,this.state=e}resolve(t,e,s,n){const o={element:e,position:s,scale:this.state.viewport.scale},i=t.resolveClick(o);if(!i)return vt.create(this.state,!0);switch(i.command.type){case j.selectStep:{const t=n||this.state.isDragDisabled||!this.designerContext.definitionModifier.isDraggable(i.component.step,i.component.parentSequence);return mt.create(i.component,t,this.designerContext)}case j.openFolder:return Ct.create(this.designerContext,e,i);case j.triggerCustomAction:return wt.create(this.designerContext,e,i);default:throw new Error("Not supported behavior type")}}}class bt{static create(t){return t.badges.map((t=>t.createStartValue()))}}class yt{static create(t,e,s){const n=gt.create(t,e.componentContext),o=new ft(e,e.state),i=e.services.wheelController.create(s.workspace),r=new yt(n,e.stepsTraverser,e.state,e.behaviorController,i,o,s.viewport,e.services);return setTimeout((()=>{r.render(),s.viewport.resetViewport(),r.onReady.forward()})),e.setWorkspaceController(r),e.state.onViewportChanged.subscribe((t=>r.onViewportChanged(t))),e.state.onIsDraggingChanged.subscribe((t=>r.onIsDraggingChanged(t))),u(0,e.state.onDefinitionChanged,e.state.onSelectedStepIdChanged,e.state.onFolderPathChanged).subscribe((t=>{r.onStateChanged(t[0],t[1],t[2])})),n.bindClick(((t,e,s)=>r.onClick(t,e,s))),n.bindWheel((t=>r.onWheel(t))),n.bindContextMenu((t=>r.onContextMenu(t))),r}constructor(t,s,n,o,i,r,a,l){this.view=t,this.stepsTraverser=s,this.state=n,this.behaviorController=o,this.wheelController=i,this.clickBehaviorResolver=r,this.viewportApi=a,this.services=l,this.onReady=new e,this.isValid=!1,this.selectedStepComponent=null}render(){let t,e;this.selectedStepComponent=null;const s=this.state.tryGetLastStepIdFromFolderPath();if(s){const n=this.stepsTraverser.getChildAndParentSequences(this.state.definition,s);e=n.childSequence,t={sequence:n.parentSequence,index:n.index}}else e=this.state.definition.sequence,t=null;this.view.render(e,t),this.trySelectStepComponent(this.state.selectedStepId),this.updateBadges()}getPlaceholders(){const t=[];return this.getRootComponent().getPlaceholders(t),t}getComponentByStepId(t){const e=this.getRootComponent().findById(t);if(!e)throw new Error(`Cannot find component for step id: ${t}`);return e}getCanvasPosition(){return this.view.getCanvasPosition()}getCanvasSize(){return this.view.getCanvasSize()}getRootComponentSize(){const t=this.getRootComponent().view;return new n(t.width,t.height)}updateSize(){setTimeout((()=>this.view.refreshSize()))}updateBadges(){const t=bt.create(this.services);this.getRootComponent().updateBadges(t),this.isValid=Boolean(t[0])}destroy(){this.view.destroy()}onClick(t,e,s){const n=1===s;if(0===s||n){const s=this.getRootComponent(),o=n,i=this.clickBehaviorResolver.resolve(s,e,t,o);this.behaviorController.start(t,i)}}onWheel(t){t.preventDefault(),t.stopPropagation(),this.wheelController.onWheel(t)}onContextMenu(t){t.preventDefault()}onIsDraggingChanged(t){this.getRootComponent().setIsDragging(t)}onViewportChanged(t){this.view.setPositionAndScale(t.position,t.scale)}onStateChanged(t,e,s){s?(this.render(),this.viewportApi.resetViewport()):t?t.changeType===o.stepPropertyChanged?this.updateBadges():this.render():void 0!==e&&this.trySelectStepComponent(e)}trySelectStepComponent(t){this.selectedStepComponent&&(this.selectedStepComponent.setIsSelected(!1),this.selectedStepComponent=null),t&&(this.selectedStepComponent=this.getRootComponent().findById(t),this.selectedStepComponent&&this.selectedStepComponent.setIsSelected(!0))}getRootComponent(){if(this.view.rootComponent)return this.view.rootComponent;throw new Error("Root component not found")}}class qt{static create(t,e,s,n){const o=s.theme||"light",i=l.element("div",{class:`sqd-designer sqd-theme-${o}`});t.appendChild(i);const r=yt.create(i,e,n),a=e.services.uiComponents.map((t=>t.create(i,n))),d=e.services.daemons.map((t=>t.create(n))),c=new qt(i,e.layoutController,r,a,d);return c.reloadLayout(),window.addEventListener("resize",c.onResizeHandler,!1),c}constructor(t,e,s,n,o){this.root=t,this.layoutController=e,this.workspace=s,this.uiComponents=n,this.daemons=o,this.onResizeHandler=()=>this.onResize()}destroy(){var t;window.removeEventListener("resize",this.onResizeHandler,!1),this.workspace.destroy(),this.uiComponents.forEach((t=>t.destroy())),this.daemons.forEach((t=>t.destroy())),null===(t=this.root.parentElement)||void 0===t||t.removeChild(this.root)}onResize(){this.reloadLayout()}reloadLayout(){const t=this.layoutController.isMobile();l.toggleClass(this.root,!t,"sqd-layout-desktop"),l.toggleClass(this.root,t,"sqd-layout-mobile")}}class xt{static create(t,e,s){const n=l.svg("svg");n.style.marginLeft="-10px",n.style.marginTop="-10px",t.appendChild(n);const o={parentSequence:[],step:e,depth:0,position:0,isInputConnected:!0,isOutputConnected:!0},i=s.stepComponentFactory.create(n,o,s);return l.attrs(n,{width:i.view.width+20,height:i.view.height+20}),l.translate(i.view.g,10,10),new xt(i.view.width,i.view.height)}constructor(t,e){this.width=t,this.height=e}destroy(){}}class St{constructor(){this.create=xt.create}}class It{static create(t,e){const s=l.element("div",{class:"sqd-control-bar"}),n=kt(d.center,"Reset view");s.appendChild(n);const o=kt(d.zoomIn,"Zoom in");s.appendChild(o);const i=kt(d.zoomOut,"Zoom out");s.appendChild(i);let r=null,a=null;e&&(r=kt(d.undo,"Undo"),s.appendChild(r),a=kt(d.redo,"Redo"),s.appendChild(a));const c=kt(d.move,"Turn on/off drag and drop");c.classList.add("sqd-disabled"),s.appendChild(c);const h=kt(d.delete,"Delete selected step");return h.classList.add("sqd-delete"),h.classList.add("sqd-hidden"),s.appendChild(h),t.appendChild(s),new It(n,o,i,r,a,c,h)}constructor(t,e,s,n,o,i,r){this.resetButton=t,this.zoomInButton=e,this.zoomOutButton=s,this.undoButton=n,this.redoButton=o,this.disableDragButton=i,this.deleteButton=r}bindResetButtonClick(t){Dt(this.resetButton,t)}bindZoomInButtonClick(t){Dt(this.zoomInButton,t)}bindZoomOutButtonClick(t){Dt(this.zoomOutButton,t)}bindUndoButtonClick(t){if(!this.undoButton)throw new Error("Undo button is disabled");Dt(this.undoButton,t)}bindRedoButtonClick(t){if(!this.redoButton)throw new Error("Redo button is disabled");Dt(this.redoButton,t)}bindDisableDragButtonClick(t){Dt(this.disableDragButton,t)}bindDeleteButtonClick(t){Dt(this.deleteButton,t)}setIsDeleteButtonHidden(t){l.toggleClass(this.deleteButton,t,"sqd-hidden")}setDisableDragButtonDisabled(t){l.toggleClass(this.disableDragButton,t,"sqd-disabled")}setUndoButtonDisabled(t){if(!this.undoButton)throw new Error("Undo button is disabled");l.toggleClass(this.undoButton,t,"sqd-disabled")}setRedoButtonDisabled(t){if(!this.redoButton)throw new Error("Redo button is disabled");l.toggleClass(this.redoButton,t,"sqd-disabled")}}function Dt(t,e){t.addEventListener("click",(t=>{t.preventDefault(),e()}),!1)}function kt(t,e){const s=l.element("div",{class:"sqd-control-bar-button",title:e}),n=d.createSvg("sqd-control-bar-button-icon",t);return s.appendChild(n),s}class Et{static create(t,e){const s=e.controlBar.isUndoRedoSupported(),n=It.create(t,s),o=new Et(n,e.controlBar,s);return n.bindResetButtonClick((()=>o.onResetButtonClicked())),n.bindZoomInButtonClick((()=>o.onZoomInButtonClicked())),n.bindZoomOutButtonClick((()=>o.onZoomOutButtonClicked())),n.bindDisableDragButtonClick((()=>o.onMoveButtonClicked())),n.bindDeleteButtonClick((()=>o.onDeleteButtonClicked())),e.controlBar.subscribe((()=>o.refreshButtons())),s&&(n.bindUndoButtonClick((()=>o.onUndoButtonClicked())),n.bindRedoButtonClick((()=>o.onRedoButtonClicked()))),o.refreshButtons(),o}constructor(t,e,s){this.view=t,this.controlBarApi=e,this.isUndoRedoSupported=s}destroy(){}onResetButtonClicked(){this.controlBarApi.resetViewport()}onZoomInButtonClicked(){this.controlBarApi.zoomIn()}onZoomOutButtonClicked(){this.controlBarApi.zoomOut()}onMoveButtonClicked(){this.controlBarApi.toggleIsDragDisabled()}onUndoButtonClicked(){this.controlBarApi.tryUndo()}onRedoButtonClicked(){this.controlBarApi.tryRedo()}onDeleteButtonClicked(){this.controlBarApi.tryDelete()}refreshButtons(){this.refreshDeleteButtonVisibility(),this.refreshIsDragDisabled(),this.isUndoRedoSupported&&this.refreshUndoRedoAvailability()}refreshIsDragDisabled(){const t=this.controlBarApi.isDragDisabled();this.view.setDisableDragButtonDisabled(!t)}refreshUndoRedoAvailability(){const t=this.controlBarApi.canUndo(),e=this.controlBarApi.canRedo();this.view.setUndoButtonDisabled(!t),this.view.setRedoButtonDisabled(!e)}refreshDeleteButtonVisibility(){const t=this.controlBarApi.canDelete();this.view.setIsDeleteButtonHidden(!t)}}class Pt{constructor(){this.create=Et.create}}const Mt=["Backspace","Delete"],Bt=["INPUT","TEXTAREA"];class Tt{static create(t){const e=new Tt(t.controlBar);return document.addEventListener("keyup",e.onKeyUp,!1),e}constructor(t){this.controlBarApi=t,this.onKeyUp=t=>{Mt.includes(t.key)&&(document.activeElement&&Bt.includes(document.activeElement.tagName)||this.controlBarApi.canDelete()&&(t.preventDefault(),t.stopPropagation(),this.controlBarApi.tryDelete()))}}destroy(){document.removeEventListener("keyup",this.onKeyUp,!1)}}class Rt{constructor(){this.create=Tt.create}}class Vt{static create(t,e,s){const n=l.element("div",{class:"sqd-smart-editor"}),o=l.element("div",{class:"sqd-smart-editor-toggle",title:"Toggle editor"});t.appendChild(o),t.appendChild(n);const i=P.create(n,e,"sqd-editor sqd-step-editor",s.stepEditorProvider,"sqd-editor sqd-global-editor",s.globalEditorProvider);return new Vt(n,o,i)}constructor(t,e,s){this.root=t,this.toggle=e,this.editor=s}bindToggleIsCollapsedClick(t){this.toggle.addEventListener("click",(e=>{e.preventDefault(),t()}),!1)}setIsCollapsed(t){l.toggleClass(this.root,t,"sqd-hidden"),l.toggleClass(this.toggle,t,"sqd-collapsed"),this.toggleIcon&&this.toggle.removeChild(this.toggleIcon),this.toggleIcon=d.createSvg("sqd-smart-editor-toggle-icon",t?d.options:d.close),this.toggle.appendChild(this.toggleIcon)}destroy(){this.editor.destroy()}}class zt{static create(t,e,s){const n=Vt.create(t,e,s);n.setIsCollapsed(e.editor.isVisibleAtStart());const o=new zt(n,e.workspace);return n.bindToggleIsCollapsedClick((()=>o.toggleIsCollapsedClick())),o}constructor(t,e){this.view=t,this.workspaceApi=e}setIsCollapsed(t){this.isCollapsed=t,this.view.setIsCollapsed(t)}toggleIsCollapsedClick(){this.setIsCollapsed(!this.isCollapsed),this.workspaceApi.updateSize()}destroy(){this.view.destroy()}}class Lt{constructor(t){this.configuration=t}create(t,e){return zt.create(t,e,this.configuration)}}class At{static create(t,e){const s=l.element("div",{class:"sqd-scrollbox"});t.appendChild(s);const n=new At(s,e);return window.addEventListener("resize",n.onResizeHandler,!1),s.addEventListener("wheel",(t=>n.onWheel(t)),!1),s.addEventListener("touchstart",(t=>n.onTouchStart(t)),!1),s.addEventListener("mousedown",(t=>n.onMouseDown(t)),!1),n}constructor(t,e){this.root=t,this.viewport=e,this.onResizeHandler=()=>this.onResize(),this.onTouchMoveHandler=t=>this.onTouchMove(t),this.onMouseMoveHandler=t=>this.onMouseMove(t),this.onTouchEndHandler=t=>this.onTouchEnd(t),this.onMouseUpHandler=t=>this.onMouseUp(t)}setContent(t){this.content&&this.root.removeChild(this.content.element),t.classList.add("sqd-scrollbox-body"),this.root.appendChild(t),this.reload(t)}refresh(){this.content&&this.reload(this.content.element)}destroy(){window.removeEventListener("resize",this.onResizeHandler,!1)}reload(t){let e=Math.min(.7*this.viewport.clientHeight,t.clientHeight);e=Math.min(e,this.viewport.clientHeight-206),this.root.style.height=e+"px",t.style.top="0px",this.content={element:t,height:e}}onResize(){this.refresh()}onWheel(t){if(t.stopPropagation(),this.content){const e=t.deltaY>0?-25:25,s=this.getScrollTop();this.setScrollTop(s+e)}}onTouchStart(t){t.preventDefault(),this.startScroll(ot(t))}onMouseDown(t){this.startScroll(nt(t))}onTouchMove(t){t.preventDefault(),this.moveScroll(ot(t))}onMouseMove(t){t.preventDefault(),this.moveScroll(nt(t))}onTouchEnd(t){t.preventDefault(),this.stopScroll()}onMouseUp(t){t.preventDefault(),this.stopScroll()}startScroll(t){this.scroll||(window.addEventListener("touchmove",this.onTouchMoveHandler,!1),window.addEventListener("mousemove",this.onMouseMoveHandler,!1),window.addEventListener("touchend",this.onTouchEndHandler,!1),window.addEventListener("mouseup",this.onMouseUpHandler,!1)),this.scroll={startPositionY:t.y,startScrollTop:this.getScrollTop()}}moveScroll(t){if(this.scroll){const e=t.y-this.scroll.startPositionY;this.setScrollTop(this.scroll.startScrollTop+e)}}stopScroll(){this.scroll&&(window.removeEventListener("touchmove",this.onTouchMoveHandler,!1),window.removeEventListener("mousemove",this.onMouseMoveHandler,!1),window.removeEventListener("touchend",this.onTouchEndHandler,!1),window.removeEventListener("mouseup",this.onMouseUpHandler,!1),this.scroll=void 0)}getScrollTop(){return this.content&&this.content.element.style.top?parseInt(this.content.element.style.top):0}setScrollTop(t){if(this.content){const e=this.content.element.clientHeight-this.content.height,s=Math.max(Math.min(t,0),-e);this.content.element.style.top=s+"px"}}}const Ht=/^[a-zA-Z][a-zA-Z0-9_-]+$/;class Ft{static validate(t){if(!Ht.test(t))throw new Error(`Step type "${t}" contains not allowed characters`)}}class Ot{static create(t,e,s){const n=l.element("div",{class:`sqd-toolbox-item sqd-type-${e.type}`,title:e.name}),o=s.tryGetIconUrl(e),i=l.element("div",{class:"sqd-toolbox-item-icon"});if(o){const t=l.element("img",{class:"sqd-toolbox-item-icon-image",src:o});i.appendChild(t)}else i.classList.add("sqd-no-icon");const r=l.element("div",{class:"sqd-toolbox-item-text"});return r.textContent=e.name,n.appendChild(i),n.appendChild(r),t.appendChild(n),new Ot(n)}constructor(t){this.root=t}bindMousedown(t){this.root.addEventListener("mousedown",t,!1)}bindTouchstart(t){this.root.addEventListener("touchstart",t,!1)}bindContextMenu(t){this.root.addEventListener("contextmenu",t,!1)}}class Ut{static create(t,e,s){Ft.validate(e.type);const n=Ot.create(t,e,s),o=new Ut(e,s);return n.bindMousedown((t=>o.onMousedown(t))),n.bindTouchstart((t=>o.onTouchstart(t))),n.bindContextMenu((t=>o.onContextMenu(t))),o}constructor(t,e){this.step=t,this.api=e}onTouchstart(t){t.preventDefault(),1===t.touches.length&&(t.stopPropagation(),this.tryDrag(ot(t)))}onMousedown(t){t.stopPropagation(),0===t.button&&this.tryDrag(nt(t))}onContextMenu(t){t.preventDefault()}tryDrag(t){this.api.tryDrag(t,this.step)}}class Zt{static create(t,e){const s=l.element("div",{class:"sqd-toolbox"}),n=l.element("div",{class:"sqd-toolbox-header"}),o=l.element("div",{class:"sqd-toolbox-header-title"});o.innerText="Toolbox";const i=l.element("div",{class:"sqd-toolbox-body"}),r=l.element("input",{class:"sqd-toolbox-filter",type:"text",placeholder:"Search..."});s.appendChild(n),s.appendChild(i),n.appendChild(o),i.appendChild(r),t.appendChild(s);const a=At.create(i,t);return new Zt(n,i,r,a,e)}constructor(t,e,s,n,o){this.header=t,this.body=e,this.filterInput=s,this.scrollBoxView=n,this.api=o}bindToggleIsCollapsedClick(t){this.header.addEventListener("click",(function(e){e.preventDefault(),t()}),!1)}bindFilterInputChange(t){function e(e){t(e.target.value)}this.filterInput.addEventListener("keyup",e,!1),this.filterInput.addEventListener("blur",e,!1)}setIsCollapsed(t){l.toggleClass(this.body,t,"sqd-hidden"),this.headerToggleIcon&&this.header.removeChild(this.headerToggleIcon),this.headerToggleIcon=d.createSvg("sqd-toolbox-toggle-icon",t?d.expand:d.close),this.header.appendChild(this.headerToggleIcon),t||this.scrollBoxView.refresh()}setGroups(t){const e=l.element("div");t.forEach((t=>{const s=l.element("div",{class:"sqd-toolbox-group-title"});s.innerText=t.name,e.appendChild(s),t.steps.forEach((t=>Ut.create(e,t,this.api)))})),this.scrollBoxView.setContent(e)}destroy(){this.scrollBoxView.destroy()}}class $t{static create(t,e,s){const n=Zt.create(t,e.toolbox),o=new $t(n,s);return o.render(),o.setIsCollapsed(e.toolbox.isVisibleAtStart()),n.bindToggleIsCollapsedClick((()=>o.toggleIsCollapsedClick())),n.bindFilterInputChange((t=>o.onFilterInputChanged(t))),o}constructor(t,e){this.view=t,this.configuration=e}destroy(){this.view.destroy()}render(){const t=this.configuration.groups.map((t=>({name:t.name,steps:t.steps.filter((t=>!this.filter||t.name.toLowerCase().includes(this.filter)))}))).filter((t=>t.steps.length>0));this.view.setGroups(t)}setIsCollapsed(t){this.isCollapsed=t,this.view.setIsCollapsed(t)}toggleIsCollapsedClick(){this.setIsCollapsed(!this.isCollapsed)}onFilterInputChanged(t){this.filter=t.toLowerCase(),this.render()}}class Xt{constructor(t){this.configuration=t}create(t,e){return $t.create(t,e,this.configuration)}}class jt{static create(t){const e=l.svg("g"),s=l.svg("path",{class:"sqd-validation-error",d:"M 0 -11 l 11 22 l -22 0 Z"});l.translate(s,11,11),e.appendChild(s);const n=d.appendPath(e,"sqd-validation-error-icon-path",d.alert,12);return l.translate(n,5,7.5),t.appendChild(e),new jt(t,e,22,22)}constructor(t,e,s,n){this.parent=t,this.g=e,this.width=s,this.height=n}destroy(){this.parent.removeChild(this.g)}}class Qt{static create(t,e,s){return new Qt(t,e,s.configuration.validator)}constructor(t,e,s){this.parentElement=t,this.stepContext=e,this.validator=s,this.view=null}update(t){const e=!this.validator||this.validator(this.stepContext.step,this.stepContext.parentSequence);return e?this.view&&(this.view.destroy(),this.view=null):this.view||(this.view=jt.create(this.parentElement)),e&&t}resolveClick(){return null}}class Nt{constructor(){this.createBadge=Qt.create,this.createStartValue=()=>!0}}class Jt{static create(t,e,s){const{step:o}=e,i=l.svg("g",{class:`sqd-step-container sqd-type-${o.type}`});t.appendChild(i);const r=V.create(i,20,o.name,"primary"),a={sequence:o.sequence,depth:e.depth+1,isInputConnected:!0,isOutputConnected:e.isOutputConnected},d=X.create(i,a,s),c=r.width/2,h=Math.max(c-d.view.joinX,0)+20,p=Math.max(c-(d.view.width-d.view.joinX),0)+20,u=h+d.view.width+p,g=42+d.view.height,v=d.view.joinX+h;l.translate(r.g,v,0),l.translate(d.view.g,h,42);const w=s.configuration.iconUrlProvider?s.configuration.iconUrlProvider(o.componentType,o.type):null,m=M.createRectInput(i,v,0,w);B.createStraightJoin(i,new n(v,0),20);const C=L.create(i,[u],g);return new Jt(i,u,g,v,d,m,C)}constructor(t,e,s,n,o,i,r){this.g=t,this.width=e,this.height=s,this.joinX=n,this.sequenceComponent=o,this.inputView=i,this.regionView=r,this.sequenceComponents=[this.sequenceComponent],this.placeholders=null}getClientPosition(){return this.regionView.getClientPosition()}resolveClick(t){return this.regionView.resolveClick(t)||this.g.contains(t.element)?{type:j.selectStep}:null}setIsDragging(t){this.inputView.setIsHidden(t),this.sequenceComponent.setIsDragging(t)}setIsSelected(t){this.regionView.setIsSelected(t)}setIsDisabled(t){l.toggleClass(this.g,t,"sqd-disabled")}hasOutput(){return this.sequenceComponent.hasOutput}}class Wt{constructor(){this.componentType="container",this.createComponentView=Jt.create}getChildren(t){return{type:i.singleSequence,sequences:t.sequence}}}class Yt{create(){return{canCreate:()=>!0}}}const Gt=30;class _t{static create(t,e,s,n){const o=l.svg("g",{class:"sqd-root-start-stop"});t.appendChild(o);const i=X.create(o,{sequence:e,depth:0,isInputConnected:!0,isOutputConnected:!0},n),r=i.view,a=r.joinX-Gt/2,c=Gt+r.height,h=s?18:22,p=Kt(s?d.folder:d.play,h);l.translate(p,a,0),o.appendChild(p),l.translate(r.g,0,Gt);const u=Kt(s?d.folder:d.stop,h);l.translate(u,a,c),o.appendChild(u);let g=null,v=null;return s&&(g=O.create(o,a,0,Gt,Gt,H.out),v=O.create(o,a,c,Gt,Gt,H.out)),new _t(o,r.width,r.height+2*Gt,r.joinX,i,g,v)}constructor(t,e,s,n,o,i,r){this.g=t,this.width=e,this.height=s,this.joinX=n,this.component=o,this.startPlaceholderView=i,this.endPlaceholderView=r}destroy(){var t;null===(t=this.g.parentNode)||void 0===t||t.removeChild(this.g)}}function Kt(t,e){const s=Gt/2,n=l.svg("circle",{class:"sqd-root-start-stop-circle",cx:s,cy:s,r:s}),o=l.svg("g");o.appendChild(n);const i=(Gt-e)/2,r=d.appendPath(o,"sqd-root-start-stop-icon",t,e);return l.translate(r,i,i),o}class te{static create(t,e,s,n){const o=_t.create(t,e,!!s,n);return new te(o,s)}constructor(t,e){this.view=t,this.parentSequencePlaceIndicator=e}resolveClick(t){return this.view.component.resolveClick(t)}findById(t){return this.view.component.findById(t)}getPlaceholders(t){if(this.view.component.getPlaceholders(t),this.parentSequencePlaceIndicator&&this.view.startPlaceholderView&&this.view.endPlaceholderView){const{index:e,sequence:s}=this.parentSequencePlaceIndicator;t.push(new $(this.view.startPlaceholderView,s,e)),t.push(new $(this.view.endPlaceholderView,s,e+1))}}setIsDragging(t){this.view.component.setIsDragging(t),this.view.startPlaceholderView&&this.view.endPlaceholderView&&(this.view.startPlaceholderView.setIsVisible(t),this.view.endPlaceholderView.setIsVisible(t))}updateBadges(t){this.view.component.updateBadges(t)}}class ee{constructor(){this.create=te.create}}class se{static create(t,e,s){const{step:o}=e,i=l.svg("g",{class:`sqd-step-switch sqd-type-${o.type}`});t.appendChild(i);const r=Object.keys(o.branches),a=r.map((t=>{const n={sequence:o.branches[t],depth:e.depth+1,isInputConnected:!0,isOutputConnected:e.isOutputConnected};return X.create(i,n,s)})),d=r.map((t=>V.create(i,58,t,"secondary"))),c=V.create(i,20,o.name,"primary");let h=0;const p=a.map(((t,e)=>{const s=Math.max(d[e].width,40)/2,n=Math.max(s-t.view.joinX,0)+20,o=Math.max(s-(t.view.width-t.view.joinX),0)+20,i=t.view.width+n+o,r=t.view.joinX+n,a=h;return h+=i,{width:i,branchOffsetLeft:n,offsetX:a,joinX:r}})),u=Math.floor(r.length/2),g=p[u];let v=g.offsetX;r.length%2!=0&&(v+=g.joinX);const w=p.reduce(((t,e)=>t+e.width),0),m=Math.max(...a.map((t=>t.view.height))),C=c.width/2+20,f=Math.max(C-v,0),b=Math.max(C-(w-v),0),y=f+w+b,q=m+20+44+32,x=f+v;l.translate(c.g,x,0),a.forEach(((t,s)=>{const o=p[s],r=f+o.offsetX+o.branchOffsetLeft;if(l.translate(d[s].g,f+o.offsetX+o.joinX,0),l.translate(t.view.g,r,80),t.hasOutput&&e.isOutputConnected){const e=80+t.view.height,s=q-e-16;s>0&&B.createStraightJoin(i,new n(f+o.offsetX+o.joinX,e),s)}}));const S=s.configuration.iconUrlProvider?s.configuration.iconUrlProvider(o.componentType,o.type):null,I=M.createRectInput(i,x,0,S);if(B.createStraightJoin(i,new n(x,0),20),B.createJoins(i,new n(x,42),p.map((t=>new n(f+t.offsetX+t.joinX,58)))),e.isOutputConnected){const t=a.map(((t,e)=>t.hasOutput?e:null)).filter((t=>null!==t)).map((t=>new n(f+p[t].offsetX+p[t].joinX,80+m)));t.length>0&&B.createJoins(i,new n(x,q),t)}const D=p.map((t=>t.width));D[0]+=f,D[D.length-1]+=b;const k=L.create(i,D,q);return new se(i,y,q,x,a,k,I)}constructor(t,e,s,n,o,i,r){this.g=t,this.width=e,this.height=s,this.joinX=n,this.sequenceComponents=o,this.regionView=i,this.inputView=r,this.placeholders=null}getClientPosition(){return this.regionView.getClientPosition()}resolveClick(t){return this.regionView.resolveClick(t)||this.g.contains(t.element)?{type:j.selectStep}:null}setIsDragging(t){var e;null===(e=this.inputView)||void 0===e||e.setIsHidden(t)}setIsSelected(t){this.regionView.setIsSelected(t)}setIsDisabled(t){l.toggleClass(this.g,t,"sqd-disabled")}hasOutput(){return this.sequenceComponents.some((t=>t.hasOutput))}}class ne{constructor(){this.componentType="switch",this.createComponentView=se.create}getChildren(t){return{type:i.branches,sequences:t.branches}}}class oe{constructor(){this.componentType="task"}createComponentView(t,e,s){return N.create(t,e,s.configuration,!1)}getChildren(){return null}}class ie{static resolve(t,e){const s={};return function(t,e){for(const s of e)s.steps&&(t.steps=(t.steps||[]).concat(s.steps)),s.badges&&(t.badges=(t.badges||[]).concat(s.badges)),s.uiComponents&&(t.uiComponents=(t.uiComponents||[]).concat(s.uiComponents)),s.draggedComponent&&(t.draggedComponent=s.draggedComponent),s.wheelController&&(t.wheelController=s.wheelController),s.placeholderController&&(t.placeholderController=s.placeholderController),s.viewportController&&(t.viewportController=s.viewportController),s.rootComponent&&(t.rootComponent=s.rootComponent),s.daemons&&(t.daemons=(t.daemons||[]).concat(s.daemons))}(s,t||[]),function(t,e){t.steps||(t.steps=[]),t.steps.push(new Wt),t.steps.push(new ne),t.steps.push(new oe),t.badges||(t.badges=[]),t.badges.unshift(new Nt),t.draggedComponent||(t.draggedComponent=new St),t.uiComponents||(t.uiComponents=[]),e.controlBar&&t.uiComponents.push(new Pt),e.editors&&t.uiComponents.push(new Lt(e.editors)),e.toolbox&&t.uiComponents.push(new Xt(e.toolbox)),t.wheelController||(t.wheelController=new _),t.placeholderController||(t.placeholderController=new Yt),t.viewportController||(t.viewportController=new et),t.rootComponent||(t.rootComponent=new ee),t.daemons||(t.daemons=[]),t.daemons.push(new Rt)}(s,e),s}}class re{static create(t,e,s){if(!t)throw new Error("Placeholder is not set");if(n=t,document.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_DISCONNECTED)throw new Error("Placeholder is not attached to the DOM");var n;if(!e)throw new Error("Start definition is not set");if(!s)throw new Error("Configuration is not set");const o=s;!function(t){if(void 0===t.controlBar)throw new Error('The "controlBar" property is not defined in the configuration');if(t.toolbox&&void 0!==t.toolbox.isHidden)throw new Error('The "isHidden" property in the toolbox configuration is depreciated');if(t.editors&&void 0!==t.editors.isHidden)throw new Error('The "isHidden" property in the editors configuration is depreciated')}(o);const i=ie.resolve(s.extensions,o),r=pt.create(t,e,o,i),a=x.create(r),l=qt.create(t,r,o,a),d=new re(l,r.state,r.stepsTraverser,a);return l.workspace.onReady.subscribe((()=>d.onReady.forward())),r.state.onDefinitionChanged.subscribe((()=>{setTimeout((()=>d.onDefinitionChanged.forward(r.state.definition)))})),r.state.onSelectedStepIdChanged.subscribe((()=>d.onSelectedStepIdChanged.forward(r.state.selectedStepId))),d}constructor(t,s,n,o){this.view=t,this.state=s,this.stepsTraverser=n,this.api=o,this.onReady=new e,this.onDefinitionChanged=new e,this.onSelectedStepIdChanged=new e}getDefinition(){return this.state.definition}isValid(){return this.view.workspace.isValid}isReadonly(){return this.state.isReadonly}setIsReadonly(t){this.state.setIsReadonly(t)}getSelectedStepId(){return this.state.selectedStepId}selectStepById(t){this.state.setSelectedStepId(t)}clearSelectedStep(){this.state.setSelectedStepId(null)}moveViewportToStep(t){this.api.viewport.moveViewportToStep(t)}moveViewPortToStep(t){this.moveViewportToStep(t)}updateBadges(){this.api.workspace.updateBadges()}getStepParents(t){return this.stepsTraverser.getParents(this.state.definition,t)}destroy(){this.view.destroy()}}class ae{static create(){return new ae}constructor(){this.api=null,this.isUndoRedoSupported=()=>this.getApi().isUndoRedoSupported(),this.tryUndo=()=>this.getApi().tryUndo(),this.canUndo=()=>this.getApi().canUndo(),this.tryRedo=()=>this.getApi().tryRedo(),this.canRedo=()=>this.getApi().canRedo(),this.resetViewPort=()=>{this.getApi().resetViewport()},this.resetViewport=()=>{this.getApi().resetViewport()},this.zoomIn=()=>{this.getApi().zoomIn()},this.zoomOut=()=>{this.getApi().zoomOut()},this.toggleIsDragDisabled=()=>{this.getApi().toggleIsDragDisabled()},this.canDelete=()=>this.getApi().canDelete(),this.tryDelete=()=>this.getApi().tryDelete(),this.isReady=()=>!!this.api}setApi(t){if(t&&this.api)throw new Error("Api is already set");this.api=t}getApi(){if(!this.api)throw new Error("Designer is not ready yet");return this.api}}class le{static create(t,e){return e.controller.setApi(t.controlBar),new le(e.controller)}constructor(t){this.controller=t}destroy(){this.controller.setApi(null)}}class de{constructor(t){this.configuration=t}create(t){return le.create(t,this.configuration)}}class ce{static create(t,e){if(!e.placeholder)throw new Error("Placeholder is not set");const s=new ce(t,e);return s.setPlaceholder(e.placeholder),s}constructor(t,e){this.api=t,this.configuration=e}setPlaceholder(t){this.editor=P.create(t,this.api,"sqd-external-editor sqd-external-step-editor",this.configuration.stepEditorProvider,"sqd-external-editor sqd-external-global-editor",this.configuration.globalEditorProvider)}destroy(){this.editor&&this.editor.destroy()}}class he{static create(){return new he}constructor(){this.api=null,this.tryDrag=(t,e,s)=>this.getApi().tryDrag(new n(t,e),s),this.isReady=()=>!!this.api}setApi(t){if(t&&this.api)throw new Error("Api is already set");this.api=t}getApi(){if(!this.api)throw new Error("Designer is not ready yet");return this.api}}class pe{static create(t,e){return e.controller.setApi(t.toolbox),new pe(e.controller)}constructor(t){this.controller=t}destroy(){this.controller.setApi(null)}}class ue{constructor(t){this.configuration=t}create(t){return pe.create(t,this.configuration)}}class ge{static create(t){return new ge(t)}constructor(t){this.configuration=t,this.daemons=[new de(this.configuration)]}}class ve{constructor(t){this.configuration=t}create(t){return ce.create(t,this.configuration)}}class we{static create(t){return new we(t)}constructor(t){this.configuration=t,this.daemons=[new ve(this.configuration)]}}class me{static create(t){return new me(t)}constructor(t){this.configuration=t,this.daemons=[new ue(this.configuration)]}}var Ce=s(62),fe=s.n(Ce),be=s(36),ye=s.n(be),qe=s(793),xe=s.n(qe),Se=s(892),Ie=s.n(Se),De=s(173),ke=s.n(De),Ee=s(464),Pe=s.n(Ee),Me=s(446),Be={};Be.styleTagTransform=Pe(),Be.setAttributes=Ie(),Be.insert=xe().bind(null,"head"),Be.domAPI=ye(),Be.insertStyleElement=ke(),fe()(Me.Z,Be),Me.Z&&Me.Z.locals&&Me.Z.locals;var Te=s(929),Re={};Re.styleTagTransform=Pe(),Re.setAttributes=Ie(),Re.insert=xe().bind(null,"head"),Re.domAPI=ye(),Re.insertStyleElement=ke(),fe()(Te.Z,Re),Te.Z&&Te.Z.locals&&Te.Z.locals;const Ve=he.create(),ze=ae.create();function Le(t){switch(t.target.getAttribute("data-action")){case"zoomIn":ze.zoomIn();break;case"zoomOut":ze.zoomOut();break;case"resetViewport":ze.resetViewport();break;case"undo":ze.tryUndo();break;case"redo":ze.tryRedo();break;case"delete":ze.tryDelete()}}function Ae(t){t.preventDefault();const e=t,s=e.touches?e.touches[0]:t;Ve.tryDrag(s.clientX,s.clientY,{componentType:"task",name:"test",properties:{},type:"task"})}function He(){const t=document.createElement("div");return t.innerText="Please select any step...",t}function Fe(t,e){const s=document.createElement("div");s.innerHTML='<h4>Name</h4> <input type="text" />';const n=s.querySelector("input");return n.value=t.name,n.addEventListener("input",(()=>{t.name=n.value,e.notifyNameChanged()})),s}document.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("designer");document.querySelectorAll(".control-bar-button").forEach((t=>{t.addEventListener("click",Le,!1)}));const e=document.querySelector(".custom-toolbox-item");e&&(e.addEventListener("touchstart",Ae,!1),e.addEventListener("mousedown",Ae,!1));const s=document.querySelector(".custom-editor-placeholder"),n={undoStackSize:10,steps:{},editors:!1,toolbox:!1,controlBar:!1,extensions:[ge.create({controller:ze}),me.create({controller:Ve}),we.create({placeholder:s,globalEditorProvider:He,stepEditorProvider:Fe})]};re.create(t,{properties:{},sequence:[{componentType:"task",id:"0x1",name:"test",properties:{},type:"task"}]},n)}))})()})();