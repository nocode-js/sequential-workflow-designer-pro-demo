(()=>{"use strict";var t={75:(t,e,s)=>{s.d(e,{Z:()=>a});var i=s(81),o=s.n(i),n=s(645),r=s.n(n)()(o());r.push([t.id,".sqd-custom-dragged-component{border-radius:4px;box-sizing:border-box;box-shadow:0 2px 2px rgba(0,0,0,.15)}.sqd-custom-dragged-component svg{width:80%;height:80%;margin:10%}.sqd-custom-dragged-component.sqd-style-atomic{border:1px solid #429288;background:#67d1bf}.sqd-custom-dragged-component.sqd-style-conditional{border:1px solid #9da3ae;background:#fff}.sqd-handle-circle{fill:#8b8c90}.sqd-statistics-rect{fill:#525d6b}.sqd-statistics-item-rect{fill:#656e7a}.sqd-statistics-item-value-text{fill:#fff;font-weight:bold}.sqd-statistics-item-description-text{fill:#fff;font-size:12px}",""]);const a=r},883:(t,e,s)=>{s.d(e,{Z:()=>a});var i=s(81),o=s.n(i),n=s(645),r=s.n(n)()(o());r.push([t.id,".sqd-theme-flat .sqd-toolbox{background:#fff;box-shadow:0 0 8px rgba(0,0,0,.15),0 2px 4px rgba(0,0,0,.15)}.sqd-theme-flat .sqd-toolbox-header-title{color:#000}.sqd-theme-flat .sqd-toolbox-filter{background:#fff;color:#000;border:1px solid #c3c3c3}.sqd-theme-flat .sqd-toolbox-filter:focus{border-color:#939393}.sqd-theme-flat .sqd-toolbox-group-title{color:#000;background:#e5e5e5}.sqd-theme-flat .sqd-toolbox-item{color:#000;border:1px solid #c3c3c3;box-shadow:0 2px 2px rgba(0,0,0,.15);background:#fff}.sqd-theme-flat .sqd-toolbox-item:hover{border-color:#939393;background:#fff}.sqd-theme-flat .sqd-toolbox-item .sqd-toolbox-item-icon.sqd-no-icon{background:#c6c6c6}.sqd-theme-flat .sqd-control-bar{background:#fff;box-shadow:0 0 2px #666}.sqd-theme-flat .sqd-control-bar-button{border:1px solid #c3c3c3;background:#fff}.sqd-theme-flat .sqd-control-bar-button:hover{border-color:#939393;background:#fff}.sqd-theme-flat .sqd-control-bar-button .sqd-icon-path{fill:#000}.sqd-theme-flat .sqd-control-bar-button.sqd-delete .sqd-icon-path{fill:#e01a24}.sqd-theme-flat .sqd-smart-editor{background:#fff;box-shadow:0 0 8px rgba(0,0,0,.15)}.sqd-theme-flat .sqd-smart-editor-toggle{background:#fff;box-shadow:0 0 8px rgba(0,0,0,.15)}.sqd-theme-flat.sqd-context-menu{background:#fff;box-shadow:0 0 8px rgba(0,0,0,.2)}.sqd-theme-flat .sqd-context-menu-group{color:#888}.sqd-theme-flat .sqd-context-menu-item{color:#000}.sqd-theme-flat .sqd-context-menu-item:hover{background:#eee}.sqd-theme-flat.sqd-designer{background:#fff}.sqd-theme-flat .sqd-line-grid-path{stroke:#eceff1;stroke-width:1}.sqd-theme-flat .sqd-join{stroke-width:2;stroke:#4b5563}.sqd-theme-flat .sqd-region{stroke:#cecece;stroke-width:0;stroke-dasharray:3}.sqd-theme-flat .sqd-region.sqd-selected{stroke:#14b8a6;stroke-width:2;stroke-dasharray:0}.sqd-theme-flat .sqd-placeholder .sqd-placeholder-rect{fill:#dee9fc;stroke:#4b84ee;stroke-width:2;stroke-dasharray:3}.sqd-theme-flat .sqd-placeholder.sqd-hover .sqd-placeholder-rect{fill:#4b84ee}.sqd-theme-flat .sqd-placeholder-icon-path{fill:#fff}.sqd-theme-flat .sqd-placeholder.sqd-hover .sqd-placeholder-icon-path{fill:#fff}.sqd-theme-flat .sqd-root-start-stop-circle{fill:#4b5563}.sqd-theme-flat .sqd-root-start-stop-icon{fill:#fff}.sqd-theme-flat .sqd-step-task .sqd-step-task-rect{fill:#fff;stroke-width:1;stroke:#9da3ae;filter:drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, 0.15))}.sqd-theme-flat .sqd-step-task .sqd-step-task-rect.sqd-selected{stroke:#14b8a6;stroke-width:2}.sqd-theme-flat .sqd-step-task .sqd-step-task-text{fill:#000}.sqd-theme-flat .sqd-step-task .sqd-step-task-empty-icon{fill:#c6c6c6}.sqd-theme-flat .sqd-step-task .sqd-input{fill:#fff;stroke-width:2;stroke:#4b5563}.sqd-theme-flat .sqd-step-task .sqd-output{fill:#fff;stroke-width:2;stroke:#4b5563}.sqd-theme-flat .sqd-step-switch>.sqd-label-primary>.sqd-label-text{fill:#000}.sqd-theme-flat .sqd-step-switch>.sqd-label-primary>.sqd-label-rect{fill:#fff;stroke-width:1;stroke:#9da3ae;filter:drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, 0.25))}.sqd-theme-flat .sqd-step-switch>.sqd-label-secondary>.sqd-label-rect{fill:#4b5563;stroke-width:0}.sqd-theme-flat .sqd-step-switch>.sqd-label-secondary>.sqd-label-text{fill:#fff}.sqd-theme-flat .sqd-step-switch>g>.sqd-input{fill:#fff;stroke-width:2;stroke:#4b5563}.sqd-theme-flat .sqd-step-container>.sqd-label>.sqd-label-text{fill:#fff}.sqd-theme-flat .sqd-step-container>.sqd-label>.sqd-label-rect{fill:#2411db}.sqd-theme-flat .sqd-step-container>g>.sqd-input{fill:#fff;stroke-width:2;stroke:#4b5563}.sqd-theme-flat .sqd-path-bar{background:#fff;box-shadow:0 0 8px rgba(0,0,0,.15),0 2px 4px rgba(0,0,0,.15)}.sqd-theme-flat .sqd-path-bar-item{color:#000}.sqd-theme-flat .sqd-path-bar-item:hover{border-color:#939393}.sqd-theme-flat .sqd-path-bar-separator{color:#d0d0d0}.sqd-theme-flat .sqd-path-bar-reset-button{border:1px solid rgba(0,0,0,0)}.sqd-theme-flat .sqd-path-bar-reset-button:hover{border-color:#d3d3d3}.sqd-theme-flat .sqd-path-bar-reset-button .sqd-icon-path{fill:#000}.sqd-root-minimal-empty{stroke-width:2;stroke-dasharray:3;stroke:#2c18df}.sqd-theme-flat .sqd-grid-dot{fill:#ccc}.sqd-theme-flat .sqd-cross-grid-path{stroke:#e3e3e3;stroke-width:1}.sqd-theme-flat .sqd-clickable-placeholder-rect{fill:#4b5563}.sqd-theme-flat .sqd-clickable-placeholder:hover .sqd-clickable-placeholder-rect{fill:#4b84ee}.sqd-theme-flat .sqd-clickable-placeholder-icon{fill:#fff}.sqd-theme-flat .sqd-step-icon .sqd-step-icon-circle{fill:#fff;stroke:#c3c3c3;stroke-width:1;filter:drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, 0.15))}.sqd-theme-flat .sqd-step-icon .sqd-step-icon-circle.sqd-selected{stroke:#ed4800;stroke-width:2}.sqd-theme-flat .sqd-step-icon>.sqd-input{fill:#fff;stroke-width:2;stroke:#000}.sqd-theme-flat .sqd-step-icon>.sqd-output{fill:#000;stroke-width:0}.sqd-theme-flat .sqd-step-large-task .sqd-large-task-rect{fill:#fff;stroke:#9da3ae;stroke-width:1;filter:drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, 0.15))}.sqd-theme-flat .sqd-step-large-task .sqd-large-task-rect.sqd-selected{stroke:#14b8a6;stroke-width:2}.sqd-theme-flat .sqd-step-large-task .sqd-large-task-name-text{fill:#000}.sqd-theme-flat .sqd-step-large-task .sqd-large-task-description-text{fill:#8b8c91}.sqd-theme-flat .sqd-step-large-task .sqd-large-task-circle{stroke:#cccfd3;stroke-width:1}.sqd-theme-flat .sqd-step-large-task .sqd-input{fill:#fff;stroke-width:2;stroke:#4b5563}.sqd-theme-flat .sqd-step-large-task .sqd-output{fill:#fff;stroke-width:2;stroke:#4b5563}.sqd-theme-flat .sqd-step-folder .sqd-step-folder-rect{fill:#fad876;stroke:#caae5c;stroke-width:1;filter:drop-shadow(0 1.5px 1.5px rgba(0, 0, 0, 0.15))}.sqd-theme-flat .sqd-step-folder .sqd-step-folder-rect.sqd-selected{stroke:#ed4800;stroke-width:2}.sqd-theme-flat .sqd-step-folder .sqd-step-folder-tab-rect{fill:#7c631b}.sqd-theme-flat .sqd-step-folder .sqd-step-folder-empty-icon{fill:#7c631b}.sqd-theme-flat .sqd-step-folder .sqd-step-folder-button-text{fill:#7c631b}.sqd-theme-flat .sqd-step-folder .sqd-step-folder-button-rect{stroke-width:1;stroke:#7c631b}.sqd-theme-flat .sqd-step-folder .sqd-step-folder-button-rect:hover{stroke:#caae5c}.sqd-theme-flat .sqd-step-folder .sqd-step-folder-button-icon-path{fill:#7c631b}.sqd-theme-flat .sqd-step-folder .sqd-input{fill:#fff;stroke-width:2;stroke:#000}.sqd-theme-flat .sqd-step-folder .sqd-output{fill:#000;stroke-width:0}.sqd-theme-flat .sqd-counter-badge-text{fill:#fff}.sqd-theme-flat .sqd-counter-badge-rect{fill:#9b9b9b}.sqd-theme-flat .sqd-loading-badge-loading .sqd-loading-badge-circle{fill:#9b9b9b}.sqd-theme-flat .sqd-loading-badge-loading .sqd-loading-badge-icon{fill:#fff}.sqd-theme-flat .sqd-loading-badge-loaded .sqd-loading-badge-circle{fill:#269526}.sqd-theme-flat .sqd-loading-badge-loaded .sqd-loading-badge-icon{fill:#fff}.sqd-theme-flat .sqd-loading-badge-error .sqd-loading-badge-circle{fill:#d93a3a}.sqd-theme-flat .sqd-loading-badge-error .sqd-loading-badge-icon{fill:#fff}",""]);const a=r},344:(t,e,s)=>{s.d(e,{Z:()=>a});var i=s(81),o=s.n(i),n=s(645),r=s.n(n)()(o());r.push([t.id,".sqd-path-bar{position:absolute;bottom:68px;padding:4px;left:10px;z-index:20;border-radius:10px}.sqd-path-bar-reset-button{display:inline-block;vertical-align:middle;width:26px;height:26px;border-radius:5px;cursor:pointer}.sqd-path-bar-reset-button-icon{width:20px;height:20px;margin:3px 0 0 3px}.sqd-path-bar-items{margin-left:2px;display:inline-block;vertical-align:middle}.sqd-path-bar-item{display:inline-block;padding:6px;border-radius:5px;cursor:pointer;border:1px solid rgba(0,0,0,0)}.sqd-path-bar-separator{display:inline-block;padding:0 2px}.sqd-large-task-name-text{text-anchor:left;dominant-baseline:central;font-size:16px}.sqd-large-task-description-text{text-anchor:left;dominant-baseline:central;font-size:12px}.sqd-large-task-circle{fill:none}.sqd-step-folder-name{text-anchor:left;dominant-baseline:central}.sqd-step-folder-button-text{font-size:11px;text-anchor:left;dominant-baseline:central}.sqd-step-folder-button-rect{fill:rgba(0,0,0,0);cursor:pointer}.sqd-grid-dot{stroke:none}.sqd-root-minimal-empty{fill:rgba(0,0,0,0)}.sqd-counter-badge.sqd-clickable{pointer-events:bounding-box;cursor:pointer}.sqd-counter-badge.sqd-clickable:hover{opacity:.7}.sqd-counter-badge-text{font-size:11px;text-anchor:middle;dominant-baseline:central}.sqd-loading-badge-icon-loop{transform-box:fill-box;transform-origin:bottom;animation:sqd-loading-badge-animation 700ms infinite linear}@keyframes sqd-loading-badge-animation{100%{transform:rotate(360deg)}}.sqd-clickable-placeholder{pointer-events:bounding-box;cursor:pointer}",""]);const a=r},375:(t,e,s)=>{s.d(e,{Z:()=>a});var i=s(81),o=s.n(i),n=s(645),r=s.n(n)()(o());r.push([t.id,".sqd-designer{position:relative;display:flex;width:100%;height:100%}.sqd-designer,.sqd-drag,.sqd-context-menu{font-size:13px;line-height:1em}.sqd-hidden{display:none !important}.sqd-disabled{opacity:.25}.sqd-toolbox,.sqd-toolbox-filter{font-size:11px;line-height:1.2em}.sqd-toolbox{position:absolute;top:10px;left:10px;z-index:20;box-sizing:border-box;border-radius:10px;width:130px;user-select:none}.sqd-toolbox-header{position:relative;padding:15px 10px;cursor:pointer}.sqd-toolbox-header-title{display:block;font-size:1.2em;line-height:1em;font-weight:bold}.sqd-toolbox-toggle-icon{position:absolute;top:50%;right:10px;width:16px;height:16px;margin:-8px 0 0}.sqd-toolbox-header:hover .sqd-toolbox-toggle-icon{opacity:.6}.sqd-scrollbox{position:relative;overflow:hidden}.sqd-scrollbox-body{position:absolute;top:0;left:0}.sqd-toolbox-filter{display:block;box-sizing:border-box;padding:6px 8px;outline:none;width:110px;margin:0 10px 10px;box-sizing:border-box;border-radius:10px}.sqd-toolbox-group-title{text-align:center;padding:5px 0;margin:0 10px 10px;border-radius:10px}.sqd-toolbox-item{position:relative;border-radius:5px;box-sizing:border-box;margin:0 10px 10px;width:110px;cursor:move}.sqd-toolbox-item-icon{position:absolute;top:50%;left:5px;margin-top:-10px;width:20px;height:20px}.sqd-toolbox-item-icon.sqd-no-icon{border-radius:4px}.sqd-toolbox-item-icon-image{width:100%;height:100%}.sqd-toolbox-item-text{position:relative;display:block;padding:10px 10px 10px 30px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.sqd-drag{position:absolute;z-index:9999999;pointer-events:none}.sqd-control-bar{position:absolute;bottom:10px;left:10px;z-index:20;padding:8px 0 8px 8px;border-radius:10px;white-space:nowrap}.sqd-control-bar-button{display:inline-block;width:32px;height:32px;border-radius:5px;margin-right:8px;cursor:pointer;box-sizing:border-box}.sqd-control-bar-button-icon{width:24px;height:24px;margin:3px 0 0 3px}.sqd-control-bar-button.sqd-disabled .sqd-control-bar-button-icon{opacity:.2}.sqd-smart-editor-toggle{position:absolute;top:0;z-index:29;width:36px;height:64px;border-bottom-left-radius:10px;cursor:pointer}.sqd-smart-editor-toggle-icon{position:absolute;top:50%;left:50%;width:24px;height:24px;margin:-12px 0 0 -12px}.sqd-smart-editor-toggle:hover .sqd-smart-editor-toggle-icon{opacity:.6}.sqd-smart-editor{z-index:30}.sqd-layout-desktop .sqd-smart-editor{position:relative;width:300px}.sqd-layout-desktop .sqd-smart-editor-toggle{right:300px}.sqd-layout-desktop .sqd-smart-editor-toggle.sqd-collapsed{right:0}.sqd-layout-mobile .sqd-smart-editor{position:absolute;top:0;right:0;bottom:0;left:41px}.sqd-layout-mobile .sqd-smart-editor-toggle{left:5px}.sqd-layout-mobile .sqd-smart-editor-toggle.sqd-collapsed{left:auto;right:0}.sqd-context-menu{position:absolute;z-index:2000000000;border-radius:4px;overflow:hidden;padding:5px}.sqd-context-menu-group,.sqd-context-menu-item{width:130px;padding:8px 10px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.sqd-context-menu-group{font-size:11px;line-height:1em}.sqd-context-menu-item{border-radius:5px;cursor:pointer;transition:background 70ms}.sqd-workspace{flex:1;position:relative;display:block;user-select:none}.sqd-workspace-canvas{position:absolute;top:0;left:0;cursor:move}.sqd-label-text{text-anchor:middle;dominant-baseline:central}.sqd-placeholder .sqd-placeholder-rect{transition:fill 100ms}.sqd-step-task-text{text-anchor:left;dominant-baseline:central}",""]);const a=r},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var s="",i=void 0!==e[5];return e[4]&&(s+="@supports (".concat(e[4],") {")),e[2]&&(s+="@media ".concat(e[2]," {")),i&&(s+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),s+=t(e),i&&(s+="}"),e[2]&&(s+="}"),e[4]&&(s+="}"),s})).join("")},e.i=function(t,s,i,o,n){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(i)for(var a=0;a<this.length;a++){var d=this[a][0];null!=d&&(r[d]=!0)}for(var l=0;l<t.length;l++){var c=[].concat(t[l]);i&&r[c[0]]||(void 0!==n&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=n),s&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=s):c[2]=s),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),e.push(c))}},e}},81:t=>{t.exports=function(t){return t[1]}},379:t=>{var e=[];function s(t){for(var s=-1,i=0;i<e.length;i++)if(e[i].identifier===t){s=i;break}return s}function i(t,i){for(var n={},r=[],a=0;a<t.length;a++){var d=t[a],l=i.base?d[0]+i.base:d[0],c=n[l]||0,h="".concat(l," ").concat(c);n[l]=c+1;var p=s(h),u={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(-1!==p)e[p].references++,e[p].updater(u);else{var g=o(u,i);i.byIndex=a,e.splice(a,0,{identifier:h,updater:g,references:1})}r.push(h)}return r}function o(t,e){var s=e.domAPI(e);return s.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;s.update(t=e)}else s.remove()}}t.exports=function(t,o){var n=i(t=t||[],o=o||{});return function(t){t=t||[];for(var r=0;r<n.length;r++){var a=s(n[r]);e[a].references--}for(var d=i(t,o),l=0;l<n.length;l++){var c=s(n[l]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}n=d}}},569:t=>{var e={};t.exports=function(t,s){var i=function(t){if(void 0===e[t]){var s=document.querySelector(t);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(t){s=null}e[t]=s}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(s)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,s)=>{t.exports=function(t){var e=s.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(s){!function(t,e,s){var i="";s.supports&&(i+="@supports (".concat(s.supports,") {")),s.media&&(i+="@media ".concat(s.media," {"));var o=void 0!==s.layer;o&&(i+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),i+=s.css,o&&(i+="}"),s.media&&(i+="}"),s.supports&&(i+="}");var n=s.sourceMap;n&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,s)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function s(i){var o=e[i];if(void 0!==o)return o.exports;var n=e[i]={id:i,exports:{}};return t[i](n,n.exports,s),n.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.nc=void 0,(()=>{const t=[function(t){const s=t.sequence;return s?{type:e.sequence,items:s}:null},function(t){const s=t.branches;return s?{type:e.branches,items:s}:null}];var e,i,o,n,r,a;!function(t){t[t.sequence=1]="sequence",t[t.branches=2]="branches"}(e||(e={}));class d{constructor(e){this.resolvers=e?e.concat(t):t}getChildren(t){const e=this.resolvers.length;for(let s=0;s<e;s++){const e=this.resolvers[s](t);if(e)return e}return null}getParents(t,e){const s=[];let i=null,o=null;if(Array.isArray(e)?i=e:o="string"==typeof e?e:e.id,this.find(t.sequence,i,o,s))return s.reverse(),s.map((t=>"string"==typeof t?t:t.step));throw new Error(o?`Cannot get parents of step: ${o}`:"Cannot get parents of sequence")}findParentSequence(t,e){const s=[];return this.find(t.sequence,null,e,s)?s[0]:null}getParentSequence(t,e){const s=this.findParentSequence(t,e);if(!s)throw new Error(`Cannot find step by id: ${e}`);return s}findById(t,e){const s=this.findParentSequence(t,e);return s?s.step:null}getById(t,e){return this.getParentSequence(t,e).step}forEach(t,e){this.iterateSequence(t.sequence,e)}forEachSequence(t,e){this.iterateSequence(t,e)}forEachChildren(t,e){this.iterateStep(t,e)}find(t,s,i,o){if(s&&t===s)return!0;const n=t.length;for(let r=0;r<n;r++){const n=t[r];if(i&&n.id===i)return o.push({step:n,index:r,parentSequence:t}),!0;const a=this.getChildren(n);if(a)switch(a.type){case e.sequence:{const t=a.items;if(this.find(t,s,i,o))return o.push({step:n,index:r,parentSequence:t}),!0}break;case e.branches:{const t=a.items,e=Object.keys(t);for(const a of e){const e=t[a];if(this.find(e,s,i,o))return o.push(a),o.push({step:n,index:r,parentSequence:e}),!0}}break;default:throw new Error(`Not supported step children type: ${a.type}`)}}return!1}iterateSequence(t,e){const s=t.length;for(let i=0;i<s;i++){const s=t[i];if(!1===e(s,i,t))return!1;if(!this.iterateStep(s,e))return!1}return!0}iterateStep(t,s){const i=this.getChildren(t);if(i)switch(i.type){case e.sequence:{const t=i.items;if(!this.iterateSequence(t,s))return!1}break;case e.branches:{const t=Object.values(i.items);for(const e of t)if(!this.iterateSequence(e,s))return!1}break;default:throw new Error(`Not supported step children type: ${i.type}`)}return!0}}class l{constructor(t,e,s,i){this.state=t,this.historyController=e,this.definitionModifier=s,this.viewportApi=i}subscribe(t){this.state.onIsReadonlyChanged.subscribe(t),this.state.onSelectedStepIdChanged.subscribe(t),this.state.onIsDragDisabledChanged.subscribe(t),this.isUndoRedoSupported()&&this.state.onDefinitionChanged.subscribe(t)}resetViewport(){this.viewportApi.resetViewport()}zoomIn(){this.viewportApi.zoom(!0)}zoomOut(){this.viewportApi.zoom(!1)}isDragDisabled(){return this.state.isDragDisabled}toggleIsDragDisabled(){this.state.toggleIsDragDisabled()}isUndoRedoSupported(){return!!this.historyController}tryUndo(){return!(!this.canUndo()||!this.historyController||(this.historyController.undo(),0))}canUndo(){return!!this.historyController&&this.historyController.canUndo()&&!this.state.isReadonly&&!this.state.isDragging}tryRedo(){return!(!this.canRedo()||!this.historyController||(this.historyController.redo(),0))}canRedo(){return!!this.historyController&&this.historyController.canRedo()&&!this.state.isReadonly&&!this.state.isDragging}tryDelete(){return!(!this.canDelete()||!this.state.selectedStepId||(this.definitionModifier.tryDelete(this.state.selectedStepId),0))}canDelete(){return!!this.state.selectedStepId&&!this.state.isReadonly&&!this.state.isDragging&&this.definitionModifier.isDeletable(this.state.selectedStepId)}}class c{constructor(){this.listeners=[]}subscribe(t){this.listeners.push(t)}unsubscribe(t){const e=this.listeners.indexOf(t);if(!(e>=0))throw new Error("Unknown listener");this.listeners.splice(e,1)}forward(t){this.listeners.length>0&&this.listeners.forEach((e=>e(t)))}count(){return this.listeners.length}}class h{constructor(t,e){this.x=t,this.y=e}add(t){return new h(this.x+t.x,this.y+t.y)}subtract(t){return new h(this.x-t.x,this.y-t.y)}multiplyByScalar(t){return new h(this.x*t,this.y*t)}divideByScalar(t){return new h(this.x/t,this.y/t)}round(){return new h(Math.round(this.x),Math.round(this.y))}distance(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}}!function(t){t[t.stepNameChanged=1]="stepNameChanged",t[t.stepPropertyChanged=2]="stepPropertyChanged",t[t.stepChildrenChanged=3]="stepChildrenChanged",t[t.stepDeleted=4]="stepDeleted",t[t.stepMoved=5]="stepMoved",t[t.stepInserted=6]="stepInserted",t[t.globalPropertyChanged=7]="globalPropertyChanged",t[t.rootReplaced=8]="rootReplaced"}(i||(i={}));class p{constructor(t,e,s,i){this.definition=t,this.isReadonly=e,this.isToolboxCollapsed=s,this.isEditorCollapsed=i,this.onViewportChanged=new c,this.onSelectedStepIdChanged=new c,this.onFolderPathChanged=new c,this.onIsReadonlyChanged=new c,this.onIsDraggingChanged=new c,this.onIsDragDisabledChanged=new c,this.onDefinitionChanged=new c,this.onIsToolboxCollapsedChanged=new c,this.onIsEditorCollapsedChanged=new c,this.viewport={position:new h(0,0),scale:1},this.selectedStepId=null,this.folderPath=[],this.isDragging=!1,this.isDragDisabled=!1}setSelectedStepId(t){this.selectedStepId!==t&&(this.selectedStepId=t,this.onSelectedStepIdChanged.forward(t))}pushStepIdToFolderPath(t){this.folderPath.push(t),this.onFolderPathChanged.forward(this.folderPath)}setFolderPath(t){this.folderPath=t,this.onFolderPathChanged.forward(t)}tryGetLastStepIdFromFolderPath(){return this.folderPath.length>0?this.folderPath[this.folderPath.length-1]:null}setDefinition(t){this.definition=t,this.notifyDefinitionChanged(i.rootReplaced,null)}notifyDefinitionChanged(t,e){this.onDefinitionChanged.forward({changeType:t,stepId:e})}setViewport(t){this.viewport=t,this.onViewportChanged.forward(t)}setIsReadonly(t){this.isReadonly!==t&&(this.isReadonly=t,this.onIsReadonlyChanged.forward(t))}setIsDragging(t){this.isDragging!==t&&(this.isDragging=t,this.onIsDraggingChanged.forward(t))}toggleIsDragDisabled(){this.isDragDisabled=!this.isDragDisabled,this.onIsDragDisabledChanged.forward(this.isDragDisabled)}setIsToolboxCollapsed(t){this.isToolboxCollapsed!==t&&(this.isToolboxCollapsed=t,this.onIsToolboxCollapsedChanged.forward(t))}setIsEditorCollapsed(t){this.isEditorCollapsed!==t&&(this.isEditorCollapsed=t,this.onIsEditorCollapsedChanged.forward(t))}}class u{static svg(t,e){const s=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&u.attrs(s,e),s}static translate(t,e,s){t.setAttribute("transform",`translate(${e}, ${s})`)}static attrs(t,e){Object.keys(e).forEach((s=>{const i=e[s];t.setAttribute(s,"string"==typeof i?i:i.toString())}))}static element(t,e){const s=document.createElement(t);return e&&u.attrs(s,e),s}static toggleClass(t,e,s){e?t.classList.add(s):t.classList.remove(s)}}class g{static appendPath(t,e,s,i){const o=u.svg("g"),n=i/48,r=u.svg("path",{d:s,class:e,transform:`scale(${n})`});return o.appendChild(r),t.appendChild(o),o}static createSvg(t,e){const s=u.svg("svg",{class:t,viewBox:"0 0 48 48"}),i=u.svg("path",{d:e,class:"sqd-icon-path"});return s.appendChild(i),s}}g.folderIn="M42.05 42.25H11.996v-7.12h17.388L6 11.746 11.546 6.2 34.93 29.584V12.196h7.12V42.25z",g.folderOut="M6 6.2h30.054v7.12H18.666L42.05 36.704l-5.546 5.546L13.12 18.866v17.388H6V6.2z",g.center="M9 42q-1.2 0-2.1-.9Q6 40.2 6 39v-8.6h3V39h8.6v3Zm21.4 0v-3H39v-8.6h3V39q0 1.2-.9 2.1-.9.9-2.1.9ZM24 31.15q-3.15 0-5.15-2-2-2-2-5.15 0-3.15 2-5.15 2-2 5.15-2 3.15 0 5.15 2 2 2 2 5.15 0 3.15-2 5.15-2 2-5.15 2ZM6 17.6V9q0-1.2.9-2.1Q7.8 6 9 6h8.6v3H9v8.6Zm33 0V9h-8.6V6H39q1.2 0 2.1.9.9.9.9 2.1v8.6Z",g.zoomIn="M39.8 41.95 26.65 28.8q-1.5 1.3-3.5 2.025-2 .725-4.25.725-5.4 0-9.15-3.75T6 18.75q0-5.3 3.75-9.05 3.75-3.75 9.1-3.75 5.3 0 9.025 3.75 3.725 3.75 3.725 9.05 0 2.15-.7 4.15-.7 2-2.1 3.75L42 39.75Zm-20.95-13.4q4.05 0 6.9-2.875Q28.6 22.8 28.6 18.75t-2.85-6.925Q22.9 8.95 18.85 8.95q-4.1 0-6.975 2.875T9 18.75q0 4.05 2.875 6.925t6.975 2.875ZM17.3 24.3v-4.1h-4.1v-3h4.1v-4.05h3v4.05h4.05v3H20.3v4.1Z",g.zoomOut="M39.8 41.95 26.65 28.8q-1.5 1.3-3.5 2.025-2 .725-4.25.725-5.4 0-9.15-3.75T6 18.75q0-5.3 3.75-9.05 3.75-3.75 9.1-3.75 5.3 0 9.025 3.75 3.725 3.75 3.725 9.05 0 2.15-.7 4.15-.7 2-2.1 3.75L42 39.75Zm-20.95-13.4q4.05 0 6.9-2.875Q28.6 22.8 28.6 18.75t-2.85-6.925Q22.9 8.95 18.85 8.95q-4.1 0-6.975 2.875T9 18.75q0 4.05 2.875 6.925t6.975 2.875Zm-5.1-8.35v-3H23.8v3Z",g.undo="M14 38v-3h14.45q3.5 0 6.025-2.325Q37 30.35 37 26.9t-2.525-5.775Q31.95 18.8 28.45 18.8H13.7l5.7 5.7-2.1 2.1L8 17.3 17.3 8l2.1 2.1-5.7 5.7h14.7q4.75 0 8.175 3.2Q40 22.2 40 26.9t-3.425 7.9Q33.15 38 28.4 38Z",g.redo="M19.6 38q-4.75 0-8.175-3.2Q8 31.6 8 26.9t3.425-7.9q3.425-3.2 8.175-3.2h14.7l-5.7-5.7L30.7 8l9.3 9.3-9.3 9.3-2.1-2.1 5.7-5.7H19.55q-3.5 0-6.025 2.325Q11 23.45 11 26.9t2.525 5.775Q16.05 35 19.55 35H34v3Z",g.move="m24 44-8.15-8.15 2.2-2.2 4.45 4.45v-9.45h3v9.45l4.45-4.45 2.2 2.2ZM11.9 31.9 4 24l7.95-7.95 2.2 2.2L9.9 22.5h9.45v3H9.9l4.2 4.2Zm24.2 0-2.2-2.2 4.2-4.2h-9.4v-3h9.4l-4.2-4.2 2.2-2.2L44 24ZM22.5 19.3V9.9l-4.2 4.2-2.2-2.2L24 4l7.9 7.9-2.2 2.2-4.2-4.2v9.4Z",g.delete="m16.5 33.6 7.5-7.5 7.5 7.5 2.1-2.1-7.5-7.5 7.5-7.5-2.1-2.1-7.5 7.5-7.5-7.5-2.1 2.1 7.5 7.5-7.5 7.5ZM24 44q-4.1 0-7.75-1.575-3.65-1.575-6.375-4.3-2.725-2.725-4.3-6.375Q4 28.1 4 24q0-4.15 1.575-7.8 1.575-3.65 4.3-6.35 2.725-2.7 6.375-4.275Q19.9 4 24 4q4.15 0 7.8 1.575 3.65 1.575 6.35 4.275 2.7 2.7 4.275 6.35Q44 19.85 44 24q0 4.1-1.575 7.75-1.575 3.65-4.275 6.375t-6.35 4.3Q28.15 44 24 44Z",g.folderUp="M22.5 34h3V23.75l3.7 3.7 2.1-2.1-7.3-7.3-7.3 7.3 2.1 2.1 3.7-3.7ZM7.05 40q-1.2 0-2.1-.925-.9-.925-.9-2.075V11q0-1.15.9-2.075Q5.85 8 7.05 8h14l3 3h17q1.15 0 2.075.925.925.925.925 2.075v23q0 1.15-.925 2.075Q42.2 40 41.05 40Zm0-29v26h34V14H22.8l-3-3H7.05Zm0 0v26Z",g.close="m12.45 37.65-2.1-2.1L21.9 24 10.35 12.45l2.1-2.1L24 21.9l11.55-11.55 2.1 2.1L26.1 24l11.55 11.55-2.1 2.1L24 26.1Z",g.options="m19.4 44-1-6.3q-.95-.35-2-.95t-1.85-1.25l-5.9 2.7L4 30l5.4-3.95q-.1-.45-.125-1.025Q9.25 24.45 9.25 24q0-.45.025-1.025T9.4 21.95L4 18l4.65-8.2 5.9 2.7q.8-.65 1.85-1.25t2-.9l1-6.35h9.2l1 6.3q.95.35 2.025.925Q32.7 11.8 33.45 12.5l5.9-2.7L44 18l-5.4 3.85q.1.5.125 1.075.025.575.025 1.075t-.025 1.05q-.025.55-.125 1.05L44 30l-4.65 8.2-5.9-2.7q-.8.65-1.825 1.275-1.025.625-2.025.925l-1 6.3ZM24 30.5q2.7 0 4.6-1.9 1.9-1.9 1.9-4.6 0-2.7-1.9-4.6-1.9-1.9-4.6-1.9-2.7 0-4.6 1.9-1.9 1.9-1.9 4.6 0 2.7 1.9 4.6 1.9 1.9 4.6 1.9Z",g.expand="m24 30.75-12-12 2.15-2.15L24 26.5l9.85-9.85L36 18.8Z",g.alert="M24 42q-1.45 0-2.475-1.025Q20.5 39.95 20.5 38.5q0-1.45 1.025-2.475Q22.55 35 24 35q1.45 0 2.475 1.025Q27.5 37.05 27.5 38.5q0 1.45-1.025 2.475Q25.45 42 24 42Zm-3.5-12V6h7v24Z",g.play="M14.75 40.15V7.55l25.6 16.3Z",g.stop="M10.75 37.25V10.7H37.3v26.55Z",g.folder="M7.05 40q-1.2 0-2.1-.925-.9-.925-.9-2.075V11q0-1.15.9-2.075Q5.85 8 7.05 8h14l3 3h17q1.15 0 2.075.925.925.925.925 2.075v23q0 1.15-.925 2.075Q42.2 40 41.05 40Z";class f{static deepClone(t){return void 0!==window.structuredClone?window.structuredClone(t):JSON.parse(JSON.stringify(t))}}class m{static next(){const t=new Uint8Array(16);return window.crypto.getRandomValues(t),Array.from(t,(t=>t.toString(16).padStart(2,"0"))).join("")}}function w(t,e,s,i){const o=[void 0,void 0,void 0],n=new c;let r=!1;return[e,s,i].filter((t=>t)).forEach(((e,s)=>{e.subscribe((e=>{o[s]=e,r||(r=!0,setTimeout((()=>{try{n.forward(o)}finally{r=!1,o.fill(void 0)}}),t))}))})),n}class v{static create(t,e,s){const i=new v(t,e,s);return w(0,t.onDefinitionChanged,t.onSelectedStepIdChanged).subscribe((t=>{const[e,s]=t;e?i.onDefinitionChanged(e):void 0!==s&&i.onSelectedStepIdChanged(s)})),i.tryRender(t.selectedStepId),i}constructor(t,e,s){this.state=t,this.definitionWalker=e,this.handler=s,this.currentStepId=void 0}destroy(){}render(t){const e=t?this.definitionWalker.getById(this.state.definition,t):null;this.currentStepId=t,this.handler(e)}tryRender(t){this.currentStepId!==t&&this.render(t)}onDefinitionChanged(t){t.changeType===i.rootReplaced?this.render(this.state.selectedStepId):this.tryRender(this.state.selectedStepId)}onSelectedStepIdChanged(t){this.tryRender(t)}}class C{constructor(t,e,s){this.state=t,this.definitionWalker=e,this.definitionModifier=s}isCollapsed(){return this.state.isEditorCollapsed}toggleIsCollapsed(){this.state.setIsEditorCollapsed(!this.state.isEditorCollapsed)}subscribeIsCollapsed(t){this.state.onIsEditorCollapsedChanged.subscribe(t)}getDefinition(){return this.state.definition}runRenderer(t){return v.create(this.state,this.definitionWalker,t)}createStepEditorContext(t){if(!t)throw new Error("Step id is empty");return{notifyPropertiesChanged:()=>{this.state.notifyDefinitionChanged(i.stepPropertyChanged,t)},notifyNameChanged:()=>{this.state.notifyDefinitionChanged(i.stepNameChanged,t)},notifyChildrenChanged:()=>{this.state.notifyDefinitionChanged(i.stepChildrenChanged,t),this.definitionModifier.updateDependantFields()}}}createGlobalEditorContext(){return{notifyPropertiesChanged:()=>{this.state.notifyDefinitionChanged(i.globalPropertyChanged,null)}}}}class b{constructor(t,e){this.state=t,this.definitionWalker=e}subscribe(t){w(0,this.state.onFolderPathChanged,this.state.onDefinitionChanged).subscribe(t)}setFolderPath(t){this.state.setFolderPath(t)}getFolderPath(){return this.state.folderPath}getFolderPathStepNames(){return this.state.folderPath.map((t=>this.definitionWalker.getById(this.state.definition,t).name))}}class q{static create(t,e,s){const i=u.element("div",{class:`sqd-drag sqd-theme-${e}`});document.body.appendChild(i);const o=s.services.draggedComponent.create(i,t,s);return new q(o,i)}constructor(t,e){this.component=t,this.layer=e}setPosition(t){this.layer.style.top=t.y+"px",this.layer.style.left=t.x+"px"}remove(){this.component.destroy(),document.body.removeChild(this.layer)}}class x{static create(t,e){const s=new x(t,e);return e.onViewportChanged.subscribe(s.clearCacheHandler),window.addEventListener("scroll",s.clearCacheHandler,!1),s}constructor(t,e){this.placeholders=t,this.state=e,this.clearCacheHandler=()=>this.clearCache()}find(t,e,s){var i;if(!this.cache){const t=new h(window.scrollX,window.scrollY);this.cache=this.placeholders.map((e=>{const s=e.getClientRect();return{placeholder:e,lt:new h(s.x,s.y).add(t),br:new h(s.x+s.width,s.y+s.height).add(t)}})),this.cache.sort(((t,e)=>t.lt.y-e.lt.y))}const o=t.x+e,n=t.y+s;return null===(i=this.cache.find((e=>Math.max(t.x,e.lt.x)<Math.min(o,e.br.x)&&Math.max(t.y,e.lt.y)<Math.min(n,e.br.y))))||void 0===i?void 0:i.placeholder}destroy(){this.state.onViewportChanged.unsubscribe(this.clearCacheHandler),window.removeEventListener("scroll",this.clearCacheHandler,!1)}clearCache(){this.cache=void 0}}class y{static create(t,e,s){const i=q.create(e,t.theme,t.componentContext);return new y(i,t.workspaceController,t.state,e,t.definitionModifier,s)}constructor(t,e,s,i,o,n){this.view=t,this.workspaceController=e,this.designerState=s,this.step=i,this.definitionModifier=o,this.draggedStepComponent=n}onStart(t){let e=null;if(this.draggedStepComponent&&(this.draggedStepComponent.setIsDisabled(!0),this.draggedStepComponent.view.width===this.view.component.width&&this.draggedStepComponent.view.height===this.view.component.height)){const s=new h(window.scrollX,window.scrollY),i=this.draggedStepComponent.view.getClientPosition().add(s);e=t.subtract(i)}e||(e=new h(this.view.component.width,this.view.component.height).divideByScalar(2)),this.view.setPosition(t.subtract(e)),this.designerState.setIsDragging(!0);const s=this.workspaceController.getPlaceholders();this.state={startPosition:t,finder:x.create(s,this.designerState),offset:e}}onMove(t){if(this.state){const e=this.state.startPosition.subtract(t).subtract(this.state.offset);this.view.setPosition(e);const s=this.state.finder.find(e,this.view.component.width,this.view.component.height);this.currentPlaceholder!==s&&(this.currentPlaceholder&&this.currentPlaceholder.setIsHover(!1),s&&s.setIsHover(!0),this.currentPlaceholder=s)}}onEnd(t){if(!this.state)throw new Error("Invalid state");this.state.finder.destroy(),this.state=void 0,this.view.remove(),this.designerState.setIsDragging(!1);let e=!1;!t&&this.currentPlaceholder&&(e=this.draggedStepComponent?this.definitionModifier.tryMove(this.draggedStepComponent.parentSequence,this.draggedStepComponent.step,this.currentPlaceholder.parentSequence,this.currentPlaceholder.index):this.definitionModifier.tryInsert(this.step,this.currentPlaceholder.parentSequence,this.currentPlaceholder.index)),e||(this.draggedStepComponent&&this.draggedStepComponent.setIsDisabled(!1),this.currentPlaceholder&&this.currentPlaceholder.setIsHover(!1)),this.currentPlaceholder=void 0}}class S{constructor(t,e,s,i,o,n){this.state=t,this.designerContext=e,this.behaviorController=s,this.iconProvider=i,this.configuration=o,this.uidGenerator=n}isCollapsed(){return this.state.isToolboxCollapsed}toggleIsCollapsed(){this.state.setIsToolboxCollapsed(!this.state.isToolboxCollapsed)}subscribeIsCollapsed(t){this.state.onIsToolboxCollapsedChanged.subscribe(t)}tryGetIconUrl(t){return this.iconProvider.getIconUrl(t)}getLabel(t){const e=this.getConfiguration().labelProvider;return e?e(t):t.name}filterGroups(t){return this.getConfiguration().groups.map((e=>({name:e.name,steps:e.steps.filter((e=>!t||e.name.toLowerCase().includes(t)))}))).filter((t=>t.steps.length>0))}tryDrag(t,e){if(!this.state.isReadonly){const s=this.activateStep(e);return this.behaviorController.start(t,y.create(this.designerContext,s)),!0}return!1}activateStep(t){const e=f.deepClone(t);return e.id=this.uidGenerator?this.uidGenerator():m.next(),e}getConfiguration(){if(!this.configuration)throw new Error("Toolbox is disabled");return this.configuration}}class k{constructor(t,e){this.workspaceController=t,this.viewportController=e}resetViewport(){this.viewportController.setDefault()}zoom(t){this.viewportController.zoom(t)}moveViewportToStep(t){const e=this.workspaceController.getComponentByStepId(t),s=e.view.getClientPosition(),i=new h(e.view.width,e.view.height);this.viewportController.focusOnComponent(s,i)}}class I{constructor(t,e){this.state=t,this.workspaceController=e}getCanvasPosition(){return this.workspaceController.getCanvasPosition()}getCanvasSize(){return this.workspaceController.getCanvasSize()}getRootComponentSize(){return this.workspaceController.getRootComponentSize()}getViewport(){return this.state.viewport}setViewport(t){this.state.setViewport(t)}updateRootComponent(){this.workspaceController.updateRootComponent()}updateBadges(){this.workspaceController.updateBadges()}updateCanvasSize(){this.workspaceController.updateCanvasSize()}}class D{static create(t){const e=new I(t.state,t.workspaceController),s=t.services.viewportController.create(e),i=new k(t.workspaceController,s);return new D(new l(t.state,t.historyController,t.definitionModifier,i),new S(t.state,t,t.behaviorController,t.componentContext.iconProvider,t.configuration.toolbox,t.configuration.uidGenerator),new C(t.state,t.definitionWalker,t.definitionModifier),e,i,new b(t.state,t.definitionWalker))}constructor(t,e,s,i,o,n){this.controlBar=t,this.toolbox=e,this.editor=s,this.workspace=i,this.viewport=o,this.pathBar=n}}class E{constructor(t,e){this.configuration=t,this.state=e}validateStep(t,e){var s;return!(null===(s=this.configuration)||void 0===s?void 0:s.step)||this.configuration.step(t,e,this.state.definition)}validateRoot(){var t;return!(null===(t=this.configuration)||void 0===t?void 0:t.root)||this.configuration.root(this.state.definition)}}class M{constructor(t){this.configuration=t}getIconUrl(t){return this.configuration.iconUrlProvider?this.configuration.iconUrlProvider(t.componentType,t.type):null}}class z{static createForStep(t,e,s){const i=B(e.g),o=s.services.badges.map((e=>e.createForStep(i,t,s))),n=new h(e.width,0);return new z(i,n,o)}static createForRoot(t,e,s){const i=B(t),o=s.services.badges.map((t=>t.createForRoot?t.createForRoot(i,s):null));return new z(i,e,o)}constructor(t,e,s){this.g=t,this.position=e,this.badges=s}update(t){const e=this.badges.length;for(let s=0;s<e;s++){const e=this.badges[s];e&&(t[s]=e.update(t[s]))}let s=0,i=0,o=0;for(let t=0;t<e;t++){const e=this.badges[t];e&&e.view&&(s+=0===o?e.view.width/2:e.view.width,i=Math.max(i,e.view.height),u.translate(e.view.g,-s,0),s+=4,o++)}u.translate(this.g,this.position.x,this.position.y+-i/2)}resolveClick(t){for(const e of this.badges){const s=e&&e.resolveClick(t);if(s)return s}return null}}function B(t){const e=u.svg("g",{class:"sqd-badges"});return t.appendChild(e),e}(a=o||(o={}))[a.selectStep=1]="selectStep",a[a.rerenderStep=2]="rerenderStep",a[a.openFolder=3]="openFolder",a[a.triggerCustomAction=4]="triggerCustomAction",(r=n||(n={}))[r.none=0]="none",r[r.in=1]="in",r[r.out=2]="out";class P{static create(t,e,s){const i=z.createForStep(e,t,s);return new P(t,e.step,e.parentSequence,t.hasOutput(),i)}constructor(t,e,s,i,o){this.view=t,this.step=e,this.parentSequence=s,this.hasOutput=i,this.badges=o,this.isDisabled=!1}findById(t){if(this.step.id===t)return this;if(this.view.sequenceComponents)for(const e of this.view.sequenceComponents){const s=e.findById(t);if(s)return s}return null}resolveClick(t){if(this.view.sequenceComponents)for(const e of this.view.sequenceComponents){const s=e.resolveClick(t);if(s)return s}const e=this.badges.resolveClick(t);if(e)return e;const s=this.view.resolveClick(t);return s?!0===s?{type:o.selectStep,component:this}:s:null}getPlaceholders(t){this.isDisabled||(this.view.sequenceComponents&&this.view.sequenceComponents.forEach((e=>e.getPlaceholders(t))),this.view.placeholders&&this.view.placeholders.forEach((e=>t.push(e))))}setIsDragging(t){this.isDisabled||(this.view.sequenceComponents&&this.view.sequenceComponents.forEach((e=>e.setIsDragging(t))),this.view.placeholders&&this.view.placeholders.forEach((e=>e.setIsVisible(t)))),this.view.setIsDragging(t)}setIsSelected(t){this.view.setIsSelected(t)}setIsDisabled(t){this.isDisabled=t,this.view.setIsDisabled(t)}updateBadges(t){this.view.sequenceComponents&&this.view.sequenceComponents.forEach((e=>e.updateBadges(t))),this.badges.update(t)}}class T{static create(t,e){return{getStepIconUrl:()=>e.iconProvider.getIconUrl(t.step),createSequenceComponent:(s,i)=>{const o={sequence:i,depth:t.depth+1,isInputConnected:!0,isOutputConnected:t.isOutputConnected};return e.services.sequenceComponent.create(s,o,e)},createPlaceholderForArea:e.services.placeholder.createForArea.bind(e.services.placeholder)}}}class R{constructor(t){this.stepExtensionResolver=t}create(t,e,s){const i=T.create(e,s),o=this.stepExtensionResolver.resolve(e.step.componentType).createComponentView(t,e,i),n=s.services.stepComponentViewWrapper.wrap(o,e);return P.create(n,e,s)}}class L{static create(t,e,s,i,o){const n=new E(e,s),r=new M(t),a=o.placeholderController.create(),d=new R(i);return new L(n,r,a,d,o)}constructor(t,e,s,i,o){this.validator=t,this.iconProvider=e,this.placeholderController=s,this.stepComponentFactory=i,this.services=o}}class V{static create(t){return new V(t)}constructor(t){this.parent=t,this.currentContainer=null}setContent(t,e){const s=u.element("div",{class:e});s.appendChild(t),this.currentContainer&&this.parent.removeChild(this.currentContainer),this.parent.appendChild(s),this.currentContainer=s}destroy(){this.currentContainer&&this.parent.removeChild(this.currentContainer)}}class H{static create(t,e,s,i,o,n){const r=V.create(t),a=e.runRenderer((t=>function(t){const a=e.getDefinition();let d,l;if(t){const o=e.createStepEditorContext(t.id);d=i(t,o,a),l=s}else{const t=e.createGlobalEditorContext();d=n(a,t),l=o}r.setContent(d,l)}(t)));return new H(r,a)}constructor(t,e){this.view=t,this.renderer=e}destroy(){this.view.destroy(),this.renderer.destroy()}}class A{static create(t,e){const s=u.svg("g"),i=e.size/2,o=u.svg("path",{class:"sqd-validation-error",d:`M 0 ${-i} l ${i} ${e.size} l ${-e.size} 0 Z`});u.translate(o,i,i),s.appendChild(o);const n=g.appendPath(s,"sqd-validation-error-icon-path",g.alert,e.iconSize),r=.5*(e.size-e.iconSize),a=1.5*r;return u.translate(n,r,a),t.appendChild(s),new A(t,s,e.size,e.size)}constructor(t,e,s,i){this.parent=t,this.g=e,this.width=s,this.height=i}destroy(){this.parent.removeChild(this.g)}}class O{static createForStep(t,e,s,i){return new O(t,(()=>s.validator.validateStep(e.step,e.parentSequence)),i)}static createForRoot(t,e,s){return new O(t,(()=>e.validator.validateRoot()),s)}constructor(t,e,s){this.parentElement=t,this.validator=e,this.configuration=s,this.view=null}update(t){const e=this.validator();return e?this.view&&(this.view.destroy(),this.view=null):this.view||(this.view=A.create(this.parentElement,this.configuration)),e&&t}resolveClick(){return null}}const Z={view:{size:22,iconSize:12}};class W{static create(t){return new W(null!=t?t:Z)}constructor(t){this.configuration=t,this.id="validationError",this.createStartValue=()=>!0}createForStep(t,e,s){return O.createForStep(t,e,s,this.configuration.view)}createForRoot(t,e){return O.createForRoot(t,e,this.configuration.view)}}class U{static createRectInput(t,e,s,i,o,n){const r=u.svg("g");t.appendChild(r);const a=u.svg("rect",{class:"sqd-input",width:i,height:i,x:e-i/2,y:s+i/-2+.5,rx:4,ry:4});if(r.appendChild(a),n){const t=u.svg("image",{href:n,width:o,height:o,x:e-o/2,y:s+o/-2});r.appendChild(t)}return new U(r)}static createRoundInput(t,e,s,i){const o=u.svg("circle",{class:"sqd-input",cx:e,xy:s,r:i/2});return t.appendChild(o),new U(o)}constructor(t){this.root=t}setIsHidden(t){u.attrs(this.root,{visibility:t?"hidden":"visible"})}}class F{static createStraightJoin(t,e,s){const i=u.svg("line",{class:"sqd-join",x1:e.x,y1:e.y,x2:e.x,y2:e.y+s});t.insertBefore(i,t.firstChild)}static createJoins(t,e,s){const i=s[0],o=Math.abs(i.y-e.y)/2,n=Math.sign(i.y-e.y);switch(s.length){case 1:e.x===s[0].x?F.createStraightJoin(t,e,i.y*n):$(t,e,s,o,n);break;case 2:$(t,e,s,o,n);break;default:{const i=s[0],r=s[s.length-1];X(t,`M ${i.x} ${i.y} q ${.3*o} ${o*-n*.8} ${o} ${o*-n} l ${r.x-i.x-2*o} 0 q ${.8*o} ${-o*-n*.3} ${o} ${-o*-n}`);for(let e=1;e<s.length-1;e++)F.createStraightJoin(t,s[e],o*-n);F.createStraightJoin(t,e,o*n)}}}}function $(t,e,s,i,o){for(const n of s){const s=Math.abs(n.x-e.x)-2*i,r=Math.sign(n.x-e.x);X(t,`M ${e.x} ${e.y} q ${r*i*.3} ${o*i*.8} ${r*i} ${o*i} l ${r*s} 0 q ${r*i*.7} ${o*i*.2} ${r*i} ${o*i}`)}}function X(t,e){const s=u.svg("path",{class:"sqd-join",fill:"none",d:e});t.insertBefore(s,t.firstChild)}class N{static create(t,e,s,i,o){const n=u.svg("g",{class:`sqd-label sqd-label-${o}`});t.appendChild(n);const r=u.svg("text",{class:"sqd-label-text",y:e+s.height/2});r.textContent=i,n.appendChild(r);const a=Math.max(r.getBBox().width+2*s.paddingX,s.minWidth),d=u.svg("rect",{class:"sqd-label-rect",width:a,height:s.height,x:-a/2+.5,y:e+.5,rx:s.radius,ry:s.radius});return n.insertBefore(d,r),new N(n,a,s.height)}constructor(t,e,s){this.g=t,this.width=e,this.height=s}}class j{static create(t,e,s,i){const o=u.svg("circle",{class:"sqd-output",cx:e,cy:s,r:i/2});return t.appendChild(o),new j(o)}constructor(t){this.root=t}setIsHidden(t){u.attrs(this.root,{visibility:t?"hidden":"visible"})}}class Y{static create(t,e,s){const i=e.reduce(((t,e)=>t+e),0),o=[Q(t,0,0,i,0),Q(t,0,0,0,s),Q(t,0,s,i,s),Q(t,i,0,i,s)];let n=e[0];for(let i=1;i<e.length;i++)o.push(Q(t,n,0,n,s)),n+=e[i];return new Y(o,i,s)}constructor(t,e,s){this.lines=t,this.width=e,this.height=s}getClientPosition(){const t=this.lines[0].getBoundingClientRect();return new h(t.x,t.y)}resolveClick(t){const e=this.getClientPosition(),s=t.position.subtract(e);return s.x>=0&&s.y>=0&&s.x<this.width*t.scale&&s.y<this.height*t.scale}setIsSelected(t){this.lines.forEach((e=>{u.toggleClass(e,t,"sqd-selected")}))}}function Q(t,e,s,i,o){const n=u.svg("line",{class:"sqd-region",x1:e,y1:s,x2:i,y2:o});return t.insertBefore(n,t.firstChild),n}class G{static create(t,e,s,i,o,r){const a=u.svg("g",{visibility:"hidden",class:"sqd-placeholder"});t.appendChild(a);const d=u.svg("rect",{class:"sqd-placeholder-rect",width:e,height:s,rx:i,ry:i});if(a.appendChild(d),r){const t=r===n.in?g.folderIn:g.folderOut,i=g.appendPath(a,"sqd-placeholder-icon-path",t,o);u.translate(i,(e-o)/2,(s-o)/2)}return t.appendChild(a),new G(d,a)}constructor(t,e){this.rect=t,this.g=e}setIsHover(t){u.toggleClass(this.g,t,"sqd-hover")}setIsVisible(t){u.attrs(this.g,{visibility:t?"visible":"hidden"})}}class J{static create(t,e,s){const i=s.services.placeholder.gapSize.x,o=s.services.placeholder.gapSize.y,{sequence:n}=e,r=u.svg("g");t.appendChild(r);const a=[];for(let t=0;t<n.length;t++){const i={parentSequence:e.sequence,step:n[t],depth:e.depth,position:t,isInputConnected:0===t?e.isInputConnected:a[t-1].hasOutput,isOutputConnected:t!==n.length-1||e.isOutputConnected};a[t]=s.stepComponentFactory.create(r,i,s)}let d,l;if(a.length>0){const t=Math.max(...a.map((t=>t.view.width-t.view.joinX)));d=Math.max(...a.map((t=>t.view.joinX))),l=d+t}else d=i/2,l=i;let c=o;const p=[];for(let t=0;t<a.length;t++){const l=a[t],g=d-l.view.joinX;if((0===t&&e.isInputConnected||t>0&&a[t-1].hasOutput)&&F.createStraightJoin(r,new h(d,c-o),o),s.placeholderController.canCreate(n,t)){const e=s.services.placeholder.createForGap(r,n,t);u.translate(e.view.g,d-i/2,c-o),p.push(e)}u.translate(l.view.g,g,c),c+=l.view.height+o}e.isOutputConnected&&(0===a.length||a[a.length-1].hasOutput)&&F.createStraightJoin(r,new h(d,c-o),o);const g=a.length;if(s.placeholderController.canCreate(n,g)){const t=s.services.placeholder.createForGap(r,n,g);u.translate(t.view.g,d-i/2,c-o),p.push(t)}return new J(r,l,c,d,p,a)}constructor(t,e,s,i,o,n){this.g=t,this.width=e,this.height=s,this.joinX=i,this.placeholders=o,this.components=n}setIsDragging(t){this.placeholders.forEach((e=>{e.setIsVisible(t)}))}hasOutput(){return!(this.components.length>0)||this.components[this.components.length-1].hasOutput}}class _{static create(t,e,s){const i=J.create(t,e,s);return new _(i,i.hasOutput())}constructor(t,e){this.view=t,this.hasOutput=e}resolveClick(t){for(const e of this.view.components){const s=e.resolveClick(t);if(s)return s}for(const e of this.view.placeholders){const s=e.resolveClick(t);if(s)return s}return null}findById(t){for(const e of this.view.components){const s=e.findById(t);if(s)return s}return null}getPlaceholders(t){this.view.placeholders.forEach((e=>t.push(e))),this.view.components.forEach((e=>e.getPlaceholders(t)))}setIsDragging(t){this.view.setIsDragging(t),this.view.components.forEach((e=>e.setIsDragging(t)))}updateBadges(t){for(const e of this.view.components)e.updateBadges(t)}}const K=(t,e)=>(s,i,o)=>{const{step:n}=i,r=u.svg("g",{class:`sqd-step-task sqd-type-${n.type}`});s.appendChild(r);const a=2*e.paddingY+e.iconSize,d=u.svg("text",{x:e.paddingLeft+e.iconSize+e.textMarginLeft,y:a/2,class:"sqd-step-task-text"});d.textContent=n.name,r.appendChild(d);const l=Math.max(d.getBBox().width,e.minTextWidth),c=e.iconSize+e.paddingLeft+e.paddingRight+e.textMarginLeft+l,p=u.svg("rect",{x:.5,y:.5,class:"sqd-step-task-rect",width:c,height:a,rx:e.radius,ry:e.radius});r.insertBefore(p,d);const g=o.getStepIconUrl(),f=g?u.svg("image",{href:g}):u.svg("rect",{class:"sqd-step-task-empty-icon",rx:e.radius,ry:e.radius});u.attrs(f,{x:e.paddingLeft,y:e.paddingY,width:e.iconSize,height:e.iconSize}),r.appendChild(f);const m=0===i.depth&&0===i.position&&!i.isInputConnected,w=t,v=m?null:U.createRoundInput(r,c/2,0,e.inputSize),C=w?null:j.create(r,c/2,a,e.outputSize);return{g:r,width:c,height:a,joinX:c/2,sequenceComponents:null,placeholders:null,hasOutput:()=>!!C,getClientPosition(){const t=p.getBoundingClientRect();return new h(t.x,t.y)},resolveClick:t=>!!r.contains(t.element)||null,setIsDragging(t){null==v||v.setIsHidden(t),null==C||C.setIsHidden(t)},setIsDisabled(t){u.toggleClass(r,t,"sqd-disabled")},setIsSelected(t){u.toggleClass(p,t,"sqd-selected")}}};class tt{static center(t,e,s){const i=Math.max(e.x-2*t,0),o=Math.max(e.y-2*t,0),n=Math.min(Math.min(i/s.x,o/s.y),1),r=s.x*n,a=s.y*n,d=Math.max(0,(e.x-r)/2),l=Math.max(0,(e.y-a)/2);return{position:new h(d,l),scale:n}}static focusOnComponent(t,e,s,i){const o=e.position.divideByScalar(e.scale).subtract(s.divideByScalar(e.scale)),n=i.divideByScalar(2);return{position:o.add(t.divideByScalar(2)).subtract(n),scale:1}}}const et=new class{constructor(t){this.values=t}next(t,e){let s,i=0,o=Number.MAX_VALUE;for(let e=0;e<this.values.length;e++){const s=Math.abs(this.values[e]-t);o>s&&(i=e,o=s)}return s=e?Math.min(i+1,this.values.length-1):Math.max(i-1,0),{current:this.values[i],next:this.values[s]}}}([.06,.08,.1,.12,.16,.2,.26,.32,.4,.5,.6,.7,.8,.9,1]);class st{static zoom(t,e){const s=et.next(t.scale,e);return{position:t.position,scale:s.next}}static zoomByWheel(t,e,s){if(0===e.deltaY)return null;const i=et.next(t.scale,e.deltaY<0);let o;const n=Math.abs(e.deltaY);if(n<16){const e=n/16,s=i.next-i.current;o=t.scale+s*e}else o=i.next;const r=new h(e.pageX,e.pageY).subtract(s);return{position:r.divideByScalar(t.scale).subtract(t.position.divideByScalar(t.scale)).multiplyByScalar(-o).add(r),scale:o}}}class it{static create(t){return new it(t)}constructor(t){this.api=t}onWheel(t){const e=this.api.getViewport(),s=this.api.getCanvasPosition(),i=st.zoomByWheel(e,t,s);i&&this.api.setViewport(i)}}class ot{constructor(){this.create=it.create}}class nt{constructor(t){this.api=t}execute(t){this.animation&&this.animation.isAlive&&this.animation.stop();const e=this.api.getViewport(),s=e.position,i=e.scale,o=s.subtract(t.position),n=i-t.scale;this.animation=function(t,e){const s=setInterval((function(){const t=Math.min((Date.now()-i)/150,1);e(t),1===t&&o.stop()}),15),i=Date.now(),o={isAlive:!0,stop:()=>{o.isAlive=!1,clearInterval(s)}};return o}(0,(t=>{const e=i-n*t;this.api.setViewport({position:s.subtract(o.multiplyByScalar(t)),scale:e})}))}}class rt{static create(t){return new rt(t)}constructor(t){this.api=t,this.animator=new nt(this.api)}setDefault(){const t=this.api.getRootComponentSize(),e=this.api.getCanvasSize(),s=tt.center(10,e,t);this.api.setViewport(s)}zoom(t){const e=this.api.getViewport(),s=st.zoom(e,t);this.api.setViewport(s)}focusOnComponent(t,e){const s=this.api.getViewport(),i=this.api.getCanvasSize(),o=tt.focusOnComponent(i,s,t,e);this.animateTo(o)}animateTo(t){this.animator.execute(t)}}class at{constructor(){this.create=rt.create}}class dt{static create(t){const e={};for(let s=t.steps.length-1;s>=0;s--){const i=t.steps[s];e[i.componentType]=i}return new dt(e)}constructor(t){this.dict=t}resolve(t){const e=this.dict[t];if(!e)throw new Error(`Not supported component type: ${t}`);return e}}class lt{static create(t,e,s,i,o,n){const r=G.create(t,e.x,e.y,n.radius,n.iconSize,s);return new lt(r,i,o)}constructor(t,e,s){this.view=t,this.parentSequence=e,this.index=s}getClientRect(){return this.view.rect.getBoundingClientRect()}setIsHover(t){this.view.setIsHover(t)}setIsVisible(t){this.view.setIsVisible(t)}resolveClick(){return null}}function ct(t){return new h(t.pageX,t.pageY)}function ht(t){if(t.touches.length>0){const e=t.touches[0];return new h(e.pageX,e.pageY)}throw new Error("Unknown touch position")}const pt="State is not initialized",ut={passive:!1};class gt{constructor(){this.onMouseMove=t=>{t.preventDefault(),this.move(ct(t))},this.onTouchMove=t=>{t.preventDefault(),this.move(ht(t))},this.onMouseUp=t=>{t.preventDefault(),this.stop(!1,t.target)},this.onTouchEnd=t=>{var e;if(t.preventDefault(),!this.state)throw new Error(pt);const s=null!==(e=this.state.lastPosition)&&void 0!==e?e:this.state.startPosition,i=document.elementFromPoint(s.x,s.y);this.stop(!1,i)},this.onTouchStart=t=>{t.preventDefault(),1!==t.touches.length&&this.stop(!0,null)}}start(t,e){this.state?this.stop(!0,null):(this.state={startPosition:t,behavior:e},e.onStart(this.state.startPosition),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("touchmove",this.onTouchMove,ut),window.addEventListener("mouseup",this.onMouseUp,!1),window.addEventListener("touchend",this.onTouchEnd,ut),window.addEventListener("touchstart",this.onTouchStart,ut))}move(t){if(!this.state)throw new Error(pt);this.state.lastPosition=t;const e=this.state.startPosition.subtract(t),s=this.state.behavior.onMove(e);s&&(this.state.behavior.onEnd(!0,null),this.state.behavior=s,this.state.startPosition=t,this.state.behavior.onStart(this.state.startPosition))}stop(t,e){if(!this.state)throw new Error(pt);window.removeEventListener("mousemove",this.onMouseMove,!1),window.removeEventListener("touchmove",this.onTouchMove,ut),window.removeEventListener("mouseup",this.onMouseUp,!1),window.removeEventListener("touchend",this.onTouchEnd,ut),window.removeEventListener("touchstart",this.onTouchStart,ut),this.state.behavior.onEnd(t,e),this.state=void 0}}class ft{static tryMoveStep(t,e,s,i){const o=t.indexOf(e);if(o<0)throw new Error("Step not found in source sequence");return t===s&&(o<i&&i--,o===i)?null:function(){t.splice(o,1),s.splice(i,0,e)}}static insertStep(t,e,s){e.splice(s,0,t)}static deleteStep(t,e){const s=e.indexOf(t);if(s<0)throw new Error("Unknown step");e.splice(s,1)}}class mt{constructor(t,e){this.uidGenerator=t,this.definitionWalker=e}duplicate(t){const e=f.deepClone(t);return e.id=this.uidGenerator(),this.definitionWalker.forEachChildren(e,(t=>{t.id=this.uidGenerator()})),e}}class wt{constructor(t,e,s){this.definitionWalker=t,this.state=e,this.configuration=s}isDeletable(t){if(this.configuration.steps.isDeletable){const e=this.definitionWalker.getParentSequence(this.state.definition,t);return this.configuration.steps.isDeletable(e.step,e.parentSequence)}return!0}tryDelete(t){const e=this.definitionWalker.getParentSequence(this.state.definition,t);return!(this.configuration.steps.canDeleteStep&&!this.configuration.steps.canDeleteStep(e.step,e.parentSequence)||(ft.deleteStep(e.step,e.parentSequence),this.state.notifyDefinitionChanged(i.stepDeleted,e.step.id),this.updateDependantFields(),0))}tryInsert(t,e,s){return!(this.configuration.steps.canInsertStep&&!this.configuration.steps.canInsertStep(t,e,s)||(ft.insertStep(t,e,s),this.state.notifyDefinitionChanged(i.stepInserted,t.id),this.state.setSelectedStepId(t.id),0))}isDraggable(t,e){return!this.configuration.steps.isDraggable||this.configuration.steps.isDraggable(t,e)}tryMove(t,e,s,o){const n=ft.tryMoveStep(t,e,s,o);return!!n&&!(this.configuration.steps.canMoveStep&&!this.configuration.steps.canMoveStep(t,e,s,o)||(n(),this.state.notifyDefinitionChanged(i.stepMoved,e.id),this.state.setSelectedStepId(e.id),0))}isDuplicable(t,e){return!!this.configuration.steps.isDuplicable&&this.configuration.steps.isDuplicable(t,e)}tryDuplicate(t,e){const s=this.configuration.uidGenerator?this.configuration.uidGenerator:m.next,i=new mt(s,this.definitionWalker),o=e.indexOf(t),n=i.duplicate(t);return this.tryInsert(n,e,o+1)}replaceDefinition(t){if(!t)throw new Error("Definition is empty");this.state.setDefinition(t),this.updateDependantFields()}updateDependantFields(){this.state.selectedStepId&&(this.definitionWalker.findById(this.state.definition,this.state.selectedStepId)||this.state.setSelectedStepId(null));for(let t=0;t<this.state.folderPath.length;t++){const e=this.state.folderPath[t];if(!this.definitionWalker.findById(this.state.definition,e)){const e=this.state.folderPath.slice(0,t);this.state.setFolderPath(e);break}}}}class vt{static create(t,e,s){if(!s.undoStackSize||s.undoStackSize<1)throw new Error("Invalid undo stack size");const o=new vt(t,e,s.undoStackSize);return o.remember(i.rootReplaced,null),t.onDefinitionChanged.subscribe((t=>{t.changeType!==i.rootReplaced&&o.remember(t.changeType,t.stepId)})),o}constructor(t,e,s){this.state=t,this.definitionModifier=e,this.stackSize=s,this.stack=[],this.currentIndex=0}canUndo(){return this.currentIndex>1}undo(){this.currentIndex--,this.commit()}canRedo(){return this.currentIndex<this.stack.length}redo(){this.currentIndex++,this.commit()}remember(t,e){const s=f.deepClone(this.state.definition);if(this.stack.length>0&&this.currentIndex===this.stack.length){const i=this.stack[this.stack.length-1];if(function(t,e,s){return t.changeType===e&&t.stepId===s}(i,t,e))return void(i.definition=s)}this.stack.splice(this.currentIndex),this.stack.push({definition:s,changeType:t,stepId:e}),this.stack.length>this.stackSize&&this.stack.splice(0,this.stack.length-this.stackSize-1),this.currentIndex=this.stack.length}commit(){const t=f.deepClone(this.stack[this.currentIndex-1].definition);this.definitionModifier.replaceDefinition(t)}}class Ct{constructor(t){this.parent=t}isMobile(){return this.parent.clientWidth<400}}class bt{set(t){if(this.controller)throw new Error("Controller is already set");this.controller=t}get(){if(!this.controller)throw new Error("Controller is not set");return this.controller}getPlaceholders(){return this.get().getPlaceholders()}getComponentByStepId(t){return this.get().getComponentByStepId(t)}getCanvasPosition(){return this.get().getCanvasPosition()}getCanvasSize(){return this.get().getCanvasSize()}getRootComponentSize(){return this.get().getRootComponentSize()}updateBadges(){this.get().updateBadges()}updateRootComponent(){this.get().updateRootComponent()}updateCanvasSize(){this.get().updateCanvasSize()}}class qt{static create(t,e,s,i){var o,n,r;const a=f.deepClone(e),l=new Ct(t),c=!!s.isReadonly,h=!!s.toolbox&&(null!==(o=s.toolbox.isCollapsed)&&void 0!==o?o:l.isMobile()),u=!!s.editors&&(null!==(n=s.editors.isCollapsed)&&void 0!==n?n:l.isMobile()),g=s.theme||"light",m=new p(a,c,h,u),w=new bt,v=new gt,C=dt.create(i),b=null!==(r=s.definitionWalker)&&void 0!==r?r:new d,q=new wt(b,m,s);let x;s.undoStackSize&&(x=vt.create(m,q,s));const y=L.create(s.steps,s.validator,m,C,i);return new qt(g,m,s,i,y,b,q,l,w,v,x)}constructor(t,e,s,i,o,n,r,a,d,l,c){this.theme=t,this.state=e,this.configuration=s,this.services=i,this.componentContext=o,this.definitionWalker=n,this.definitionModifier=r,this.layoutController=a,this.workspaceController=d,this.behaviorController=l,this.historyController=c}setWorkspaceController(t){this.workspaceController.set(t)}}let xt=0;class yt{static create(t,e){const s="sqd-grid-pattern-"+xt++,i=u.svg("pattern",{id:s,patternUnits:"userSpaceOnUse"}),o=e.services.grid.create(),n=u.svg("defs");i.appendChild(o.element),n.appendChild(i);const r=u.svg("g"),a=u.element("div",{class:"sqd-workspace"}),d=u.svg("svg",{class:"sqd-workspace-canvas"});d.appendChild(n),d.appendChild(u.svg("rect",{width:"100%",height:"100%",fill:`url(#${s})`})),d.appendChild(r),a.appendChild(d),t.appendChild(a);const l=new yt(a,d,i,o,r,e);return window.addEventListener("resize",l.onResizeHandler,!1),l}constructor(t,e,s,i,o,n){this.workspace=t,this.canvas=e,this.pattern=s,this.gridPattern=i,this.foreground=o,this.context=n,this.onResizeHandler=()=>this.onResize()}render(t,e){this.rootComponent&&this.foreground.removeChild(this.rootComponent.view.g),this.rootComponent=this.context.services.rootComponent.create(this.foreground,t,e,this.context),this.refreshSize()}setPositionAndScale(t,e){const s=this.gridPattern.size.multiplyByScalar(e);u.attrs(this.pattern,{x:t.x,y:t.y,width:s.x,height:s.y}),this.gridPattern.setScale(e,s),u.attrs(this.foreground,{transform:`translate(${t.x}, ${t.y}) scale(${e})`})}getCanvasPosition(){const t=this.canvas.getBoundingClientRect();return new h(t.x+window.scrollX,t.y+window.scrollY)}getCanvasSize(){return new h(this.canvas.clientWidth,this.canvas.clientHeight)}bindClick(t){this.canvas.addEventListener("mousedown",(e=>{e.preventDefault(),t(ct(e),e.target,e.button)}),!1),this.canvas.addEventListener("touchstart",(e=>{e.preventDefault();const s=function(t){if(t.touches.length>0){const e=t.touches[0];return new h(e.clientX,e.clientY)}throw new Error("Unknown touch position")}(e),i=document.elementFromPoint(s.x,s.y);if(i){const s=ht(e);t(s,i,0)}}),{passive:!1})}bindContextMenu(t){this.canvas.addEventListener("contextmenu",(e=>{e.preventDefault(),t(ct(e),e.target)}),!1)}bindWheel(t){this.canvas.addEventListener("wheel",t,!1)}destroy(){window.removeEventListener("resize",this.onResizeHandler,!1)}refreshSize(){u.attrs(this.canvas,{width:this.workspace.offsetWidth,height:this.workspace.offsetHeight})}onResize(){this.refreshSize()}}class St{static create(t,e){return new St(t.viewport.position,e,t)}constructor(t,e,s){this.startPosition=t,this.resetSelectedStep=e,this.state=s}onStart(){if(this.resetSelectedStep){const t=this.state.tryGetLastStepIdFromFolderPath();this.state.setSelectedStepId(t)}}onMove(t){this.state.setViewport({position:this.startPosition.subtract(t),scale:this.state.viewport.scale})}onEnd(){}}class kt{static create(t,e,s){const i=e||s.state.isDragDisabled||!s.definitionModifier.isDraggable(t.step,t.parentSequence);return new kt(t,i,s,s.state)}constructor(t,e,s,i){this.pressedStepComponent=t,this.isDragDisabled=e,this.context=s,this.state=i}onStart(){}onMove(t){if(t.distance()>2)return this.state.isReadonly||this.isDragDisabled?St.create(this.state,!1):(this.state.setSelectedStepId(null),y.create(this.context,this.pressedStepComponent.step,this.pressedStepComponent))}onEnd(t){t||this.state.setSelectedStepId(this.pressedStepComponent.step.id)}}class It{static create(t,e){return new It(t,e)}constructor(t,e){this.clickedElement=t,this.handler=e}onStart(){}onMove(){}onEnd(t,e){!t&&e&&this.clickedElement===e&&this.handler.handle()}}class Dt{constructor(t){this.designerContext=t}handle(){this.designerContext.workspaceController.updateRootComponent()}}class Et{constructor(t,e){this.command=t,this.designerContext=e}handle(){const t=this.command.step.id;this.designerContext.state.pushStepIdToFolderPath(t)}}class Mt{constructor(t,e){this.command=t,this.designerContext=e}handle(){const t=this.designerContext.configuration.customActionHandler;if(!t)return void console.warn(`Custom action handler is not defined (action type: ${this.command.action.type})`);const e=this.createContext();t(this.command.action,this.command.step,this.command.sequence,e)}createContext(){return{notifyStepNameChanged:t=>this.notifyStepChanged(i.stepNameChanged,t),notifyStepPropertiesChanged:t=>this.notifyStepChanged(i.stepPropertyChanged,t),notifyStepInserted:t=>this.notifyStepChanged(i.stepInserted,t),notifyStepMoved:t=>this.notifyStepChanged(i.stepMoved,t),notifyStepDeleted:t=>this.notifyStepChanged(i.stepDeleted,t)}}notifyStepChanged(t,e){if(!e)throw new Error("Step id is empty");this.designerContext.state.notifyDefinitionChanged(t,e)}}class zt{constructor(t,e){this.designerContext=t,this.state=e}resolve(t,e,s){if(!t)return St.create(this.state,!0);switch(t.type){case o.selectStep:return kt.create(t.component,s,this.designerContext);case o.rerenderStep:return It.create(e,new Dt(this.designerContext));case o.openFolder:return It.create(e,new Et(t,this.designerContext));case o.triggerCustomAction:return It.create(e,new Mt(t,this.designerContext));default:throw new Error("Not supported behavior type")}}}class Bt{static create(t){return t.badges.map((t=>t.createStartValue()))}}function Pt(t){return t.findIndex((t=>"validationError"===t.id))}class Tt{static create(t,e,s){const i=document.createElement("div");i.style.left=`${t.x}px`,i.style.top=`${t.y}px`,i.className=`sqd-context-menu sqd-theme-${e}`;const o=[];for(let t=0;t<s.length;t++){const e=s[t],n=document.createElement("div");"string"==typeof e?(n.className="sqd-context-menu-group",n.innerText=e):(n.className="sqd-context-menu-item",n.innerText=e.label),o.push(n),i.appendChild(n)}const n=new Tt(i,o,s,Date.now());return document.addEventListener("mousedown",n.mouseDown,!1),document.addEventListener("mouseup",n.mouseUp,!1),document.addEventListener("touchstart",n.mouseDown,!1),document.addEventListener("touchend",n.mouseUp,!1),document.body.appendChild(i),n}constructor(t,e,s,i){this.menu=t,this.elements=e,this.items=s,this.startTime=i,this.isAttached=!0,this.mouseDown=t=>{null===this.findIndex(t.target)?this.tryDestroy():(t.preventDefault(),t.stopPropagation())},this.mouseUp=t=>{if(Date.now()-this.startTime<300)return t.preventDefault(),void t.stopPropagation();try{const e=this.findIndex(t.target);if(null!==e){const t=this.items[e];"string"!=typeof t&&t.callback()}}finally{this.tryDestroy()}}}findIndex(t){for(let e=0;e<this.elements.length;e++)if(this.elements[e].contains(t))return e;return null}tryDestroy(){this.isAttached&&(document.body.removeChild(this.menu),document.removeEventListener("mousedown",this.mouseDown,!1),document.removeEventListener("mouseup",this.mouseUp,!1),document.removeEventListener("touchstart",this.mouseDown,!1),document.removeEventListener("touchend",this.mouseUp,!1),this.isAttached=!1)}}class Rt{static build(t,e,s,i){const n=[];if(t&&t.type===o.selectStep){const e=t,o=e.component.step,r=e.component.parentSequence;n.push(o.name),i.selectedStepId===o.id?n.push({label:"Unselect",callback:()=>{i.setSelectedStepId(null)}}):n.push({label:"Select",callback:()=>{i.setSelectedStepId(o.id)}}),i.isReadonly||(s.isDeletable(o.id)&&n.push({label:"Delete",callback:()=>{s.tryDelete(o.id)}}),s.isDuplicable(o,r)&&n.push({label:"Duplicate",callback:()=>{s.tryDuplicate(o,r)}}))}return n.push({label:"Reset view",callback:()=>{e.resetViewport()}}),n}}class Lt{constructor(t,e,s,i,o){this.theme=t,this.viewportApi=e,this.definitionModifier=s,this.state=i,this.configuration=o}tryOpen(t,e){if(!1===this.configuration.contextMenu)return;this.last&&this.last.tryDestroy();const s=Rt.build(e,this.viewportApi,this.definitionModifier,this.state);this.last=Tt.create(t,this.theme,s)}destroy(){this.last&&this.last.tryDestroy()}}class Vt{static create(t,e,s){const i=yt.create(t,e.componentContext),o=new zt(e,e.state),n=e.services.wheelController.create(s.workspace),r=new Lt(e.theme,s.viewport,e.definitionModifier,e.state,e.configuration),a=new Vt(i,e.definitionWalker,e.state,e.behaviorController,n,r,o,s.viewport,e.services);return setTimeout((()=>{a.updateRootComponent(),s.viewport.resetViewport(),a.onReady.forward()})),e.setWorkspaceController(a),e.state.onViewportChanged.subscribe((t=>a.onViewportChanged(t))),e.state.onIsDraggingChanged.subscribe((t=>a.onIsDraggingChanged(t))),w(0,e.state.onDefinitionChanged,e.state.onSelectedStepIdChanged,e.state.onFolderPathChanged).subscribe((t=>{a.onStateChanged(t[0],t[1],t[2])})),i.bindClick(((t,e,s)=>a.onClick(t,e,s))),i.bindWheel((t=>a.onWheel(t))),i.bindContextMenu(((t,e)=>a.onContextMenu(t,e))),a}constructor(t,e,s,i,o,n,r,a,d){this.view=t,this.definitionWalker=e,this.state=s,this.behaviorController=i,this.wheelController=o,this.contextMenuController=n,this.clickBehaviorResolver=r,this.viewportApi=a,this.services=d,this.onReady=new c,this.isValid=!1,this.selectedStepComponent=null,this.validationErrorBadgeIndex=null}updateRootComponent(){let t,s;this.selectedStepComponent=null;const i=this.state.tryGetLastStepIdFromFolderPath();if(i){const o=this.definitionWalker.getParentSequence(this.state.definition,i),n=this.definitionWalker.getChildren(o.step);if(!n||n.type!==e.sequence)throw new Error("Cannot find single sequence in folder step");s=n.items,t={sequence:o.parentSequence,index:o.index}}else s=this.state.definition.sequence,t=null;this.view.render(s,t),this.trySelectStepComponent(this.state.selectedStepId),this.updateBadges()}updateBadges(){const t=Bt.create(this.services);this.getRootComponent().updateBadges(t),null===this.validationErrorBadgeIndex&&(this.validationErrorBadgeIndex=Pt(this.services.badges)),this.isValid=Boolean(t[this.validationErrorBadgeIndex])}getPlaceholders(){const t=[];return this.getRootComponent().getPlaceholders(t),t}getComponentByStepId(t){const e=this.getRootComponent().findById(t);if(!e)throw new Error(`Cannot find component for step id: ${t}`);return e}getCanvasPosition(){return this.view.getCanvasPosition()}getCanvasSize(){return this.view.getCanvasSize()}getRootComponentSize(){const t=this.getRootComponent().view;return new h(t.width,t.height)}updateCanvasSize(){setTimeout((()=>this.view.refreshSize()))}destroy(){this.contextMenuController.destroy(),this.view.destroy()}onClick(t,e,s){const i=1===s;if(0===s||i){const s=this.resolveClick(e,t),o=i,n=this.clickBehaviorResolver.resolve(s,e,o);this.behaviorController.start(t,n)}}onWheel(t){t.preventDefault(),t.stopPropagation(),this.wheelController.onWheel(t)}onContextMenu(t,e){const s=this.resolveClick(e,t);this.contextMenuController.tryOpen(t,s)}onIsDraggingChanged(t){this.getRootComponent().setIsDragging(t)}onViewportChanged(t){this.view.setPositionAndScale(t.position,t.scale)}onStateChanged(t,e,s){s?(this.updateRootComponent(),this.viewportApi.resetViewport()):t?t.changeType===i.stepPropertyChanged?this.updateBadges():this.updateRootComponent():void 0!==e&&this.trySelectStepComponent(e)}trySelectStepComponent(t){this.selectedStepComponent&&(this.selectedStepComponent.setIsSelected(!1),this.selectedStepComponent=null),t&&(this.selectedStepComponent=this.getRootComponent().findById(t),this.selectedStepComponent&&this.selectedStepComponent.setIsSelected(!0))}resolveClick(t,e){const s={element:t,position:e,scale:this.state.viewport.scale};return this.getRootComponent().resolveClick(s)}getRootComponent(){if(this.view.rootComponent)return this.view.rootComponent;throw new Error("Root component not found")}}class Ht{static create(t,e,s){const i=u.element("div",{class:`sqd-designer sqd-theme-${e.theme}`});t.appendChild(i);const o=Vt.create(i,e,s),n=e.services.uiComponents.map((t=>t.create(i,s))),r=e.services.daemons.map((t=>t.create(s))),a=new Ht(i,e.layoutController,o,n,r);return a.reloadLayout(),window.addEventListener("resize",a.onResizeHandler,!1),a}constructor(t,e,s,i,o){this.root=t,this.layoutController=e,this.workspace=s,this.uiComponents=i,this.daemons=o,this.onResizeHandler=()=>this.onResize()}destroy(){var t;window.removeEventListener("resize",this.onResizeHandler,!1),this.workspace.destroy(),this.uiComponents.forEach((t=>t.destroy())),this.daemons.forEach((t=>t.destroy())),null===(t=this.root.parentElement)||void 0===t||t.removeChild(this.root)}onResize(){this.reloadLayout()}reloadLayout(){const t=this.layoutController.isMobile();u.toggleClass(this.root,!t,"sqd-layout-desktop"),u.toggleClass(this.root,t,"sqd-layout-mobile")}}class At{static create(t,e,s){const i=u.svg("svg");i.style.marginLeft="-10px",i.style.marginTop="-10px",t.appendChild(i);const o={parentSequence:[],step:e,depth:0,position:0,isInputConnected:!0,isOutputConnected:!0},n=s.stepComponentFactory.create(i,o,s);return u.attrs(i,{width:n.view.width+20,height:n.view.height+20}),u.translate(n.view.g,10,10),new At(n.view.width,n.view.height)}constructor(t,e){this.width=t,this.height=e}destroy(){}}class Ot{constructor(){this.create=At.create}}class Zt{static create(t,e){const s=u.element("div",{class:"sqd-control-bar"}),i=Ut(g.center,"Reset view");s.appendChild(i);const o=Ut(g.zoomIn,"Zoom in");s.appendChild(o);const n=Ut(g.zoomOut,"Zoom out");s.appendChild(n);let r=null,a=null;e&&(r=Ut(g.undo,"Undo"),s.appendChild(r),a=Ut(g.redo,"Redo"),s.appendChild(a));const d=Ut(g.move,"Turn on/off drag and drop");d.classList.add("sqd-disabled"),s.appendChild(d);const l=Ut(g.delete,"Delete selected step");return l.classList.add("sqd-delete"),l.classList.add("sqd-hidden"),s.appendChild(l),t.appendChild(s),new Zt(i,o,n,r,a,d,l)}constructor(t,e,s,i,o,n,r){this.resetButton=t,this.zoomInButton=e,this.zoomOutButton=s,this.undoButton=i,this.redoButton=o,this.disableDragButton=n,this.deleteButton=r}bindResetButtonClick(t){Wt(this.resetButton,t)}bindZoomInButtonClick(t){Wt(this.zoomInButton,t)}bindZoomOutButtonClick(t){Wt(this.zoomOutButton,t)}bindUndoButtonClick(t){if(!this.undoButton)throw new Error("Undo button is disabled");Wt(this.undoButton,t)}bindRedoButtonClick(t){if(!this.redoButton)throw new Error("Redo button is disabled");Wt(this.redoButton,t)}bindDisableDragButtonClick(t){Wt(this.disableDragButton,t)}bindDeleteButtonClick(t){Wt(this.deleteButton,t)}setIsDeleteButtonHidden(t){u.toggleClass(this.deleteButton,t,"sqd-hidden")}setDisableDragButtonDisabled(t){u.toggleClass(this.disableDragButton,t,"sqd-disabled")}setUndoButtonDisabled(t){if(!this.undoButton)throw new Error("Undo button is disabled");u.toggleClass(this.undoButton,t,"sqd-disabled")}setRedoButtonDisabled(t){if(!this.redoButton)throw new Error("Redo button is disabled");u.toggleClass(this.redoButton,t,"sqd-disabled")}}function Wt(t,e){t.addEventListener("click",(t=>{t.preventDefault(),e()}),!1)}function Ut(t,e){const s=u.element("div",{class:"sqd-control-bar-button",title:e}),i=g.createSvg("sqd-control-bar-button-icon",t);return s.appendChild(i),s}class Ft{static create(t,e){const s=e.controlBar.isUndoRedoSupported(),i=Zt.create(t,s),o=new Ft(i,e.controlBar,s);return i.bindResetButtonClick((()=>o.onResetButtonClicked())),i.bindZoomInButtonClick((()=>o.onZoomInButtonClicked())),i.bindZoomOutButtonClick((()=>o.onZoomOutButtonClicked())),i.bindDisableDragButtonClick((()=>o.onMoveButtonClicked())),i.bindDeleteButtonClick((()=>o.onDeleteButtonClicked())),e.controlBar.subscribe((()=>o.refreshButtons())),s&&(i.bindUndoButtonClick((()=>o.onUndoButtonClicked())),i.bindRedoButtonClick((()=>o.onRedoButtonClicked()))),o.refreshButtons(),o}constructor(t,e,s){this.view=t,this.controlBarApi=e,this.isUndoRedoSupported=s}destroy(){}onResetButtonClicked(){this.controlBarApi.resetViewport()}onZoomInButtonClicked(){this.controlBarApi.zoomIn()}onZoomOutButtonClicked(){this.controlBarApi.zoomOut()}onMoveButtonClicked(){this.controlBarApi.toggleIsDragDisabled()}onUndoButtonClicked(){this.controlBarApi.tryUndo()}onRedoButtonClicked(){this.controlBarApi.tryRedo()}onDeleteButtonClicked(){this.controlBarApi.tryDelete()}refreshButtons(){this.refreshDeleteButtonVisibility(),this.refreshIsDragDisabled(),this.isUndoRedoSupported&&this.refreshUndoRedoAvailability()}refreshIsDragDisabled(){const t=this.controlBarApi.isDragDisabled();this.view.setDisableDragButtonDisabled(!t)}refreshUndoRedoAvailability(){const t=this.controlBarApi.canUndo(),e=this.controlBarApi.canRedo();this.view.setUndoButtonDisabled(!t),this.view.setRedoButtonDisabled(!e)}refreshDeleteButtonVisibility(){const t=this.controlBarApi.canDelete();this.view.setIsDeleteButtonHidden(!t)}}class $t{constructor(){this.create=Ft.create}}const Xt=["Backspace","Delete"],Nt=["INPUT","TEXTAREA"];class jt{static create(t){const e=new jt(t.controlBar);return document.addEventListener("keyup",e.onKeyUp,!1),e}constructor(t){this.controlBarApi=t,this.onKeyUp=t=>{Xt.includes(t.key)&&(document.activeElement&&Nt.includes(document.activeElement.tagName)||this.controlBarApi.canDelete()&&(t.preventDefault(),t.stopPropagation(),this.controlBarApi.tryDelete()))}}destroy(){document.removeEventListener("keyup",this.onKeyUp,!1)}}class Yt{constructor(){this.create=jt.create}}class Qt{static create(t,e,s){const i=u.element("div",{class:"sqd-smart-editor"}),o=u.element("div",{class:"sqd-smart-editor-toggle",title:"Toggle editor"});t.appendChild(o),t.appendChild(i);const n=H.create(i,e,"sqd-editor sqd-step-editor",s.stepEditorProvider,"sqd-editor sqd-global-editor",s.globalEditorProvider);return new Qt(i,o,n)}constructor(t,e,s){this.root=t,this.toggle=e,this.editor=s}bindToggleClick(t){this.toggle.addEventListener("click",(e=>{e.preventDefault(),t()}),!1)}setIsCollapsed(t){u.toggleClass(this.root,t,"sqd-hidden"),u.toggleClass(this.toggle,t,"sqd-collapsed"),this.toggleIcon&&this.toggle.removeChild(this.toggleIcon),this.toggleIcon=g.createSvg("sqd-smart-editor-toggle-icon",t?g.options:g.close),this.toggle.appendChild(this.toggleIcon)}destroy(){this.editor.destroy()}}class Gt{static create(t,e,s){const i=Qt.create(t,e.editor,s),o=new Gt(i,e.editor,e.workspace);return o.updateVisibility(),i.bindToggleClick((()=>o.onToggleClicked())),e.editor.subscribeIsCollapsed((()=>o.onIsCollapsedChanged())),o}constructor(t,e,s){this.view=t,this.editorApi=e,this.workspaceApi=s}onToggleClicked(){this.editorApi.toggleIsCollapsed()}setIsCollapsed(t){this.view.setIsCollapsed(t)}onIsCollapsedChanged(){this.updateVisibility(),this.workspaceApi.updateCanvasSize()}updateVisibility(){this.setIsCollapsed(this.editorApi.isCollapsed())}destroy(){this.view.destroy()}}class Jt{constructor(t){this.configuration=t}create(t,e){return Gt.create(t,e,this.configuration)}}const _t={passive:!1};class Kt{static create(t,e){const s=u.element("div",{class:"sqd-scrollbox"});t.appendChild(s);const i=new Kt(s,e);return window.addEventListener("resize",i.onResize,!1),s.addEventListener("wheel",(t=>i.onWheel(t)),!1),s.addEventListener("touchstart",(t=>i.onTouchStart(t)),_t),s.addEventListener("mousedown",(t=>i.onMouseDown(t)),!1),i}constructor(t,e){this.root=t,this.viewport=e,this.onResize=()=>{this.refresh()},this.onTouchStart=t=>{t.preventDefault(),this.startScroll(ht(t))},this.onMouseDown=t=>{this.startScroll(ct(t))},this.onTouchMove=t=>{t.preventDefault(),this.moveScroll(ht(t))},this.onMouseMove=t=>{t.preventDefault(),this.moveScroll(ct(t))},this.onTouchEnd=t=>{t.preventDefault(),this.stopScroll()},this.onMouseUp=t=>{t.preventDefault(),this.stopScroll()}}setContent(t){this.content&&this.root.removeChild(this.content.element),t.classList.add("sqd-scrollbox-body"),this.root.appendChild(t),this.reload(t)}refresh(){this.content&&this.reload(this.content.element)}destroy(){window.removeEventListener("resize",this.onResize,!1)}reload(t){let e=Math.min(.7*this.viewport.clientHeight,t.clientHeight);e=Math.min(e,this.viewport.clientHeight-206),this.root.style.height=e+"px",t.style.top="0px",this.content={element:t,height:e}}onWheel(t){if(t.stopPropagation(),this.content){const e=t.deltaY>0?-25:25,s=this.getScrollTop();this.setScrollTop(s+e)}}startScroll(t){this.scroll||(window.addEventListener("touchmove",this.onTouchMove,_t),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("touchend",this.onTouchEnd,_t),window.addEventListener("mouseup",this.onMouseUp,!1)),this.scroll={startPositionY:t.y,startScrollTop:this.getScrollTop()}}moveScroll(t){if(this.scroll){const e=t.y-this.scroll.startPositionY;this.setScrollTop(this.scroll.startScrollTop+e)}}stopScroll(){this.scroll&&(window.removeEventListener("touchmove",this.onTouchMove,_t),window.removeEventListener("mousemove",this.onMouseMove,!1),window.removeEventListener("touchend",this.onTouchEnd,_t),window.removeEventListener("mouseup",this.onMouseUp,!1),this.scroll=void 0)}getScrollTop(){return this.content&&this.content.element.style.top?parseInt(this.content.element.style.top):0}setScrollTop(t){if(this.content){const e=this.content.element.clientHeight-this.content.height,s=Math.max(Math.min(t,0),-e);this.content.element.style.top=s+"px"}}}const te=/^[a-zA-Z][a-zA-Z0-9_-]+$/;class ee{static validate(t){if(!te.test(t))throw new Error(`Step type "${t}" contains not allowed characters`)}}class se{static create(t,e,s){const i=s.getLabel(e),o=u.element("div",{class:`sqd-toolbox-item sqd-type-${e.type}`,title:i}),n=s.tryGetIconUrl(e),r=u.element("div",{class:"sqd-toolbox-item-icon"});if(n){const t=u.element("img",{class:"sqd-toolbox-item-icon-image",src:n});r.appendChild(t)}else r.classList.add("sqd-no-icon");const a=u.element("div",{class:"sqd-toolbox-item-text"});return a.textContent=i,o.appendChild(r),o.appendChild(a),t.appendChild(o),new se(o)}constructor(t){this.root=t}bindMousedown(t){this.root.addEventListener("mousedown",t,!1)}bindTouchstart(t){this.root.addEventListener("touchstart",t,!1)}bindContextMenu(t){this.root.addEventListener("contextmenu",t,!1)}}class ie{static create(t,e,s){ee.validate(e.type);const i=se.create(t,e,s),o=new ie(e,s);return i.bindMousedown((t=>o.onMousedown(t))),i.bindTouchstart((t=>o.onTouchstart(t))),i.bindContextMenu((t=>o.onContextMenu(t))),o}constructor(t,e){this.step=t,this.api=e}onTouchstart(t){t.preventDefault(),1===t.touches.length&&(t.stopPropagation(),this.tryDrag(ht(t)))}onMousedown(t){t.stopPropagation(),0===t.button&&this.tryDrag(ct(t))}onContextMenu(t){t.preventDefault()}tryDrag(t){this.api.tryDrag(t,this.step)}}class oe{static create(t,e){const s=u.element("div",{class:"sqd-toolbox"}),i=u.element("div",{class:"sqd-toolbox-header"}),o=u.element("div",{class:"sqd-toolbox-header-title"});o.innerText="Toolbox";const n=u.element("div",{class:"sqd-toolbox-body"}),r=u.element("input",{class:"sqd-toolbox-filter",type:"text",placeholder:"Search..."});s.appendChild(i),s.appendChild(n),i.appendChild(o),n.appendChild(r),t.appendChild(s);const a=Kt.create(n,t);return new oe(i,n,r,a,e)}constructor(t,e,s,i,o){this.header=t,this.body=e,this.filterInput=s,this.scrollBoxView=i,this.api=o}bindToggleClick(t){this.header.addEventListener("click",(function(e){e.preventDefault(),t()}),!1)}bindFilterInputChange(t){function e(e){t(e.target.value)}this.filterInput.addEventListener("keyup",e,!1),this.filterInput.addEventListener("blur",e,!1)}setIsCollapsed(t){u.toggleClass(this.body,t,"sqd-hidden"),this.headerToggleIcon&&this.header.removeChild(this.headerToggleIcon),this.headerToggleIcon=g.createSvg("sqd-toolbox-toggle-icon",t?g.expand:g.close),this.header.appendChild(this.headerToggleIcon),t||this.scrollBoxView.refresh()}setGroups(t){const e=u.element("div");t.forEach((t=>{const s=u.element("div",{class:"sqd-toolbox-group-title"});s.innerText=t.name,e.appendChild(s),t.steps.forEach((t=>ie.create(e,t,this.api)))})),this.scrollBoxView.setContent(e)}destroy(){this.scrollBoxView.destroy()}}class ne{static create(t,e){const s=oe.create(t,e),i=new ne(s,e);return i.render(),i.onIsCollapsedChanged(),s.bindToggleClick((()=>i.onToggleClicked())),s.bindFilterInputChange((t=>i.onFilterInputChanged(t))),e.subscribeIsCollapsed((()=>i.onIsCollapsedChanged())),i}constructor(t,e){this.view=t,this.api=e}destroy(){this.view.destroy()}render(){const t=this.api.filterGroups(this.filter);this.view.setGroups(t)}onIsCollapsedChanged(){this.view.setIsCollapsed(this.api.isCollapsed())}onToggleClicked(){this.api.toggleIsCollapsed()}onFilterInputChanged(t){this.filter=t.toLowerCase(),this.render()}}class re{create(t,e){return ne.create(t,e.toolbox)}}const ae={view:{paddingTop:20,paddingX:20,inputSize:18,inputIconSize:14,label:{height:22,paddingX:10,minWidth:50,radius:10}}};class de{static create(t){return new de(null!=t?t:ae)}constructor(t){var e;this.configuration=t,this.componentType="container",this.createComponentView=(e=this.configuration.view,(t,s,i)=>{const{step:o}=s,n=u.svg("g",{class:`sqd-step-container sqd-type-${o.type}`});t.appendChild(n);const r=N.create(n,e.paddingTop,e.label,o.name,"primary"),a=i.createSequenceComponent(n,o.sequence),d=r.width/2,l=Math.max(d-a.view.joinX,0)+e.paddingX,c=Math.max(d-(a.view.width-a.view.joinX),0)+e.paddingX,p=l+a.view.width+c,g=e.paddingTop+e.label.height+a.view.height,f=a.view.joinX+l;u.translate(r.g,f,0),u.translate(a.view.g,l,e.paddingTop+e.label.height);const m=i.getStepIconUrl(),w=U.createRectInput(n,f,0,e.inputSize,e.inputIconSize,m);F.createStraightJoin(n,new h(f,0),e.paddingTop);const v=Y.create(n,[p],g);return{g:n,width:p,height:g,joinX:f,placeholders:null,sequenceComponents:[a],getClientPosition:()=>v.getClientPosition(),resolveClick:t=>!(!v.resolveClick(t)&&!n.contains(t.element))||null,setIsDragging(t){w.setIsHidden(t)},setIsSelected(t){v.setIsSelected(t)},setIsDisabled(t){u.toggleClass(n,t,"sqd-disabled")},hasOutput:()=>a.hasOutput}})}}class le{create(){return{canCreate:()=>!0}}}const ce={gapWidth:100,gapHeight:24,radius:6,iconSize:16};class he{static create(t){return new he(null!=t?t:ce)}constructor(t){this.configuration=t,this.gapSize=new h(this.configuration.gapWidth,this.configuration.gapHeight)}createForGap(t,e,s){return lt.create(t,this.gapSize,n.none,e,s,this.configuration)}createForArea(t,e,s,i,o){return lt.create(t,e,s,i,o,this.configuration)}}const pe=30;class ue{static create(t,e,s,i){const o=u.svg("g",{class:"sqd-root-start-stop"});t.appendChild(o);const r=_.create(o,{sequence:e,depth:0,isInputConnected:!0,isOutputConnected:!0},i),a=r.view,d=a.joinX-15,l=pe+a.height,c=s?18:22,p=ge(s?g.folder:g.play,c);u.translate(p,d,0),o.appendChild(p),u.translate(a.g,0,pe);const f=ge(s?g.folder:g.stop,c);u.translate(f,d,l),o.appendChild(f);let m=null,w=null;if(s){const t=new h(pe,pe);m=i.services.placeholder.createForArea(o,t,n.out,s.sequence,s.index),w=i.services.placeholder.createForArea(o,t,n.out,s.sequence,s.index),u.translate(m.view.g,d,0),u.translate(w.view.g,d,l)}const v=z.createForRoot(o,new h(d+pe,0),i);return new ue(o,a.width,a.height+60,a.joinX,r,m,w,v)}constructor(t,e,s,i,o,n,r,a){this.g=t,this.width=e,this.height=s,this.joinX=i,this.component=o,this.startPlaceholder=n,this.endPlaceholder=r,this.badges=a}destroy(){var t;null===(t=this.g.parentNode)||void 0===t||t.removeChild(this.g)}}function ge(t,e){const s=u.svg("circle",{class:"sqd-root-start-stop-circle",cx:15,cy:15,r:15}),i=u.svg("g");i.appendChild(s);const o=(pe-e)/2,n=g.appendPath(i,"sqd-root-start-stop-icon",t,e);return u.translate(n,o,o),i}class fe{static create(t,e,s,i){const o=ue.create(t,e,s,i);return new fe(o)}constructor(t){this.view=t}resolveClick(t){return this.view.component.resolveClick(t)}findById(t){return this.view.component.findById(t)}getPlaceholders(t){this.view.component.getPlaceholders(t),this.view.startPlaceholder&&this.view.endPlaceholder&&(t.push(this.view.startPlaceholder),t.push(this.view.endPlaceholder))}setIsDragging(t){this.view.component.setIsDragging(t),this.view.startPlaceholder&&this.view.endPlaceholder&&(this.view.startPlaceholder.setIsVisible(t),this.view.endPlaceholder.setIsVisible(t))}updateBadges(t){this.view.badges.update(t),this.view.component.updateBadges(t)}}class me{constructor(){this.create=fe.create}}const we={view:{minContainerWidth:40,paddingX:20,paddingTop:20,connectionHeight:16,inputSize:18,inputIconSize:14,branchNameLabel:{height:22,paddingX:10,minWidth:50,radius:10},nameLabel:{height:22,paddingX:10,minWidth:50,radius:10}}};class ve{static create(t){return new ve(null!=t?t:we)}constructor(t){var e;this.configuration=t,this.componentType="switch",this.createComponentView=(e=this.configuration.view,(t,s,i)=>{const{step:o}=s,n=u.svg("g",{class:`sqd-step-switch sqd-type-${o.type}`});t.appendChild(n);const r=Object.keys(o.branches),a=r.map((t=>i.createSequenceComponent(n,o.branches[t]))),d=r.map((t=>{const s=e.paddingTop+e.nameLabel.height+e.connectionHeight;return N.create(n,s,e.branchNameLabel,t,"secondary")})),l=N.create(n,e.paddingTop,e.nameLabel,o.name,"primary");let c=0;const p=a.map(((t,s)=>{const i=Math.max(d[s].width,e.minContainerWidth)/2,o=Math.max(i-t.view.joinX,0)+e.paddingX,n=Math.max(i-(t.view.width-t.view.joinX),0)+e.paddingX,r=t.view.width+o+n,a=t.view.joinX+o,l=c;return c+=r,{width:r,branchOffsetLeft:o,offsetX:l,joinX:a}})),g=Math.floor(r.length/2),f=p[g];let m=f.offsetX;r.length%2!=0&&(m+=f.joinX);const w=p.reduce(((t,e)=>t+e.width),0),v=Math.max(...a.map((t=>t.view.height))),C=l.width/2+e.paddingX,b=Math.max(C-m,0),q=Math.max(C-(w-m),0),x=b+w+q,y=v+e.paddingTop+e.nameLabel.height+e.branchNameLabel.height+2*e.connectionHeight,S=b+m;u.translate(l.g,S,0);const k=e.paddingTop+e.nameLabel.height+e.branchNameLabel.height+e.connectionHeight;a.forEach(((t,i)=>{const o=p[i],r=b+o.offsetX+o.branchOffsetLeft;if(u.translate(d[i].g,b+o.offsetX+o.joinX,0),u.translate(t.view.g,r,k),t.hasOutput&&s.isOutputConnected){const s=e.paddingTop+e.nameLabel.height+e.branchNameLabel.height+e.connectionHeight+t.view.height,i=y-s-e.connectionHeight;i>0&&F.createStraightJoin(n,new h(b+o.offsetX+o.joinX,s),i)}}));let I=null;if(e.inputSize>0){const t=i.getStepIconUrl();I=U.createRectInput(n,S,0,e.inputSize,e.inputIconSize,t)}if(F.createStraightJoin(n,new h(S,0),e.paddingTop),F.createJoins(n,new h(S,e.paddingTop+e.nameLabel.height),p.map((t=>new h(b+t.offsetX+t.joinX,e.paddingTop+e.nameLabel.height+e.connectionHeight)))),s.isOutputConnected){const t=a.map(((t,e)=>t.hasOutput?e:null)).filter((t=>null!==t)).map((t=>new h(b+p[t].offsetX+p[t].joinX,e.paddingTop+e.connectionHeight+e.nameLabel.height+e.branchNameLabel.height+v)));t.length>0&&F.createJoins(n,new h(S,y),t)}const D=p.map((t=>t.width));D[0]+=b,D[D.length-1]+=q;const E=Y.create(n,D,y);return{g:n,width:x,height:y,joinX:S,placeholders:null,sequenceComponents:a,getClientPosition:()=>E.getClientPosition(),resolveClick:t=>!(!E.resolveClick(t)&&!n.contains(t.element))||null,setIsDragging(t){null==I||I.setIsHidden(t)},setIsSelected(t){E.setIsSelected(t)},setIsDisabled(t){u.toggleClass(n,t,"sqd-disabled")},hasOutput:()=>a.some((t=>t.hasOutput))}})}}const Ce={view:{paddingLeft:12,paddingRight:12,paddingY:10,textMarginLeft:12,minTextWidth:70,iconSize:22,radius:5,inputSize:14,outputSize:10}};class be{static create(t){return new be(null!=t?t:Ce)}constructor(t){this.configuration=t,this.componentType="task",this.createComponentView=K(!1,this.configuration.view)}}class qe{constructor(){this.create=_.create}}class xe{constructor(){this.wrap=t=>t}}class ye{static create(t){const e=u.svg("path",{class:"sqd-line-grid-path",fill:"none"});return new ye(t,e)}constructor(t,e){this.size=t,this.element=e}setScale(t,e){u.attrs(this.element,{d:`M ${e.x} 0 L 0 0 0 ${e.y}`})}}const Se={gridSizeX:48,gridSizeY:48};class ke{static create(t){return new ke(null!=t?t:Se)}constructor(t){this.configuration=t}create(){const t=new h(this.configuration.gridSizeX,this.configuration.gridSizeY);return ye.create(t)}}class Ie{static resolve(t,e){const s={};return function(t,e){for(const s of e)s.steps&&(t.steps=(t.steps||[]).concat(s.steps)),s.stepComponentViewWrapper&&(t.stepComponentViewWrapper=s.stepComponentViewWrapper),s.badges&&(t.badges=(t.badges||[]).concat(s.badges)),s.uiComponents&&(t.uiComponents=(t.uiComponents||[]).concat(s.uiComponents)),s.draggedComponent&&(t.draggedComponent=s.draggedComponent),s.wheelController&&(t.wheelController=s.wheelController),s.placeholderController&&(t.placeholderController=s.placeholderController),s.placeholder&&(t.placeholder=s.placeholder),s.viewportController&&(t.viewportController=s.viewportController),s.grid&&(t.grid=s.grid),s.rootComponent&&(t.rootComponent=s.rootComponent),s.sequenceComponent&&(t.sequenceComponent=s.sequenceComponent),s.daemons&&(t.daemons=(t.daemons||[]).concat(s.daemons))}(s,t||[]),function(t,e){t.steps||(t.steps=[]),t.steps.push(de.create()),t.steps.push(ve.create()),t.steps.push(be.create()),t.stepComponentViewWrapper||(t.stepComponentViewWrapper=new xe),t.badges||(t.badges=[]),Pt(t.badges)<0&&t.badges.push(W.create()),t.draggedComponent||(t.draggedComponent=new Ot),t.uiComponents||(t.uiComponents=[]),e.controlBar&&t.uiComponents.push(new $t),e.editors&&t.uiComponents.push(new Jt(e.editors)),e.toolbox&&t.uiComponents.push(new re),t.wheelController||(t.wheelController=new ot),t.placeholderController||(t.placeholderController=new le),t.placeholder||(t.placeholder=he.create()),t.viewportController||(t.viewportController=new at),t.grid||(t.grid=ke.create()),t.rootComponent||(t.rootComponent=new me),t.sequenceComponent||(t.sequenceComponent=new qe),t.daemons||(t.daemons=[]),t.daemons.push(new Yt)}(s,e),s}}function De(t,e){throw new Error(`The "${t}" property in the "${e}" configuration is depreciated`)}class Ee{static create(t,e,s){if(!t)throw new Error("Placeholder is not set");if(i=t,document.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_DISCONNECTED)throw new Error("Placeholder is not attached to the DOM");var i;if(!e)throw new Error("Start definition is not set");if(!s)throw new Error("Configuration is not set");const o=s;!function(t){if(void 0===t.controlBar)throw new Error('The "controlBar" property is not defined in the configuration');t.toolbox&&void 0!==t.toolbox.isHidden&&De("isHidden","toolbox"),t.editors&&void 0!==t.editors.isHidden&&De("isHidden","editors"),t.steps.validator&&De("validator","steps")}(o);const n=Ie.resolve(s.extensions,o),r=qt.create(t,e,o,n),a=D.create(r),d=Ht.create(t,r,a),l=new Ee(d,r.state,r.definitionWalker,a);return d.workspace.onReady.subscribe((()=>l.onReady.forward())),r.state.onDefinitionChanged.subscribe((()=>{setTimeout((()=>l.onDefinitionChanged.forward(r.state.definition)))})),r.state.onSelectedStepIdChanged.subscribe((()=>l.onSelectedStepIdChanged.forward(r.state.selectedStepId))),l.state.onIsToolboxCollapsedChanged.subscribe((t=>{l.onIsToolboxCollapsedChanged.forward(t)})),l.state.onIsEditorCollapsedChanged.subscribe((t=>{l.onIsEditorCollapsedChanged.forward(t)})),l}constructor(t,e,s,i){this.view=t,this.state=e,this.walker=s,this.api=i,this.onReady=new c,this.onDefinitionChanged=new c,this.onSelectedStepIdChanged=new c,this.onIsToolboxCollapsedChanged=new c,this.onIsEditorCollapsedChanged=new c}getDefinition(){return this.state.definition}isValid(){return this.view.workspace.isValid}isReadonly(){return this.state.isReadonly}setIsReadonly(t){this.state.setIsReadonly(t)}getSelectedStepId(){return this.state.selectedStepId}selectStepById(t){this.state.setSelectedStepId(t)}clearSelectedStep(){this.state.setSelectedStepId(null)}moveViewportToStep(t){this.api.viewport.moveViewportToStep(t)}moveViewPortToStep(t){this.moveViewportToStep(t)}updateRootComponent(){this.api.workspace.updateRootComponent()}updateBadges(){this.api.workspace.updateBadges()}isToolboxCollapsed(){return this.state.isToolboxCollapsed}setIsToolboxCollapsed(t){this.state.setIsToolboxCollapsed(t)}isEditorCollapsed(){return this.state.isEditorCollapsed}setIsEditorCollapsed(t){this.state.setIsEditorCollapsed(t)}getStepParents(t){return this.walker.getParents(this.state.definition,t)}destroy(){this.view.destroy()}}class Me{static create(t){const e=[];return t.container&&e.push(de.create(t.container)),t.switch&&e.push(ve.create(t.switch)),t.task&&e.push(be.create(t.task)),new Me(e)}constructor(t){this.steps=t}}var ze;!function(t){t[t.loading=1]="loading",t[t.loaded=2]="loaded",t[t.error=3]="error"}(ze||(ze={}));class Be{}Be.plus="M21.712 43.8V25.987H3.9v-4.275h17.812V3.9h4.275v17.813H43.8v4.274H25.987V43.8h-4.275z",Be.done="M18.137 38.6 4.3 24.763l3.794-3.794 10.043 10.043 21.369-21.37 3.794 3.795L18.137 38.6z",Be.loading="M24 8c7.83 0 14.51 5.67 15.78 13.4a3.057 3.057 0 0 0 2.98 2.6c.88 0 1.72-.39 2.29-1.06.58-.68.82-1.57.67-2.44C44 9.84 34.8 2 24 2 13.2 2 4 9.84 2.28 20.5c-.15.87.1 1.76.67 2.44.57.67 1.41 1.06 2.29 1.06a3.057 3.057 0 0 0 2.98-2.6C9.49 13.67 16.17 8 24 8zm0 0",Be.error="M24.045 43.071q-1.549 0-2.647-1.103-1.098-1.102-1.098-2.651 0-1.55 1.103-2.647 1.103-1.099 2.652-1.099 1.549 0 2.647 1.103 1.098 1.103 1.098 2.652 0 1.549-1.103 2.647-1.103 1.098-2.652 1.098zM20.3 30.214V4.5h7.5v25.714h-7.5z";class Pe{static create(t,e,s,i,o){const r=u.svg("g");t.appendChild(r);const a=e,d=s/2-a/2,l=u.svg("g",{class:"sqd-clickable-placeholder"});u.translate(l,0,d),r.appendChild(l);const c=u.svg("rect",{class:"sqd-clickable-placeholder-rect",width:a,height:a,rx:i,ry:i});l.appendChild(c);const h=g.appendPath(l,"sqd-clickable-placeholder-icon",Be.plus,o),p=(a-o)/2;u.translate(h,p,p);const f=G.create(r,a,a,i,0,n.none);return u.translate(f.g,0,d),new Pe(f,l,r)}constructor(t,e,s){this.rectPlaceholderView=t,this.plusG=e,this.g=s}resolveClick(t){return this.plusG.contains(t.element)}setIsHover(t){this.rectPlaceholderView.setIsHover(t)}setIsVisible(t){this.rectPlaceholderView.setIsVisible(t)}}class Te{static create(t,e,s,i,o){const n=Pe.create(t,e.x,e.y,o.rectRadius,o.iconSize);return new Te(n,s,i)}constructor(t,e,s){this.view=t,this.parentSequence=e,this.index=s}getClientRect(){return this.view.rectPlaceholderView.rect.getBoundingClientRect()}setIsHover(t){this.view.setIsHover(t)}setIsVisible(t){this.view.setIsVisible(t)}resolveClick(t){if(this.view.resolveClick(t)){const t={type:"clickablePlaceholderClicked",index:this.index};return{type:o.triggerCustomAction,action:t,step:null,sequence:this.parentSequence}}return null}}const Re={gapWidth:24,gapHeight:88,iconSize:16,rectRadius:6};class Le{static create(t){return new Le(null!=t?t:Re)}constructor(t){this.configuration=t,this.gapSize=new h(this.configuration.gapWidth,this.configuration.gapHeight)}createForGap(t,e,s){return Te.create(t,this.gapSize,e,s,this.configuration)}createForArea(t,e,s,i,o){const n={gapHeight:this.configuration.gapWidth,gapWidth:this.configuration.gapHeight,radius:this.configuration.rectRadius,iconSize:this.configuration.iconSize};return lt.create(t,e,s,i,o,n)}}class Ve{static create(t){const e=Le.create(t);return new Ve(e)}constructor(t){this.placeholder=t}}class He{static create(t,e,s){const i=s.create(e);return t.appendChild(i.element),new He(i.width,i.height,i.destroy)}constructor(t,e,s){this.width=t,this.height=e,this.destroyHandler=s}destroy(){this.destroyHandler&&this.destroyHandler()}}class Ae{constructor(t){this.configuration=t}create(t,e){return He.create(t,e,this.configuration)}}class Oe{static create(t){const e=new Ae(t);return new Oe(e)}constructor(t){this.draggedComponent=t}}class Ze{static create(t){return new Ze(t.steps)}constructor(t){this.steps=t}}class We{static create(t){const e=u.svg("circle",{class:"sqd-grid-dot"}),s=new h(t.gridSizeX,t.gridSizeY);return new We(s,e,t.dotR)}constructor(t,e,s){this.size=t,this.element=e,this.r=s}setScale(t){const e=this.r*t;u.attrs(this.element,{r:e,cx:e/2+.5,cy:e/2+.5})}}const Ue={gridSizeX:16,gridSizeY:16,dotR:1};class Fe{static create(t){return new Fe(null!=t?t:Ue)}constructor(t){this.configuration=t}create(){return We.create(this.configuration)}}class $e{static create(t){const e=Fe.create(t);return new $e(e)}constructor(t){this.grid=t}}class Xe{static create(t){return new Xe(t)}constructor(t){this.stepComponentViewWrapper=t}}class Ne{static create(t){const e=u.svg("g");for(let t=0;t<2;t++)for(let s=0;s<3;s++){const i=u.svg("circle",{class:"sqd-handle-circle",r:1,cx:4*t,cy:5*s});e.appendChild(i)}return t.appendChild(e),new Ne(e,4,10)}constructor(t,e,s){this.g=t,this.width=e,this.height=s}}const je=K(!1,{paddingLeft:12,paddingRight:24,paddingY:12,textMarginLeft:12,minTextWidth:100,iconSize:22,radius:2,inputSize:10,outputSize:10}),Ye={componentType:"task",createComponentView(t,e,s){const i=je(t,e,s),o=Ne.create(i.g);return u.translate(o.g,i.width-o.width-12,(i.height-o.height)/2),i}},Qe=t=>{const e=function(t){switch(t){case"task":case"largeTask":return{styleName:"atomic",svg:'<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 96 960 960" width="48"><path fill="#FFF" d="M480 976 317 813l44-44 89 89V606H198l84 84-44 44L80 576l159-159 44 44-85 85h252V294l-84 84-44-44 158-158 158 158-44 44-84-84v252h252l-84-84 44-44 158 158-158 158-44-44 84-84H510v252l89-89 44 44-163 163Z"/></svg>'};case"switch":return{styleName:"conditional",svg:'<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 96 960 960" width="48"><path fill="#5EC169" d="M450 976V776q0-48-16-79t-49-64l43-43q13 11 27.5 30t24.5 35q17-26 33.5-45t31.5-32q58-47 83.5-113.5T648 290l-90 90-42-42 162-162 162 162-42 42-90-90q5 126-24.5 198.5T585 624q-44 40-59.5 73T510 776v200h-60ZM258 420q-4-18-6.5-52.5T251 291l-89 89-42-42 162-162 162 162-42 42-90-90q-2 38-1 66.5t5 49.5l-58 14Zm84 171q-17-18-37.5-47.5T273 479l59-15q9 25 24 48t28 37l-42 42Z"/></svg>'}}throw new Error(`Unknown component type: ${t}`)}(t.componentType),s=document.createElement("div");return s.style.width="48px",s.style.height="48px",s.className=`sqd-custom-dragged-component sqd-style-${e.styleName}`,s.innerHTML=e.svg,{element:s,width:48,height:48}};class Ge{static create(t){return new Ge(t)}constructor(t){this.configuration=t}wrap(t,e){return this.configuration.controller.isVisible&&this.configuration.componentTypes.includes(e.step.componentType)?function(t,e,s){const i=u.svg("g");t.g.insertBefore(i,t.g.firstChild);const o=s(e.step),n=Math.floor(t.width/100),r=Math.ceil(o.length/n),a=20+46*r+8*(r-1),d=(t.width-20-8*(n-1))/n,l=u.svg("rect",{class:"sqd-statistics-rect",width:t.width,height:a+20,y:t.height-20,rx:2,ry:2});i.appendChild(l);for(let e=0;e<o.length;e++){const s=o[e],r=e%n,a=Math.floor(e/n),l=10+d*r+8*r,c=t.height+10+54*a,h=u.svg("rect",{class:"sqd-statistics-item-rect",width:d,height:46,rx:2,ry:2,x:l,y:c}),p=u.svg("rect",{class:"sqd-statistics-item-border",fill:s.color,width:10,height:46,rx:2,ry:2,x:l,y:c}),g=l+10+10,f=u.svg("text",{class:"sqd-statistics-item-value-text",x:g,y:c+20});f.textContent=s.value;const m=u.svg("text",{class:"sqd-statistics-item-description-text",x:g,y:c+36});m.textContent=s.description,i.appendChild(h),i.appendChild(p),i.appendChild(f),i.appendChild(m)}return Object.assign(Object.assign({},t),{height:t.height+a})}(t,e,this.configuration.dataProvider):t}}class Je{constructor(t){this.isVisible=t}toggleIsVisible(){this.isVisible=!this.isVisible}}Je.create=(t=!1)=>new Je(t);const _e=(ts={textMarginLeft:16,minTextWidth:200,nameY:24,descriptionY:48,paddingLeft:12,paddingRight:24,paddingY:12,circleSize:48,iconSize:26,inputSize:10,outputSize:10,radius:2},es=t=>`Step type: ${t.type}`,(t,e,s)=>{const i=u.svg("g",{class:`sqd-step-large-task sqd-type-${e.step.type}`});t.appendChild(i);const o=ts.paddingLeft+ts.circleSize+ts.textMarginLeft,n=u.svg("text",{class:"sqd-large-task-name-text",x:o,y:ts.nameY});n.textContent=e.step.name,i.appendChild(n);const r=n.getBBox(),a=u.svg("text",{class:"sqd-large-task-description-text",x:o,y:ts.descriptionY});a.textContent=es(e.step),i.appendChild(a);const d=a.getBBox(),l=u.svg("circle",{class:"sqd-large-task-circle",cx:ts.paddingLeft+ts.circleSize/2,cy:ts.paddingY+ts.circleSize/2,r:ts.circleSize/2});i.appendChild(l);const c=Math.max(r.width,d.width,ts.minTextWidth),p=ts.circleSize+c+ts.paddingLeft+ts.paddingRight+ts.textMarginLeft,g=ts.circleSize+2*ts.paddingY,f=s.getStepIconUrl();if(f){const t=u.svg("image",{href:f,width:ts.iconSize,height:ts.iconSize,x:ts.paddingLeft+ts.circleSize/2-ts.iconSize/2,y:ts.paddingY+ts.circleSize/2-ts.iconSize/2});i.appendChild(t)}const m=0!==e.depth||0!==e.position||e.isInputConnected?U.createRoundInput(i,p/2,0,ts.inputSize):null,w=j.create(i,p/2,g,ts.outputSize),v=u.svg("rect",{class:"sqd-large-task-rect",x:.5,y:.5,width:p,height:g,rx:ts.radius,ry:ts.radius});return i.insertBefore(v,n),{g:i,width:p,height:g,joinX:p/2,placeholders:null,sequenceComponents:null,resolveClick(t){return!!this.g.contains(t.element)||null},setIsSelected(t){u.toggleClass(v,t,"sqd-selected")},setIsDisabled(t){u.toggleClass(i,t,"sqd-disabled")},getClientPosition(){const t=i.getBoundingClientRect();return new h(t.x,t.y)},setIsDragging(t){null==m||m.setIsHidden(t),null==w||w.setIsHidden(t)},hasOutput:()=>!0}}),Ke={componentType:"largeTask",createComponentView(t,e,s){const i=_e(t,e,s),o=Ne.create(i.g);return u.translate(o.g,i.width-o.width-12,(i.height-o.height)/2),i}};var ts,es,ss=s(379),is=s.n(ss),os=s(795),ns=s.n(os),rs=s(569),as=s.n(rs),ds=s(565),ls=s.n(ds),cs=s(216),hs=s.n(cs),ps=s(589),us=s.n(ps),gs=s(375),fs={};fs.styleTagTransform=us(),fs.setAttributes=ls(),fs.insert=as().bind(null,"head"),fs.domAPI=ns(),fs.insertStyleElement=hs(),is()(gs.Z,fs),gs.Z&&gs.Z.locals&&gs.Z.locals;var ms=s(344),ws={};ws.styleTagTransform=us(),ws.setAttributes=ls(),ws.insert=as().bind(null,"head"),ws.domAPI=ns(),ws.insertStyleElement=hs(),is()(ms.Z,ws),ms.Z&&ms.Z.locals&&ms.Z.locals;var vs=s(883),Cs={};Cs.styleTagTransform=us(),Cs.setAttributes=ls(),Cs.insert=as().bind(null,"head"),Cs.domAPI=ns(),Cs.insertStyleElement=hs(),is()(vs.Z,Cs),vs.Z&&vs.Z.locals&&vs.Z.locals;var bs=s(75),qs={};function xs(t){return{id:m.next(),componentType:"task",name:t,properties:{},type:"task"}}function ys(){return{id:m.next(),componentType:"largeTask",name:"Large task",properties:{},type:"task"}}function Ss(t,e){return{id:m.next(),branches:{true:t,false:e},componentType:"switch",name:"If",properties:{},type:"if"}}function ks(t,e,s,i){if("clickablePlaceholderClicked"===t.type){const e=t,o=document.getElementById("toolboxChoice"),n=[...o.getElementsByTagName("button")];o.classList.remove("hidden");const r=()=>{o.classList.add("hidden"),n.forEach((t=>t.removeEventListener("click",a,!1)))},a=t=>{const o=t.target.getAttribute("data-type");if("cancel"!==o){const t=function(t){switch(t){case"if":return Ss([],[]);case"task":return xs("Task");case"largeTask":return ys()}throw new Error(`Unknown type: ${t}`)}(o);s.splice(e.index,0,t),i.notifyStepInserted(t.id)}r()};n.forEach((t=>t.addEventListener("click",a,!1)))}}qs.styleTagTransform=us(),qs.setAttributes=ls(),qs.insert=as().bind(null,"head"),qs.domAPI=ns(),qs.insertStyleElement=hs(),is()(bs.Z,qs),bs.Z&&bs.Z.locals&&bs.Z.locals;const Is=["#afe5ed","#afcaed","#ceafed","#edc6af","#ede0af","#d5edaf"],Ds=["Reads","Writes","Sends","Errors","Warnings","Files"];function Es(){return Array(Math.round(5*Math.random())+1).fill(null).map(((t,e)=>({value:(1e3*Math.random()).toFixed(0),color:Is[e],description:Ds[e]})))}document.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("designer"),e={properties:{},sequence:[ys(),xs("Send e-mail"),Ss([],[xs("Save file")])]},s=Je.create(),i={theme:"flat",editors:!1,toolbox:!1,controlBar:!0,steps:{iconUrlProvider:()=>"./assets/icon-task.svg"},customActionHandler:ks,extensions:[Ve.create({gapHeight:70,gapWidth:22,iconSize:16,rectRadius:2}),Oe.create({create:Qe}),Ze.create({steps:[Ye,Ke]}),$e.create(),Me.create({switch:{view:{minContainerWidth:40,paddingX:20,paddingTop:5,connectionHeight:20,inputSize:0,inputIconSize:0,nameLabel:{height:47,paddingX:10,minWidth:80,radius:2},branchNameLabel:{height:26,paddingX:10,minWidth:60,radius:2}}}}),Xe.create(Ge.create({controller:s,componentTypes:["task","largeTask"],dataProvider:Es}))]},o=Ee.create(t,e,i);document.getElementById("toggleStatisticsButton").addEventListener("click",(()=>{s.toggleIsVisible(),o.updateRootComponent()}),!1)}),!1)})()})();